var _code='function JSNetwork(){};var CONDITION_PERIOD={MINUTE_ID:101,MULTIDAY_MINUTE_ID:102,HISTORY_MINUTE_ID:103,KLINE_DAY_ID:0,KLINE_WEEK_ID:1,KLINE_TWOWEEK_ID:21,KLINE_MONTH_ID:2,KLINE_QUARTER_ID:9,KLINE_YEAR_ID:3,KLINE_MINUTE_ID:4,KLINE_5_MINUTE_ID:5,KLINE_15_MINUTE_ID:6,KLINE_30_MINUTE_ID:7,KLINE_60_MINUTE_ID:8};function CustomIndexScript(){this.DataMap=new Map,this.Get=function(n){return this.DataMap.has(n)?this.DataMap.get(n):null},this.Add=function(n){this.DataMap.set(n.ID,n)}}var g_CustomIndex=new CustomIndexScript;function JSIndexScript(){this.DataMap=new Map([["MA",this.MA],["均线",this.MA],["MA4",this.MA4],["MA5",this.MA5],["MA6",this.MA6],["MA7",this.MA7],["MA8",this.MA8],["BOLL",this.BOLL],["BOLL副图",this.BOLL2],["BBI",this.BBI],["DKX",this.DKX],["MIKE",this.MIKE],["PBX",this.PBX],["ENE",this.ENE],["MACD",this.MACD],["KDJ",this.KDJ],["MACD2",this.MACD2],["VOL",this.VOL],["RSI",this.RSI],["BRAR",this.BRAR],["WR",this.WR],["BIAS",this.BIAS],["OBV",this.OBV],["DMI",this.DMI],["CR",this.CR],["PSY",this.PSY],["CCI",this.CCI],["DMA",this.DMA],["TRIX",this.TRIX],["VR",this.VR],["EMV",this.EMV],["ROC",this.ROC],["MTM",this.MTM],["FSL",this.FSL],["CYR",this.CYR],["MASS",this.MASS],["WAD",this.WAD],["CHO",this.CHO],["ADTM",this.ADTM],["HSL",this.HSL],["BIAS36",this.BIAS36],["BIAS_QL",this.BIAS_QL],["DPO",this.DPO],["OSC",this.OSC],["ATR",this.ATR],["NVI",this.NVI],["PVI",this.PVI],["UOS",this.UOS],["CYW",this.CYW],["LON",this.LON],["NDB",this.NDB],["SKDJ",this.SKDJ],["KD",this.KD],["FKX",this.FKX],["DKCOL",this.DKCOL],["UDL",this.UDL],["MFI",this.MFI],["LWR",this.LWR],["MARSI",this.MARSI],["CYD",this.CYD],["CYF",this.CYF],["TAPI",this.TAPI],["VMACD",this.VMACD],["QACD",this.QACD],["VPT",this.VPT],["WVAD",this.WVAD],["DBQR",this.DBQR],["JS",this.JS],["CYE",this.CYE],["QR",this.QR],["GDX",this.GDX],["JLHB",this.JLHB],["PCNT",this.PCNT],["BTX",this.BTX],["AMO",this.AMO],["VRSI",this.VRSI],["HSCOL",this.HSCOL],["DBQRV",this.DBQRV],["DBLB",this.DBLB],["ACD",this.ACD],["EXPMA",this.EXPMA],["EXPMA_S",this.EXPMA_S],["HMA",this.HMA],["LMA",this.LMA],["VMA",this.VMA],["AMV",this.AMV],["BBIBOLL",this.BBIBOLL],["ALLIGAT",this.ALLIGAT],["ZX",this.ZX],["XS",this.XS],["XS2",this.XS2],["SG-XDT",this.SG_XDT],["SG-SMX",this.SG_SMX],["SG-LB",this.SG_LB],["SG-PF",this.SG_PF],["RAD",this.RAD],["SHT",this.SHT],["ZLJC",this.ZLJC],["ZLMM",this.ZLMM],["SLZT",this.SLZT],["ADVOL",this.ADVOL],["CYC",this.CYC],["CYS",this.CYS],["CYQKL",this.CYQKL],["SCR",this.SCR],["ASR",this.ASR],["SAR",this.SAR],["TJCJL",this.TJCJL],["量比",this.VOLRate],["平均K线",this.HeikinAshi],["ADL",this.ADL],["SQJZ",this.SQJZ],["XT",this.XT],["CFJT",this.CFJT],["CYX",this.CYX],["WAVE",this.WAVE],["VOL-TDX",this.VOL_TDX],["EMPTY",this.EMPTY],["CJL2",this.CJL],["ASI",this.ASI],["DC",this.DC],["DEMA",this.DEMA],["VWAP",this.VWAP],["飞龙四式",this.Dragon4_Main],["飞龙四式-附图",this.Dragon4_Fig],["资金分析",this.FundsAnalysis],["融资占比",this.MarginProportion],["负面新闻",this.NewsNegative],["涨跌趋势",this.UpDownAnalyze],["北上资金",this.HK2SHSZ],["股东人数",this.ShareHolder],["两融余额",this.Margin2],["两融余额2",this.Margin3],["Zealink-资金吸筹",this.Zealink_Index1],["Zealink-牛熊区间",this.Zealink_Index2],["Zealink-持仓信号",this.Zealink_Index3],["Zealink-增减持",this.Zealink_Index4],["Zealink-大宗交易",this.Zealink_Index5],["Zealink-信托持股",this.Zealink_Index6],["Zealink-官网新闻",this.Zealink_Index7],["Zealink-高管要闻",this.Zealink_Index8],["Zealink-股权质押",this.Zealink_Index9],["Zealink-操盘BS点",this.Zealink_Index10],["Zealink-操盘BS点2",this.Zealink_Index11],["放心股-操盘BS点",this.FXG_BSPoint],["放心股-涨停多空线",this.FXG_INDEX],["放心股-涨停吸筹区",this.FXG_INDEX2],["放心股-量能黄金点",this.FXG_INDEX3],["五彩K线-十字星",this.COLOR_KSTAR1],["五彩K线-早晨之星",this.COLOR_KSTAR2],["五彩K线-黄昏之星",this.COLOR_KSTAR3],["五彩K线-长十字",this.COLOR_SHI1],["五彩K线-身怀六甲",this.COLOR_K220],["五彩K线-三个白武士",this.COLOR_K300],["五彩K线-三只乌鸦",this.COLOR_K310],["五彩K线-光头阳线",this.COLOR_K380],["五彩K线-光脚阴线",this.COLOR_K390],["五彩K线-垂死十字",this.COLOR_K134],["五彩K线-早晨十字星",this.COLOR_K140],["五彩K线-黄昏十字星",this.COLOR_K150],["五彩K线-射击之星",this.COLOR_K160],["五彩K线-倒转锤头",this.COLOR_K165],["五彩K线-锤头",this.COLOR_K170],["五彩K线-吊颈",this.COLOR_K180],["五彩K线-穿头破脚",this.COLOR_K190],["五彩K线-出水芙蓉",this.COLOR_CSFR],["五彩K线-乌云盖顶",this.COLOR_WYGD],["五彩K线-曙光初现",this.COLOR_SGCJ],["五彩K线-十字胎",this.COLOR_SZTAI],["五彩K线-剑",this.COLOR_SWORD],["五彩K线-平顶",this.COLOR_PINGDING],["五彩K线-平底",this.COLOR_PINGDI],["五彩K线-大阳烛",this.COLOR_DAYANZHU],["五彩K线-大阴烛",this.COLOR_DAYINGZHU],["五彩K线-好友反攻",this.COLOR_HYFG],["五彩K线-跳空缺口",this.COLOR_TKQK],["五彩K线-双飞乌鸦",this.COLOR_SFWY],["五彩K线-上升三部曲",this.COLOR_SSSBQ],["五彩K线-下跌三部曲",this.COLOR_XDSBQ],["五彩K线-长下影",this.COLOR_CHXY],["五彩K线-长上影",this.COLOR_CHSY],["五彩K线-分离",this.COLOR_FENLI],["交易系统-BIAS",this.TRADE_BIAS],["交易系统-CCI",this.TRADE_CCI],["交易系统-DMI",this.TRADE_DMI],["交易系统-KD",this.TRADE_KD],["交易系统-BOLL",this.TRADE_BOLL],["交易系统-KDJ",this.TRADE_KDJ],["交易系统-MA",this.TRADE_MA],["交易系统-MACD",this.TRADE_MACD],["交易系统-MTM",this.TRADE_MTM],["交易系统-PSY",this.TRADE_PSY],["交易系统-ROC",this.TRADE_ROC],["交易系统-RSI",this.TRADE_RSI],["交易系统-VR",this.TRADE_VR],["交易系统-DPSJ",this.TRADE_DPSJ],["TEST",this.TEST]])}JSIndexScript.AddIndex=function(n){for(var S in n)g_CustomIndex.Add(n[S])},JSIndexScript.prototype.Get=function(n){var S=g_CustomIndex.Get(n);if(S)return S;var A=this.DataMap.get(n);return A?A():null},JSIndexScript.prototype.Search=function(n){var S=[],A=new RegExp(n,"i");return this.DataMap.forEach(function(n,E){0!=E.indexOf("交易系统-")&&0!=E.indexOf("五彩K线-")&&E.search(A)>=0&&S.push(E)}),S},JSIndexScript.prototype.MA=function(){return{Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"}],Script:"MA1:MA(CLOSE,M1);MA2:MA(CLOSE,M2);MA3:MA(CLOSE,M3);"}},JSIndexScript.prototype.MA4=function(){return{Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"}],Script:"MA1:MA(CLOSE,M1);MA2:MA(CLOSE,M2);MA3:MA(CLOSE,M3);MA4:MA(CLOSE,M4);"}},JSIndexScript.prototype.MA5=function(){return{Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"}],Script:"MA1:MA(CLOSE,M1);MA2:MA(CLOSE,M2);MA3:MA(CLOSE,M3);MA4:MA(CLOSE,M4);MA5:MA(CLOSE,M5);"}},JSIndexScript.prototype.MA6=function(){return{Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"}],Script:"MA1:MA(CLOSE,M1);MA2:MA(CLOSE,M2);MA3:MA(CLOSE,M3);MA4:MA(CLOSE,M4);MA5:MA(CLOSE,M5);MA6:MA(CLOSE,M6);"}},JSIndexScript.prototype.MA7=function(){return{Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"},{Name:"MA7",DynamicName:"MA{M7}"}],Script:"MA1:MA(CLOSE,M1);MA2:MA(CLOSE,M2);MA3:MA(CLOSE,M3);MA4:MA(CLOSE,M4);MA5:MA(CLOSE,M5);MA6:MA(CLOSE,M6);MA7:MA(CLOSE,M7);"}},JSIndexScript.prototype.MA8=function(){return{Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0},{Name:"M8",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"},{Name:"MA7",DynamicName:"MA{M7}"},{Name:"MA8",DynamicName:"MA{M8}"}],Script:"MA1:MA(CLOSE,M1);MA2:MA(CLOSE,M2);MA3:MA(CLOSE,M3);MA4:MA(CLOSE,M4);MA5:MA(CLOSE,M5);MA6:MA(CLOSE,M6);MA7:MA(CLOSE,M7);MA8:MA(CLOSE,M8);"}},JSIndexScript.prototype.BOLL=function(){return{Name:"BOLL",Description:"布林线",IsMainIndex:!0,Args:[{Name:"M",Value:20}],Script:"BOLL:MA(CLOSE,M);UB:BOLL+2*STD(CLOSE,M);LB:BOLL-2*STD(CLOSE,M);"}},JSIndexScript.prototype.BOLL2=function(){return{Name:"BOLL2",Description:"布林线",IsMainIndex:!1,KLineType:0,Args:[{Name:"M",Value:20}],Script:"BOLL:MA(CLOSE,M);UB:BOLL+2*STD(CLOSE,M);LB:BOLL-2*STD(CLOSE,M);"}},JSIndexScript.prototype.BBI=function(){return{Name:"BBI",Description:"多空均线",IsMainIndex:!0,Args:[{Name:"M1",Value:3},{Name:"M2",Value:6},{Name:"M3",Value:12},{Name:"M4",Value:24}],Script:"BBI:(MA(CLOSE,M1)+MA(CLOSE,M2)+MA(CLOSE,M3)+MA(CLOSE,M4))/4;"}},JSIndexScript.prototype.DKX=function(){return{Name:"DKX",Description:"多空线",IsMainIndex:!1,Args:[{Name:"M",Value:10}],Script:"MID:=(3*CLOSE+LOW+OPEN+HIGH)/6;DKX:(20*MID+19*REF(MID,1)+18*REF(MID,2)+17*REF(MID,3)+16*REF(MID,4)+15*REF(MID,5)+14*REF(MID,6)+13*REF(MID,7)+12*REF(MID,8)+11*REF(MID,9)+10*REF(MID,10)+9*REF(MID,11)+8*REF(MID,12)+7*REF(MID,13)+6*REF(MID,14)+5*REF(MID,15)+4*REF(MID,16)+3*REF(MID,17)+2*REF(MID,18)+REF(MID,20))/210;MADKX:MA(DKX,M);"}},JSIndexScript.prototype.MIKE=function(){return{Name:"MIKE",Description:"麦克支撑压力",IsMainIndex:!0,Args:[{Name:"N",Value:10}],Script:"HLC:=REF(MA((HIGH+LOW+CLOSE)/3,N),1);HV:=EMA(HHV(HIGH,N),3);LV:=EMA(LLV(LOW,N),3);STOR:EMA(2*HV-LV,3);MIDR:EMA(HLC+HV-LV,3);WEKR:EMA(HLC*2-LV,3);WEKS:EMA(HLC*2-HV,3);MIDS:EMA(HLC-HV+LV,3);STOS:EMA(2*LV-HV,3);"}},JSIndexScript.prototype.PBX=function(){return{Name:"PBX",Description:"瀑布线",IsMainIndex:!0,Args:[{Name:"M1",Value:4},{Name:"M2",Value:6},{Name:"M3",Value:9},{Name:"M4",Value:13},{Name:"M5",Value:18},{Name:"M6",Value:24}],Script:"PBX1:(EMA(CLOSE,M1)+MA(CLOSE,M1*2)+MA(CLOSE,M1*4))/3;PBX2:(EMA(CLOSE,M2)+MA(CLOSE,M2*2)+MA(CLOSE,M2*4))/3;PBX3:(EMA(CLOSE,M3)+MA(CLOSE,M3*2)+MA(CLOSE,M3*4))/3;PBX4:(EMA(CLOSE,M4)+MA(CLOSE,M4*2)+MA(CLOSE,M4*4))/3;PBX5:(EMA(CLOSE,M5)+MA(CLOSE,M5*2)+MA(CLOSE,M5*4))/3;PBX6:(EMA(CLOSE,M6)+MA(CLOSE,M6*2)+MA(CLOSE,M6*4))/3;"}},JSIndexScript.prototype.ENE=function(){return{Name:"ENE",Description:"轨道线",IsMainIndex:!0,Args:[{Name:"N",Value:25},{Name:"M1",Value:6},{Name:"M2",Value:6}],Script:"UPPER:(1+M1/100)*MA(CLOSE,N);LOWER:(1-M2/100)*MA(CLOSE,N);ENE:(UPPER+LOWER)/2;"}},JSIndexScript.prototype.MACD=function(){return{Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:"DIF:EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);DEA:EMA(DIF,MID);MACD:(DIF-DEA)*2,COLORSTICK;"}},JSIndexScript.prototype.MACD2=function(){return{Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:"DIF2:=EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);DEA2:=EMA(DIF2,MID);MACD:(DIF2-DEA2)*2,COLORSTICK,LINETHICK50;DIF:DIF2;DEA:DEA2;"}},JSIndexScript.prototype.KDJ=function(){return{Name:"KDJ",Description:"随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;K:SMA(RSV,M1,1);D:SMA(K,M2,1);J:3*K-2*D;"}},JSIndexScript.prototype.VOL=function(){return{Name:"VOL",Description:"成交量",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"}],Script:"VOL:VOL,VOLSTICK;VMA1:MA(VOL,M1);VMA2:MA(VOL,M2);"}},JSIndexScript.prototype.VOL_TDX=function(){return{Name:"VOL-TDX",Description:"成交量(虚拟)",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:"TOTAL:=IF(PERIOD=1,5,IF(PERIOD=2,15,IF(PERIOD=3,30,IF(PERIOD=4,60,IF(PERIOD=5,TOTALFZNUM,1)))));MTIME:=MOD(FROMOPEN,TOTAL);CTIME:=IF(MTIME<0.5,TOTAL,MTIME);VVOL:IF((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VOL*(TOTAL+3)/(CTIME+3),DRAWNULL),NODRAW;STICKLINE((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VVOL,0,-1,-1),COLORYELLOW;VOLUME:VOL,VOLSTICK;MAVOL1:MA(VOLUME,M1);MAVOL2:MA(VOLUME,M2);"}},JSIndexScript.prototype.RSI=function(){return{Name:"RSI",Description:"相对强弱指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:"LC:=REF(CLOSE,1);RSI1:SMA(MAX(CLOSE-LC,0),N1,1)/SMA(ABS(CLOSE-LC),N1,1)*100;RSI2:SMA(MAX(CLOSE-LC,0),N2,1)/SMA(ABS(CLOSE-LC),N2,1)*100;RSI3:SMA(MAX(CLOSE-LC,0),N3,1)/SMA(ABS(CLOSE-LC),N3,1)*100;"}},JSIndexScript.prototype.BRAR=function(){return{Name:"BRAR",Description:"情绪指标",IsMainIndex:!1,Args:[{Name:"N",Value:26}],Script:"BR:SUM(MAX(0,HIGH-REF(CLOSE,1)),N)/SUM(MAX(0,REF(CLOSE,1)-LOW),N)*100;AR:SUM(HIGH-OPEN,N)/SUM(OPEN-LOW,N)*100;"}},JSIndexScript.prototype.WR=function(){return{Name:"WR",Description:"威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:10},{Name:"N1",Value:6}],Script:"WR1:100*(HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N));WR2:100*(HHV(HIGH,N1)-CLOSE)/(HHV(HIGH,N1)-LLV(LOW,N1));"}},JSIndexScript.prototype.BIAS=function(){return{Name:"BIAS",Description:"乖离率",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:"BIAS1 :(CLOSE-MA(CLOSE,N1))/MA(CLOSE,N1)*100;BIAS2 :(CLOSE-MA(CLOSE,N2))/MA(CLOSE,N2)*100;BIAS3 :(CLOSE-MA(CLOSE,N3))/MA(CLOSE,N3)*100;"}},JSIndexScript.prototype.OBV=function(){return{Name:"OBV",Description:"累积能量线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:"VA:=IF(CLOSE>REF(CLOSE,1),VOL,-VOL);OBV:SUM(IF(CLOSE==REF(CLOSE,1),0,VA),0);MAOBV:MA(OBV,M);"}},JSIndexScript.prototype.DMI=function(){return{Name:"DMI",Description:"趋向指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"MM",Value:6}],Script:"MTR:=EXPMEMA(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(REF(CLOSE,1)-LOW)),N);HD :=HIGH-REF(HIGH,1);LD :=REF(LOW,1)-LOW;DMP:=EXPMEMA(IF(HD>0&&HD>LD,HD,0),N);DMM:=EXPMEMA(IF(LD>0&&LD>HD,LD,0),N);PDI: DMP*100/MTR;MDI: DMM*100/MTR;ADX: EXPMEMA(ABS(MDI-PDI)/(MDI+PDI)*100,MM);ADXR:EXPMEMA(ADX,MM);"}},JSIndexScript.prototype.CR=function(){return{Name:"CR",Description:"带状能量线",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:40},{Name:"M4",Value:62}],Script:"MID:=REF(HIGH+LOW,1)/2;CR:SUM(MAX(0,HIGH-MID),N)/SUM(MAX(0,MID-LOW),N)*100;MA1:REF(MA(CR,M1),M1/2.5+1);MA2:REF(MA(CR,M2),M2/2.5+1);MA3:REF(MA(CR,M3),M3/2.5+1);MA4:REF(MA(CR,M4),M4/2.5+1);"}},JSIndexScript.prototype.PSY=function(){return{Name:"PSY",Description:"心理线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"PSY:COUNT(CLOSE>REF(CLOSE,1),N)/N*100;PSYMA:MA(PSY,M);"}},JSIndexScript.prototype.CCI=function(){return{Name:"CCI",Description:"商品路径指标",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:"TYP:=(HIGH+LOW+CLOSE)/3;CCI:(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));"}},JSIndexScript.prototype.DMA=function(){return{Name:"DMA",Description:"平均差",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:50},{Name:"M",Value:10}],Script:"DIF:MA(CLOSE,N1)-MA(CLOSE,N2);DIFMA:MA(DIF,M);"}},JSIndexScript.prototype.TRIX=function(){return{Name:"TRIX",Description:"三重指数平均线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:9}],Script:"MTR:=EMA(EMA(EMA(CLOSE,N),N),N);TRIX:(MTR-REF(MTR,1))/REF(MTR,1)*100;MATRIX:MA(TRIX,M) ;"}},JSIndexScript.prototype.VR=function(){return{Name:"VR",Description:"成交量变异率",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M",Value:6}],Script:"TH:=SUM(IF(CLOSE>REF(CLOSE,1),VOL,0),N);TL:=SUM(IF(CLOSE<REF(CLOSE,1),VOL,0),N);TQ:=SUM(IF(CLOSE==REF(CLOSE,1),VOL,0),N);VR:100*(TH*2+TQ)/(TL*2+TQ);MAVR:MA(VR,M);"}},JSIndexScript.prototype.EMV=function(){return{Name:"EMV",Description:"简易波动指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"M",Value:9}],Script:"VOLUME:=MA(VOL,N)/VOL;MID:=100*(HIGH+LOW-REF(HIGH+LOW,1))/(HIGH+LOW);EMV:MA(MID*VOLUME*(HIGH-LOW)/MA(HIGH-LOW,N),N);MAEMV:MA(EMV,M);"}},JSIndexScript.prototype.ROC=function(){return{Name:"ROC",Description:"变动率指标",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"ROC:100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);MAROC:MA(ROC,M);"}},JSIndexScript.prototype.MTM=function(){return{Name:"MTM",Description:"动量线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"MTM:CLOSE-REF(CLOSE,N);MAMTM:MA(MTM,M);"}},JSIndexScript.prototype.FSL=function(){return{Name:"FSL",Description:"分水岭",IsMainIndex:!1,Args:[],Script:"SWL:(EMA(CLOSE,5)*7+EMA(CLOSE,10)*3)/10;SWS:DMA(EMA(CLOSE,12),MAX(1,100*(SUM(VOL,5)/(3*CAPITAL))));"}},JSIndexScript.prototype.CYR=function(){return{Name:"CYR",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N",Value:13},{Name:"M",Value:5}],Script:"DIVE:=0.01*EMA(AMOUNT,N)/EMA(VOL,N);CYR:(DIVE/REF(DIVE,1)-1)*100;MACYR:MA(CYR,M);"}},JSIndexScript.prototype.MASS=function(){return{Name:"MASS",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N1",Value:9},{Name:"N2",Value:25},{Name:"M",Value:6}],Script:"MASS:SUM(MA(HIGH-LOW,N1)/MA(MA(HIGH-LOW,N1),N1),N2);MAMASS:MA(MASS,M);"}},JSIndexScript.prototype.WAD=function(){return{Name:"WAD",Description:"威廉多空力度线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:"MIDA:=CLOSE-MIN(REF(CLOSE,1),LOW);MIDB:=IF(CLOSE<REF(CLOSE,1),CLOSE-MAX(REF(CLOSE,1),HIGH),0);WAD:SUM(IF(CLOSE>REF(CLOSE,1),MIDA,MIDB),0);MAWAD:MA(WAD,M);"}},JSIndexScript.prototype.CHO=function(){return{Name:"CHO",Description:"佳庆指标",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:20},{Name:"M",Value:6}],Script:"MID:=SUM(VOL*(2*CLOSE-HIGH-LOW)/(HIGH+LOW),0);CHO:MA(MID,N1)-MA(MID,N2);MACHO:MA(CHO,M);"}},JSIndexScript.prototype.ADTM=function(){return{Name:"ADTM",Description:"动态买卖气指标",IsMainIndex:!1,Args:[{Name:"N",Value:23},{Name:"M",Value:8}],Script:"DTM:=IF(OPEN<=REF(OPEN,1),0,MAX((HIGH-OPEN),(OPEN-REF(OPEN,1))));DBM:=IF(OPEN>=REF(OPEN,1),0,MAX((OPEN-LOW),(OPEN-REF(OPEN,1))));STM:=SUM(DTM,N);SBM:=SUM(DBM,N);ADTM:IF(STM>SBM,(STM-SBM)/STM,IF(STM==SBM,0,(STM-SBM)/SBM));MAADTM:MA(ADTM,M);"}},JSIndexScript.prototype.HSL=function(){return{Name:"HSL",Description:"换手线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"HSL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100);MAHSL:MA(HSL,N);"}},JSIndexScript.prototype.BIAS36=function(){return{Name:"BIAS36",Description:"三六乖离",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:"BIAS36:MA(CLOSE,3)-MA(CLOSE,6);BIAS612:MA(CLOSE,6)-MA(CLOSE,12);MABIAS:MA(BIAS36,M);"}},JSIndexScript.prototype.BIAS_QL=function(){return{Name:"BIAS_QL",Description:"乖离率-传统版",IsMainIndex:!1,Args:[{Name:"N",Value:6},{Name:"M",Value:6}],Script:"BIAS :(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;BIASMA :MA(BIAS,M);"}},JSIndexScript.prototype.DPO=function(){return{Name:"DPO",Description:"区间震荡线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:"DPO:CLOSE-REF(MA(CLOSE,N),N/2+1);MADPO:MA(DPO,M);"}},JSIndexScript.prototype.OSC=function(){return{Name:"OSC",Description:"变动速率线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:"OSC:100*(CLOSE-MA(CLOSE,N));MAOSC:EXPMEMA(OSC,M);"}},JSIndexScript.prototype.ATR=function(){return{Name:"ATR",Description:"真实波幅",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:"MTR:MAX(MAX((HIGH-LOW),ABS(REF(CLOSE,1)-HIGH)),ABS(REF(CLOSE,1)-LOW));ATR:MA(MTR,N);"}},JSIndexScript.prototype.NVI=function(){return{Name:"ATR",Description:"负成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:"NVI:100*MULAR(IF(V<REF(V,1),C/REF(C,1),1),0);MANVI:MA(NVI,N);"}},JSIndexScript.prototype.PVI=function(){return{Name:"PVI",Description:"正成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:"NVI:100*MULAR(IF(V>REF(V,1),C/REF(C,1),1),0);MANVI:MA(NVI,N);"}},JSIndexScript.prototype.UOS=function(){return{Name:"UOS",Description:"终极指标",IsMainIndex:!1,Args:[{Name:"N1",Value:7},{Name:"N2",Value:14},{Name:"N3",Value:28},{Name:"M",Value:6}],Script:"TH:=MAX(HIGH,REF(CLOSE,1));TL:=MIN(LOW,REF(CLOSE,1));ACC1:=SUM(CLOSE-TL,N1)/SUM(TH-TL,N1);ACC2:=SUM(CLOSE-TL,N2)/SUM(TH-TL,N2);ACC3:=SUM(CLOSE-TL,N3)/SUM(TH-TL,N3);UOS:(ACC1*N2*N3+ACC2*N1*N3+ACC3*N1*N2)*100/(N1*N2+N1*N3+N2*N3);MAUOS:EXPMEMA(UOS,M);"}},JSIndexScript.prototype.CYW=function(){return{Name:"CYW",Description:"主力控盘",IsMainIndex:!1,Args:[],Script:"VAR1:=CLOSE-LOW;VAR2:=HIGH-LOW;VAR3:=CLOSE-HIGH;VAR4:=IF(HIGH>LOW,(VAR1/VAR2+VAR3/VAR2)*VOL,0);CYW: SUM(VAR4,10)/10000, COLORSTICK;"}},JSIndexScript.prototype.LON=function(){return{Name:"LON",Description:"龙系长线",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:"LC := REF(CLOSE,1);VID := SUM(VOL,2)/(((HHV(HIGH,2)-LLV(LOW,2)))*100);RC := (CLOSE-LC)*VID;LONG := SUM(RC,0);DIFF := SMA(LONG,10,1);DEA := SMA(LONG,20,1);LON : DIFF-DEA;LONMA : MA(LON,10);LONT : LON, COLORSTICK;"}},JSIndexScript.prototype.NDB=function(){return{Name:"NDB",Description:"脑电波",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:"HH:=IF(C/REF(C,1)>1.098 AND L>REF(H,1),2*C-REF(C,1)-H,2*C-H-L);V1:= BARSCOUNT(C) - 1;V2:= 2 * REF(C, V1) - REF(H, V1) - REF(L, V1);DK: SUM(HH, 0) + V2;MDK5: MA(DK, P1);MDK10: MA(DK, P2);"}},JSIndexScript.prototype.SKDJ=function(){return{Name:"SKDJ",Description:"慢速随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M",Value:3}],Script:"LOWV:=LLV(LOW,N);HIGHV:=HHV(HIGH,N);RSV:=EMA((CLOSE-LOWV)/(HIGHV-LOWV)*100,M);K:EMA(RSV,M);D:MA(K,M);"}},JSIndexScript.prototype.KD=function(){return{Name:"KD",Description:"随机指标KD",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;K:SMA(RSV,M1,1);D:SMA(K,M2,1);"}},JSIndexScript.prototype.FKX=function(){return{Name:"FKX",Description:"反K线",IsMainIndex:!0,Args:[],Script:"DRAWKLINE(-LOW, -OPEN, -HIGH, -CLOSE);"}},JSIndexScript.prototype.DKCOL=function(){return{Name:"DKCOL",Description:"多空能量柱(适用于分时主图)",IsMainIndex:!0,Args:[{Name:"N",Value:5}],Script:"FF:=(C-REF(C,N))/REF(C,N);STICKLINE(FF>0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORRED;STICKLINE(FF<0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORGREEN;"}},JSIndexScript.prototype.UDL=function(){return{Name:"UDL",Description:"引力线",IsMainIndex:!1,Args:[{Name:"N1",Value:3},{Name:"N2",Value:5},{Name:"N3",Value:10},{Name:"N4",Value:20},{Name:"M",Value:6}],Script:"UDL:(MA(CLOSE,N1)+MA(CLOSE,N2)+MA(CLOSE,N3)+MA(CLOSE,N4))/4;MAUDL:MA(UDL,M);"}},JSIndexScript.prototype.MFI=function(){return{Name:"MFI",Description:"资金流量指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"N2",Value:6}],Script:"TYP := (HIGH + LOW + CLOSE)/3;V1:=SUM(IF(TYP>REF(TYP,1),TYP*VOL,0),N)/SUM(IF(TYP<REF(TYP,1),TYP*VOL,0),N);MFI:100-(100/(1+V1));"}},JSIndexScript.prototype.LWR=function(){return{Name:"LWR",Description:"LWR威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"RSV:= (HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N))*100;LWR1:SMA(RSV,M1,1);LWR2:SMA(LWR1,M2,1);"}},JSIndexScript.prototype.MARSI=function(){return{Name:"MARSI",Description:"相对强弱平均线",IsMainIndex:!1,Args:[{Name:"M1",Value:10},{Name:"M2",Value:6}],Script:"DIF:=CLOSE-REF(CLOSE,1);VU:=IF(DIF>=0,DIF,0);VD:=IF(DIF<0,-DIF,0);MAU1:=MEMA(VU,M1);MAD1:=MEMA(VD,M1);MAU2:=MEMA(VU,M2);MAD2:=MEMA(VD,M2);RSI10:MA(100*MAU1/(MAU1+MAD1),M1);RSI6:MA(100*MAU2/(MAU2+MAD2),M2);"}},JSIndexScript.prototype.CYD=function(){return{Name:"CYD",Description:"承接因子",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"CYDS:WINNER(CLOSE)/(VOL/CAPITAL);CYDN:WINNER(CLOSE)/MA(VOL/CAPITAL,N);"}},JSIndexScript.prototype.CYF=function(){return{Name:"CYF",Description:"市场能量",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"CYF:100-100/(1+EMA(HSL,N));"}},JSIndexScript.prototype.TAPI=function(){return{Name:"TAPI",Description:"加权指数成交值",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:"TAPI:AMOUNT/INDEXC;MATAIP:MA(TAPI,M);"}},JSIndexScript.prototype.VMACD=function(){return{Name:"VMACD",Description:"量平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:"DIF:EMA(VOL,SHORT)-EMA(VOL,LONG);DEA:EMA(DIF,MID);MACD:DIF-DEA,COLORSTICK;"}},JSIndexScript.prototype.QACD=function(){return{Name:"QACD",Description:"快速异同平均",IsMainIndex:!1,Args:[{Name:"N1",Value:12},{Name:"N2",Value:26},{Name:"M",Value:9}],Script:"DIF:EMA(CLOSE,N1)-EMA(CLOSE,N2);MACD:EMA(DIF,M);DDIF:DIF-MACD;"}},JSIndexScript.prototype.VPT=function(){return{Name:"VPT",Description:"量价曲线",IsMainIndex:!1,Args:[{Name:"N",Value:51},{Name:"M",Value:6}],Script:"VPT:SUM(VOL*(CLOSE-REF(CLOSE,1))/REF(CLOSE,1),N);MAVPT:MA(VPT,M);"}},JSIndexScript.prototype.WVAD=function(){return{Name:"WVAD",Description:"威廉变异离散量",IsMainIndex:!1,Args:[{Name:"N",Value:24},{Name:"M",Value:6}],Script:"WVAD:SUM((CLOSE-OPEN)/(HIGH-LOW)*VOL,N)/10000;MAWVAD:MA(WVAD,M);"}},JSIndexScript.prototype.DBQR=function(){return{Name:"WVAD",Description:"对比强弱",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:60}],Script:"ZS:(INDEXC-REF(INDEXC,N))/REF(INDEXC,N);GG:(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);MADBQR1:MA(GG,M1);MADBQR2:MA(GG,M2);MADBQR3:MA(GG,M3);"}},JSIndexScript.prototype.JS=function(){return{Name:"JS",Description:"加速线",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],Script:"JS:100*(CLOSE-REF(CLOSE,N))/(N*REF(CLOSE,N));MAJS1:MA(JS,M1);MAJS2:MA(JS,M2);MAJS3:MA(JS,M3);"}},JSIndexScript.prototype.CYE=function(){return{Name:"CYE",Description:"市场趋势",IsMainIndex:!1,Args:[],Script:"MAL:=MA(CLOSE,5);MAS:=MA(MA(CLOSE,20),5);CYEL:(MAL-REF(MAL,1))/REF(MAL,1)*100;CYES:(MAS-REF(MAS,1))/REF(MAS,1)*100;"}},JSIndexScript.prototype.QR=function(){return{Name:"QR",Description:"强弱指标",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"个股: (CLOSE-REF(CLOSE,N))/REF(CLOSE,N)*100; 大盘: (INDEXC-REF(INDEXC,N))/REF(INDEXC,N)*100; 强弱值:EMA(个股-大盘,2),COLORSTICK;"}},JSIndexScript.prototype.GDX=function(){return{Name:"GDX",Description:"轨道线",IsMainIndex:!1,Args:[{Name:"N",Value:30},{Name:"M",Value:9}],Script:"AA:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,N))/MA(CLOSE,N); 轨道:DMA(CLOSE,AA);压力线:(1+M/100)*轨道; 支撑线:(1-M/100)*轨道;"}},JSIndexScript.prototype.JLHB=function(){return{Name:"JLHB",Description:"绝路航标",IsMainIndex:!1,Args:[{Name:"N",Value:7},{Name:"M",Value:5}],Script:"VAR1:=(CLOSE-LLV(LOW,60))/(HHV(HIGH,60)-LLV(LOW,60))*80; B:SMA(VAR1,N,1); VAR2:SMA(B,M,1); 绝路航标:IF(CROSS(B,VAR2) AND B<40,50,0);"}},JSIndexScript.prototype.PCNT=function(){return{Name:"PCNT",Description:"幅度比",IsMainIndex:!1,Args:[{Name:"M",Value:5}],Script:"PCNT:(CLOSE-REF(CLOSE,1))/CLOSE*100;MAPCNT:EXPMEMA(PCNT,M);"}},JSIndexScript.prototype.BTX=function(){return{Name:"BTX",Description:"宝塔线",IsMainIndex:!1,Args:[],Script:"B1:=REF(C,1);B2:= REF(C, 2);SS:= IF(C > REF(C, 1) AND REF(C, 1) >= REF(C, 2), 1, IF(C < REF(C, 1) AND REF(C, 1) <= REF(C, 2), -1, IF(C > REF(C, 2) AND REF(C, 2) > REF(C, 1), 2, IF(C < REF(C, 2) AND REF(C, 2) < REF(C, 1), -2, 0))));SM:= IF(REF(SS, 1) <> 0, REF(SS, 1), IF(REF(SS, 2) <> 0, REF(SS, 2), IF(REF(SS, 3) <> 0, REF(SS, 3), IF(REF(SS, 5) <> 0, REF(SS, 5), IF(REF(SS, 6) <> 0, REF(SS, 6), IF(REF(SS, 7) <> 0, REF(SS, 7), 0))))));MC:= IF(REF(SS, 1) <> 0, B2, IF(SM > 0, MIN(B1, B2), MAX(B1, B2)));TOW1:= IF(C > REF(C, 1), C, REF(C, 1));TOW2:= IF((SS == -1 OR SS == -2) AND SM > 0, B2, TOW1);TOWER:= IF(TOW1 > TOW2, TOW1, TOW2);STICKLINE(SS == 1 OR SM >= 1 AND SS == 0, B1, C, 10, 1), COLORRED;STICKLINE(SS == -1 OR SM <= -1 AND SS == 0, B1, C, 10, 0), COLORCYAN;STICKLINE(SS == 2, B2, C, 10, 1), COLORRED;STICKLINE(SS == -2, B2, C, 10, 0), COLORCYAN;STICKLINE((SS == -1 OR SS == -2) AND SM > 0, B2, B1, 10, 1), COLORRED;STICKLINE((SS == 1 OR SS == 2) AND SM < 0, B2, B1, 10, 0), COLORCYAN;"}},JSIndexScript.prototype.AMO=function(){return{Name:"AMO",Description:"成交金额",IsMainIndex:!1,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:"AMOW:AMOUNT/10000.0,VOLSTICK;AMO1:MA(AMOW,M1);AMO2:MA(AMOW,M2);"}},JSIndexScript.prototype.VRSI=function(){return{Name:"VRSI",Description:"相对强弱量",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:"LC:=REF(VOL,1);RSI1:SMA(MAX(VOL-LC,0),N1,1)/SMA(ABS(VOL-LC),N1,1)*100;RSI2:SMA(MAX(VOL-LC,0),N2,1)/SMA(ABS(VOL-LC),N2,1)*100;RSI3:SMA(MAX(VOL-LC,0),N3,1)/SMA(ABS(VOL-LC),N3,1)*100;"}},JSIndexScript.prototype.HSCOL=function(){return{Name:"HSCOL",Description:"换手柱",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"HSCOL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100),VOLSTICK;MAHSL:MA(HSCOL,N);"}},JSIndexScript.prototype.DBQRV=function(){return{Name:"DBQRV",Description:"对比强弱量(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"ZS:(INDEXV-REF(INDEXV,N))/REF(INDEXV,N);GG:(VOL-REF(VOL,N))/REF(VOL,N);"}},JSIndexScript.prototype.DBLB=function(){return{Name:"DBLB",Description:"对比量比(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M",Value:5}],Script:"GG:=VOL/SUM(REF(VOL,1),N);ZS:=INDEXV/SUM(REF(INDEXV,1),N);DBLB:GG/ZS;MADBLB:MA(DBLB,M);"}},JSIndexScript.prototype.ACD=function(){return{Name:"ACD",Description:"升降线",IsMainIndex:!1,Args:[{Name:"M",Value:20}],Script:"LC:=REF(CLOSE,1);DIF:=CLOSE-IF(CLOSE>LC,MIN(LOW,LC),MAX(HIGH,LC));ACD:SUM(IF(CLOSE==LC,0,DIF),0);MAACD:EXPMEMA(ACD,M);"}},JSIndexScript.prototype.EXPMA=function(){return{Name:"EXPMA",Description:"指数平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:"EXP1:EMA(CLOSE,M1);EXP2:EMA(CLOSE,M2);"}},JSIndexScript.prototype.EXPMA_S=function(){return{Name:"EXPMA_S",Description:"指数平均线-副图",IsMainIndex:!1,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:"EXP1:EMA(CLOSE,M1);EXP2:EMA(CLOSE,M2);"}},JSIndexScript.prototype.HMA=function(){return{Name:"HMA",Description:"高价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"HMA1:MA(HIGH,M1);HMA2:MA(HIGH,M2);HMA3:MA(HIGH,M3);HMA4:MA(HIGH,M4);HMA5:MA(HIGH,M5);"}},JSIndexScript.prototype.LMA=function(){return{Name:"LMA",Description:"低价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"LMA1:MA(LOW,M1);LMA2:MA(LOW,M2);LMA3:MA(LOW,M3);LMA4:MA(LOW,M4);LMA5:MA(LOW,M5);"}},JSIndexScript.prototype.VMA=function(){return{Name:"VMA",Description:"变异平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"VV:=(HIGH+OPEN+LOW+CLOSE)/4;VMA1:MA(VV,M1);VMA2:MA(VV,M2);VMA3:MA(VV,M3);VMA4:MA(VV,M4);VMA5:MA(VV,M5);"}},JSIndexScript.prototype.AMV=function(){return{Name:"AMV",Description:"成本价均线",IsMainIndex:!1,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:"AMOV:=VOL*(OPEN+CLOSE)/2;AMV1:SUM(AMOV,M1)/SUM(VOL,M1);AMV2:SUM(AMOV,M2)/SUM(VOL,M2);AMV3:SUM(AMOV,M3)/SUM(VOL,M3);AMV4:SUM(AMOV,M4)/SUM(VOL,M4);"}},JSIndexScript.prototype.BBIBOLL=function(){return{Name:"BBIBOLL",Description:"多空布林线",IsMainIndex:!0,Args:[{Name:"N",Value:11},{Name:"M",Value:6}],Script:"CV:=CLOSE;BBIBOLL:(MA(CV,3)+MA(CV,6)+MA(CV,12)+MA(CV,24))/4;UPR:BBIBOLL+M*STD(BBIBOLL,N);DWN:BBIBOLL-M*STD(BBIBOLL,N);"}},JSIndexScript.prototype.ALLIGAT=function(){return{Name:"ALLIGAT",Description:"鳄鱼线",IsMainIndex:!0,Args:[],Script:"NN:=(H+L)/2;上唇:REF(MA(NN,5),3),COLOR40FF40;牙齿:REF(MA(NN,8),5),COLOR0000C0;下颚:REF(MA(NN,13),8),COLORFF4040;"}},JSIndexScript.prototype.ZX=function(){return{Name:"ZX",Description:"重心线",IsMainIndex:!1,Args:[],Script:"AV:0.01*AMOUNT/VOL;"}},JSIndexScript.prototype.XS=function(){return{Name:"XS",Description:"薛斯通道",IsMainIndex:!0,Args:[{Name:"N",Value:13}],Script:"VAR2:=CLOSE*VOL;VAR3:=EMA((EMA(VAR2,3)/EMA(VOL,3)+EMA(VAR2,6)/EMA(VOL,6)+EMA(VAR2,12)/EMA(VOL,12)+EMA(VAR2,24)/EMA(VOL,24))/4,N);SUP:1.06*VAR3;SDN:VAR3*0.94;VAR4:=EMA(CLOSE,9);LUP:EMA(VAR4*1.14,5);LDN:EMA(VAR4*0.86,5);"}},JSIndexScript.prototype.XS2=function(){return{Name:"XS2",Description:"薛斯通道II",IsMainIndex:!0,Args:[{Name:"N",Value:102},{Name:"M",Value:7}],Script:"AA:=MA((2*CLOSE+HIGH+LOW)/4,5); 通道1:AA*N/100; 通道2:AA*(200-N)/100; CC:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,20))/MA(CLOSE,20); DD:=DMA(CLOSE,CC); 通道3:(1+M/100)*DD; 通道4:(1-M/100)*DD;"}},JSIndexScript.prototype.SG_XDT=function(){return{Name:"SG-XDT",Description:"心电图(需下载日线)",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:"QR:CLOSE/INDEXC*1000;MQR1:MA(QR,5);MQR2:MA(QR,10);"}},JSIndexScript.prototype.SG_SMX=function(){return{Name:"SG-SMX",Description:"生命线(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:50}],Script:"H1:=HHV(HIGH,N);L1:=LLV(LOW,N);H2:=HHV(INDEXH,N);L2:=LLV(INDEXL,N);ZY:=CLOSE/INDEXC*2000;ZY1:EMA(ZY,3);ZY2:EMA(ZY,17);ZY3:EMA(ZY,34);"}},JSIndexScript.prototype.SG_LB=function(){return{Name:"SG-LB",Description:"量比(需下载日线)",IsMainIndex:!1,Args:[],Script:"ZY2:=VOL/INDEXV*1000;量比:ZY2;MA5:MA(ZY2,5);MA10:MA(ZY2,10);"}},JSIndexScript.prototype.SG_PF=function(){return{Name:"SG-PF",Description:"强势股评分(需下载日线)",IsMainIndex:!1,Args:[],Script:"ZY1:=CLOSE/INDEXC*1000;A1:=IF(ZY1>HHV(ZY1,3),10,0);A2:=IF(ZY1>HHV(ZY1,5),15,0);A3:=IF(ZY1>HHV(ZY1,10),20,0);A4:=IF(ZY1>HHV(ZY1,2),10,0);A5:=COUNT(ZY1>REF(ZY1,1) ,9)*5;强势股评分:A1+A2+A3+A4+A5;"}},JSIndexScript.prototype.RAD=function(){return{Name:"RAD",Description:"威力雷达(需下载日线)",IsMainIndex:!1,Args:[{Name:"D",Value:3},{Name:"S",Value:30},{Name:"M",Value:30}],Script:"SM:=(OPEN+HIGH+CLOSE+LOW)/4;SMID:=MA(SM,D);IM:=(INDEXO+INDEXH+INDEXL+INDEXC)/4;IMID:=MA(IM,D);SI1:=(SMID-REF(SMID,1))/SMID;II:=(IMID-REF(IMID,1))/IMID;RADER1:SUM((SI1-II)*2,S)*1000;RADERMA:SMA(RADER1,M,1);"}},JSIndexScript.prototype.SHT=function(){return{Name:"SHT",Description:"龙系短线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:"VAR1:=MA((VOL-REF(VOL,1))/REF(VOL,1),5);VAR2:=(CLOSE-MA(CLOSE,24))/MA(CLOSE,24)*100;MY: VAR2*(1+VAR1);SHT: MY, COLORSTICK;SHTMA: MA(SHT,N);"}},JSIndexScript.prototype.ZLJC=function(){return{Name:"ZLJC",Description:"主力进出",IsMainIndex:!1,Args:[],Script:"VAR1:=(CLOSE+LOW+HIGH)/3; VAR2:=SUM(((VAR1-REF(LOW,1))-(HIGH-VAR1))*VOL/100000/(HIGH-LOW),0); VAR3:=EMA(VAR2,1); JCS:VAR3; JCM:MA(VAR3,12); JCL:MA(VAR3,26);"}},JSIndexScript.prototype.ZLMM=function(){return{Name:"ZLMM",Description:"主力买卖",IsMainIndex:!1,Args:[],Script:"LC :=REF(CLOSE,1);RSI2:=SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100;RSI3:=SMA(MAX(CLOSE-LC,0),18,1)/SMA(ABS(CLOSE-LC),18,1)*100;MMS:MA(3*RSI2-2*SMA(MAX(CLOSE-LC,0),16,1)/SMA(ABS(CLOSE-LC),16,1)*100,3);MMM:EMA(MMS,8);MML:MA(3*RSI3-2*SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100,5);"}},JSIndexScript.prototype.SLZT=function(){return{Name:"SLZT",Description:"神龙在天",IsMainIndex:!1,Args:[],Script:"白龙: MA(CLOSE,125);黄龙: 白龙+2*STD(CLOSE,170);紫龙: 白龙-2*STD(CLOSE,145);青龙: SAR(125,1,7), LINESTICK;VAR2:=HHV(HIGH,70);VAR3:=HHV(HIGH,20);红龙: VAR2*0.83;蓝龙: VAR3*0.91;"}},JSIndexScript.prototype.ADVOL=function(){return{Name:"ADVOL",Description:"龙系离散量",IsMainIndex:!1,Args:[],Script:"A:=SUM(((CLOSE-LOW)-(HIGH-CLOSE))*VOL/10000/(HIGH-LOW),0);ADVOL:A;MA1:MA(A,30);MA2:MA(MA1,100);"}},JSIndexScript.prototype.CYC=function(){return{Name:"CYC",Description:"成本均线",IsMainIndex:!0,Args:[{Name:"P1",Value:5},{Name:"P2",Value:13},{Name:"P3",Value:34}],Script:"JJJ:=IF(DYNAINFO(8)>0.01,0.01*DYNAINFO(10)/DYNAINFO(8),DYNAINFO(3));DDD:=(DYNAINFO(5)<0.01 || DYNAINFO(6)<0.01);JJJT:=IF(DDD,1,(JJJ<(DYNAINFO(5)+0.01) && JJJ>(DYNAINFO(6)-0.01)));CYC1:IF(JJJT,0.01*EMA(AMOUNT,P1)/EMA(VOL,P1),EMA((HIGH+LOW+CLOSE)/3,P1));CYC2:IF(JJJT,0.01*EMA(AMOUNT,P2)/EMA(VOL,P2),EMA((HIGH+LOW+CLOSE)/3,P2));CYC3:IF(JJJT,0.01*EMA(AMOUNT,P3)/EMA(VOL,P3),EMA((HIGH+LOW+CLOSE)/3,P3));CYC4:IF(JJJT,DMA(AMOUNT/(100*VOL),100*VOL/FINANCE(7)),EMA((HIGH+LOW+CLOSE)/3,120));"}},JSIndexScript.prototype.CYS=function(){return{Name:"CYS",Description:"市场盈亏",IsMainIndex:!1,Args:[],Script:"CYC13:EMA(AMOUNT,13)/EMA(VOL,13);CYS:(CLOSE-CYC13)/CYC13*100;"}},JSIndexScript.prototype.CYQKL=function(){return{Name:"CYQKL",Description:"博弈K线长度",IsMainIndex:!1,Args:[],Script:"KL:100*(WINNER(CLOSE)-WINNER(OPEN));"}},JSIndexScript.prototype.SCR=function(){return{Name:"SCR",Description:"筹码集中度",IsMainIndex:!1,Args:[{Name:"P1",Value:90}],Script:"A:=P1+(100-P1)/2;B:=(100-P1)/2;CC:=COST(A);DD:=COST(B);SCR:(CC-DD)/(CC+DD)*100/2;"}},JSIndexScript.prototype.ASR=function(){return{Name:"ASR",Description:"浮筹比例",IsMainIndex:!1,Args:[],Script:"ASR:(WINNER(C*1.1)-WINNER(C*0.9))/WINNER(HHV(H,0))*100;"}},JSIndexScript.prototype.SAR=function(){return{Name:"SAR",Description:"抛物转向",IsMainIndex:!0,Args:[{Name:"P",Value:10},{Name:"STEP",Value:2},{Name:"MAXP",Value:20}],Script:"S:SAR(P,STEP,MAXP),CIRCLEDOT;"}},JSIndexScript.prototype.TJCJL=function(){return{Name:"太极成交量",Description:"太极成交量",IsMainIndex:!0,Args:[],Script:"总手:VOL,NODRAW;ZZ:=IF(REF(C,1)>REF(O,1) AND O>REF(C,1)*1.014 AND C<O*1.02,1,3);V5:=MA(V,5);V12:=MA(V,12);V34:=MA(V,34);C6:=MA(C,6);STICKLINE(VOL,0,VOL,10,0),COLORLIGRAY;STICKLINE(CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,0,VOL,10,0),COLORRED;STICKLINE(CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,0,VOL,10,0),COLORGREEN;STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05,0,VOL,10,0),COLORYELLOW;STICKLINE(VOL<MA(VOL,5)/2 AND V<V12/2,0,VOL,10,0),COLORBLUE;STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,VOL*0.5,0,10,0),COLORRED;STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,VOL*0.5,0,10,0),COLORRED;"}},JSIndexScript.prototype.Dragon4_Main=function(){return{Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!0,Args:[{Name:"N1",Value:5},{Name:"N2",Value:10},{Name:"N3",Value:50},{Name:"N4",Value:60}],Script:"蜻蜓点水:=EMA(CLOSE,N1),COLORGRAY;魔界:=EMA(CLOSE,N2),COLORGREEN;水:=EMA(CLOSE,N3),COLORRED;DRAWKLINE(HIGH,OPEN,LOW,CLOSE);生命线:MA(CLOSE,N4),COLORBLUE,LINETHICK2;DRAWBAND(魔界,\'RGB(186,225,250)\',水,\'RGB(253,194,124)\');DRAWBAND(蜻蜓点水,\'RGB(128,138,135)\',魔界,\'RGB(0,0,255)\');"}},JSIndexScript.prototype.Dragon4_Fig=function(){return{Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!1,Args:[],Script:"倍:VOL>=REF(V,1)*1.90 AND C>REF(C,1),COLORYELLOW;低:VOL<REF(LLV(VOL,13),1),COLORGREEN;地:VOL<REF(LLV(VOL,100),1),COLORMAGENTA; 平:=ABS(VOL-HHV(REF(VOL,1),5))/HHV(REF(VOL,1),5)<=0.03 OR ABS(VOL-REF(VOL,1))/REF(VOL,1)<=0.03,NODRAW,COLORWHITE;倍缩:VOL<=REF(V,1)*0.5,COLORFF8000;梯量:COUNT(V>REF(V,1),3)==3 AND COUNT(C>O,3)==3,COLORBROWN;缩量涨:COUNT(C>REF(C,1),2)==2 AND COUNT(V<REF(V,1),2)==2,COLORBLUE;STICKLINE(C>=REF(C,1),V,0,2,0),COLORRED;STICKLINE(C<REF(C,1),V,0,2,0),COLORGREEN;STICKLINE(倍,0,V,2,0),COLORYELLOW;STICKLINE(低,0,V,2,0),COLORGREEN;STICKLINE(地,0,V,2,0),COLORLIMAGENTA;STICKLINE(平,0,V,2,0),COLORGRAY;STICKLINE(倍缩,0,V,2,0),COLORFF8000;STICKLINE(梯量,0,V,2,0),COLORBROWN;STICKLINE(缩量涨,0,V,2,0),COLORBLUE;"}},JSIndexScript.prototype.FundsAnalysis=function(){return{Name:"资金分析",Description:"资金分析",IsMainIndex:!1,Args:[{Name:"M",Value:55},{Name:"N",Value:34}],Script:"LC:=REF(CLOSE,1);RSI:=((SMA(MAX((CLOSE - LC),0),3,1) / SMA(ABS((CLOSE - LC)),3,1)) * 100);FF:=EMA(CLOSE,3);MA15:=EMA(CLOSE,21); DRAWTEXT(CROSS(85,RSI),75,\'▼\'),COLORGREEN;VAR1:=IF(YEAR>=2038 AND MONTH>=1,0,1);VAR2:=REF(LOW,1)*VAR1;VAR3:=SMA(ABS(LOW-VAR2),3,1)/SMA(MAX(LOW-VAR2,0),3,1)*100*VAR1;VAR4:=EMA(IF(CLOSE*1.3,VAR3*10,VAR3/10),3)*VAR1;VAR5:=LLV(LOW,30)*VAR1;VAR6:=HHV(VAR4,30)*VAR1;VAR7:=IF(MA(CLOSE,58),1,0)*VAR1;VAR8:=EMA(IF(LOW<=VAR5,(VAR4+VAR6*2)/2,0),3)/618*VAR7*VAR1;吸筹A:IF(VAR8>100,100,VAR8)*VAR1,COLORFB2F3B;{吸筹B}STICKLINE(吸筹A>-150,0,吸筹A,8,0),COLORFB2F3B;散户线: 100*(HHV(HIGH,M)-CLOSE)/(HHV(HIGH,M)-LLV(LOW,M)),COLORAA89BD,LINETHICK2;RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;K:=SMA(RSV,3,1);D:=SMA(K,3,1);J:=3*K-2*D;主力线:EMA(J,5),COLORF39800,LINETHICK2;DRAWICON(CROSS(主力线,散户线),主力线,1);DRAWICON(CROSS(散户线,主力线),主力线,2);"}},JSIndexScript.prototype.MarginProportion=function(){return{Name:"融资占比(%)",Description:"融资占比",IsMainIndex:!1,Condition:{Period:[CONDITION_PERIOD.KLINE_DAY_ID]},Args:[],Script:"占比:MARGIN(2);"}},JSIndexScript.prototype.Margin2=function(){return{Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[CONDITION_PERIOD.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:"T1:MARGIN(1);        T2:MA(MARGIN(1),N);"}},JSIndexScript.prototype.Margin3=function(){return{Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[CONDITION_PERIOD.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:"T1:=MARGIN(1);        T2:=MA(MARGIN(1),N);        STICKLINE(T1-T2>=0,0,T1-T2,50,T1>T2),COLORRED;        STICKLINE(T1-T2<0,T1-T2,0,50,T1>T2),COLORGREEN;"}},JSIndexScript.prototype.FXG_BSPoint=function(){return{Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,Args:[],Script:"MA5:MA(CLOSE,5);        MA13:MA(CLOSE,13);        MA21:MA(CLOSE,21);        MA34:MA(CLOSE,34);        {MA55:MA(CLOSE,55),COLOR0000FF;}        {MA120:=MA(CLOSE,120),COLORFFFF00;}        天使:=EMA(C,2),COLOR000000;        魔鬼:=EMA(SLOPE(C,21)*20+C,42),COLOR000000;        买:=CROSS(天使,魔鬼);        卖:=CROSS(魔鬼,天使);        DRAWICON(买,L*0.97,13);        DRAWICON(卖,H*1.03,14);        DRAWKLINE_IF(天使>=魔鬼,HIGH,CLOSE,LOW,OPEN),COLORRED;        DRAWKLINE_IF(天使<魔鬼,HIGH,CLOSE,LOW,OPEN),COLORBLUE;        DRAWKLINE_IF(CROSS(天使,魔鬼),HIGH,CLOSE,LOW,OPEN),COLORYELLOW;        DRAWKLINE_IF(CROSS(魔鬼,天使),HIGH,CLOSE,LOW,OPEN),COLORBLACK;"}},JSIndexScript.prototype.FXG_INDEX=function(){return{Name:"涨停多空线",Description:"涨停多空线",IsMainIndex:!1,Args:[],Script:"做多能量线: SMA((CLOSE-LLV(LOW,9))/(HHV(HIGH,9)-LLV(LOW,9))*100,5,1)-8,COLORRED,LINETHICK3;做空能量线: SMA((HHV(HIGH,36)-CLOSE)/(HHV(HIGH,36)-LLV(LOW,36))*100,2,1),COLORGREEN,LINETHICK3;20,POINTDOT,COLORF00FF0;50,POINTDOT,COLORGREEN;80,POINTDOT,COLORLIBLUE;"}},JSIndexScript.prototype.FXG_INDEX2=function(){return{Name:"涨停吸筹区",Description:"涨停吸筹区",IsMainIndex:!1,Args:[],Script:"VAR0:=EMA(HHV(HIGH,500),21); VAR1:=EMA(HHV(HIGH,250),21);VAR2:=EMA(HHV(HIGH,90),21); VAR3:=EMA(LLV(LOW,500),21); VAR4:=EMA(LLV(LOW,250),21); VAR5:=EMA(LLV(LOW,90),21);VAR6:=EMA((VAR3*0.96+VAR4*0.96+VAR5*0.96+VAR0*0.558+VAR1*0.558+VAR2*0.558)/6,21); VAR7:=EMA((VAR3*1.25+VAR4*1.23+VAR5*1.2+VAR0*0.55+VAR1*0.55+VAR2*0.65)/6,21); VAR8:=EMA((VAR3*1.3+VAR4*1.3+VAR5*1.3+VAR0*0.68+VAR1*0.68+VAR2*0.68)/6,21); VAR9:=EMA((VAR6*3+VAR7*2+VAR8)/6*1.738,21); VAR10:=REF(LOW,1); VAR11:=SMA(ABS(LOW-VAR10),3,1)/SMA(MAX(LOW-VAR10,0),3,1)*100; VAR12:=EMA(IFF(CLOSE*1.35<=VAR9,VAR11*10,VAR11/10),3); VAR13:=LLV(LOW,30); VAR14:=HHV(VAR12,30); VAR15:=IFF(MA(CLOSE,58),1,0); VAR16:=EMA(IFF(LOW<=VAR13,(VAR12+VAR14*2)/2,0),3)/618*VAR15;资金入场:IFF(VAR16>0,VAR16,0),LINETHICK,LINETHICK2, COLORFF0000; A1:IFF(资金入场>0,资金入场*1.2,0),STICK,LINETHICK5, COLORFF0000;A2:IFF(资金入场>0,资金入场*0.8,0),STICK,LINETHICK5, COLORFF6600;A3:IFF(资金入场>0,资金入场*0.6,0),STICK,LINETHICK5, COLORFF9900;A4:IFF(资金入场>0,资金入场*0.4,0) ,STICK,LINETHICK5,COLORFFCC00;A5:IFF(资金入场>0,资金入场*0.2,0) ,STICK,LINETHICK5,COLORFFFF00;"}},JSIndexScript.prototype.FXG_INDEX3=function(){return{Name:"量能黄金点",Description:"量能黄金点",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"A:=IFF((CLOSE>126.32),VOL,VOL); 主力:=MA(A,4),COLORRED;游资:=MA(A,8),COLORYELLOW;大户:=MA(A,16),COLORF0F000;散户:=MA(A,32),COLOR00FF00;主比:=ABS(((主力)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORRED;游比:=ABS(((游资)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORYELLOW;大比:=ABS(((大户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORF0F000;散比:=ABS(((散户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLOR00FF00;警戒线:MA(A,180),COLORFF66FF;STICKLINE((主力 > 0),0,主力,2.5,0),COLOR1020BB;STICKLINE((主力 > 0),0,主力,0.7,0),COLORRED;STICKLINE((游资 > 0),0,游资,2.5,0),COLOR009CFF;STICKLINE((游资 > 0),0,游资,0.7,0),COLORYELLOW;STICKLINE((大户 > 0),0,大户,2.5,0),COLORFF8800;STICKLINE((大户 > 0),0,大户,0.7,0),COLORLIBLUE;STICKLINE((散户 > 0),0,散户,2.5,0),COLOR00CA00;STICKLINE((散户 > 0),0,散户,0.7,0),COLORGREEN;"}},JSIndexScript.prototype.NewsNegative=function(){return{Name:"负面新闻",Description:"负面新闻统计",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"N",Value:5},{Name:"N2",Value:10}],Script:"负面:NEWS(1);MA1:MA(负面,N);MA2:MA(负面,N2);"}},JSIndexScript.prototype.UpDownAnalyze=function(){return{Name:"涨跌趋势",Description:"涨跌趋势",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[CONDITION_PERIOD.MINUTE_ID,CONDITION_PERIOD.MULTIDAY_MINUTE_ID,CONDITION_PERIOD.KLINE_DAY_ID]},Args:[],Script:"上涨家数:UPCOUNT(\'CNA.CI\'),COLORRED;下跌家数:DOWNCOUNT(\'CNA.CI\'),COLORGREEN;"}},JSIndexScript.prototype.HK2SHSZ=function(){return{Name:"北上资金",Description:"北上资金",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[CONDITION_PERIOD.MINUTE_ID,CONDITION_PERIOD.MULTIDAY_MINUTE_ID,CONDITION_PERIOD.KLINE_DAY_ID]},Args:[],Script:"净流入:HK2SHSZ(1),COLORSTICK;"}},JSIndexScript.prototype.ShareHolder=function(){return{Name:"股东人数",Description:"股东人数",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[CONDITION_PERIOD.KLINE_DAY_ID,CONDITION_PERIOD.KLINE_MONTH_ID,CONDITION_PERIOD.KLINE_WEEK_ID,CONDITION_PERIOD.KLINE_YEAR_ID]},Args:[],Script:"人数:FINANCE(100);"}},JSIndexScript.prototype.VOLRate=function(){return{Name:"量比",Description:"量比",IsMainIndex:!1,Condition:{Period:[CONDITION_PERIOD.MINUTE_ID,CONDITION_PERIOD.MULTIDAY_MINUTE_ID]},Args:[],Script:"LIANGBI:VOLR;"}},JSIndexScript.prototype.COLOR_KSTAR1=function(){return{Name:"十字星",Description:"十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH>LOW;"}},JSIndexScript.prototype.COLOR_KSTAR2=function(){return{Name:"早晨之星",Description:"早晨之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:(REF(CLOSE,2)/REF(OPEN,2)<0.95) && (REF(OPEN,1) < REF(CLOSE,2)) && (ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03) && CLOSE/OPEN>1.05 && CLOSE>REF(CLOSE,2);"}},JSIndexScript.prototype.COLOR_KSTAR3=function(){return{Name:"黄昏之星",Description:"黄昏之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05 && REF(OPEN,1)>REF(CLOSE,2) && ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03 && CLOSE/OPEN<0.95 && CLOSE<REF(CLOSE,2);"}},JSIndexScript.prototype.COLOR_SHI1=function(){return{Name:"长十字",Description:"长十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH/LOW>1.03;"}},JSIndexScript.prototype.COLOR_K220=function(){return{Name:"身怀六甲",Description:"身怀六甲",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1)>0.04&&            ABS(CLOSE-OPEN)/CLOSE<0.005&&            MAX(CLOSE,OPEN)<MAX(REF(CLOSE,1),REF(OPEN,1))&&            MIN(CLOSE,OPEN)>MIN(REF(CLOSE,1),REF(OPEN,1));"}},JSIndexScript.prototype.COLOR_K300=function(){return{Name:"三个白武士",Description:"三个白武士",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:UPNDAY(CLOSE,3)&&NDAY(CLOSE,OPEN,3);"}},JSIndexScript.prototype.COLOR_K310=function(){return{Name:"三只乌鸦",Description:"三只乌鸦",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:DOWNNDAY(CLOSE,3)&&NDAY(OPEN,CLOSE,3);"}},JSIndexScript.prototype.COLOR_K380=function(){return{Name:"光头阳线",Description:"光头阳线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:HIGH==CLOSE&&HIGH>LOW;"}},JSIndexScript.prototype.COLOR_K390=function(){return{Name:"光脚阴线",Description:"光脚阴线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:LOW==CLOSE&&HIGH>LOW;"}},JSIndexScript.prototype.COLOR_K134=function(){return{Name:"垂死十字",Description:"垂死十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&CLOSE==LOW&&CLOSE<HIGH;"}},JSIndexScript.prototype.COLOR_K140=function(){return{Name:"早晨十字星",Description:"早晨十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)<0.95&&REF(OPEN,1)<REF(CLOSE,2)&&REF(OPEN,1)==REF(CLOSE,1)&&CLOSE/OPEN>1.05&&CLOSE>REF(CLOSE,2);"}},JSIndexScript.prototype.COLOR_K150=function(){return{Name:"黄昏十字星",Description:"黄昏十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05&&REF(OPEN,1)>REF(CLOSE,2)&&REF(OPEN,1)=REF(CLOSE,1)&&CLOSE/OPEN<0.95&&CLOSE<REF(CLOSE,2);"}},JSIndexScript.prototype.COLOR_K160=function(){return{Name:"射击之星",Description:"射击之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:MIN(OPEN,CLOSE)==LOW&&HIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&CLOSE>MA(CLOSE,5);"}},JSIndexScript.prototype.COLOR_K165=function(){return{Name:"倒转锤头",Description:"倒转锤头",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:MIN(OPEN,CLOSE)==LOW&&HIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&CLOSE<MA(CLOSE,5);"}},JSIndexScript.prototype.COLOR_K170=function(){return{Name:"锤头",Description:"锤头",IsMainIndex:!0,InstructionType:2,Script:"OUT:HIGH==MAX(OPEN,CLOSE)&&HIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&CLOSE<MA(CLOSE,5);"}},JSIndexScript.prototype.COLOR_K180=function(){return{Name:"吊颈",Description:"吊颈",IsMainIndex:!0,InstructionType:2,Script:"OUT:HIGH==MAX(OPEN,CLOSE)&&HIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&CLOSE>MA(CLOSE,5);"}},JSIndexScript.prototype.COLOR_K190=function(){return{Name:"穿头破脚",Description:"穿头破脚",IsMainIndex:!0,InstructionType:2,Script:"OUT:(REF(CLOSE,1)/REF(OPEN,1)>1.03&&CLOSE/OPEN<0.96&&CLOSE<REF(OPEN,1)&&OPEN>REF(CLOSE,1))||(REF(CLOSE,1)/REF(OPEN,1)<0.97&&CLOSE/OPEN>1.04&&CLOSE>REF(OPEN,1)&&OPEN<REF(CLOSE,1));"}},JSIndexScript.prototype.COLOR_SWORD=function(){return{Name:"剑",Description:"剑",IsMainIndex:!0,InstructionType:2,Script:"AA:=VOL>REF(VOL,1)||VOL>(CAPITAL*0.1);BB:=OPEN>=(REF(HIGH,1))&&REF(HIGH,1)>(REF(HIGH,2)*1.06);CC:=CLOSE>(REF(CLOSE,1))-(REF(CLOSE,1)*0.01);DD:=CLOSE<(HIGH*0.965) && HIGH>(OPEN*1.05);EE:=LOW<OPEN && LOW<CLOSE&&HIGH>(REF(CLOSE,1)*1.06);FF:=(HIGH-(MAX(OPEN,CLOSE)))/2>(MIN(OPEN,CLOSE))-LOW;GG:=(ABS(OPEN-CLOSE))/2<(MIN(OPEN,CLOSE)-LOW);SWORDO:AA&&BB&&CC&&DD&&EE&&FF&&GG;"}},JSIndexScript.prototype.COLOR_CSFR=function(){return{Name:"出水芙蓉",Description:"出水芙蓉",IsMainIndex:!0,InstructionType:2,Script:"A:=CLOSE>OPEN;B:=A&&CLOSE>MA(CLOSE,S)&&CLOSE>MA(CLOSE,M)&&CLOSE>MA(CLOSE,LL);CC:=B&&OPEN<MA(CLOSE,M)&&OPEN<MA(CLOSE,LL);CSFRO:CC&&(CLOSE-OPEN)>0.0618*CLOSE;"}},JSIndexScript.prototype.COLOR_WYGD=function(){return{Name:"乌云盖顶",Description:"乌云盖顶",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,1)/REF(OPEN,1)>1.03 AND CLOSE/OPEN<0.97 AND OPEN>REF(CLOSE,1) AND CLOSE<REF(CLOSE,1), 3);"}},JSIndexScript.prototype.COLOR_SGCJ=function(){return{Name:"曙光初现",Description:"曙光初现",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,1)/REF(OPEN,1)<0.97 AND CLOSE/OPEN>1.03 AND OPEN<REF(CLOSE,1) AND CLOSE>REF(CLOSE,1), 3);"}},JSIndexScript.prototype.COLOR_SZTAI=function(){return{Name:"十字胎",Description:"十字胎",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1) > 0.04 AND CLOSE==OPEN AND CLOSE < MAX(REF(CLOSE,1),REF(OPEN,1)) AND CLOSE > MIN(REF(CLOSE,1),REF(OPEN,1)), 2);"}},JSIndexScript.prototype.COLOR_PINGDING=function(){return{Name:"平顶",Description:"平顶",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET(ABS(HIGH-REF(HIGH,1))/HIGH<0.001,2);"}},JSIndexScript.prototype.COLOR_PINGDI=function(){return{Name:"平底",Description:"平底",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET((ABS(LOW-REF(LOW,1))/LOW<0.001 AND ABS(REF(LOW,1)-REF(LOW,2))/REF(LOW,1)<=0.001),2);"}},JSIndexScript.prototype.COLOR_DAYANZHU=function(){return{Name:"大阳烛",Description:"大阳烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:CLOSE/OPEN>1.05 AND HIGH/LOW < CLOSE/OPEN+0.018;"}},JSIndexScript.prototype.COLOR_DAYINGZHU=function(){return{Name:"大阴烛",Description:"大阴烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:OPEN/CLOSE > 1.05 AND HIGH/LOW < OPEN/CLOSE+0.018;"}},JSIndexScript.prototype.COLOR_HYFG=function(){return{Name:"好友反攻",Description:"好友反攻",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( (REF(CLOSE,1)<REF(OPEN,1) AND CLOSE>OPEN AND ABS(CLOSE-REF(CLOSE,1))/CLOSE<0.002),2);"}},JSIndexScript.prototype.COLOR_TKQK=function(){return{Name:"跳空缺口",Description:"跳空缺口",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( HIGH<REF(LOW,1) OR LOW>REF(HIGH,1),2);"}},JSIndexScript.prototype.COLOR_SFWY=function(){return{Name:"双飞乌鸦",Description:"双飞乌鸦",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,1)<REF(OPEN,1) AND CLOSE<OPEN AND CLOSE/OPEN<0.98,1);"}},JSIndexScript.prototype.COLOR_SSSBQ=function(){return{Name:"上升三部曲",Description:"上升三部曲",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,4)/REF(OPEN,4)>1.03 AND REF(CLOSE,3)<REF(OPEN,3) AND REF(CLOSE,2)<REF(OPEN,2) AND REF(CLOSE,1)<REF(OPEN,1) AND REF(LOW,4)<REF(LOW,3) AND REF(LOW,4)<REF(LOW,2) AND REF(LOW,4)<REF(LOW,1) AND REF(HIGH,4)>REF(HIGH,3) AND REF(HIGH,4)>REF(HIGH,2) AND REF(HIGH,4)>REF(HIGH,1) AND CLOSE/OPEN>1.03 AND CLOSE>REF(CLOSE,4), 5);"}},JSIndexScript.prototype.COLOR_XDSBQ=function(){return{Name:"下跌三部曲",Description:"下跌三部曲",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,4)/REF(OPEN,4)<0.97 AND REF(CLOSE,3)>REF(OPEN,3) AND REF(CLOSE,2)>REF(OPEN,2) AND REF(CLOSE,1)>REF(OPEN,1) AND REF(LOW,4)<REF(LOW,3) AND REF(LOW,4)<REF(LOW,2) AND REF(LOW,4)<REF(LOW,1) AND REF(HIGH,4)>REF(HIGH,3) AND REF(HIGH,4)>REF(HIGH,2) AND REF(HIGH,4)>REF(HIGH,1) AND CLOSE/OPEN<0.97 AND CLOSE<REF(CLOSE,4), 5);"}},JSIndexScript.prototype.COLOR_CHXY=function(){return{Name:"长下影",Description:"长下影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(MIN(CLOSE,OPEN)-LOW)/(HIGH-LOW)>0.667;"}},JSIndexScript.prototype.COLOR_CHSY=function(){return{Name:"长上影",Description:"长上影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(HIGH-MAX(CLOSE,OPEN))/(HIGH-LOW)>0.667,COLORBLUE;"}},JSIndexScript.prototype.COLOR_FENLI=function(){return{Name:"分离",Description:"分离",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( OPEN==REF(OPEN,1) AND (CLOSE-OPEN)*(REF(CLOSE,1)-REF(OPEN,1))<0,2);"}},JSIndexScript.prototype.TRADE_BIAS=function(){return{Name:"BIAS",Description:"乖离率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:6},{Name:"LH",Value:6}],Script:"BIAS:=(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;ENTERLONG:CROSS(-LL,BIAS);EXITLONG:CROSS(BIAS,LH);"}},JSIndexScript.prototype.TRADE_CCI=function(){return{Name:"CCI",Description:"CCI专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:"TYP:=(HIGH+LOW+CLOSE)/3;CCI:=(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));INDEX:=CCI;ENTERLONG:CROSS(INDEX,-100);EXITLONG:CROSS(100,INDEX);"}},JSIndexScript.prototype.TRADE_DMI=function(){return{Name:"DMI",Description:"趋向专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:"MTR:=SUM(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(LOW-REF(CLOSE,1))),N);HD :=HIGH-REF(HIGH,1);LD :=REF(LOW,1)-LOW;PDM:=SUM(IF(HD>0&&HD>LD,HD,0),N);MDM:=SUM(IF(LD>0&&LD>HD,LD,0),N);PDI:=PDM*100/MTR;MDI:=MDM*100/MTR;ENTERLONG:CROSS(PDI,MDI);EXITLONG:CROSS(MDI,PDI);"}},JSIndexScript.prototype.TRADE_KD=function(){return{Name:"KD",Description:"KD指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:"WRSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;WK:=SMA(WRSV,M1,1);D:=SMA(WK,M2,1);ENTERLONG:CROSS(WK,D)&&WK<20;EXITLONG:CROSS(D,WK)&&WK>80;"}},JSIndexScript.prototype.TRADE_BOLL=function(){return{Name:"BOLL",Description:"布林带专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:20}],Script:"MID :=MA(CLOSE,N);UPPER:=MID+2*STD(CLOSE,N);LOWER:=MID-2*STD(CLOSE,N);ENTERLONG:CROSS(CLOSE,LOWER);EXITLONG:CROSS(CLOSE,UPPER);"}},JSIndexScript.prototype.TRADE_KDJ=function(){return{Name:"KDJ",Description:"KDJ专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3}],Script:"RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;K:=SMA(RSV,M1,1);D:=SMA(K,M1,1);J:=3*K-2*D;ENTERLONG:CROSS(J,0);EXITLONG:CROSS(100,J);"}},JSIndexScript.prototype.TRADE_MA=function(){return{Name:"MA",Description:"均线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"SHORT",Value:5},{Name:"LONG",Value:20}],Script:"ENTERLONG:CROSS(MA(CLOSE,SHORT),MA(CLOSE,LONG));EXITLONG:CROSS(MA(CLOSE,LONG),MA(CLOSE,SHORT));"}},JSIndexScript.prototype.TRADE_MACD=function(){return{Name:"MACD",Description:"MACD专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"LONG",Value:26},{Name:"SHORT",Value:12},{Name:"M",Value:9}],Script:"DIFF:=EMA(CLOSE,SHORT) - EMA(CLOSE,LONG);DEA  := EMA(DIFF,M);MACD := 2*(DIFF-DEA);ENTERLONG:CROSS(MACD,0);EXITLONG:CROSS(0,MACD);"}},JSIndexScript.prototype.TRADE_MTM=function(){return{Name:"MTM",Description:"动力指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6}],Script:"WMTM:=C-REF(C,N);ENTERLONG:CROSS(WMTM,0);EXITLONG:CROSS(0,WMTM);"}},JSIndexScript.prototype.TRADE_PSY=function(){return{Name:"PSY",Description:"PSY心理线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:10},{Name:"LH",Value:85}],Script:"MYPSY:=COUNT(CLOSE>REF(CLOSE,1),N)/N*100;ENTERLONG:CROSS(LL,MYPSY);EXITLONG:CROSS(MYPSY,LH);"}},JSIndexScript.prototype.TRADE_ROC=function(){return{Name:"ROC",Description:"变动速率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"WROC:=MA(100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N),M);ENTERLONG:CROSS(WROC,0);EXITLONG:CROSS(0,WROC);"}},JSIndexScript.prototype.TRADE_RSI=function(){return{Name:"RSI",Description:"相对强弱专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6},{Name:"LL",Value:20},{Name:"LH",Value:80}],Script:"LC:=REF(CLOSE,1);WRSI:=SMA(MAX(CLOSE-LC,0),N,1)/SMA(ABS(CLOSE-LC),N,1)*100;ENTERLONG:CROSS(WRSI,LL);EXITLONG:CROSS(LH,WRSI);"}},JSIndexScript.prototype.TRADE_VR=function(){return{Name:"VR",Description:"VR容量比率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:26},{Name:"LL",Value:70},{Name:"LH",Value:250}],Script:"WVR := SUM((IF(CLOSE>OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)/SUM((IF(CLOSE<OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)*100;ENTERLONG:CROSS(LL,WVR);EXITLONG:CROSS(WVR,LH);"}},JSIndexScript.prototype.TRADE_DPSJ=function(){return{Name:"DPSJ",Description:"大盘随机专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N1",Value:18},{Name:"N2",Value:12}],Script:"RSV:=(INDEXC-LLV(INDEXL,N1))/(HHV(INDEXH,N1)-LLV(INDEXL,N1))*100;K:=SMA(RSV,N2,1);HSL:VOL/100/(FINANCE(7));ENTERLONG: CROSS(K,20);EXITLONG: (CROSS(HSL,5) OR CROSS(K,80));"}},JSIndexScript.prototype.Zealink_Index1=function(){return{Name:"资金吸筹",Description:"资金吸筹",IsMainIndex:!1,Args:[],Script:"VAR1:=REF((LOW+OPEN+CLOSE+HIGH)/4,1);  VAR2:= SMA(ABS(LOW - VAR1), 13, 1) / SMA(MAX(LOW - VAR1, 0), 10, 1);VAR3:= EMA(VAR2, 10);VAR4:= LLV(LOW, 33);VAR5:= EMA(IF(LOW <= VAR4, VAR3, 0), 3) * 0.2;主力进场: IF(VAR5 > REF(VAR5, 1), VAR5,0), COLORRED, NODRAW;洗盘: IF(VAR5 < REF(VAR5, 1),  VAR5,0), COLORYELLOW, NODRAW;STICKLINE(VAR5> REF(VAR5, 1),0, VAR5, 20, 0), COLORRED;STICKLINE(VAR5 < REF(VAR5, 1), 0, VAR5, 20, 0), COLORYELLOW;"}},JSIndexScript.prototype.Zealink_Index2=function(){return{Name:"牛熊区间",Description:"牛熊区间",IsMainIndex:!1,YSpecificMaxMin:{Max:100,Min:1,Count:4},YSplitScale:[1,50,100],Args:[],Script:"短高H:=(20*H+19*REF(H,1)+18*REF(H,2)+17*REF(H,3)+16*REF(H,4)+15*REF(H,5)+14*REF(H,6)+ 13 * REF(H, 7) + 12 * REF(H, 8) + 11 * REF(H, 9) + 10 * REF(H, 10) + 9 * REF(H, 11) + 8 * REF(H, 12)+ 7 * REF(H, 13) + 6 * REF(H, 14) + 5 * REF(H, 15) + 4 * REF(H, 16) + 3 * REF(H, 17) + 2 * REF(H, 18) +REF(H, 20))/ 210, COLORBLUE, LINETHICK1;短低L:= (20 * L + 19 * REF(L, 1) + 18 * REF(L, 2) + 17 * REF(L, 3) + 16 * REF(L, 4) + 15 * REF(L, 5) + 14 * REF(L, 6)+ 13 * REF(L, 7) + 12 * REF(L, 8) + 11 * REF(L, 9) + 10 * REF(L, 10) + 9 * REF(L, 11) + 8 * REF(L, 12)+ 7 * REF(L, 13) + 6 * REF(L, 14) + 5 * REF(L, 15) + 4 * REF(L, 16) + 3 * REF(L, 17) + 2 * REF(L, 18) +REF(L, 20)) / 210, COLORBLUE, LINETHICK1;D90H:= EMA(短高H, 90), COLORRED, LINETHICK1;D90L:= EMA(短低L, 90), COLORRED, LINETHICK1;D90差:= D90H - D90L;D90顶:= D90H + D90差 * 2, COLORRED, LINETHICK1;D90底:= D90L - D90差 * 2, COLORRED, LINETHICK1;高0:= (EMA(EMA(H, 25), 25) - EMA(EMA(L, 25), 25)) * 1 + EMA(EMA(H, 25), 25), LINETHICK1, COLORWHITE;低0:= EMA(EMA(L, 25), 25) - (EMA(EMA(H, 25), 25) - EMA(EMA(L, 25), 25)) * 1, LINETHICK1, COLORWHITE;多头定位:= 低0 >= D90底 AND 高0 >= D90顶;空头定位:= 高0 <= D90顶 AND 低0 <= D90底;震荡定位:= 低0 >= D90底 AND 高0 <= D90顶;牛市: IF(多头定位 == 1, 100, 1), COLORRED, NODRAW;熊市: IF(空头定位 == 1, 100, 1), COLORGREEN, NODRAW;震荡: IF(震荡定位 == 1, 100, 1), COLORGRAY, NODRAW;STICKLINE(多头定位 == 1, 100, 1, 100, 0), COLORRED;STICKLINE(空头定位 == 1, 100, 1, 100, 0), COLORGREEN;STICKLINE(震荡定位 == 1, 100, 1, 100, 0), COLORGRAY;"}},JSIndexScript.prototype.Zealink_Index3=function(){return{Name:"持仓信号",Description:"持仓信号",IsMainIndex:!0,Args:[],Script:\'买线:=EMA(C,2);卖线:=EMA(SLOPE(C,30)*5+C,20); BU:=CROSS(买线,卖线);SEL:=CROSS(卖线,买线);STICKLINE(买线>=卖线 AND CLOSE>OPEN,LOW,HIGH,0,1),COLORRED;STICKLINE(买线>=卖线 AND CLOSE<OPEN,LOW,HIGH,0,1),COLORRED;STICKLINE(买线>=卖线 AND CLOSE>OPEN,CLOSE,OPEN,50,1),COLORRED;STICKLINE(买线>=卖线 AND CLOSE<OPEN,CLOSE,OPEN,50,0),COLORRED;STICKLINE(买线<卖线 AND CLOSE<OPEN,LOW,HIGH,0,1),COLORGREEN;STICKLINE(买线<卖线 AND CLOSE>OPEN,LOW,HIGH,0,1),COLORGREEN;STICKLINE(买线<卖线 AND CLOSE<OPEN,CLOSE,OPEN,50,0),COLORGREEN;STICKLINE(买线<卖线 AND CLOSE>OPEN,CLOSE,OPEN,50,1),COLORGREEN;HHJSJDA:=(3*CLOSE+OPEN+LOW+HIGH)/6;HHJSJDB:(19*HHJSJDA+19*REF(HHJSJDA,1)+18*REF(HHJSJDA,2)+17*REF(HHJSJDA,3)+16*REF(HHJSJDA,4)+15*REF(HHJSJDA,5)+14*REF(HHJSJDA,6)+13*REF(HHJSJDA,7)+12*REF(HHJSJDA,8)+11*REF(HHJSJDA,9)+10*REF(HHJSJDA,10)+9*REF(HHJSJDA,11)+8*REF(HHJSJDA,12)+7*REF(HHJSJDA,13)+6*REF(HHJSJDA,14)+5*REF(HHJSJDA,15)+4*REF(HHJSJDA,16)+3*REF(HHJSJDA,17)+2*REF(HHJSJDA,20)+REF(HHJSJDA,19))/210,COLORYELLOW;HHJSJDC:MA(HHJSJDB,5),COLORRED;SVAR11:=HHV(HIGH,34);SVAR14:=CLOSE-REF(CLOSE,1);SVAR15:=MAX(SVAR14,0);SVAR16:=ABS(SVAR14);SVAR17:=SMA(SVAR15,7,1)/SMA(SVAR16,7,1)*100;SVAR18:=SMA(SVAR15,13,1)/SMA(SVAR16,13,1)*100;SVAR19:=BARSCOUNT(CLOSE);SVAR20:=SMA(MAX(SVAR14,0),6,1)/SMA(ABS(SVAR14),6,1)*100;SVAR21:=(-200)*(HHV(HIGH,60)-CLOSE)/(HHV(HIGH,60)-LLV(LOW,60))+100;SVAR1A:=(CLOSE-LLV(LOW,15))/(HHV(HIGH,15)-LLV(LOW,15))*100;SVAR1B:=SMA((SMA(SVAR1A,4,1)-50)*2,3,1);SVAR1C:=(INDEXC-LLV(INDEXL,14))/(HHV(INDEXH,14)-LLV(INDEXL,14))*100;SVAR1D:=SMA(SVAR1C,4,1);SVAR1E:=SMA(SVAR1D,3,1);SVAR1F:=(HHV(HIGH,30)-CLOSE)/CLOSE*100;SVAR22:=SVAR20<=25 AND SVAR21<-95 AND SVAR1F>20 AND SVAR1B<-30 AND SVAR1E<30 AND SVAR11-CLOSE>=-0.25 AND SVAR17<22 AND SVAR18<28 AND SVAR19>50;BUY3:=CROSS(SVAR22,0.5) AND COUNT(SVAR22==1,10)==1;SVARF:=LOW*0.9;SVAR10X:=100-3*SMA((OPEN-LLV(LOW,75))/(HHV(HIGH,75)-LLV(LOW,75))*100,20,1)+2*SMA(SMA((OPEN-LLV(LOW,75))/(HHV(HIGH,75)-LLV(LOW,75))*100,20,1),15,1);SVAR11X:=SVARF<REF(SVAR10X,1) AND VOL>REF(VOL,1) AND CLOSE>REF(CLOSE,1);BUY2:=SVAR11X AND COUNT(SVAR11X,30)==1;VAR1:=(CLOSE+HIGH+LOW+OPEN)/4;VAR2:=SUMBARS(VOL,CAPITAL);VAR3:=HHV(VAR1,VAR2);VAR4:=LLV(VAR1,VAR2);VAR5:=(2*VAR1-VAR4-REF(VAR4,1))/(VAR3-VAR4);VAR6:=(VAR1-VAR4)/(VAR3-VAR4);VAR7:=IF(VAR1<=VAR4,VAR5*60,VAR6*60);VAR8:=600*(EMA(CLOSE,3)-EMA(LOW,30))/EMA(LOW,30);VAR9:=EMA(VAR8,7);VARC:=HHV(HIGH,9)-LLV(LOW,9);VARD:=HHV(HIGH,9)-CLOSE;VARE:=CLOSE-LLV(LOW,9);VARF:=VARD/VARC*100-70;VAR10:=(CLOSE-LLV(LOW,60))/(HHV(HIGH,60)-LLV(LOW,60))*100;VAR11:=(2*CLOSE+HIGH+LOW)/4;VAR12:=SMA(VARE/VARC*100,3,1);VAR13:=LLV(LOW,34);VAR14:=SMA(VAR12,3,1)-SMA(VARF,9,1);VAR15:=IF(VAR14>100,VAR14-100,0);VAR16:=HHV(HIGH,34);VAR17:=EMA((VAR11-VAR13)/(VAR16-VAR13)*100,8);VAR18:=EMA(VAR17,5);BUY:=STICKLINE(VAR17-VAR18>0,VAR17,VAR18,8,1),COLORRED;SELL:=STICKLINE(VAR17-VAR18<0,VAR17,VAR18,8,1),COLORGREEN;BUY1:=VAR17>VAR18 AND REF(VAR17,1)<REF(VAR18,1);SELL1:=VAR17<VAR18 AND REF(VAR17,1)>REF(VAR18,1);短高H:=(20*H+19*REF(H,1)+18*REF(H,2)+17*REF(H,3)+16*REF(H,4)+15*REF(H,5)+14*REF(H,6)+13*REF(H,7)+12*REF(H,8)+11*REF(H,9)+10*REF(H,10)+9*REF(H,11)+8*REF(H,12)+7*REF(H,13)+6*REF(H,14)+5*REF(H,15)+4*REF(H,16)+3*REF(H,17)+2*REF(H,18)+REF(H,20))/210,COLORBLUE,LINETHICK1;短低L:=(20*L+19*REF(L,1)+18*REF(L,2)+17*REF(L,3)+16*REF(L,4)+15*REF(L,5)+14*REF(L,6)+13*REF(L,7)+12*REF(L,8)+11*REF(L,9)+10*REF(L,10)+9*REF(L,11)+8*REF(L,12)+7*REF(L,13)+6*REF(L,14)+5*REF(L,15)+4*REF(L,16)+3*REF(L,17)+2*REF(L,18)+REF(L,20))/210,COLORBLUE,LINETHICK1;D90H:=EMA(短高H,90),COLORRED,LINETHICK1;D90L:=EMA(短低L,90),COLORRED,LINETHICK1;D90差:=D90H-D90L;D90顶:=D90H+D90差*2,COLORRED,LINETHICK1;D90底:=D90L-D90差*2,COLORRED,LINETHICK1;高0:=(EMA(EMA(H,25),25)-EMA(EMA(L,25),25))*1+EMA(EMA(H,25),25),LINETHICK1,COLORWHITE;低0:=EMA(EMA(L,25),25)-(EMA(EMA(H,25),25)-EMA(EMA(L,25),25))*1,LINETHICK1,COLORWHITE;多头定位:=低0>=D90底 AND 高0>=D90顶;空头定位:=高0<=D90顶 AND 低0<=D90底;震荡定位:=低0>=D90底 AND 高0<=D90顶;牛市:=多头定位==1;熊市:=空头定位==1;震荡:=震荡定位==1;非牛市:=熊市 OR 震荡;非熊市:=牛市 OR 震荡;BUY11:=BUY1 AND 非熊市;SELL11:=SELL1 AND 震荡定位==0;BUY111:=BUY11 AND COUNT(BUY11,10)<2;BUY0:=BUY111 AND COUNT(BUY111,21)==1;SELL111:=SELL11 AND COUNT(SELL11,10)<2;SELL0:=SELL111 AND COUNT(SELL111,10)==1;XK1:=EMA(100*(CLOSE-LLV(LOW,34))/(HHV(HIGH,34)-LLV(LOW,34)),3)/4;上穿:=REF(XK1,1)<5 AND XK1>=5;BUY4:=上穿 AND COUNT(XK1<2,12)<1;SELL2:=REF(XK1,1)<=22.5 AND XK1>22.5 AND COUNT(REF(XK1,1)>=22.5 AND XK1<22.5,5)>0;SELL3:=REF(XK1,1)>=21.5 AND XK1<21.5 AND COUNT(REF(XK1,1)>=22.5 AND XK1<22.5,12)>1;SELL4:=SELL2 OR SELL3 AND COUNT((SELL2 OR SELL3)==1,5)==1;SUPERDRAWTEXT(BUY0,L,"机会",2,10),COLORRED;SUPERDRAWTEXT(SELL0,H,"风险",1,10),COLORGREEN;SUPERDRAWTEXT(BUY2,L,"机会",2,10),COLORRED;SUPERDRAWTEXT(BUY4,L,"机会",2,10),COLORRED;SUPERDRAWTEXT(SELL4,H,"风险",1,10),COLORGREEN;\'}},JSIndexScript.prototype.Zealink_Index4=function(){return{Name:"股东实际增减持",Description:"股东实际增减持",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"增持:NEWS(4),NODRAW,COLORRED;减持:NEWS(5),NODRAW,COLORGREEN;STICKLINE(增持>0,0,增持,1,0),COLORRED;STICKLINE(减持<0,0,减持,1,0),COLORGREEN;"}},JSIndexScript.prototype.Zealink_Index5=function(){return{Name:"大宗交易",Description:"大宗交易",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"交易次数:NEWS(7);"}},JSIndexScript.prototype.Zealink_Index6=function(){return{Name:"信托持股",Description:"信托持股",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"家数:NEWS(6);"}},JSIndexScript.prototype.Zealink_Index7=function(){return{Name:"官网新闻",Description:"官网新闻",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"个数:NEWS(8);"}},JSIndexScript.prototype.Zealink_Index8=function(){return{Name:"高管要闻",Description:"高管要闻",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"个数:NEWS(9);"}},JSIndexScript.prototype.Zealink_Index9=function(){return{Name:"股权质押",Description:"股权质押",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"次数:NEWS(10);"}},JSIndexScript.prototype.Zealink_Index10=function(){return{Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,FloatPrecision:0,Args:[],Script:"JJ:=(CLOSE+HIGH+LOW)/3; A:=EMA(JJ,10); B:=REF(A,1);M1:=EMA(CLOSE,3);M2:=EMA(CLOSE,8); M3:=EMA(M2,13); M4:=EMA(M2,55); B1:=A>B AND REF(A,1)<REF(B,1);S1:=A<B AND REF(A,1)>REF(B,1);INDEXCLOSE:INDEXC,EXDATA;INDEXOPEN:INDEXO,EXDATA;DRAWICON(REF(B1,1),L*0.97,13);DRAWICON(REF(S1,1),H*1.03,14);"}},JSIndexScript.prototype.Zealink_Index11=function(){return{Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,FloatPrecision:0,Args:[],Script:"JJ:=(CLOSE+HIGH+LOW)/3;A:=EMA(JJ,10);B:=REF(A,1);M1:=EMA(CLOSE,3);M2:=EMA(CLOSE,8); M3:=EMA(M2,13);M4:=EMA(M2,55);持股区域:=STICKLINE(A>B,A,B,2,0),COLORYELLOW; 持币区域:=STICKLINE(A<B,A,B,2,0),COLORBLUE;VR1:=(C+O+REF(C,1))/3;VR3:=HHV(VR1,21);VR4:=LLV(VR1,21);VR5:=(2*VR1-VR4-REF(VR4,1))/(VR3-VR4);VR6:=(VR1-VR4)/(VR3-VR4);VR7:=IF(VR1<=VR4,VR5*60,VR6*60);VR8:=600*(EMA(C,3)-EMA(L,30))/EMA(L,30);VR9:=EMA(VR8,7);VRA:=(WINNER(120*C/100)-WINNER(100*C/100))*100;VRB:=(-100)*(WINNER(120*C/100)-WINNER(100*C/100))+5;VRC:=HHV(H,9)-LLV(L,9);VRD:=HHV(H,9)-C;VRE:=C-LLV(L,9);VRF:=VRD/VRC*100-70;VR10:=(C-LLV(L,60))/(HHV(H,60)-LLV(L,60))*100;VR11:=(2*C+H+L)/4;VR12:=SMA(VRE/VRC*100,3,1);VR13:=LLV(L,34);VR14:=SMA(VR12,3,1)-SMA(VRF,9,1);VR15:=IF(VR14>100,VR14-100,0);VR16:=HHV(H,34);VR17:=EMA((VR11-VR13)/(VR16-VR13)*100,8);VR18:=EMA(VR17,5);B1:=A>B AND REF(A,1)<REF(B,1);S1:=A<B AND REF(A,1)>REF(B,1);B9:=BARSLAST(REF(B1,1) AND (REF(VR17>VR18,1) OR MIN(VR17,VR18)>REF(MAX(VR17,VR18),1)));S9:=BARSLAST(REF(S1,1) AND (REF(VR17<VR18,1) OR MAX(VR17,VR18)<REF(MIN(VR17,VR18),1)));DRAWICON(REF(B1,1) AND (REF(VR17>VR18,1) OR MIN(VR17,VR18)>REF(MAX(VR17,VR18),1)) AND REF(B9,2)>=S9,L*0.97,13);DRAWICON(REF(S1,1) AND (REF(VR17<VR18,1) OR MAX(VR17,VR18)<REF(MIN(VR17,VR18),1)) AND REF(S9,1)>=B9,H*1.03,14);DRAWKLINE_IF(VR17>VR18,HIGH,CLOSE,LOW,OPEN),COLORRED;DRAWKLINE_IF(VR17<VR18,HIGH,CLOSE,LOW,OPEN),COLORBLUE;INDEXCLOSE:INDEXC,EXDATA;\t\t//取指数的收盘价 回测的时候计算BATE系数用 "}},JSIndexScript.prototype.HeikinAshi=function(){return{Name:"平均K线",Description:"Heikin-Ashi 平均K线",IsMainIndex:!0,KLineType:-1,Args:[],Script:"HCLOSE:(OPEN+HIGH+LOW+CLOSE)/4, NODRAW;HOPEN:(REF(OPEN,1)+REF(CLOSE,1))/2,NODRAW;HHIGH:MAX(HIGH,MAX(HOPEN,HCLOSE)),NODRAW;HLOW:MIN(LOW,MIN(HOPEN,HCLOSE)),NODRAW;DRAWKLINE(HHIGH,HOPEN,HLOW,HCLOSE);"}},JSIndexScript.prototype.ADL=function(){return{Name:"腾落指标",Description:"腾落指标",IsMainIndex:!1,StringFormat:2,Condition:{Period:[CONDITION_PERIOD.KLINE_DAY_ID,CONDITION_PERIOD.KLINE_WEEK_ID,CONDITION_PERIOD.KLINE_TWOWEEK_ID,CONDITION_PERIOD.KLINE_MONTH_ID,CONDITION_PERIOD.KLINE_QUARTER_ID,CONDITION_PERIOD.KLINE_YEAR_ID],Include:["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]},Args:[{Name:"M",Value:7}],Script:"ADL:SUM(ADVANCE-DECLINE,0);MAADL:MA(ADL,M);"}},JSIndexScript.prototype.EMPTY=function(){return{Name:"",Description:"空指标",IsMainIndex:!0,Args:[],Script:"VAR2:=C;"}},JSIndexScript.prototype.CJL=function(){return{Name:"CJL",Description:"期货持仓量",IsMainIndex:!1,Args:[],Script:"成交量:VOL,VOLSTICK;持仓量:VOLINSTK,LINEOVERLAY;"}},JSIndexScript.prototype.ASI=function(){return{Name:"ASI",Description:"振动升降指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6}],Script:"X_1:=REF(CLOSE,1);X_2:=ABS(HIGH-X_1);X_3:=ABS(LOW-X_1);X_4:=ABS(HIGH-REF(LOW,1));X_5:=ABS(X_1-REF(OPEN,1));X_6:=IF(X_2>X_3 AND X_2>X_4,X_2+X_3/2+X_5/4,IF(X_3>X_4 AND X_3>X_2,X_3+X_2/2+X_5/4,X_4+X_5/4));X_7:=CLOSE-X_1+(CLOSE-OPEN)/2+X_1-REF(OPEN,1);X_8:=8*X_7/X_6*MAX(X_2,X_3);ASI:SUM(X_8,0),LINETHICK2;MASI:MA(ASI,N1),LINETHICK2;"}},JSIndexScript.prototype.DC=function(){return{Name:"DC",Description:"唐奇安通道",IsMainIndex:!0,Args:[{Name:"N1",Value:20}],Script:"UPPER:HHV(H,N1),COLORBLUE,LINETHICK2;LOWER:LLV(L,N1),COLORBLUE,LINETHICK2;MIDDLE:(UPPER+LOWER)/2,COLORRED,LINETHICK3;"}},JSIndexScript.prototype.DEMA=function(){return{Name:"DEMA",Description:"双重指数移动均线",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:"ERR:=C-EMA(C,N1);DEMA:EMA(C,10)+EMA(ERR,N1);"}},JSIndexScript.prototype.VWAP=function(){return{Name:"VWAP",Description:"成交量加权平均价",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:"PRICE:=(H+L+C)/3;T2:=VOL*PRICE;VWAP:SUM(T2,0)/SUM(VOL,0);"}},JSIndexScript.prototype.SQJZ=function(){return{Name:"SQJZ",Description:"神奇九转",IsMainIndex:!0,Script:"B:=C<REF(C,4);N:=CURRBARSCOUNT;B1:=(N=6 AND REFXV(COUNT(B,6),5)=6) OR (N=7 AND REFXV(COUNT(B,7),6)=7) OR (N=8 AND REFXV(COUNT(B,8),7)=8) OR (N>=9 AND REFXV(COUNT(B,9),8)=9);DRAWNUMBER(B1 AND REF(B,1)=0,L,1),COLORMAGENTA;B2:=(N=5 AND REFXV(COUNT(B,6),4)=6) OR (N=6 AND REFXV(COUNT(B,7),5)=7) OR (N=7 AND REFXV(COUNT(B,8),6)=8) OR (N>=8 AND REFXV(COUNT(B,9),7)=9);DRAWNUMBER(B2 AND REF(B,2)=0,L,2),COLORMAGENTA;B8:=(N=1 AND COUNT(B,8)=8) OR (N>=2 AND REFXV(COUNT(B,9),1)=9);DRAWNUMBER(B8 AND REF(B,8)=0,L,8),COLORMAGENTA;B9:=(N>=1 AND COUNT(B,9)=9);DRAWNUMBER(B9 AND REF(B,9)=0,L,9),COLORBROWN;S:=C>REF(C,4);S1:=(N=6 AND REFXV(COUNT(S,6),5)=6) OR (N=7 AND REFXV(COUNT(S,7),6)=7) OR (N=8 AND REFXV(COUNT(S,8),7)=8) OR (N>=9 AND REFXV(COUNT(S,9),8)=9);DRAWNUMBER(S1 AND REF(S,1)=0,H,1),COLORMAGENTA,DRAWABOVE;S2:=(N=5 AND REFXV(COUNT(S,6),4)=6) OR (N=6 AND REFXV(COUNT(S,7),5)=7) OR (N=7 AND REFXV(COUNT(S,8),6)=8) OR (N>=8 AND REFXV(COUNT(S,9),7)=9);DRAWNUMBER(S2 AND REF(S,2)=0,H,2),COLORMAGENTA,DRAWABOVE;S8:=(N=1 AND COUNT(S,8)=8) OR (N>=2 AND REFXV(COUNT(S,9),1)=9);DRAWNUMBER(S8 AND REF(S,8)=0,H,8),COLORMAGENTA,DRAWABOVE;S9:=(N>=1 AND COUNT(S,9)=9);DRAWNUMBER(S9 AND REF(S,9)=0,H,9),COLORGREEN,DRAWABOVE;"}},JSIndexScript.prototype.XT=function(){return{Name:"XT",Description:"箱体",IsMainIndex:!0,Args:[{Name:"N",Value:10}],Script:"【箱顶】:PEAK(CLOSE,N,1)*0.98;【箱底】:TROUGH(CLOSE,N,1)*1.02;【箱高】:100*(【箱顶】-【箱底】)/【箱底】,NODRAW;"}},JSIndexScript.prototype.CFJT=function(){return{Name:"CFJT",Description:"财富阶梯",IsMainIndex:!0,Script:"突破:=REF(EMA(C,14),1);A1X:=(EMA(C,10)-突破)/突破*100;多方:=IF(A1X>=0,REF(EMA(C,10),BARSLAST(CROSS(A1X,0))+1),DRAWNULL);空方:=IF(A1X<0,REF(EMA(C,10),BARSLAST(CROSS(0,A1X))+1),DRAWNULL);STICKLINE(A1X>=0,多方,突破,110,0),COLORRED;STICKLINE(A1X<0,空方,突破,110,0),COLORGREEN;"}},JSIndexScript.prototype.CYX=function(){return{Name:"CYX",Description:"撑压线",IsMainIndex:!0,Args:[{Name:"N",Value:7}],Script:"Z1:=STRCAT(HYBLOCK,\' \');Z2:=STRCAT(Z1,DYBLOCK);Z3:=STRCAT(Z2,\' \');DRAWTEXT_FIX(ISLASTBAR,0,0,0,STRCAT(Z3,GNBLOCK)),COLOR00C0C0;A1:=REF(H,N)=HHV(H,2*N+1);B1:=FILTER(A1,N);C1:=BACKSET(B1,N+1);D1:=FILTER(C1,N);A2:=REF(L,N)=LLV(L,2*N+1);B2:=FILTER(A2,N);C2:=BACKSET(B2,N+1);D2:=FILTER(C2,N);E1:=(REF(LLV(L,2*N),1)+REF(HHV(H,2*N),1))/2;E2:=(H+L)/2;H1:=(D1 AND NOT(D2 AND E1>=E2)) OR ISLASTBAR OR BARSCOUNT(C)=1;L1:=(D2 AND NOT(D1 AND E1<E2));H2:=D1 AND NOT(D2 AND E1>=E2);X1:=REF(BARSLAST(H1),1)+1;F1:=BACKSET(H1 AND COUNT(L1,X1)>0,LLVBARS(IF(L1,L,10000),X1));G1:=F1>REF(F1,1);I1:=BACKSET(G1,2);LD:=I1>REF(I1,1);L2:=LD OR ISLASTBAR OR BARSCOUNT(C)=1;X2:=REF(BARSLAST(L2),1)+1;F2:=BACKSET(L2 AND COUNT(H2,X2)>0,HHVBARS(IF(H2,H,0),X2));G2:=F2>REF(F2,1);I2:=BACKSET(G2,2);HD:=I2>REF(I2,1);R1:=BACKSET(ISLASTBAR,BARSLAST(HD)+1);S1:=R1>REF(R1,1);T1:=BACKSET(ISLASTBAR,BARSLAST(LD)+1);U1:=T1>REF(T1,1);R2:=BACKSET(S1,REF(BARSLAST(HD),1)+2);S2:=R2>REF(R2,1);T2:=BACKSET(U1,REF(BARSLAST(LD),1)+2);U2:=T2>REF(T2,1);DRAWLINE(S2,H,S1,H,1),LINETHICK2,COLORRED;DRAWLINE(U2,L,U1,L,1),LINETHICK2,COLORGREEN;"}},JSIndexScript.prototype.WAVE=function(){return{Name:"WAVE",Description:"波浪分析",IsMainIndex:!0,Args:[{Name:"N",Value:5}],Script:"ZIG(3,N);"}},JSIndexScript.prototype.TEST=function(){return{Name:"TEST",Description:"测试脚本",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:"DRAWCHANNEL(OPEN>C,H,L, \'RGB(255,94,102)\', 2 ,\'5,5\',\'RGBA(58,20,62,0.3)\' );"}};var debug=!1;function oldChart(e,t){for(var a=-1,r=0;r<e.OldPaint.length;r++)e.OldPaint[r].Name==t.Name&&(a=r);return!(a<0)&&e.OldPaint[a]}function mylog(){debug&&console.log.apply(console,arguments)}if(!JSConsole)var JSConsole={Chart:{Log:mylog},Complier:{Log:mylog}};var g_JSComplierResource={Domain:"https://opensource.zealink.com",CacheDomain:"https://opensourcecache.zealink.com",DrawIcon:{Family:"iconfont",Data:new Map([[1,{Text:"",Color:"rgb(255,106,106)"}],[2,{Text:"",Color:"rgb(46,139,87)"}],[11,{Text:"",Color:"rgb(245,159,40)"}],[12,{Text:"",Color:"rgb(245,159,40)"}],[13,{Text:"",Color:"rgb(209,37,35)"}],[14,{Text:"",Color:"rgb(127,209,59)"}],[9,{Text:"",Color:"rgb(245,159,40)"}],[36,{Text:"",Color:"rgb(255,106,106)"}],[37,{Text:"",Color:"rgb(46,139,87)"}],[38,{Text:"",Color:"rgb(238,44,44)"}],[39,{Text:"",Color:"rgb(0,139,69)"}],[46,{Text:"",Color:"rgb(51,51,51)"}]])},CustomDrawIcon:{Data:new Map},CustomFunction:{Data:new Map},CustomVariant:{Data:new Map},GetDrawIcon:function(e){if(g_JSComplierResource.CustomDrawIcon.Data.has(e)){const t=g_JSComplierResource.CustomDrawIcon.Data.get(e);return{Symbol:t.Text,Color:t.Color,Family:t.Family,IconFont:!0,ID:e}}if(g_JSComplierResource.DrawIcon.Data.has(e)){const t=g_JSComplierResource.DrawIcon.Data.get(e);return{Symbol:t.Text,Color:t.Color,Family:g_JSComplierResource.DrawIcon.Family,IconFont:!0,ID:e}}return null},GetDrawTextIcon:function(e){return new Map([[1,{Symbol:"↑",Color:"rgb(238,44,44)"}],[2,{Symbol:"↓",Color:"rgb(0,139,69)"}],[3,{Symbol:"😧"}],[4,{Symbol:"😨"}],[5,{Symbol:"😁"}],[6,{Symbol:"😱"}],[7,{Symbol:"B",Color:"rgb(238,44,44)"}],[8,{Symbol:"S",Color:"rgb(0,139,69)"}],[9,{Symbol:"💰"}],[10,{Symbol:"📪"}],[11,{Symbol:"👆"}],[12,{Symbol:"👇"}],[13,{Symbol:"B",Color:"rgb(178,34,34)"}],[14,{Symbol:"S",Color:"rgb(0,139,69)"}],[36,{Symbol:"Χ",Color:"rgb(238,44,44)"}],[37,{Symbol:"X",Color:"rgb(0,139,69)"}],[38,{Symbol:"▲",Color:"rgb(238,44,44)"}],[39,{Symbol:"▼",Color:"rgb(0,139,69)"}],[40,{Symbol:"◉",Color:"rgb(238,44,44)"}],[41,{Symbol:"◈",Color:"rgb(238,44,44)"}],[42,{Symbol:"📌"}],[43,{Symbol:"💎"}],[44,{Symbol:"🥇"}],[45,{Symbol:"🥈"}],[46,{Symbol:"🥉"}],[47,{Symbol:"🏅"}]]).get(e)},IsCustomFunction:function(e){return!!g_JSComplierResource.CustomFunction.Data.has(e)},IsCustomVariant:function(e){return!!g_JSComplierResource.CustomVariant.Data.has(e)}},Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal \'use strict\' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 \'%1\' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label \'%0\'",UnterminatedRegExp:"Invalid regular expression: missing /"},Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},Character={FromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},IsWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},IsLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},IsIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||12304===e||12305===e||e>=128&&Regex.NonAsciiIdentifierStart.test(Character.FromCodePoint(e))},IsIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||35===e||12304===e||12305===e||e>=128&&Regex.NonAsciiIdentifierPart.test(Character.FromCodePoint(e))},IsDecimalDigit:function(e){return e>=48&&e<=57},IsHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}},TOKEN_NAME={};function JSComplierHelper(){}function ErrorHandler(){this.Error=[],this.RecordError=function(e){this.Error.push(e)},this.ConstructError=function(e,t){let a=new Error(e);try{throw a}catch(e){Object.create&&Object.defineProperties&&((a=Object.create(e)).Column=t)}return a},this.CreateError=function(e,t,a,r,i){let n="Line "+t+": "+r,s=this.ConstructError(n,a);return s.Index=e,s.LineNumber=t,s.Description=r,s.Word=i,s},this.ThrowError=function(e,t,a,r,i){throw this.CreateError(e,t,a,r,i)},this.ThrowDownloadJob=function(e,t,a,r,i){let n=this.CreateError(e,t,a,r);throw n.Job=i,n}}function Scanner(e,t){this.Source=e,this.ErrorHandler=t,this.Length=e.length,this.Index=0,this.LineNumber=e.length>0?1:0,this.LineStart=0,this.CurlyStack=[],this.SaveState=function(){return{Index:this.Index,LineNumber:this.LineNumber,LineStart:this.LineStart}},this.RestoreState=function(e){this.Index=e.Index,this.LineNumber=e.LineNumber,this.LineStart=e.LineStart},this.IsEOF=function(){return this.Index>=this.Length},this.IsKeyword=function(e){return!1},this.CodePointAt=function(e){let t=this.Source.charCodeAt(e);if(t>=55296&&t<=56319){let a=this.Source.charCodeAt(e+1);if(a>=56320&&a<=57343)t=1024*(t-55296)+a-56320+65536}return t},this.Lex=function(){if(this.IsEOF())return{Type:2,Value:"",LineNumber:this.LineNumber,LineStart:this.LineStart,Start:this.Index,End:this.Index};let e=this.Source.charCodeAt(this.Index);return Character.IsIdentifierStart(e)?this.ScanIdentifier():40===e||41===e||59===e?this.ScanPunctuator():39===e||34===e?this.ScanStringLiteral():46==e?Character.IsDecimalDigit(this.Source.charCodeAt(this.Index+1))?this.ScanNumericLiteral():this.ScanPunctuator():Character.IsDecimalDigit(e)?this.ScanNumericLiteral():e>=55296&&e<57343&&Character.IsIdentifierStart(this.CodePointAt(this.Index))?this.ScanIdentifier():this.ScanPunctuator()},this.ScanIdentifier=function(){let e,t=this.Index,a=92===this.Source.charCodeAt(t)?this.GetComplexIdentifier():this.GetIdentifier();if(3!=(e=a.length?3:this.IsKeyword(a)?4:null==a?5:"true"==a||"false"==a?1:3)&&t+a.length!=this.Index){this.Index;throw this.Index=t,Messages.InvalidEscapedReservedWord}return"AND"!=a&&"OR"!=a||(e=7),{Type:e,Value:a,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:t,End:this.Index}},this.GetIdentifier=function(){let e=this.Index++;for(;!this.IsEOF();){let t=this.Source.charCodeAt(this.Index);if(92==t)return this.Index=e,this.GetComplexIdentifier();if(t>=55296&&t<57343)return this.Index=e,this.GetComplexIdentifier();if(!Character.IsIdentifierPart(t))break;++this.Index}return this.Source.slice(e,this.Index)},this.ScanPunctuator=function(){let e=this.Index,t=this.Source[this.Index];switch(t){case"(":++this.Index;break;case")":case";":case",":case".":++this.Index;break;default:"AND"==(t=this.Source.substr(this.Index,3))?this.Index+=3:"&&"===(t=this.Source.substr(this.Index,2))||"||"===t||"=="===t||"!="===t||"<="===t||">="===t||"=>"===t||":="==t||"OR"==t||"<>"==t?this.Index+=2:(t=this.Source[this.Index],"<>=!+-*%&|^/:".indexOf(t)>=0&&++this.Index)}return this.Index==e&&this.ThrowUnecpectedToken(),{Type:7,Value:t,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:e,End:this.Index}},this.ScanStringLiteral=function(){let e=this.Index,t=this.Source[this.Index];++this.Index;let a="";for(;!this.IsEOF();){let e=this.Source[this.Index++];if(e==t){t="";break}if("\"==e)throw"not complete";if(Character.IsLineTerminator(e.charCodeAt(0)))break;a+=e}return""!=t&&(this.Index=e,this.ThrowUnecpectedToken()),{Type:8,Value:a,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:e,End:this.Index}},this.ScanNumericLiteral=function(){let e=this.Index,t=this.Source[this.Index],a="";if("."!=t){if(a=this.Source[this.Index++],t=this.Source[this.Index],"0"==a&&("x"==t||"X"==t))return++this.Index,this.ScanHexLiteral(e);for(;Character.IsDecimalDigit(this.Source.charCodeAt(this.Index));)a+=this.Source[this.Index++];t=this.Source[this.Index]}if("."==t){for(a+=this.Source[this.Index++];Character.IsDecimalDigit(this.Source.charCodeAt(this.Index));)a+=this.Source[this.Index++];t=this.Source[this.Index]}if("e"==t||"E"==t)if(a+=this.Source[this.Index++],"+"!=(t=this.Source[this.Index])&&"-"!=t||(a+=this.Source[this.Index]),Character.IsDecimalDigit(this.Source.charCodeAt(this.Index)))for(;Character.IsDecimalDigit(this.Source.charCodeAt(this.Index));)a+=this.Source[this.Index++];else this.ThrowUnecpectedToken();return Character.IsIdentifierStart(this.Source.charCodeAt(this.Index))&&this.ThrowUnecpectedToken(),{Type:6,Value:parseFloat(a),LineNumber:this.LineNumber,LineStart:this.LineStart,Start:e,End:this.Index}},this.ScanComments=function(){let e=0==this.Index;for(;!this.IsEOF();){let t=this.Source.charCodeAt(this.Index);if(Character.IsWhiteSpace(t))++this.Index;else if(Character.IsLineTerminator(t))++this.Index,13==t&&10==this.Source.charCodeAt(this.Index)&&++this.Index,++this.LineNumber,this.LineStart=this.Index,e=!0;else if(47==t){if(47!=(t=this.Source.charCodeAt(this.Index+1)))break;this.Index+=2;this.SkipSingleLineComment(2);e=!0}else{if(123!=t)break;this.Index+=1;this.SkipMultiLineComment()}}},this.SkipMultiLineComment=function(){for(var e=[];!this.IsEOF();){var t=this.Source.charCodeAt(this.Index);if(Character.IsLineTerminator(t))++this.LineNumber,++this.Index,this.LineStart=this.Index;else{if(125==t)return this.Index+=1,e;++this.Index}}return e},this.SkipSingleLineComment=function(e){let t=[];for(;!this.IsEOF();){let e=this.Source.charCodeAt(this.Index);if(++this.Index,Character.IsLineTerminator(e))return 13===e&&10===this.Source.charCodeAt(this.Index)&&++this.Index,++this.LineNumber,this.LineStart=this.Index,t}return t},this.ThrowUnecpectedToken=function(e,t){return e||(e=Messages.UnexpectedTokenIllegal),this.ErrorHandler.ThrowError(this.Index,this.LineNumber,this.Index-this.LineStart+1,e,t)}}function Tokenizer(e){this.ErrorHandler=new ErrorHandler,this.Scanner=new Scanner(e,this.ErrorHandler),this.Buffer=[],this.GetNextToken=function(){if(0==this.Buffer.length){this.Scanner.ScanComments();if(!this.Scanner.IsEOF()){let e=this.Scanner.Lex(),t={Type:TOKEN_NAME[e.Type],Value:this.Scanner.Source.slice(e.Start,e.End)};this.Buffer.push(t)}}return this.Buffer.shift()}}TOKEN_NAME[1]="Boolean",TOKEN_NAME[2]="<end>",TOKEN_NAME[3]="Identifier",TOKEN_NAME[4]="Keyword",TOKEN_NAME[5]="Null",TOKEN_NAME[6]="Numeric",TOKEN_NAME[7]="Punctuator",TOKEN_NAME[8]="String",TOKEN_NAME[9]="RegularExpression",TOKEN_NAME[10]="Template",JSComplierHelper.GetPeriodInfo=function(e){const t=[{Name:"MIN1",Period:4,Order:1},{Name:"MIN5",Period:5,Order:2},{Name:"MIN15",Period:6,Order:3},{Name:"MIN30",Period:7,Order:4},{Name:"MIN60",Period:8,Order:5},{Name:"DAY",Period:0,Order:1e3},{Name:"WEEK",Period:1,Order:1001},{Name:"MONTH",Period:2,Order:1002},{Name:"SEASON",Period:9,Order:1003},{Name:"YEAR",Period:3,Order:1004}];if(e.Name){for(var a in t)if(e.Name&&t[a].Name==e.Name)return t[a];return null}if(IFrameSplitOperator.IsNumber(e.PeriodID)){for(var a in t)if(t[a].Period==e.PeriodID)return t[a];return null}return null},JSComplierHelper.GetConvertValueName=function(e){var t;return"COVER_C"==e?t="CLOSE":"COVER_O"==e?t="OPEN":"COVER_H"==e?t="HIGH":"COVER_L"==e?t="LOW":"COVER_A"==e?t="AMOUNT":"COVER_V"==e&&(t="VOL"),t};var Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};function Node(e){this.IsNeedIndexData=!1,this.IsNeedLatestIndexData=!1,this.IsNeedLatestData=!1,this.IsNeedSymbolData=!1,this.IsNeedMarginData=new Set,this.IsNeedNewsAnalysisData=new Set,this.NeedBlockIncreaseData=[],this.IsNeedSymbolExData=new Set,this.NeedHK2SHSZData=[],this.IsNeedSectionFinance=new Map,this.FunctionData=[],this.IsAPIData=[],this.ExecuteIndex=[],this.OtherSymbolData=[],this.PeriodSymbolData=[],this.ErrorHandler=e,this.GetDataJobList=function(){let e=[];for(var t in this.IsNeedSymbolData&&e.push({ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_DATA}),this.IsNeedIndexData&&e.push({ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_INDEX_DATA}),this.IsNeedLatestData&&e.push({ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_LATEST_DATA}),this.IsNeedLatestIndexData&&e.push({ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_LATEST_INDEX_DATA}),this.NeedBlockIncreaseData)e.push(this.NeedBlockIncreaseData[t]);for(var a of this.IsNeedMarginData)e.push({ID:a});for(var t in this.NeedHK2SHSZData)e.push(this.NeedHK2SHSZData[t]);for(var a of this.IsNeedNewsAnalysisData)e.push({ID:a});for(var a of this.IsNeedSymbolExData)e.push({ID:a});for(var r of this.IsNeedSectionFinance)e.push({ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_SF,SF:r});for(var t in this.IsAPIData){r=this.IsAPIData[t];e.push(r)}for(var t in this.ExecuteIndex){r=this.ExecuteIndex[t];e.push(r)}for(var t in this.OtherSymbolData){r=this.OtherSymbolData[t];e.push(r)}for(var t in this.PeriodSymbolData){r=this.PeriodSymbolData[t];e.push(r)}for(var t in this.FunctionData){r=this.FunctionData[t];e.push(r)}return e},this.VerifySymbolVariable=function(e,t){if(new Set(["INDEXA","INDEXC","INDEXH","INDEXL","INDEXO","INDEXV","INDEXDEC","INDEXADV"]).has(e))this.IsNeedIndexData=!0;else if(new Set(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]).has(e))this.IsNeedSymbolData=!0;else{if("VOLR"===e&&(this.IsNeedSymbolExData.has(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_VOLR_DATA)||this.IsNeedSymbolExData.add(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_VOLR_DATA)),"HYBLOCK"!=e&&"DYBLOCK"!=e&&"GNBLOCK"!=e||this.IsNeedSymbolExData.has(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GROUP_DATA)||this.IsNeedSymbolExData.add(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GROUP_DATA),new Set(["CAPITAL","TOTALCAPITAL","EXCHANGE"]).has(e)){var a={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_VARIANT,VariantName:e};return t&&(a.Token={Index:t.Start,Line:t.LineNumber}),void this.FunctionData.push(a)}if("FROMOPEN"!=e){if("ADVANCE"==e||"DECLINE"==e){a={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_INDEX_INCREASE_DATA,IsSelfSymbol:!0,FunctionName:e};return t&&(a.Token={Index:t.Start,Line:t.LineNumber}),void this.NeedBlockIncreaseData.push(a)}if(e.indexOf("#")>0){var r=e.split("#");if(2!=r.length){var i=`${e}, 跨周期语法错误, 变量名#周期`;this.ThrowUnexpectedToken(t,i)}else{if(["C","CLOSE","O","OPEN","H","HIGH","L","LOW","AMOUNT","AMO","VOL","V","VOLINSTK"].indexOf(r[0])<0){i=`${e}, 跨周期语法错误, 数据只支持\'OPEN,HIGH,LOW,CLOSE,VOL,AMOUNT,VOLINSTK\'`;this.ThrowUnexpectedToken(t,i)}if(["MIN1","MIN5","MIN15","MIN30","MIN60","DAY","WEEK","MONTH","SEASON","YEAR"].indexOf(r[1])<0){i=`${e}, 跨周期语法错误， 周期只支持\'MIN1,MIN5,MIN15,MIN30,MIN60,DAY,WEEK,MONTH,SEASON,YEAR\'`;this.ThrowUnexpectedToken(t,i)}a={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA,VarName:e,ValueName:r[0],PeriodName:r[1]};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.PeriodSymbolData.push(a)}}else if(g_JSComplierResource.IsCustomVariant(e)){a={VariantName:e,ID:JS_EXECUTE_JOB_ID.JOB_CUSTOM_VARIANT_DATA};return t&&(a.Token={Index:t.Start,Line:t.LineNumber}),void this.FunctionData.push(a)}}else this.IsNeedLatestIndexData=!0}},this.VerifySymbolLiteral=function(e,t){if(IFrameSplitOperator.IsString(e)&&e.indexOf("$")>0){if(2!=e.split("$").length)return;var a={Literal:e,ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_OTHER_SYMBOL_DATA};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.OtherSymbolData.push(a)}},this.VerifySymbolFunction=function(e,t,a){if(g_JSComplierResource.IsCustomFunction(e.Name)){var r={FunctionName:e.Name,ID:JS_EXECUTE_JOB_ID.JOB_CUSTOM_FUNCTION_DATA,Args:t};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.FunctionData.push(r)}if("DYNAINFO"==e.Name)return void(this.IsNeedLatestData=!0);if("FINANCE"==e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_FINANCE,Args:t,FunctionName:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.FunctionData.push(r)}if("FINVALUE"==e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_FINVALUE,Args:t,FunctionName:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.FunctionData.push(r)}if("FINONE"==e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_FINONE,Args:t,FunctionName:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.FunctionData.push(r)}if("GPJYVALUE"==e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GPJYVALUE,Args:t,FunctionName:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.FunctionData.push(r)}if("MARGIN"===e.Name){let e=JS_EXECUTE_JOB_ID.GetMarginJobID(t[0].Value);return void(e&&!this.IsNeedMarginData.has(e)&&this.IsNeedMarginData.add(e))}if("NEWS"===e.Name){let e=JS_EXECUTE_JOB_ID.GetNewsAnalysisID(t[0].Value);return void(e&&!this.IsNeedNewsAnalysisData.has(e)&&this.IsNeedNewsAnalysisData.add(e))}if("HK2SHSZ"===e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_HK_TO_SHSZ,Args:t,FunctionName:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.NeedHK2SHSZData.push(r)}if("COST"==e.Name||"WINNER"==e.Name||"PPART"==e.Name||"COSTEX"==e.Name||"LWINNER"==e.Name||"PWINNER"==e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_FINANCE,Args:[7],FunctionName:"FINANCE",FunctionName2:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.FunctionData.push(r)}if("BETA"===e.Name)return void(this.IsNeedIndexData=!0);if("UPCOUNT"==e.Name||"DOWNCOUNT"==e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_INDEX_INCREASE_DATA,Args:t,FunctionName:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.NeedBlockIncreaseData.push(r)}if("STKINDI"==e.Name){r={ID:JS_EXECUTE_JOB_ID.JOB_EXECUTE_INDEX,Args:t,FunctionName:e.Name};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.ExecuteIndex.push(r)}if("COVER_C"==e.Name||"COVER_O"==e.Name||"COVER_H"==e.Name||"COVER_L"==e.Name||"COVER_A"==e.Name||"COVER_V"==e.Name){var i=t[0].Value;if(["MIN1","MIN5","MIN15","MIN30","MIN60","DAY","WEEK","MONTH","SEASON","YEAR"].indexOf(i)<0){var n=`${e.Name}, 跨周期函数错误， 周期只支持\'MIN1,MIN5,MIN15,MIN30,MIN60,DAY,WEEK,MONTH,SEASON,YEAR\'`;this.ThrowUnexpectedToken(a,n)}var s=JSComplierHelper.GetConvertValueName(e.Name);r={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA,FunctionName:e.Name,ValueName:s,PeriodName:i};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.PeriodSymbolData.push(r)}if("SF"==e.Name){let e=JS_EXECUTE_JOB_ID.GetSectionReportPeriod(t[0].Value,t[1].Value);if(!e)return;let a=JS_EXECUTE_JOB_ID.GetSectionFinanceID(t[2].Value);if(!a)return;var u=e.Year+"-"+e.Quarter;if(this.IsNeedSectionFinance.has(u)){(o=this.IsNeedSectionFinance.get(u)).Fields.has(a)||o.Fields.add(a)}else{var o={Period:e,Fields:new Set([a])};this.IsNeedSectionFinance.set(u,o)}return}if("LOADAPIDATA"==e.Name){r={Name:e.Name,ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_CUSTOM_API_DATA,Args:t};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.IsAPIData.push(r)}if(new Set(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]).has(e.Name)){r={Name:e.Name,ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_OTHER_SYMBOL_DATA,Args:t};return a&&(r.Token={Index:a.Start,Line:a.LineNumber}),void this.OtherSymbolData.push(r)}},this.ExpressionStatement=function(e){return{Type:Syntax.ExpressionStatement,Expression:e}},this.Script=function(e){return{Type:Syntax.Program,Body:e,SourceType:"通达信脚本"}},this.SequenceExpression=function(e){return{Type:Syntax.SequenceExpression,Expression:e}},this.BinaryExpression=function(e,t,a){return{Type:"||"===e||"&&"===e||"AND"==e||"OR"==e?Syntax.LogicalExpression:Syntax.BinaryExpression,Operator:e,Left:t,Right:a}},this.Literal=function(e,t,a){return this.VerifySymbolLiteral(e,a),{Type:Syntax.Literal,Value:e,Raw:t}},this.Identifier=function(e,t){return this.VerifySymbolVariable(e,t),{Type:Syntax.Identifier,Name:e}},this.AssignmentExpression=function(e,t,a){return{Type:Syntax.AssignmentExpression,Operator:e,Left:t,Right:a}},this.UnaryExpression=function(e,t){return{Type:Syntax.UnaryExpression,Operator:e,Argument:t,Prefix:!0}},this.EmptyStatement=function(){return{Type:Syntax.EmptyStatement}},this.CallExpression=function(e,t,a){return this.VerifySymbolFunction(e,t,a),{Type:Syntax.CallExpression,Callee:e,Arguments:t}},this.StaticMemberExpression=function(e,t){return{Type:Syntax.MemberExpression,Computed:!1,Object:e,Property:t}},this.Directive=function(e,t){return{Type:Syntax.ExpressionStatement,Expression:e,Directive:t}},this.ThrowUnexpectedToken=function(e,t){throw this.UnexpectedTokenError(e,t)},this.UnexpectedTokenError=function(e,t){let a=t||Messages.UnexpectedToken,r="ILLEGAL";if(e&&(r=e.Value),a=a.replace("%0",r),e&&"number"==typeof e.LineNumber){let t=e.Start,r=e.LineNumber,i=-1;return this.ErrorHandler.CreateError(t,r,i,a)}}}function JSParser(e){this.ErrorHandler=new ErrorHandler,this.Scanner=new Scanner(e,this.ErrorHandler),this.Node=new Node(this.ErrorHandler),this.LookAhead={Type:2,Value:"",LineNumber:this.Scanner.LineNumber,LineStart:0,Start:0,End:0},this.HasLineTerminator=!1,this.Context={IsModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,FirstCoverInitializedNameError:null,IsAssignmentTarget:!1,IsBindingElement:!1,InFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},Strict:!1},this.PeratorPrecedence={")":0,";":0,",":0,"]":0,"||":1,OR:1,"&&":2,AND:2,"|":3,"^":4,"&":5,"==":6,"=":6,"!=":6,"<>":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.StartMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.LastMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.Initialize=function(){this.NextToken(),this.LastMarker={Index:this.Scanner.Index,Line:this.Scanner.LineNumber,Column:this.Scanner.Index-this.Scanner.LineStart}},this.CreateNode=function(){return{Index:this.StartMarker.Index,Line:this.StartMarker.Line,Column:this.StartMarker.Column}},this.StartNode=function(e,t){null==t&&(t=0);let a=e.Start-e.LineStart,r=e.LineNumber;return a<0&&(a+=t,r--),{Index:e.Start,Line:r,Column:a}},this.Match=function(e){return 7==this.LookAhead.Type&&this.LookAhead.Value==e},this.Expect=function(e){let t=this.NextToken();7==t.Type&&t.Value==e||this.ThrowUnexpectedToken(t)},this.MatchAssign=function(){if(7!=this.LookAhead.Type)return!1;let e=this.LookAhead.Value;return":"==e||":="==e},this.GetTokenRaw=function(e){return this.Scanner.Source.slice(e.Start,e.End)},this.NextToken=function(){let e=this.LookAhead;this.LastMarker.Index=this.Scanner.Index,this.LastMarker.Line=this.Scanner.LineNumber,this.LastMarker.Column=this.Scanner.Index-this.Scanner.LineStart,this.CollectComments(),this.Scanner.Index!==this.StartMarker.Index&&(this.StartMarker.Index=this.Scanner.Index,this.StartMarker.Line=this.Scanner.LineNumber,this.StartMarker.Column=this.Scanner.Index-this.Scanner.LineStart);let t=this.Scanner.Lex();return this.HasLineTerminator=e.LineNumber!=t.LineNumber,t&&this.Context.Strict&&t.Type,this.LookAhead=t,e},this.CollectComments=function(){this.Scanner.ScanComments()},this.ParseScript=function(){let e=this.CreateNode(),t=this.ParseDirectivePrologues();for(;2!=this.LookAhead.Type;)t.push(this.ParseStatementListItem());return this.Finalize(e,this.Node.Script(t))},this.ParseDirective=function(){let e=this.LookAhead,t=this.CreateNode(),a=this.ParseExpression(),r=a.Type===Syntax.Literal?this.GetTokenRaw(e).slice(1,-1):null;return this.ConsumeSemicolon(),this.Finalize(t,r?this.Node.Directive(a,r):this.Node.ExpressionStatement(a))},this.ParseDirectivePrologues=function(){let e=[];for(;;){if(8!=this.LookAhead.Type)break;let t=this.ParseDirective();e.push(t)}return e},this.ParseStatementListItem=function(){let e;return this.Context.IsAssignmentTarget=!0,this.Context.IsBindingElement=!0,4==this.LookAhead.Type||(e=this.ParseStatement()),e},this.ParseStatement=function(){let e;switch(this.LookAhead.Type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.ParseExpressionStatement();break;case 7:let t=this.LookAhead.Value;e="("===t?this.ParseExpressionStatement():";"===t?this.ParseEmptyStatement():this.ParseExpressionStatement();break;case 3:e=this.ParseLabelledStatement();break;case 4:break;default:e="error"}return e},this.ParseEmptyStatement=function(){let e=this.CreateNode();return this.Expect(";"),this.Finalize(e,this.Node.EmptyStatement())},this.ParseLabelledStatement=function(){let e=this.CreateNode(),t=this.ParseExpression();this.ConsumeSemicolon();let a=new this.Node.ExpressionStatement(t);return this.Finalize(e,a)},this.ParseExpression=function(){let e=this.LookAhead,t=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(this.Match(",")){let a=[];for(a.push(t);2!=this.LookAhead.Type&&this.Match(",");)this.NextToken(),a.push(this.IsolateCoverGrammar(this.ParseAssignmentExpression));t=this.Finalize(this.StartNode(e),this.Node.SequenceExpression(a))}return t},this.ParseAssignmentExpression=function(){let e,t=this.LookAhead,a=t;if(e=this.ParseConditionalExpression(),this.MatchAssign()){if(!this.Context.IsAssignmentTarget){let t=e.Marker;this.ThrowUnexpectedError(t.Index,t.Line,t.Column,Messages.InvalidLHSInAssignment)}this.Match("=")||this.Match(":")?this.ReinterpretExpressionAsPattern(e):(this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1);let r=(a=this.NextToken()).Value,i=this.IsolateCoverGrammar(this.ParseAssignmentExpression);e=this.Finalize(this.StartNode(t),this.Node.AssignmentExpression(r,e,i)),this.Context.FirstCoverInitializedNameError=null}return e},this.ParseConditionalExpression=function(){this.LookAhead;return this.InheritCoverGrammar(this.ParseBinaryExpression)},this.ParseBinaryExpression=function(){let e=this.LookAhead,t=this.InheritCoverGrammar(this.ParseExponentiationExpression),a=this.LookAhead;var r=this.BinaryPrecedence(a);if(r>0){this.NextToken(),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1;let i=[e,this.LookAhead],n=t,s=this.IsolateCoverGrammar(this.ParseExponentiationExpression),u=[n,a.Value,s],o=[r];for(;!((r=this.BinaryPrecedence(this.LookAhead))<=0);){for(;u.length>2&&r<=o[o.length-1];){s=u.pop();let e=u.pop();o.pop(),n=u.pop(),i.pop();let t=this.StartNode(i[i.length-1]);u.push(this.Finalize(t,this.Node.BinaryExpression(e,n,s)))}u.push(this.NextToken().Value),o.push(r),i.push(this.LookAhead),u.push(this.IsolateCoverGrammar(this.ParseExponentiationExpression))}let l=u.length-1;t=u[l];let D=i.pop();for(;l>1;){let e=i.pop(),a=D&&D.LineStart,r=this.StartNode(e,a),n=u[l-1];t=this.Finalize(r,this.Node.BinaryExpression(n,u[l-2],t)),l-=2,D=e}}return t},this.ParseExponentiationExpression=function(){this.LookAhead;return this.InheritCoverGrammar(this.ParseUnaryExpression)},this.ParseUnaryExpression=function(){let e;if(this.Match("+")||this.Match("-")){let t=this.StartNode(this.LookAhead),a=this.NextToken();e=this.InheritCoverGrammar(this.ParseUnaryExpression),e=this.Finalize(t,this.Node.UnaryExpression(a.Value,e)),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1}else e=this.ParseUpdateExpression();return e},this.ParseUpdateExpression=function(){let e;this.LookAhead;return e=this.InheritCoverGrammar(this.ParseLeftHandSideExpressionAllowCall)},this.ParseLeftHandSideExpressionAllowCall=function(){let e,t=this.LookAhead;for(e=this.InheritCoverGrammar(this.ParsePrimaryExpression);;)if(this.Match(".")){this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!0,this.Expect(".");const a=this.ParseIdentifierName();e=this.Finalize(this.StartNode(t),this.Node.StaticMemberExpression(e,a))}else{if(!this.Match("("))break;this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!1;var a=this.ParseArguments();e=this.Finalize(this.StartNode(t),this.Node.CallExpression(e,a,t))}return e},this.IsIdentifierName=function(e){return 3===e.Type||4===e.Type||1===e.Type||5===e.Type},this.ParseIdentifierName=function(){const e=this.CreateNode(),t=this.NextToken();return this.IsIdentifierName(t)||this.ThrowUnexpectedToken(t),this.Finalize(e,this.Node.Identifier(t.Value,t))},this.ParseArguments=function(){this.Expect("(");var e=[];if(!this.Match(")"))for(;;){let t=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(e.push(t),this.Match(")"))break;if(this.ExpectCommaSeparator(),this.Match(")"))break}return this.Expect(")"),e},this.ExpectCommaSeparator=function(){this.Expect(",")},this.ParsePrimaryExpression=function(){let e,t=this.CreateNode();var a,r;switch(this.LookAhead.Type){case 3:a=this.NextToken(),e=this.Finalize(t,this.Node.Identifier(a.Value,a));break;case 6:case 8:this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1,a=this.NextToken(),r=this.GetTokenRaw(a),e=this.Finalize(t,this.Node.Literal(a.Value,r,a));break;case 7:switch(this.LookAhead.Value){case"(":this.Context.IsBindingElement=!1,e=this.InheritCoverGrammar(this.ParseGroupExpression);break;default:e=this.ThrowUnexpectedToken(this.NextToken())}break;default:e=this.ThrowUnexpectedToken(this.NextToken())}return e},this.ParseGroupExpression=function(){let e;if(this.Expect("("),this.Match(")"))this.NextToken();else{this.LookAhead;let t=!1;if(this.Context.IsBindingElement=!0,e=this.InheritCoverGrammar(this.ParseAssignmentExpression),this.Match(",")){let t=[];for(this.Context.IsAssignmentTarget=!1,t.push(e);2!=this.LookAhead.Type&&this.Match(",");)this.NextToken(),this.Match(")")}t||(this.Expect(")"),this.Context.IsBindingElement=!1)}return e},this.ParseExpressionStatement=function(){let e=this.CreateNode(),t=this.ParseExpression();return this.ConsumeSemicolon(),this.Finalize(e,this.Node.ExpressionStatement(t))},this.ConsumeSemicolon=function(){this.Match(";")?this.NextToken():this.HasLineTerminator||(this.LastMarker.Index=this.StartMarker.Index,this.LastMarker.Line=this.StartMarker.Line,this.LastMarker.Column=this.StartMarker.Column)},this.ReinterpretExpressionAsPattern=function(e){switch(e.Type){case Syntax.Identifier:case Syntax.MemberExpression:case Syntax.AssignmentExpression:}},this.Finalize=function(e,t){return t.Marker={Line:e.Line,Column:e.Column,Index:e.Index},t},this.BinaryPrecedence=function(e){let t,a=e.Value;return t=7===e.Type&&this.PeratorPrecedence[a]||0},this.IsolateCoverGrammar=function(e){let t=this.Context.IsBindingElement,a=this.Context.IsAssignmentTarget,r=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;let i=e.call(this);return this.Context.FirstCoverInitializedNameError,this.Context.IsBindingElement=t,this.Context.IsAssignmentTarget=a,this.Context.FirstCoverInitializedNameError=r,i},this.InheritCoverGrammar=function(e){let t=this.Context.IsBindingElement,a=this.Context.IsAssignmentTarget,r=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;let i=e.call(this);return this.Context.IsBindingElement=this.Context.IsBindingElement&&t,this.Context.IsAssignmentTarget=this.Context.IsAssignmentTarget&&a,this.Context.FirstCoverInitializedNameError=r||this.Context.FirstCoverInitializedNameError,i},this.ThrowUnexpectedToken=function(e,t){throw this.UnexpectedTokenError(e,t)},this.ThrowUnexpectedError=function(e,t,a,r){let i=r||"执行异常";return this.ErrorHandler.ThrowError(e,t,a,i)},this.UnexpectedTokenError=function(e,t){let a=t||Messages.UnexpectedToken,r="ILLEGAL";if(e&&(r=e.Value),a=a.replace("%0",r),e&&"number"==typeof e.LineNumber){let t=e.Start,r=e.LineNumber,i=this.LastMarker.Index-this.LastMarker.Column,n=e.Start-i+1;return this.ErrorHandler.CreateError(t,r,n,a)}{let e=this.LastMarker.Index,t=this.LastMarker.Line,r=this.LastMarker.Column+1;return this.ErrorHandler.CreateError(e,t,r,a)}}}function JSAlgorithm(e,t){this.ErrorHandler=e,this.SymbolData=t,this.Add=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e+t;let i,n,s=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var u=0;u<a;++u)s[u]=null,u<e.length&&u<t.length&&this.IsNumber(e[u])&&this.IsNumber(t[u])&&(s[u]=e[u]+t[u]);return s}for(var u in a?(i=e,n=t):(i=t,n=e),n)s[u]=null,this.IsNumber(n[u])&&this.IsNumber(i)&&(s[u]=i+n[u]);return s},this.Subtract=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e-t;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&this.IsNumber(e[n])&&this.IsNumber(t[n])&&(i[n]=e[n]-t[n]);return i}if(a)for(var n in t)i[n]=null,this.IsNumber(e)&&this.IsNumber(t[n])&&(i[n]=e-t[n]);else for(var n in e)i[n]=null,this.IsNumber(e[n])&&this.IsNumber(t)&&(i[n]=e[n]-t);return i},this.Multiply=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e*t;let i,n,s=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var u=0;u<a;++u)s[u]=null,u<e.length&&u<t.length&&this.IsNumber(e[u])&&this.IsNumber(t[u])&&(s[u]=e[u]*t[u]);return s}for(var u in a?(i=e,n=t):(i=t,n=e),n)s[u]=null,this.IsNumber(n[u])&&this.IsNumber(i)&&(s[u]=i*n[u]);return s},this.Divide=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return 0==t?null:e/t;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&this.IsNumber(e[n])&&this.IsDivideNumber(t[n])&&(i[n]=e[n]/t[n]);return i}if(a)for(var n in t)i[n]=null,this.IsNumber(e)&&this.IsDivideNumber(t[n])&&(i[n]=e/t[n]);else for(var n in e)i[n]=null,this.IsNumber(e[n])&&this.IsDivideNumber(t)&&(i[n]=e[n]/t);return i},this.GT=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e>t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]>t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e>t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]>t?1:0);return i},this.GTE=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e>=t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]>=t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e>=t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]>=t?1:0);return i},this.LT=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e<t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]<t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e<t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]<t?1:0);return i},this.LTE=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e>=t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]<=t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e<=t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]<=t?1:0);return i},this.EQ=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e==t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]==t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e==t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]==t?1:0);return i},this.NEQ=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e!=t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]!=t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e!=t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]!=t?1:0);return i},this.And=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e&&t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]&&t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e&&t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]&&t?1:0);return i},this.Or=function(e,t){let a="number"==typeof e,r="number"==typeof t;if(a&&r)return e||t?1:0;let i=[];if(!a&&!r){let a=Math.max(e.length,t.length);for(var n=0;n<a;++n)i[n]=null,n<e.length&&n<t.length&&(isNaN(e[n])||isNaN(t[n])||(i[n]=e[n]||t[n]?1:0));return i}if(a)for(var n in t)i[n]=null,isNaN(e)||isNaN(t[n])||(i[n]=e||t[n]?1:0);else for(var n in e)i[n]=null,isNaN(e[n])||isNaN(t)||(i[n]=e[n]||t?1:0);return i},this.IF=function(e,t,a){let r=this.IsNumber(e),i=this.IsNumber(t),n=this.IsNumber(a);var s=Array.isArray(t),u=Array.isArray(a);if(r)return e?t:a;let o=[];for(var l in e)e[l]?o[l]=i?t:s?t[l]:null:o[l]=n?a:u?a[l]:null;return o},this.IFN=function(e,t,a){return this.IF(e,a,t)},this.REF=function(e,t){let a=[];if("number"==typeof t){if(e.length<=0)return a;if(t>=e.length)return a;a=e.slice(0,e.length-t);for(var r=e[0],i=0;i<t;++i)a.unshift(r)}else for(i=0;i<e.length;++i)if(a[i]=null,!(i>=t.length)){var n=t[i];a[i]=n>=0&&n<=i?e[i-n]:i?a[i-1]:e[i]}return a},this.REFV=function(e,t){let a=[];if("number"==typeof t){if(e.length<=0)return a;if(t>=e.length)return a;a=e.slice(0,e.length-t);for(var r=0;r<t;++r)a.unshift(null)}else for(r=0;r<e.length;++r)if(a[r]=null,!(r>=t.length)){var i=t[r];i>=0&&i<=r&&(a[r]=e[r-i])}return a},this.REFX=function(e,t){let a=[];if("number"==typeof t){if(e.length<=0)return a;if(t>=e.length)return a;a=e.slice(t,e.length);for(var r=e[e.length-1],i=0;i<t;++i)a.push(r)}else{var n=e.length;for(i=0;i<e.length;++i)if(a[i]=null,!(i>=t.length)){var s=t[i];a[i]=s>=0&&s+i<n?e[i+s]:i?a[i-1]:e[i]}}return a},this.REFXV=function(e,t){let a=[];if("number"==typeof t){if(e.length<=0)return a;if(t>=e.length)return a;a=e.slice(t,e.length);for(var r=0;r<t;++r)a.push(null)}else{var i=e.length;for(r=0;r<e.length;++r)if(a[r]=null,!(r>=t.length)){var n=t[r];n>=0&&n+r<i&&(a[r]=e[r+n])}}return a},this.MAX=function(e,t){if(0==e.length&&this.ThrowUnexpectedNode(t,"MAX() Error: 参数个数不能为0"),1==e.length)return e[0];var a=[],r=[];for(var i in e){var n=e[i];IFrameSplitOperator.IsNumber(n)?r.push(n):Array.isArray(n)&&a.push(n)}var s=null;if(r.length>0){s=r[0];for(i=1;i<r.length;++i)s=Math.max(s,r[i])}var u=null;if(a.length>0){u=a[0].slice(0);for(i=1;i<a.length;++i){var o=a[i];for(var l in o){var D=u[l];n=o[l];IFrameSplitOperator.IsNumber(D)&&(IFrameSplitOperator.IsNumber(n)?u[l]=Math.max(D,n):u[l]=null)}}}if(null==u&&null!=s)return s;if(u&&null==s)return u;for(var i in u)IFrameSplitOperator.IsNumber(u[i])&&(u[i]=Math.max(u[i],s));return u},this.MIN=function(e,t){if(0==e.length&&this.ThrowUnexpectedNode(t,"MIN() Error: 参数个数不能为0"),1==e.length)return e[0];var a=[],r=[];for(var i in e){var n=e[i];IFrameSplitOperator.IsNumber(n)?r.push(n):Array.isArray(n)&&a.push(n)}var s=null;if(r.length>0){s=r[0];for(i=1;i<r.length;++i)s=Math.min(s,r[i])}var u=null;if(a.length>0){u=a[0].slice(0);for(i=1;i<a.length;++i){var o=a[i];for(var l in o){var D=u[l];n=o[l];IFrameSplitOperator.IsNumber(D)&&(IFrameSplitOperator.IsNumber(n)?u[l]=Math.min(D,n):u[l]=null)}}}if(null==u&&null!=s)return s;if(u&&null==s)return u;for(var i in u)IFrameSplitOperator.IsNumber(u[i])&&(u[i]=Math.min(u[i],s));return u},this.ABS=function(e){let t=[];for(var a in e)t[a]=null,isNaN(e[a])||(t[a]=Math.abs(e[a]));return t},this.MA=function(e,t){let a=[];if(t<=0)return a;if(Array.isArray(t)){for(u=0;u<e.length;++u)if(a[u]=null,!(u>=t.length)){var r=t[u];if(this.IsNumber(r)&&!(r<=0)){for(var i=0,n=0,s=(l=u,0);l>=0&&s<r;--l,++s)i+=e[l],++n;n>0&&(a[u]=i/n)}}}else{if(t<=0&&(t=1),!e||!e.length)return a;for(var u=0;u<e.length&&(a[u]=null,!this.IsNumber(e[u]));++u);e=e.slice(0);for(var o=0;u<e.length;++u,++o){if(o<t-1){a[u]=null;continue}let r=e[u-(t-1)],i=0;for(var l=t-1;l>=0;--l){var D=e[u-l];this.IsNumber(D)?r=D:(D=r,e[u-l]=D),i+=D}a[u]=i/t}}return a},this.EMA=function(e,t){var a=[];if(e.length<=0)return a;if(Array.isArray(t))for(var r=0;r<t.length;++r){var i=t[r];if(this.IsNumber(i)&&!((i=parseInt(i))<=0)){i>r+1&&(i=r+1);for(var n=[2/(i+1),(i-1)/(i+1)],s=null,u=null,o=0;o<i;++o){var l=e[r-(i-o-1)];this.IsNumber(l)||coninue,u=s=null==u?l:n[0]*l+n[1]*u}a[r]=s}}else{for(var D=0;D<e.length&&(null==e[D]||isNaN(e[D]));++D);var h=D,c=D+1;a[h]=e[h];for(r=D+1;r<e.length;++r,++h,++c)a[c]=(2*e[c]+(t-1)*a[h])/(t+1)}return a},this.XMA=function(e,t){for(var a=[],r=0;r<e.length&&!this.IsNumber(e[r]);++r);for(var i=parseInt((t-2)/2),n=0,s=0,u=0,o=r,l=0;o<e.length;++o){for(u=o+(t-i)-1,l=o-i-1;l<u;++l)l>=0&&l<e.length&&this.IsNumber(e[l])&&(n+=e[l],++s);a[o]=0!=s?n/s:null,n=0,s=0}return a},this.SMA=function(e,t,a){var r=[];if(Array.isArray(t))for(var i=0;i<t.length;++i){var n=t[i];if(this.IsNumber(n)&&!((n=parseInt(n))<=0)){n>i+1&&(n=i+1);for(var s=null,u=null,o=0;o<n;++o){var l=e[i-(n-o-1)];this.IsNumber(l)&&(null==s?(s=l,u=l):s=u=(a*l+(n-a)*s)/n)}r[i]=u}}else{i=0;for(var D=null;i<e.length;++i)if(null!=e[i]&&!isNaN(e[i])){D=e[i],r[i]=D;break}for(++i;i<e.length;++i)r[i]=(a*e[i]+(t-a)*D)/t,D=r[i]}return r},this.DMA=function(e,t){var a=[];if(e.length<0||e.length!=t.length)return a;for(var r=0;r<e.length;++r)if(null!=e[r]&&!isNaN(e[r])&&null!=t[r]&&!isNaN(t[r])){a[r]=e[r];break}for(r+=1;r<e.length;++r)null==e[r]||null==t[r]?a[r]=null:t[r]<1?a[r]=t[r]*e[r]+(1-t[r])*a[r-1]:a[r]=e[r];return a},this.WMA=function(e,t){let a=[];if(!e||!e.length)return a;if(Array.isArray(t)){for(h=0;h<t.length&&h<e.length;++h){a[h]=null;var r=t[h];if(!(r<=0)){for(var i=0,n=0,s=0,u=0;u<r;++u)if(n=e[h-(r-u-1)],i=u,this.IsNumber(n)){s=n;break}if(!(i>=r)){for(var o=0,l=0,D=(u=i,1);u<r;++u,++D)n=e[h-(r-u-1)],this.IsNumber(n)?s=n:n=s,l+=D,o+=n*D;a[h]=o/l}}}return a}if(t<=0)return[];var h=0;for(h=0;h<e.length&&!this.IsNumber(e[h]);++h)a[h]=null;e=e.slice(0);for(var c=0;h<e.length;++h,++c)if(c<t-1)a[h]=null;else{for(s=e[h-(t-1)],o=0,l=0,u=t-1;u>=0;--u){n=e[h-u];this.IsNumber(n)?s=n:(n=s,e[h-u]=n),l+=t-u,o+=n*(t-u)}a[h]=o/l}return a},this.MEMA=function(e,t){let a=[];if(!e||!e.length)return a;var r=0,i=0;for(i=0;i<e.length&&!this.IsNumber(e[i]);++i)a[i]=null;if(r=i,t<1||r+t>=e.length)return a;var n=0;for(e=e.slice(0);r<i+t;++r)a[r]=null,!this.IsNumber(e[r])&&r-1>=0&&(e[r]=e[r-1]),n+=e[r];for(a[r-1]=n/t;r<e.length;++r)this.IsNumber(a[r-1])&&this.IsNumber(e[r])?a[r]=(e[r]+a[r-1]*(t-1))/t:r-1>-1&&this.IsNumber(a[r-1])?a[r]=a[r-1]:a[r]=null;return a},this.EXPMA=function(e,t){let a=[];if(t>=e.length)return a;let r=t;for(;r<e.length;++r)if(null!=e[r]){a[r]=e[r];break}for(r+=1;r<e.length;++r)null!=a[r-1]&&null!=e[r]?a[r]=(2*e[r]+(t-1)*a[r-1])/(t+1):null!=a[r-1]&&(a[r]=a[r-1]);return a},this.EXPMEMA=function(e,t){var a=[];if(t>=e.length)return a;for(var r=0;r<e.length&&(!e[r]||isNaN(e[r]));++r);for(var i=0,n=0;r<e.length&&n<t;++n,++r)e[r]&&!isNaN(e[r])?i+=e[r]:i+=e[r-1];for(a[r-1]=i/t;r<e.length;++r)null!=a[r-1]&&null!=e[r]?a[r]=(2*e[r]+(t-1)*a[r-1])/(t+1):null!=a[r-1]&&(a[r]=a[r-1]);return a},this.SUMBARS=function(e,t){var a=[];if(!(e&&e.length&&t&&t.length))return a;for(var r=0,i=0,n=0;r<e.length&&!this.IsNumber(e[r]);++r)a[r]=null;for(i=e.length-1;i>=r;--i){var s=0;for(n=i,s=0;n>=r&&s<t[i];--n)s+=e[n];a[i]=n<r?null:i-n}for(i=r+1;i<e.length;++i)null==a[i]&&(a[i]=a[i-1]);return a},this.REVERSE=function(e){for(var t=[],a=0;a<e.length&&!this.isNumber(e[a]);++a)t[a]=null;for(;a<e.length;++a)this.isNumber(e[a])?t[a]=0-e[a]:t[a]=null;return t},this.COUNT=function(e,t){if(Array.isArray(t)){for(var a=null,r=e.length,i=0;i<r;++i)if(this.IsNumber(e[i])){a=i;break}if(null==a)return[];var n=[],s=0;for(i=0;i<t.length;++i){var u=t[i];if(IFrameSplitOperator.IsNumber(u)){u<1&&(u=i+1),s=0;for(var o=i,l=0;o>=0&&l<u;--o,++l)e[o]&&++s;n[i]=s}}return n}for(u=t,r=e.length,u=u<1?r:u,i=0,o=0;i<r&&!this.IsNumber(e[i]);++i);n=[];for(var D=0;i<r&&o<u;++i,++o)D=e[i]?D+1:D,n[i]=D;for(;i<r;++i)e[i-u]&&D&&D--,D=e[i]?D+1:D,n[i]=D;return n},this.HHV=function(e,t){let a=[];if(Array.isArray(t)){for(var r=null,i=0,n=0;i<e.length;++i)if(a[i]=null,!(i>=t.length)){r=null;var s=t[i];if(s>0&&s<=i)for(n=i-s;n<=i;++n)(null==r||r<e[n])&&(r=e[n]);else for(s=i,n=0;n<=i;++n)(null==r||r<e[n])&&(r=e[n]);a[i]=r}}else{if(t>e.length)return a;t<=0&&(t=e.length-1);var u=0;for(u=0;u<e.length&&!this.IsNumber(e[u]);++u);u<e.length&&(a[u]=e[u]);for(i=u+1,n=2;i<e.length&&n<t;++i,++n)e[i]>=e[u]&&(u=i),a[i]=e[u];for(;i<e.length;++i){if(i-u<t)u=e[i]<e[u]?u:i;else for(n=u=i-t+1;n<=i;++n)u=e[n]<e[u]?u:n;a[i]=e[u]}}return a},this.LLV=function(e,t){var a=[];if(Array.isArray(t)){for(var r=0;r<e.length;++r)if(a[r]=null,!(r>=t.length)){var i=null,n=t[r];if(n>0&&n<=r)for(var s=r-n;s<=r;++s)(null==i||i>e[s])&&(i=e[s]);else{n=r;for(s=0;s<=r;++s)(null==i||i>e[s])&&(i=e[s])}a[r]=i}}else{if(t>e.length)return a;t<=0&&(t=e.length-1);for(i=null,r=t;r<e.length;++r,++s){if(null==i||r<t+i)i=e[r]>e[i]?i:r;else for(s=1+(i=r-t+1);s<=r;++s)e[s]<e[i]&&(i=s);a[r]=e[i]}}return a},this.STD=function(e,t){for(var a=[],r=0,i=[],n=t-1;n<e.length;++n){r=0;for(var s=0;s<t;++s)r+=e[n-s];i[n]=r/t}for(n=t-1;n<e.length;++n){r=0;for(s=0;s<t;++s)r+=Math.pow(e[n-s]-i[n],2);a[n]=Math.sqrt(r/t)}return a},this.AVEDEV=function(e,t){for(var a=[],r=0,i=[],n=t-1;n<e.length;++n){r=0;for(var s=0;s<t;++s)r+=e[n-s];i[n]=r/t}for(n=t-1;n<e.length;++n){r=0;for(s=0;s<t;++s)r+=Math.abs(e[n-s]-i[n]);a[n]=r/t}return a},this.CROSS=function(e,t){var a=[];if(Array.isArray(e)&&Array.isArray(t)){if(e.length!=t.length)return[];for(var r=0;r<e.length&&(!this.IsNumber(e[r])||!this.IsNumber(t[r]));++r);for(++r;r<e.length;++r)a[r]=e[r]>t[r]&&e[r-1]<t[r-1]?1:0}else if(Array.isArray(e)&&"number"==typeof t){for(r=0;r<e.length&&!this.IsNumber(e[r]);++r);for(++r;r<e.length;++r)a[r]=e[r]>t&&e[r-1]<t?1:0}else if("number"==typeof e&&Array.isArray(t)){for(r=0;r<t.length&&!this.IsNumber(t[r]);++r);for(++r;r<t.length;++r)a[r]=t[r]<e&&t[r-1]>e?1:0}return a},this.MULAR=function(e,t){var a=[];if(Array.isArray(t))for(n=0;n<e.length;++n){a[n]=null;var r=t[n];if(this.IsNumber(r)&&!((r=parseInt(r))<0))for(s=n,u=0;s>=0&&u<r;--s,++u)0==u?a[n]=e[s]:a[n]*=e[s]}else{if(e.length<t)return a;if(0==t){for(var i=t;i<e.length;++i)if(this.IsNumber(e[i])){a[i]=e[i];break}for(++i;i<e.length;++i)a[i]=a[i-1]*e[i]}else for(var n=t-1,s=0;n<e.length;++n,++s)for(var u=0;u<t;++u)0==u?a[n]=e[u+s]:a[n]*=e[u+s]}return a},this.SUM=function(e,t){var a=[];if(Array.isArray(t))for(i=0;i<e.length;++i){a[i]=null;var r=t[i];if(r>0)for(n=i,s=0;n>=0&&s<r;--n,++s)0==s?a[i]=e[n]:a[i]+=e[n]}else if(0==t){a[0]=e[0];for(var i=1;i<e.length;++i)a[i]=a[i-1]+e[i]}else for(var i=t-1,n=0;i<e.length;++i,++n)for(var s=0;s<t;++s)0==s?a[i]=e[s+n]:a[i]+=e[s+n];return a},this.BARSCOUNT=function(e){let t=[],a=null;for(var r in e){if(t[r]=0,null==a){if(!this.IsNumber(e[r]))continue;a=0}t[r]=a,++a}return t},this.DEVSQ=function(e,t){var a=[];"number"!=typeof t&&(t=parseInt(t));var r=t,i=e.length,n=0,s=0,u=0,o=0,l=0;for(n=0;n<i&&!this.isNumber(e[n]);++n)a[n]=null;if(r<1||n+r>i)return a;for(o=0;n<i&&s<r;++n,++s)o+=e[n]/r;if(s==r){for(l=0,n--;u<r;u++)l+=(e[n-u]-o)*(e[n-u]-o);a[n]=l,n++}for(;n<i;++n){for(o+=(e[n]-e[n-r])/r,l=0,u=0;u<r;++u)l+=(e[n-u]-o)*(e[n-u]-o);a[n]=l}return a},this.NOT=function(e){if("number"==typeof e)return e?0:1;let t=[];for(var a in e)t[a]=null,this.IsNumber(e[a])&&(t[a]=e[a]?0:1);return t},this.FORCAST=function(e,t){var a=[];"number"!=typeof t&&(t=parseInt(t));var r=t,i=e.length;if(r<1||r>=i)return a;var n,s,u,o,l,D=0,h=0,c=0,C=0;for(o=0;o<i&&!this.IsNumber(e[o]);++o)a[o]=null;for(u=o+r-1;u<i;++u){for(D=h=c=C=0,o=0,l=r;o<r&&o<=u;++o,--l)D+=l,h+=e[u-o];for(D/=r,h/=r,o=0,l=r;o<r&&o<=u;++o,--l)c+=(l-D)*(e[u-o]-h),C+=(l-D)*(l-D);n=h-D*(s=c/C),a[u]=s*r+n}return a},this.SLOPE=function(e,t){let a=[];if("number"!=typeof t&&(t=parseInt(t)),t<1||!e.length)return a;if(t>=e.length)return a;let r,i,n,s,u=0;for(var o=0;o<e.length&&(a[o]=null,!this.IsNumber(e[o]));++o,++u);for(o=u+t-1;o<e.length;++o){a[o]=null,r=i=n=s=0;for(var l=0;l<t&&l<=o;++l)r+=o-l,i+=e[o-l];for(r/=t,i/=t,l=0;l<t&&l<=o;++l)n+=(o-l-r)*(e[o-l]-i),s+=(o-l-r)*(o-l-r);s?a[o]=n/s:o&&(a[o]=a[o-1])}return a},this.STDP=function(e,t){var a=[];"number"!=typeof t&&(t=parseInt(t));var r=t,i=e.length;if(r<1||r>=i)return a;var n=0,s=0;for(n=0;n<i&&!this.IsNumber(e[n]);++n)a[n]=null;for(var u,o=0,l=0;n<i&&s<r;++n,++s)o+=e[n]*e[n],l+=e[n];for(s==r&&(u=r*o-l*l,a[n-1]=Math.sqrt(u)/r);n<i;++n)u=r*(o+=e[n]*e[n]-e[n-r]*e[n-r])-(l+=e[n]-e[n-r])*l,a[n]=Math.sqrt(u)/r;return a},this.VAR=function(e,t){var a=[];"number"!=typeof t&&(t=parseInt(t));var r,i,n,s,u=t,o=e.length;if(u<=1||u>=o)return a;for(r=0;r<o&&!this.IsNumber(e[r]);++r)a[r]=null;for(i=0,r=r+u-1;r<o;++r){for(n=s=0,i=0;i<u&&i<=r;++i)n+=e[r-i]*e[r-i],s+=e[r-i];a[r]=(u*n-s*s)/u*(u-1)}return a},this.VARP=function(e,t){var a=[];"number"!=typeof t&&(t=parseInt(t));var r=t,i=e.length;if(r<1||r>=i)return a;var n=0,s=0;for(n=0;n<i&&!this.IsNumber(e[n]);++n)a[n]=null;for(var u=0,o=0;n<i&&s<r;++n,++s)u+=e[n]*e[n],o+=e[n];for(s==r&&(a[n-1]=(r*u-o*o)/(r*r));n<i;++n)u+=e[n]*e[n]-e[n-r]*e[n-r],o+=e[n]-e[n-r],a[n]=(r*u-o*o)/(r*r);return a},this.RANGE=function(e,t,a){let r="number"==typeof t,i="number"==typeof a;if("number"==typeof e&&r&&i)return e>Math.min(t,a)&&e<Math.max(t,a)?1:0;let n,s,u=[];for(var o=0;o<e.length;++o)if(u[o]=null,n=e[o],this.IsNumber(n)){if(r)s=t;else{if(o>=t.length)continue;s=t[o]}if(this.IsNumber(s)){if(i)rangeValue2=a;else{if(o>=a.length)continue;rangeValue2=a[o]}this.IsNumber(rangeValue2)&&(u[o]=n>Math.min(s,rangeValue2)&&n<Math.max(s,rangeValue2)?1:0)}}return u},this.EXIST=function(e,t){if("number"==typeof e)return 0;if(Array.isArray(t)){var a=[];if(e.length<=0)return a;for(var r in e)a[r]=0;for(r=0;r<t.length&&r<e.length;++r){var i=t[r];if(this.IsNumber(i)&&!((i=parseInt(i))<=0)){i>r+1&&(i=r+1);for(var n=!1,s=0,u=0;u<i;++u)if(r-(i-u-1),s=e[r],this.IsNumber(s)&&s>0){n=!0;break}a[r]=n?1:0}}return a}t=parseInt(t);var o=null;for(a=[],r=0;r<e.length;++r)a[r]=null,s=e[r],this.IsNumber(s)&&s>0&&(o=r),a[r]=null!=o&&r-o<t?1:0;return a},this.TFILTER=function(e,t,a){a=parseInt(a);let r=Math.max(e.length,t.length);for(var i=0;i<r;++i);return[]},this.FILTER=function(e,t){for(var a=[],r=0,i=0;r<e.length;++r)if(e[r]){for(a[r]=1,i=0;i<t&&i+r+1<e.length;++i)a[i+r+1]=0;r+=t}else a[r]=0;return a},this.BARSLAST=function(e){var t=[];if(!e)return t;let a=null;for(var r=0;r<e.length;++r)t[r]=null,e[r]>0?a=0:null!=a&&++a,null!=a&&(t[r]=a);return t},this.BARSSINCEN=function(e,t){for(var a=[],r=null,i=0;i<e.length;++i)a[i]=null,null==r?e[i]&&(r=0):e[i]?r+1<t&&++r:r=null,r&&(a[i]=r);return a},this.BARSSINCE=function(e){for(var t=[],a=null,r=0;r<e.length;++r)t[r]=null,null==a?e[r]&&(a=0):++a,a&&(t[r]=a);return t},this.Trigonometric=function(e,t){if(Array.isArray(e)){var a=[];for(var r in e){var i=e[r];this.IsNumber(i)?a[r]=t(i):a[r]=null}return a}return this.IsNumber(e)?t(e):null},this.ASIN=function(e){if(Array.isArray(e)){var t=[];for(var a in e){var r=e[a];if(t[a]=null,this.IsNumber(r))if(r>=-1&&r<=1)t[a]=Math.asin(r);else if(a-1>=0){var i=t[a-1];this.IsNumber(i)&&(t[a]=i)}}return t}return this.IsNumber(e)?Math.acos(e):null},this.ACOS=function(e){if(Array.isArray(e)){var t=[];for(var a in e){var r=e[a];if(t[a]=null,this.IsNumber(r))if(r>=-1&&r<=1)t[a]=Math.acos(r);else if(a-1>=0){var i=t[a-1];this.IsNumber(i)&&(t[a]=i)}}return t}return this.IsNumber(e)?Math.acos(e):null},this.LAST=function(e,t,a){if(!Array.isArray(e))return[];for(var r=[],i=e.length,n=t,s=a,u=0,o=0,l=0,D=0;u<i&&!e[u];++u);for(o=u,D=u-s+1;o<i;++o,++D){for(l=0==n?u:Math.max(u,o-n);l<D&&!(e[l]<=0);++l);r[o]=l<D?0:1}return r},this.ZIG=function(e,t){var a=this.SymbolData.Data;if("number"==typeof e)switch(e){case 0:e=a.GetOpen();break;case 1:e=a.GetHigh();break;case 2:e=a.GetLow();break;case 3:e=a.GetClose();break;default:return[]}return this.ZIG_Calculate(e,t)},this.GetFirstVaildIndex=function(e){for(var t=0;t<e.length;++t)if(this.IsNumber(e[t]))return t;return e.length},this.ZIG_Calculate=function(e,t){var a=[],r=e.length,i=this.GetFirstVaildIndex(e),n=0,s=0,u=0,o=0,l=0;for(n=i+1,s=u=i;n<r-1&&u==i;++n)u=100*Math.abs(e[n]-e[i])>=t*e[i]?e[n]>e[i]?n:-n:i;for(;n<r-1;++n)if(e[n]>=e[n-1]&&e[n]>=e[n+1])if(u<0){if(100*(e[n]-e[-u])<t*e[-u])continue;for(l=(e[s]-e[o=-u])/(-u-s),a[o--]=e[-u];o>=s;o--)a[o]=e[-u]+(-u-o)*l;s=-u,u=n}else e[n]>e[u]&&(u=n);else if(e[n]<=e[n-1]&&e[n]<=e[n+1])if(u>0){if(100*(e[u]-e[n])<t*e[u])continue;for(l=(e[u]-e[o=s])/(u-s),a[o++]=e[s];o<=u;++o)a[o]=e[s]+(o-s)*l;s=u,u=-n}else e[n]<e[-u]&&(u=-n);if(Math.abs(u)>=r-2&&(u>0&&e[r-1]>=e[u]&&(u=r-1),u<0&&e[r-1]<=e[-u]&&(u=1-r)),u>0)for(l=(e[u]-e[o=s])/(u-s),a[o++]=e[s];o<=u;++o)a[o]=e[s]+(o-s)*l;else for(l=(e[s]-e[o=-u])/(-u-s),a[o--]=e[-u];o>=s;o--)a[o]=e[-u]+(-u-o)*l;if((u=Math.abs(u))<r-1)if(e[r-1]>=e[u])for(l=(e[r-1]-e[o=u])/(r-u),a[o++]=e[u];o<r;++o)a[o]=e[u]+(o-u)*l;else for(l=(e[u]-e[o=r-1])/(r-u),a[o--]=e[r-1];o>=u;o--)a[o]=e[r-1]+(r-o)*l;return a},this.JSDraw=null,this.CalculateZIGLine=function(e,t,a,r,i){null==this.JSDraw&&(this.JSDraw=new JSDraw(this.ErrorHandler));var n=e;if(t.Up)for(var s=e.ID+1;s<a.ID;++s){var u=r[s];this.IsNumber(u)&&(n.Value<u&&(n={ID:s,Value:u}))}else for(s=e.ID+1;s<a.ID;++s){u=r[s];this.IsNumber(u)&&(n.Value>u&&(n={ID:s,Value:u}))}t.Value=n.Value,t.ID=n.ID;var o={Start:{ID:e.ID,Value:e.Value},End:{ID:t.ID,Value:t.Value}},l=this.JSDraw.CalculateDrawLine(o);for(var s in l){i[(D=l[s]).ID]=D.Value}if(a.ID==r.length-1)for(var s in o={Start:{ID:t.ID,Value:t.Value},End:{ID:a.ID,Value:a.Value}},l=this.JSDraw.CalculateDrawLine(o)){var D;i[(D=l[s]).ID]=D.Value}else e.ID=t.ID,e.Value=t.Value,t.ID=a.ID,t.Value=a.Value,t.Up=e.Value<t.Value},this.TROUGHBARS=function(e,t,a){var r=this.ZIG(e,t),i=[],n=a;if(n<1)return i;for(var s=r.length,u=[],o=0;o<n;++o)u[o]=0;var l=0;o=this.GetFirstVaildIndex(r)+1;for(n--;o<s&&r[o]>r[o-1];++o);for(;o<s&&r[o]<r[o-1];++o);for(u[0]=--o;o<s-1;++o){if(r[o]<r[o+1]){if(l){if(n)for(var D=u.slice(0),h=0;h<n;++h)u[h+1]=D[h];u[l=0]=o}}else l=1;u[n]&&(i[o]=o-u[n])}return u[n]&&(i[o]=o-u[n]),i},this.TROUGH=function(e,t,a){var r=this.ZIG(e,t),i=[],n=a;if(n<1)return i;for(var s=r.length,u=[],o=0;o<n;++o)u[o]=0;o=1;var l=0;o=this.GetFirstVaildIndex(r)+1;for(n--;o<s&&r[o]>r[o-1];++o);for(;o<s&&r[o]<r[o-1];++o);for(u[0]=--o;o<s-1;++o){if(r[o]<r[o+1]){if(l){if(n)for(var D=u.slice(0),h=0;h<n;++h)u[h+1]=D[h];u[l=0]=o}}else l=1;u[n]&&(i[o]=r[u[n]])}return u[n]&&(i[o]=r[u[n]]),i},this.PEAKBARS=function(e,t,a){var r=this.ZIG(e,t),i=[],n=r.length,s=a;if(s<1)return i;for(var u=[],o=0;o<s;++o)u[o]=0;var l=0;o=this.GetFirstVaildIndex(r)+1;for(s--;o<n&&r[o]<r[o-1];++o);for(;o<n&&r[o]>r[o-1];++o);for(u[0]=--o;o<n-1;++o){if(r[o]>r[o+1]){if(l){if(s)for(var D=u.slice(0),h=0;h<s;++h)u[h+1]=D[h];u[l=0]=o}}else l=1;u[s]&&(i[o]=o-u[s])}return u[s]&&(i[o]=o-u[s]),i},this.PEAK=function(e,t,a){var r=this.ZIG(e,t),i=[],n=r.length,s=a;if(s<1)return i;for(var u=0,o=[],l=0;l<s;++l)o[l]=0;l=this.GetFirstVaildIndex(r)+1;for(s--;l<n&&r[l]<r[l-1];++l);for(;l<n&&r[l]>r[l-1];++l);for(o[0]=--l;l<n-1;++l){if(r[l]>r[l+1]){if(u){if(s)for(var D=o.slice(0),h=0;h<s;++h)o[h+1]=D[h];o[u=0]=l}}else u=1;o[s]&&(i[l]=r[o[s]])}return o[s]&&(i[l]=r[o[s]]),i},this.EVERY=function(e,t){var a=[];if(t<1)return a;for(var r=0;r<e.length&&(a[r]=null,!this.IsNumber(e[r]));++r);for(var i=0;r<e.length;++r)e[r]?i+=1:i=0,i==t?(a[r]=1,--i):a[r]=0;return a},this.COST=function(e,t){var a=[],r=e/100;if(r<1e-6||r>1)return a;var i=this.SymbolData.Data.Data;if(!i||i.length<=0)return a;for(var n=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),s=i[0].High,u=i[0].Low,o=0;o<i.length;++o){var l=i[o];u=Math.min(u,l.Low),s=Math.max(s,l.High)}(u>2e3||u<0||s>2e3||u<0)&&this.ThrowUnexpectedNode(t,"COST() 历史K线最大最小值错误, 超出(0,1000)范围");var D=parseInt(100*s+1),h=parseInt(100*u-1),c=0,C=0,E=0;s=D/100,u=h/100;var m=D-h+1;if(m<1)return a;var A=[],N=[];for(o=0;o<m;++o)A[o]=0,N[o]=0;var I=0,S=0,f=0,O=0;for(o=0;o<i.length;++o)if(!(o>=n.length)){if(n[o]>1){var d=i[o];I=d.Vol/n[o];for(var p=0;p<m;p++)A[p]*=1-I;c=parseInt(Math.min(D,Math.max(h,100*d.Low)))-h,C=parseInt(Math.min(D,Math.max(h,100*d.High)))-h,E=parseInt(Math.min(D,Math.max(h,100*d.Close)))-h;for(p=0;p<m;++p)N[p]=0;var _=parseInt((c+C+2*E)/4);if(_==C||_==c)N[_]+=d.Vol;else{for(var T=d.Vol/(_-c),y=c;y<_;++y)N[y]+=T/(_-c)*(y-c);for(;y<=C;++y)N[y]+=T/(_-C)*(y-C)}for(S=0,p=c;p<=C;p++)A[p]+=N[p];for(p=0;p<m;p++)S+=A[p];for(p=0,O=f=0;p<m;++p)if((f+=A[p])>=S*r){O=(s-u)*p/m+u;break}}a[o]=O}return a},this.WINNER=function(e,t){var a=[],r=this.SymbolData.Data.Data;if(!r||r.length<=0)return a;for(var i=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),n=r[0].High,s=r[0].Low,u=0;u<r.length;++u){var o=r[u];s=Math.min(s,o.Low),n=Math.max(n,o.High)}(s>1e3||s<0||n>1e3||s<0)&&this.ThrowUnexpectedNode(t,"WINNER() 历史K线最大最小值错误, 超出(0,1000)范围");var l=parseInt(100*n+1),D=parseInt(100*s-1),h=0,c=0,C=0;n=l/100,s=D/100;var E=l-D+1;if(E<1)return a;var m=[],A=[];for(u=0;u<E;++u)m[u]=0,A[u]=0;var N=0,I=0,S=0;for(u=0;u<r.length;++u)if(!(u>=i.length)&&i[u]>1){var f=r[u];N=f.Vol/i[u];for(var O=0;O<E;O++)m[O]*=1-N;h=parseInt(Math.min(l,Math.max(D,100*f.Low)))-D,c=parseInt(Math.min(l,Math.max(D,100*f.High)))-D,C=parseInt(Math.min(l,Math.max(D,100*f.Close)))-D;for(O=0;O<E;++O)A[O]=0;var d=parseInt((h+c+2*C)/4);if(d==c||d==h)A[d]+=f.Vol;else{for(var p=f.Vol/(d-h),_=h;_<d;++_)A[_]+=p/(d-h)*(_-h);for(;_<=c;++_)A[_]+=p/(d-c)*(_-c)}for(I=0,O=h;O<=c;O++)m[O]+=A[O];for(O=0;O<E;O++)I+=m[O];c=Array.isArray(e)?parseInt(Math.min(100*e[u]-D,E-1)):parseInt(Math.min(100*e-D,E-1));for(O=0,S=0;O<=c;O++)S+=m[O];I>0?a[u]=S/I:u-1>=0&&(a[u]=a[u-1])}return a},this.COSTEX=function(e,t,a){var r=[],i=this.SymbolData.Data.Data;if(!i||i.length<=0)return r;for(var n=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:a}),s=i[0].High,u=i[0].Low,o=0;o<i.length;++o){var l=i[o];u=Math.min(u,l.Low),s=Math.max(s,l.High)}(u>1e3||u<0||s>1e3||u<0)&&this.ThrowUnexpectedNode(a,"COSTEX() 历史K线最大最小值错误, 超出(0,1000)范围");var D=parseInt(100*s+1),h=parseInt(100*u-1),c=0,C=0,E=0;s=D/100,u=h/100;var m=D-h+1;if(m<1)return r;var A=[],N=[];for(o=0;o<m;++o)A[o]=0,N[o]=0;for(var I=0,S=0,f=0,O=0,d=0,p=0,_=(o=0,0);o<i.length;++o)if(!(o>=n.length)&&n[o]>1){var T=i[o];I=T.Vol/n[o];for(_=0;_<m;_++)A[_]*=1-I;c=parseInt(Math.min(D,Math.max(h,100*T.Low)))-h,C=parseInt(Math.min(D,Math.max(h,100*T.High)))-h,E=parseInt(Math.min(D,Math.max(h,100*T.Close)))-h;for(_=0;_<m;++_)N[_]=0;var y=parseInt((c+C+2*E)/4);if(y==C||y==c)N[y]+=T.Vol;else{for(var L=T.Vol/(y-c),F=c;F<y;++F)N[F]+=L/(y-c)*(F-c);for(;F<=C;++F)N[F]+=L/(y-C)*(F-C)}0;for(_=c;_<=C;_++)A[_]+=N[_];for(_=0;_<m;_++)A[_];for(C=Array.isArray(e)?parseInt(Math.min(100*e[o]-h,m-1)):parseInt(Math.min(100*e-h,m-1)),_=0,f=0,O=0;_<=C;_++)f+=A[_],O+=.01*(_+h)*A[_];for(C=Array.isArray(t)?parseInt(Math.min(100*t[o]-h,m-1)):parseInt(Math.min(100*t-h,m-1)),_=0,d=0,p=0;_<=C;_++)d+=A[_],p+=.01*(_+h)*A[_];S=f-d,dPerVolRange=O-p,Math.abs(dPerVolRange)>.001&&0!=S?r[o]=dPerVolRange/S:o-1>=0&&(r[o]=r[o-1])}return r},this.PPART=function(e,t){var a=[],r=e;if(r<0)return a;var i=this.SymbolData.Data.Data;if(!i||i.length<=0)return a;for(var n=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),s=r,u=0;s<i.length;++s){var o=s-r;if(!(o<0)){var l=0;for(u=0;u<r;++u){l+=i[u+o].Vol}if(s<n.length&&n[s]>0){var D=1-l/n[s];a[s]=D}}}return a},this.LWINNER=function(e,t,a){var r=e;r<=0&&this.ThrowUnexpectedNode(a,"LWINNER() 第1个参数错误");var i=[],n=this.SymbolData.Data.Data;if(!n||n.length<=0)return i;for(var s=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:a}),u=0,o=0,l=r-1,D=0,h=0;l<n.length;++l){var c=l-r+1,C=n[c].High,E=n[c].Low;for(D=0;D<r;++D){var m=n[c+D];E=Math.min(E,m.Low),C=Math.max(C,m.High)}(E>1e3||E<0||C>1e3||E<0)&&this.ThrowUnexpectedNode(a,"LWINNER() 历史K线最大最小值错误, 超出(0,1000)范围");var A=parseInt(100*C+1),N=parseInt(100*E-1),I=0,S=0,f=0;C=A/100,E=N/100;var O=A-N+1;if(O<1)return i;var d=[],p=[];for(D=0;D<O;++D)d[D]=0,p[D]=0;for(D=0;D<r;++D){var _=s[c+D];if(!(_<1)){var T=n[c+D],y=T.Vol/_;for(h=0;h<O;h++)d[h]*=1-y;I=parseInt(Math.min(A,Math.max(N,100*T.Low)))-N,S=parseInt(Math.min(A,Math.max(N,100*T.High)))-N,f=parseInt(Math.min(A,Math.max(N,100*T.Close)))-N;for(h=0;h<O;++h)p[h]=0;var L=parseInt((I+S+2*f)/4);if(L==S||L==I)p[L]+=T.Vol;else{var F=T.Vol/(L-I);for(let e=I;e<L;++e)p[e]+=F/(L-I)*(e-I);for(let e;e<=S;++e)p[e]+=F/(L-S)*(e-S)}u=0;for(h=I;h<=S;h++)d[h]+=p[h]}}for(D=0;D<O;D++)u+=d[D];for(S=Array.isArray(t)?parseInt(Math.min(100*t[l]-N,O-1)):parseInt(Math.min(100*t-N,O-1)),o=0,h=0;h<=S;h++)o+=d[h];u>0&&o>0&&o<=u?i[l]=o/u:l-1>=0&&(i[l]=i[l-1])}return i},this.PWINNER=function(e,t,a){return[]},this.CalculateChip=function(e,t,a,r){for(var i={Min:null,Max:null,Data:[]},n=1,s=null,u=null,o=e;o>=0;--o){let D={};var l=a[o];D.Vol=o==e?l.Vol*t[o]:l.Vol*n,D.Date=l.Date,D.High=l.High,D.Low=l.Low,null==s?s=D.High:s<D.High&&(s=D.High),null==u?u=D.Low:u<D.Low&&(u=D.Low),i.Data[o]=D,n*=1-t[o]/100*r}return i.Max=s,i.Min=u,i},this.UPNDAY=function(e,t){var a=[];if(t<1)return a;if(null==e||t>e.length)return a;for(var r=0,i=0;i<e.length;++i)a[i]=0,i-1<0||(this.IsNumber(e[i])&&this.IsNumber(e[i-1])?(e[i]>e[i-1]?++r:r=0,r==t&&(a[i]=1,--r)):r=0);return a},this.DOWNNDAY=function(e,t){var a=[];if(t<1)return a;if(null==e||t>e.length)return a;for(var r=0,i=0;i<e.length;++i)a[i]=0,i-1<0||(this.IsNumber(e[i])&&this.IsNumber(e[i-1])?(e[i]<e[i-1]?++r:r=0,r==t&&(a[i]=1,--r)):r=0);return a},this.NDAY=function(e,t,a){var r=[];if(a<1)return r;if(!Array.isArray(e)&&!Array.isArray(t))return r;if(null==e||null==t)return r;if(Array.isArray(e)&&Array.isArray(t)){if(a>=e.length||a>=t.length)return r;for(var i=Math.max(e.length,t.length),n=0,s=0;s<i;++s)r[s]=0,s>=e.length||s>=t.length||(this.IsNumber(e[s])&&this.IsNumber(t[s])?(e[s]>t[s]?++n:n=0,n==a&&(r[s]=1,--n)):n=0)}else if(Array.isArray(e)&&!Array.isArray(t)){if(a>=e.length||!this.IsNumber(t))return;n=0;for(var s in e)r[s]=0,this.IsNumber(e[s])?(e[s]>t?++n:n=0,n==a&&(r[s]=1,--n)):n=0}else if(!Array.isArray(e)&&Array.isArray(t)){if(a>=t.length||!this.IsNumber(e))return;n=0;for(var s in t)r[s]=0,this.IsNumber(t[s])?(e>t[s]?++n:n=0,n==a&&(r[s]=1,--n)):n=0}return r},this.LONGCROSS=function(e,t,a){for(var r=[],i=Math.max(e.length,t.length),n=0;n<i;++n)r[n]=0,n-1<0||n>=e.length||n>=t.length||this.IsNumber(e[n])&&this.IsNumber(t[n])&&this.IsNumber(e[n-1])&&this.IsNumber(t[n-1])&&e[n]>t[n]&&e[n-1]<t[n-1]&&(r[n]=1);n=0;for(var s=0;n<i;++n)if(r[n])for(s=1;s<=a&&n-s>=0;++s)if(e[n-s]>=t[n-s]){r[n]=0;break}return r},this.EXISTR=function(e,t,a){var r=[];if(!Array.isArray(e))return r;if(t=parseInt(t),a=parseInt(a),t<=0&&(t=e.length),a<=0&&(a=1),a>t)return r;r=[];for(var i=0,n=0;i<e.length;++i)if(r[i]=null,!(i-t<0||i-a<0))for(r[i]=0,n=t;n>=a;--n){var s=e[i-n];if(this.IsNumber(s)&&s){r[i]=1;break}}return r},this.RELATE=function(e,t,a){var r=[];if(a<1&&(a=1),!Array.isArray(e)||!Array.isArray(t))return r;for(var i=this.CalculateAverage(e,a),n=this.CalculateAverage(t,a),s=Math.max(e.length,t.length),u=0,o=0;u<s;++u)if(r[u]=null,!(u>=e.length||u>=t.length||u>=i.length||u>=n.length)){var l=i[u],D=n[u],h=0,c=0,C=0;for(o=u-a+1;o<=u;++o)h+=(e[o]-l)*(t[o]-D),c+=Math.pow(e[o]-l,2),C+=Math.pow(t[o]-D,2);r[u]=h/a/(Math.sqrt(c/a)*Math.sqrt(C/a))}return r},this.CalculateAverage=function(e,t){var a=[];if(t<1)return a;for(var r=0,i=0;i<e.length&&!this.IsNumber(e[i]);++i);for(;i<e.length&&i<t;++i){a[i]=null;var n=e[i];this.IsNumber(n)&&(r+=n)}for(a[i-1]=r/t;i<e.length;++i){n=e[i];var s=e[i-t];this.IsNumber(n)||(n=0),this.IsNumber(s)||(s=0),r=r-s+n,a[i]=r/t}return a},this.COVAR=function(e,t,a){var r=[];if(a<1&&(a=1),!Array.isArray(e)||!Array.isArray(t))return r;for(var i=this.CalculateAverage(e,a),n=this.CalculateAverage(t,a),s=Math.max(e.length,t.length),u=(s=Math.max(e.length,t.length),0),o=0;u<s;++u)if(r[u]=null,!(u>=e.length||u>=t.length||u>=i.length||u>=n.length)){var l=i[u],D=n[u],h=0;for(o=u-a+1;o<=u;++o)h+=(e[o]-l)*(t[o]-D);r[u]=h/a}return r},this.HHVBARS=function(e,t){var a=[];if(!Array.isArray(e))return a;if(Array.isArray(t))for(var r=0;r<t.length;++r){a[r]=null;var i=t[r];if(this.IsNumber(i)){var n=r-i;n<0&&(n=0);for(var s=null,u=n;u<e.length;++u)if(this.IsNumber(e[u])){s=u;break}for(var o=0;u<e.length&&o<i;++o,++u)e[u]>=e[s]&&(s=u);null!=s&&(a[r]=r-s)}}else{t<1&&(t=e.length);for(s=null,r=0;r<e.length;++r)if(a[r]=null,this.IsNumber(e[r])){s=r;break}u=0;for(r=s+1;r<e.length&&u<t;++r,++u)e[r]>=e[s]&&(s=r),t==e.length&&(a[r]=r-s);for(;r<e.length;++r){if(r-s<t)e[r]>=e[s]&&(s=r);else for(u=s=r-t+1;u<=r;++u)e[u]>=e[s]&&(s=u);a[r]=r-s}}return a},this.LLVBARS=function(e,t){var a=[];if(!Array.isArray(e))return a;if(Array.isArray(t))for(var r=0;r<t.length;++r){a[r]=null;var i=t[r];if(this.IsNumber(i)){var n=r-i;n<0&&(n=0);for(var s=null,u=n;u<e.length;++u)if(this.IsNumber(e[u])){s=u;break}for(var o=0;u<e.length&&o<i;++o,++u)e[u]<=e[s]&&(s=u);null!=s&&(a[r]=r-s)}}else{t<1&&(t=e.length);for(s=null,r=0;r<e.length;++r)if(a[r]=null,this.IsNumber(e[r])){s=r;break}u=0;for(r=s+1;r<e.length&&u<t;++r,++u)e[r]<=e[s]&&(s=r),t==e.length&&(a[r]=r-s);for(;r<e.length;++r){if(r-s<t)e[r]<=e[s]&&(s=r);else for(u=s=r-t+1;u<=r;++u)e[u]<=e[s]&&(s=u);a[r]=r-s}}return a},this.BETA=function(e){var t=[],a=this.SymbolData.Data,r=this.SymbolData.IndexData;e<=0&&(e=1);for(var i=[],n=[],s=0;s<a.Data.length;++s){i[s]=0,n[s]=0;var u=a.Data[s],o=r.Data[s];u.Close>0&&u.YClose>0&&(i[s]=(u.Close-u.YClose)/u.YClose),o.Close>0&&o.YClose>0&&(n[s]=(o.Close-o.YClose)/o.YClose)}for(var l=this.CalculateAverage(i,e),D=this.CalculateAverage(n,e),h=(s=0,0);s<a.Data.length;++s)if(t[s]=null,!(s>=i.length||s>=n.length||s>=l.length||s>=D.length)){var c=l[s],C=D[s],E=0,m=0;for(h=s-e+1;h<=s;++h){var A=n[h]-C;E+=A*(i[h]-c),m+=A*A}this.IsDivideNumber(m)&&this.IsNumber(E)&&(t[s]=E/m)}return t},this.BETA2=function(e,t,a){var r=[];a<=0&&(a=1);for(var i=[null],n=[null],s=Math.max(e.length,t.length),u={X:e[0],Y:t[0]},o=1;o<s;++o){i[o]=0,n[o]=0;var l=e[o],D=t[o];u.X>0&&(i[o]=(l-u.X)/u.X),u.Y>0&&(n[o]=(D-u.Y)/u.Y),u={X:l,Y:D}}for(var h=this.CalculateAverage(i,a),c=this.CalculateAverage(n,a),C=(o=0,0);o<s;++o)if(r[o]=null,!(o>=i.length||o>=n.length||o>=h.length||o>=c.length)){var E=h[o],m=c[o],A=0,N=0;for(C=o-a+1;C<=o;++C){var I=i[C]-E;A+=I*(n[C]-m),N+=I*I}this.IsDivideNumber(N)&&this.IsNumber(A)&&(r[o]=A/N)}return r},this.SAR=function(e,t,a){var r=[],i=this.SymbolData.Data;if(e>=i.Data.length)return r;for(var n=null,s=null,u=0;u<e;++u){var o=i.Data[u];null==n?n=o.High:n<o.High&&(n=o.High),null==s?s=o.Low:s>o.Low&&(s=o.Low)}var l=0;r[e-1]=s;var D=s,h=i.Data[0].High,c=t/100;for(u=e;u<i.Data.length;++u){var C=h,E=(o=i.Data[u],i.Data[u-1]);0==l?o.Low<r[u-1]?(l=1,h=o.Low,c=t/100,D=Math.max(o.High,E.High),D=Math.max(D,C+c*(h-C))):(l=0,o.High>C&&(h=o.High,c=Math.min(c+t/100,a/100)),D=Math.min(o.Low,E.Low),D=Math.min(D,r[u-1]+c*(h-r[u-1]))):1==l&&(o.High>r[u-1]?(l=0,h=o.High,c=t/100,D=Math.min(o.Low,E.Low),D=Math.min(D,r[u-1]+c*(h-C))):(l=1,o.Low<C&&(h=o.Low,c=Math.min(c+t/100,a/100)),D=Math.max(o.High,E.High),D=Math.max(D,r[u-1]+c*(h-r[u-1])))),r[u]=D}return r},this.SARTURN=function(e,t,a){var r=[],i=this.SAR(e,t,a),n=this.SymbolData.Data,s=0;for(s=0;s<i.length&&!this.IsNumber(i[s]);++s);var u=0;s<n.Data.length&&(u=n.Data[s].Close>i[s]);for(var o=s+1;o<n.Data.length;++o){var l=n.Data[o];l.Close<i[o]&&u?r[o]=-1:r[o]=l.Close>i[o]&&!u?1:0,u=l.Close>i[o]}return r},this.BACKSET=function(e,t){var a=[];if(!e)return a;var r=e.length;if(!this.IsNumber(r)||r<=0)return a;if(Array.isArray(t)){for(var i=0;i<r;++i)a[i]=0;for(i=0;i<r;++i){var n=e[i],s=t[i];if(this.IsNumber(n)&&n&&this.IsNumber(s))for(var u=i,o=0;u>=0&&o<s;--u,++o)a[u]=1}}else{for(i=0;i<r;++i)a[i]=0;for(var l=0;l<r&&!this.IsNumber(e[l]);++l);if(l==r)return a;var D=Math.min(r-l,Math.max(t,1));for(i=r-1,u=0;i>=0;--i){n=e[i];if(this.IsNumber(n)&&n)for(u=i;u>i-D;--u)a[u]=1}if(e[i])for(u=i;u>=l;--u)a[u]=1}return a},this.BETWEEN=function(e,t,a){var r=[],i="number"==typeof t,n="number"==typeof a;if("number"==typeof e&&i&&n)return e>=t&&e<=a?1:0;for(var s in e){r[s]=0;var u=e[s],o=null,l=null;i?o=t:s<t.length-1&&(o=t[s]),n?l=a:s<a.length-1&&(l=a[s]),null!=o&&null!=l&&(o>l?u>=l&&u<=o&&(r[s]=1):u<=l&&u>=o&&(r[s]=1))}return r},this.STRCAT=function(e,t){var a=[];return IFrameSplitOperator.IsString(e)&&IFrameSplitOperator.IsString(t)&&(a=e+t),a},this.VARCAT=function(e,t){var a=[];if(Array.isArray(e)&&Array.isArray(t))for(var r=Math.max(e.length,t.length),i="",n=0;n<r;++n){if(a[n]=null,i="",n<e.length){var s=e[n];IFrameSplitOperator.IsString(s)&&(i+=s)}if(n<t.length){s=t[n];IFrameSplitOperator.IsString(s)&&(i+=s)}""!=i&&(a[n]=i)}else if(IFrameSplitOperator.IsString(e)&&Array.isArray(t))for(n=0;n<t.length;++n){a[n]=null;s=t[n];IFrameSplitOperator.IsString(s)&&(a[n]=e+s)}else if(Array.isArray(e)&&IFrameSplitOperator.IsString(t))for(n=0;n<e.length;++n){a[n]=null;s=e[n];IFrameSplitOperator.IsString(s)&&(a[n]=s+t)}else IFrameSplitOperator.IsString(e)&&IFrameSplitOperator.IsString(t)&&(a=e+t);return a},this.STRSPACE=function(e){var t=[];if(Array.isArray(e))for(var a=0;a<e.length;++a){t[a]=null;var r=e[a];IFrameSplitOperator.IsString(r)&&(t[a]=r+" ")}else IFrameSplitOperator.IsString(e)&&(t=e+" ");return t},this.CON2STR=function(e,t){var a=[];if(Array.isArray(e))for(var r=e.length-1;r>=0;--r){var i=e[r];if(this.IsNumber(i))return a=i.toFixed(t)}else this.IsNumber(e)&&(a=e.toFixed(t));return a},this.VAR2STR=function(e,t){var a=[];if(Array.isArray(e))for(var r=0;r<e.length;++r){a[r]=null;var i=e[r];this.IsNumber(i)&&(a[r]=i.toFixed(t))}else this.IsNumber(e)&&(a=e.toFixed(t));return a},this.MOD=function(e,t){var a=[];let r="number"==typeof e,i="number"==typeof t;if(r&&i)return JSAlgorithm.MOD(e,t);if(!r&&!i){let r=Math.max(e.length,t.length);for(var n=0;n<r;++n)a[n]=null,n<e.length&&n<t.length&&this.IsNumber(e[n])&&this.IsNumber(t[n])&&(a[n]=JSAlgorithm.MOD(e[n],t[n]));return a}if(r&&!i){for(var n in t)a[n]=null,this.IsNumber(e)&&this.IsNumber(t[n])&&(a[n]=JSAlgorithm.MOD(e,t[n]));return a}if(!r&&i){for(var n in e)a[n]=null,this.IsNumber(e[n])&&this.IsNumber(t)&&(a[n]=JSAlgorithm.MOD(e[n],t));return a}return a},this.POW=function(e,t){var a=[];if(!IFrameSplitOperator.IsNumber(t))return a;if("number"==typeof e)return Math.pow(e,t);for(var r in e){var i=e[r];this.IsNumber(i)?a[r]=Math.pow(i,t):a[r]=null}return a},this.CEILING=function(e){if("number"==typeof e)return parseInt(e);var t=[];for(var a in e){var r=e[a];this.IsNumber(r)?t[a]=parseInt(r):t[a]=null}return t},this.FLOOR=function(e){if("number"==typeof e)return parseInt(e-1);var t=[];for(var a in e){var r=e[a];this.IsNumber(r)?t[a]=parseInt(r-1):t[a]=null}return t},this.ZTPRICE=function(e,t){if(!this.IsNumber(t))return null;if(Array.isArray(e)){var a=[];for(var r in e){var i=e[r];this.IsNumber(i)?a[r]=(1+t)*i:a[r]=null}return a}return this.IsNumber(e)?a=(1+t)*e:void 0},this.DTPRICE=function(e,t){if(!this.IsNumber(t))return null;if(Array.isArray(e)){var a=[];for(var r in e){var i=e[r];this.IsNumber(i)?a[r]=(1-t)*i:a[r]=null}return a}return this.IsNumber(e)?a=(1-t)*e:void 0},this.FRACPART=function(e){if(Array.isArray(e)){var t=[],a=0;for(var r in e){var i=e[r];this.IsNumber(i)?(a=parseInt(i),t[r]=i-a):t[r]=null}return t}if(this.IsNumber(e))return t=e-(a=parseInt(e))},this.BARSLASTCOUNT=function(e){var t=null;if(Array.isArray(e)){if(t=[],e.length>0)for(var a=0,r=e.length-1;r>=0;--r){a=0;for(var i=r;i>=0&&e[i];--i)++a;t[r]=a}}else t=e?1:0;return t},this.INTPART=function(e){var t=null;if(Array.isArray(e))for(var a in t=[],e){var r=e[a];this.IsNumber(r)?t[a]=parseInt(r):t[a]=null}else this.IsNumber(e)&&(t=parseInt(e));return t},this.CONST=function(e){if(Array.isArray(e)){var t=e.length;return t>0?e[t-1]:null}return e},this.TOPRANGE=function(e){if(this.IsNumber(e))return 0;var t=[];if(Array.isArray(e))for(var a=e.length-1;a>=0;--a){t[a]=0;var r=e[a];if(this.IsNumber(r)){for(var i=0,n=a-1;n>=0&&!(e[n]>r);--n)++i;t[a]=i}}return t},this.LOWRANGE=function(e){if(this.IsNumber(e))return 0;var t=[];if(Array.isArray(e))for(var a=e.length-1;a>=0;--a){t[a]=0;var r=e[a];if(this.IsNumber(r)){for(var i=0,n=a-1;n>=0&&!(e[n]<r);--n)++i;t[a]=i}}return t},this.FINDLOW=function(e,t,a,r){if(this.IsNumber(e))return e;var i=[];if(Array.isArray(e))for(var n=e.length-1;n>=0;--n){i[n]=null;for(var s=[],u=t;u<a;++u){var o;if((o=n-u)<0)break;var l=e[o];this.IsNumber(l)&&s.push(l)}if(s.length>0)s.sort(function(e,t){return e-t}),(o=r-1)<0?o=0:o>=s.length&&(o=s.length-1),i[n]=s[o]}return i},this.FINDHIGH=function(e,t,a,r){if(this.IsNumber(e))return e;var i=[];if(Array.isArray(e))for(var n=e.length-1;n>=0;--n){i[n]=null;for(var s=[],u=t;u<a;++u){var o;if((o=n-u)<0)break;var l=e[o];this.IsNumber(l)&&s.push(l)}if(s.length>0)s.sort(function(e,t){return t-e}),(o=r-1)<0?o=0:o>=s.length&&(o=s.length-1),i[n]=s[o]}return i},this.FINDHIGHBARS=function(e,t,a,r){if(this.IsNumber(e))return a-t-r;var i=[];if(Array.isArray(e))for(var n=e.length-1;n>=0;--n){i[n]=null;for(var s=[],u=t;u<a;++u){var o;if((o=n-u)<0)break;var l=e[o];this.IsNumber(l)&&s.push({Value:l,Period:u})}if(s.length>0)s.sort(function(e,t){return t.Value-e.Value}),(o=r-1)<0?o=0:o>=s.length&&(o=s.length-1),i[n]=s[o].Period}return i},this.FINDLOWBARS=function(e,t,a,r){if(this.IsNumber(e))return a-t-r;var i=[];if(Array.isArray(e))for(var n=e.length-1;n>=0;--n){i[n]=null;for(var s=[],u=t;u<a;++u){var o;if((o=n-u)<0)break;var l=e[o];this.IsNumber(l)&&s.push({Value:l,Period:u})}if(s.length>0)s.sort(function(e,t){return e.Value-t.Value}),(o=r-1)<0?o=0:o>=s.length&&(o=s.length-1),i[n]=s[o].Period}return i},this.HOD=function(e,t){var a=[];if(IFrameSplitOperator.IsNumber(e))return 1;if(Array.isArray(e))for(var r=e.length-1;r>=0;--r){var i=e[r];if(IFrameSplitOperator.IsNumber(i)){if(Array.isArray(t))var n=parseInt(t[r]);else n=parseInt(t);t<=0&&(n=r);for(var s=1,u=r-1,o=1;u>=0&&o<n;--u,++o){var l=e[u];IFrameSplitOperator.IsNumber(l)&&l>i&&++s}a[r]=s}}return a},this.LOD=function(e,t){var a=[];if(IFrameSplitOperator.IsNumber(e))return 1;if(Array.isArray(e))for(var r=e.length-1;r>=0;--r){var i=e[r];if(IFrameSplitOperator.IsNumber(i)){if(Array.isArray(t))var n=parseInt(t[r]);else n=parseInt(t);t<=0&&(n=r);for(var s=1,u=r-1,o=1;u>=0&&o<n;--u,++o){var l=e[u];IFrameSplitOperator.IsNumber(l)&&l<i&&++s}a[r]=s}}return a},this.BARSNEXT=function(e){if(!Array.isArray(e))return 0;for(var t=[],a=0;a<e.length;++a){t[a]=0;for(var r=a,i=0;r<e.length;++r,++i){if(e[r]>0){t[a]=i;break}}}return t},this.RAND=function(e){if(Array.isArray(e)){var t=[];for(var a in e){t[a]=null;var r=e[a];(i=parseInt(r))<=0||(t[a]=Math.ceil(Math.random()*i))}return t}var i;if((i=parseInt(e))<=0)return null;var n=this.SymbolData.Data.Data.length;for(t=[],a=0;a<n;++a)t[a]=Math.ceil(Math.random()*i);return t},this.AMA=function(e,t){var a,r=[];if(Array.isArray(t)){for(var i=e.length-1;i>=0;--i)if(this.IsNumber(t[i])){a=t[i];break}}else a=t;if(this.IsNumber(a)){if(a>1)return r;for(var n=0,s=0;n<e.length;++n)if(r[n]=null,this.IsNumber(e[n])){s=e[n],r[n]=s;break}for(i=n+1;i<e.length;++i){var u=e[i];r[i]=r[i-1]+a*(u-r[i-1])}}return r},this.TMA=function(e,t,a){var r=[];if(this.IsNumber(t)&&t<=1&&this.IsNumber(a)&&a<1){var i=!1;for(var n in e)if(r[n]=null,0==i){var s=e[n];this.IsNumber(s)&&(r[n]=s,r[n],i=!0)}else{s=e[n];if(!this.IsNumber(s))continue;r[n]=t*r[n-1]+a*s,r[n]}}return r},this.CallFunction=function(e,t,a,r){switch(e){case"MAX":case"MAX6":return this.MAX(t,a);case"MIN":case"MIN6":return this.MIN(t,a);case"REF":return this.REF(t[0],t[1]);case"REFV":return this.REFV(t[0],t[1]);case"REFX":return this.REFX(t[0],t[1]);case"REFXV":return this.REFXV(t[0],t[1]);case"ABS":return this.ABS(t[0]);case"MA":return this.MA(t[0],t[1]);case"EMA":return this.EMA(t[0],t[1]);case"SMA":return this.SMA(t[0],t[1],t[2]);case"DMA":return this.DMA(t[0],t[1]);case"XMA":return this.XMA(t[0],t[1]);case"EXPMA":return this.EXPMA(t[0],t[1]);case"EXPMEMA":return this.EXPMEMA(t[0],t[1]);case"COUNT":return this.COUNT(t[0],t[1]);case"LLV":return this.LLV(t[0],t[1]);case"LLVBARS":return this.LLVBARS(t[0],t[1]);case"HHV":return this.HHV(t[0],t[1]);case"HHVBARS":return this.HHVBARS(t[0],t[1]);case"MULAR":return this.MULAR(t[0],t[1]);case"CROSS":return this.CROSS(t[0],t[1]);case"LONGCROSS":return this.LONGCROSS(t[0],t[1],t[2]);case"AVEDEV":return this.AVEDEV(t[0],t[1]);case"STD":return this.STD(t[0],t[1]);case"IF":case"IFF":return this.IF(t[0],t[1],t[2]);case"IFN":return this.IFN(t[0],t[1],t[2]);case"NOT":return this.NOT(t[0]);case"SUM":return this.SUM(t[0],t[1]);case"RANGE":return this.RANGE(t[0],t[1],t[2]);case"EXIST":return this.EXIST(t[0],t[1]);case"EXISTR":return this.EXISTR(t[0],t[1],t[2]);case"FILTER":return this.FILTER(t[0],t[1]);case"TFILTER":return this.TFILTER(t[0],t[1],t[2]);case"SLOPE":return this.SLOPE(t[0],t[1]);case"BARSLAST":return this.BARSLAST(t[0]);case"BARSCOUNT":return this.BARSCOUNT(t[0]);case"BARSSINCEN":return this.BARSSINCEN(t[0],t[1]);case"BARSSINCE":return this.BARSSINCE(t[0]);case"LAST":return this.LAST(t[0],t[1],t[2]);case"EVERY":return this.EVERY(t[0],t[1]);case"DEVSQ":return this.DEVSQ(t[0],t[1]);case"ZIG":return this.ZIG(t[0],t[1]);case"TROUGHBARS":return this.TROUGHBARS(t[0],t[1],t[2]);case"TROUGH":return this.TROUGH(t[0],t[1],t[2]);case"PEAKBARS":return this.PEAKBARS(t[0],t[1],t[2]);case"PEAK":return this.PEAK(t[0],t[1],t[2]);case"COST":return this.COST(t[0]);case"WINNER":return this.WINNER(t[0],a);case"PPART":return this.PPART(t[0],a);case"COSTEX":return this.COSTEX(t[0],t[1],a);case"LWINNER":return this.LWINNER(t[0],t[1],a);case"PWINNER":return this.PWINNER(t[0],t[1],a);case"FORCAST":return this.FORCAST(t[0],t[1]);case"STDP":return this.STDP(t[0],t[1]);case"VAR":return this.VAR(t[0],t[1]);case"VARP":return this.VARP(t[0],t[1]);case"UPNDAY":return this.UPNDAY(t[0],t[1]);case"DOWNNDAY":return this.DOWNNDAY(t[0],t[1]);case"NDAY":return this.NDAY(t[0],t[1],t[2]);case"RELATE":return this.RELATE(t[0],t[1],t[2]);case"COVAR":return this.COVAR(t[0],t[1],t[2]);case"BETA":return this.BETA(t[0]);case"BETA2":return this.BETA2(t[0],t[1],t[2]);case"WMA":return this.WMA(t[0],t[1]);case"MEMA":return this.MEMA(t[0],t[1]);case"SUMBARS":return this.SUMBARS(t[0],t[1]);case"REVERSE":return this.REVERSE(t[0]);case"SAR":return this.SAR(t[0],t[1],t[2]);case"SARTURN":return this.SARTURN(t[0],t[1],t[2]);case"BACKSET":return this.BACKSET(t[0],t[1]);case"BETWEEN":return this.BETWEEN(t[0],t[1],t[2]);case"STRCAT":return this.STRCAT(t[0],t[1]);case"CON2STR":return this.CON2STR(t[0],t[1]);case"VAR2STR":return this.VAR2STR(t[0],t[1]);case"VARCAT":return this.VARCAT(t[0],t[1]);case"STRSPACE":return this.STRSPACE(t[0]);case"DTPRICE":return this.DTPRICE(t[0],t[1]);case"ZTPRICE":return this.ZTPRICE(t[0],t[1]);case"MOD":return this.MOD(t[0],t[1]);case"POW":return this.POW(t[0],t[1]);case"CEILING":return this.CEILING(t[0]);case"FLOOR":return this.FLOOR(t[0]);case"FRACPART":return this.FRACPART(t[0]);case"BARSLASTCOUNT":return this.BARSLASTCOUNT(t[0]);case"INTPART":return this.INTPART(t[0]);case"CONST":return this.CONST(t[0]);case"TOPRANGE":return this.TOPRANGE(t[0]);case"LOWRANGE":return this.LOWRANGE(t[0]);case"FINDLOW":return this.FINDLOW(t[0],t[1],t[2],t[3]);case"FINDLOWBARS":return this.FINDLOWBARS(t[0],t[1],t[2],t[3]);case"FINDHIGH":return this.FINDHIGH(t[0],t[1],t[2],t[3]);case"FINDHIGHBARS":return this.FINDHIGHBARS(t[0],t[1],t[2],t[3]);case"BARSNEXT":return this.BARSNEXT(t[0]);case"HOD":return this.HOD(t[0],t[1]);case"LOD":return this.LOD(t[0],t[1]);case"AMA":return this.AMA(t[0],t[1]);case"TMA":return this.TMA(t[0],t[1],t[2]);case"ATAN":return this.Trigonometric(t[0],Math.atan);case"ACOS":return this.ACOS(t[0]);case"ASIN":return this.ASIN(t[0]);case"COS":return this.Trigonometric(t[0],Math.cos);case"SIN":return this.Trigonometric(t[0],Math.sin);case"TAN":return this.Trigonometric(t[0],Math.tan);case"LN":return this.Trigonometric(t[0],Math.log);case"LOG":return this.Trigonometric(t[0],Math.log10);case"EXP":return this.Trigonometric(t[0],Math.exp);case"SQRT":return this.Trigonometric(t[0],Math.sqrt);case"RAND":return this.RAND(t[0]);default:this.ThrowUnexpectedNode(a,"函数"+e+"不存在",e)}},this.CallCustomFunction=function(e,t,a,r){var i=g_JSComplierResource.CustomFunction.Data.get(e),n=a.GetStockCacheData({CustomName:e,Node:r});if(!i.Invoke)return{Out:n};JSConsole.Complier.Log("[JSAlgorithm::CallCustomFunction] call custom function functionInfo=",i);var s=this,u={Name:e,Args:t,Symbol:a.Symbol,Period:a.Period,Right:a.Right,KData:a.Data,DownloadData:n,ThrowError:function(e){s.ThrowUnexpectedNode(r,e)}};return i.Invoke(u)},this.ThrowUnexpectedNode=function(e,t,a){let r=e.Marker,i=t||"执行异常";return this.ErrorHandler.ThrowError(r.Index,r.Line,r.Column,i,a)}}function JSDraw(e,t){this.ErrorHandler=e,this.SymbolData=t,this.DRAWTEXT=function(e,t,a){let r=[],i={DrawData:r,DrawType:"DRAWTEXT",Text:a};if(Array.isArray(e)){if(e.length<=0)return i;var n=this.IsNumber(t);for(var s in e)r[s]=null,!isNaN(e[s])&&e[s]&&(n?r[s]=t:this.IsNumber(t[s])&&(r[s]=t[s]))}else if(this.IsNumber(e)&&e)for(n=this.IsNumber(t),s=0;s<this.SymbolData.Data.Data.length;++s)n?r[s]=t:this.IsNumber(t[s])&&(r[s]=t[s]);return i},this.DRAWTEXT_FIX=function(e,t,a,r,i){var n={Value:[],Text:[]},s={DrawData:n,DrawType:"DRAWTEXT_FIX",Text:null,Position:{X:t,Y:a,Type:r}};if(e.length<=0)return s;if(Array.isArray(e))for(var u in e)n.Text[u]=null,n.Value[u]=0,!isNaN(e[u])&&e[u]&&(n.Value[u]=1,n.Text[u]=i);else if(e)for(u=0;u<this.SymbolData.Data.Data.length;++u)n.Text[u]=i,n.Value[u]=1;return s},this.SUPERDRAWTEXT=function(e,t,a,r,i){let n=[],s={DrawData:n,DrawType:"SUPERDRAWTEXT",Text:a,YOffset:i,Direction:r,TextAlign:"center"};if(e.length<=0)return s;var u="number"==typeof t;for(var o in e)n[o]=null,!isNaN(e[o])&&e[o]&&(u?n[o]=t:this.IsNumber(t[o])&&(n[o]=t[o]));return s},this.STICKLINE=function(e,t,a,r,i){let n=[],s={DrawData:n,DrawType:"STICKLINE",Width:r,Type:i};if(s.Width<0&&(s.Width=3),e.length<=0)return s;var u="number"==typeof t,o="number"==typeof a;for(var l in e)if(n[l]=null,!isNaN(e[l])&&e[l])if(u&&o)n[l]={Value:t,Value2:a};else if(u&&!o){if(isNaN(a[l]))continue;n[l]={Value:t,Value2:a[l]}}else if(!u&&o){if(isNaN(t[l]))continue;n[l]={Value:t[l],Value2:a}}else{if(isNaN(t[l])||isNaN(a[l]))continue;n[l]={Value:t[l],Value2:a[l]}}return s},this.DRAWLINE=function(e,t,a,r,i){let n=[],s={DrawData:n,DrawType:"DRAWLINE",Expand:i};if(e.length<=0)return s;let u=Math.max(e.length,a.length),o=!1,l=!1,D={Start:{},End:{},List:new Array};for(var h=0;h<u;++h){if(n[h]=null,h<e.length&&h<a.length)if(0==o&&0==l){if(null==e[h]||!e[h])continue;o=!0,D.Start={ID:h,Value:t[h]}}else if(1==o&&0==l){if(!(c=null!=a[h]&&a[h])){e[h]&&(D.Start={ID:h,Value:t[h]});continue}c&&(l=!0,D.End={ID:h,Value:r[h]})}else if(1==o&&1==l){var c;if(c=null!=a[h]&&a[h])D.End={ID:h,Value:r[h]};else if(e[h]){let e=this.CalculateDrawLine(D);for(var C in e){let t=e[C];n[t.ID]=t.Value}1==i&&this.CalculateDrawDataExtendLine(n,D.Start.ID-2),o=l=!1,o=!0,l=!1,(D={Start:{},End:{}}).Start={ID:h,Value:t[h]}}}if(1==o&&1==l){let e=this.CalculateDrawLine(D);for(var C in e){let t=e[C];n[t.ID]=t.Value}}}return 1==i&&this.CalculateDrawDataExtendLine(n),s},this.DRAWBAND=function(e,t,a,r){let i=[],n={DrawData:i,DrawType:"DRAWBAND",Color:[t.toLowerCase(),r.toLowerCase()]},s=Math.max(e.length,a.length);for(var u=0;u<s;++u){let t={Value:null,Value2:null};u<e.length&&(t.Value=e[u]),u<a.length&&(t.Value2=a[u]),i.push(t)}return n},this.GetDataByIndex=function(e,t){var a={Result:!1,Data:null};return this.IsNumber(e)?(a.Result=!0,a.Data=e):t<e.length?(a.Result=!0,a.Data=e[t]):a.Result=!1,a},this.FILLRGN=function(e,t,a){let r=[],i={DrawData:r,DrawType:"FILLRGN"};this.IsNumber(t),this.IsNumber(a);if(Array.isArray(e))for(var n in e){if(r[n]=null,e[n])if((u=this.GetDataByIndex(t,n)).Result)if((o=this.GetDataByIndex(a,n)).Result){var s={Value:u.Data,Value2:o.Data};r[n]=s}}else if(e)for(n=0;n<this.SymbolData.Data.Data.length;++n){var u,o;if(r[n]=null,(u=this.GetDataByIndex(t,n)).Result)if((o=this.GetDataByIndex(a,n)).Result){s={Value:u.Data,Value2:o.Data};r[n]=s}}return i},this.DRAWKLINE=function(e,t,a,r){let i=[],n={DrawData:i,DrawType:"DRAWKLINE"},s=Math.max(e.length,t.length,a.length,r.length);for(var u=0;u<s;++u){let n={Open:null,High:null,Low:null,Close:null};u<e.length&&u<t.length&&u<a.length&&u<r.length&&(n.Open=t[u],n.High=e[u],n.Low=a[u],n.Close=r[u]),i[u]=n}return n},this.DRAWKLINE_IF=function(e,t,a,r,i){let n=[],s={DrawData:n,DrawType:"DRAWKLINE_IF"},u=Math.max(e.length,t.length,a.length,r.length,i.length);for(var o=0;o<u;++o){let s={Open:null,High:null,Low:null,Close:null};o<t.length&&o<a.length&&o<r.length&&o<i.length&&o<e.length&&e[o]&&(s.Open=a[o],s.High=t[o],s.Low=r[o],s.Close=i[o]),n[o]=s}return s},this.POLYLINE=function(e,t){let a=[],r={DrawData:a,DrawType:"POLYLINE"},i=!1;if("number"==typeof t)if(this.IsNumber(e)){if(e)for(var n=this.SymbolData.Data.Data.length,s=0;s<n;++s)a[s]=t}else{var u=!1;for(var s in e)if(a[s]=null,u)a[s]=t;else{if(!e[s])continue;u=!0,a[s]=t}}else{let r={Start:{},End:{},List:new Array};for(var s in e)if(a[s]=null,0==i){if(null==e[s]||!e[s])continue;if(s>=t.length||!this.IsNumber(t[s]))continue;i=!0,r.Start={ID:parseInt(s),Value:t[s]}}else if(1==i){if(null==e[s]||!e[s])continue;if(s>=t.length||!this.IsNumber(t[s]))continue;r.End={ID:parseInt(s),Value:t[s]};let i=this.CalculateDrawLine(r);for(var o in i){let e=i[o];a[e.ID]=e.Value}r={Start:{ID:r.End.ID,Value:r.End.Value},End:{}}}this.CalculateDrawDataExtendLine(a)}return r},this.CalculateDrawDataExtendLine=function(e,t){if(!(t<0)){var a=null,r=e.length;this.IsNumber(t)&&t<r&&(r=t);for(var i=r-1;i>=0;--i)if(this.IsNumber(e[i])){a=i;break}if(null!=a&&a-1>=0){var n=a-1;for(i=a+1;i<r;++i){var s=e[n],u=(s-e[a])*(i-n)/(a-n);if(s-u<0)break;e[i]=s-u}}}},this.DRAWNUMBER=function(e,t,a){let r,i={Value:new Array,Text:new Array},n={DrawData:i,DrawType:"DRAWNUMBER"},s="number"==typeof a;for(var u in s&&(r=IFrameSplitOperator.IsInteger(a)?a.toString():a.toFixed(2)),e)if(i.Value[u]=null,e[u]&&!(u>=t.length)&&this.IsNumber(t[u]))if(s)i.Value[u]=t[u],i.Text[u]=r;else{if(u>=a.length||!a[u])continue;i.Value[u]=t[u],"number"==typeof a[u]?i.Text[u]=a[u].toFixed(2):i.Text[u]=a[u].toString()}return n},this.DRAWNUMBER_FIX=function(e,t,a,r,i){var n={Value:[],Text:[]},s={DrawData:n,DrawType:"DRAWNUMBER_FIX",Position:{X:t,Y:a,Type:r}},u=IFrameSplitOperator.IsNumber(i);if(Array.isArray(e)){for(var o in e)if(n.Text[o]=null,n.Value[o]=null,e[o])if(u)n.Text[o]=this.RemoveZero(i.toFixed(2)),n.Value[o]=i;else{if(o>=i.length||!IFrameSplitOperator.IsNumber(i[o]))continue;var l=i[o];n.Text[o]=this.RemoveZero(l.toFixed(2)),n.Value[o]=l}}else if(e)for(o=0;o<this.SymbolData.Data.Data.length;++o)if(u)n.Text[o]=this.RemoveZero(i.toFixed(2)),n.Value[o]=i;else{if(o>=i.length||!IFrameSplitOperator.IsNumber(i[o]))continue;l=i[o];n.Text[o]=this.RemoveZero(l.toFixed(2)),n.Value[o]=l}else;return s},this.DRAWICON=function(e,t,a){var r=g_JSComplierResource.GetDrawIcon(a);r||g_JSComplierResource.GetDrawTextIcon(a),r||(r={Symbol:"🚩"});let i=[],n={DrawData:i,DrawType:"DRAWICON",Icon:r};if(e.length<=0)return n;var s="number"==typeof t;if("number"==typeof e){if(!e)return n;for(var u=0;u<this.SymbolData.Data.Data.length;++u)s?i[u]=t:u<t.length&&this.IsNumber(t[u])?i[u]=t[u]:i[u]=null;return n}for(var u in e)i[u]=null,e[u]&&(s?i[u]=t:this.IsNumber(t[u])&&(i[u]=t[u]));return n},this.DRAWCHANNEL=function(e,t,a,r,i,n,s){let u=[],o={DrawData:u,DrawType:"DRAWCHANNEL",Border:{}};if(e.length<=0)return o;if(r&&(o.Border.Color=r),s&&(o.AreaColor=s),i>0&&(o.Border.Width=i),n){let e=n.split(",");for(var l in o.Border.Dotted=[],e){if(e[l]){var D=parseInt(e[l]);D<=0||o.Border.Dotted.push(D)}}o.Border.Dotted.length<=0&&(o.Border.Dotted=null)}var h="number"==typeof t,c="number"==typeof a;if("number"==typeof e){if(!e)return o;for(l=0;l<this.SymbolData.Data.Data.length;++l)if(u[l]=null,h&&c)u[l]={Value:t,Value2:a};else if(h&&!c){if(isNaN(a[l]))continue;u[l]={Value:t,Value2:a[l]}}else if(!h&&c){if(isNaN(t[l]))continue;u[l]={Value:t[l],Value2:a}}else{if(isNaN(t[l])||isNaN(a[l]))continue;u[l]={Value:t[l],Value2:a[l]}}}else for(l=0;l<e.length;++l)if(u[l]=null,!isNaN(e[l])&&e[l])if(h&&c)u[l]={Value:t,Value2:a};else if(h&&!c){if(isNaN(a[l]))continue;u[l]={Value:t,Value2:a[l]}}else if(!h&&c){if(isNaN(t[l]))continue;u[l]={Value:t[l],Value2:a}}else{if(isNaN(t[l])||isNaN(a[l]))continue;u[l]={Value:t[l],Value2:a[l]}}return o},this.RGB=function(e,t,a){return`RGB(${e},${t},${a})`},this.RGBA=function(e,t,a,r){return`RGB(${e},${t},${a},${r})`},this.PARTLINE=function(e){let t=[],a={DrawData:t,DrawType:"PARTLINE"};if(e.length<3)return a;for(var r=e[0],i=[],n=1;n<e.length&&n+1<e.length;n+=2)i.push({Cond:e[n],RGB:e[n+1]});for(var n in r){var s={Value:null,RGB:null};t[n]=s;var u=r[n];if(this.IsNumber(u)){var o=null;for(var l in i){var D=i[l];if(Array.isArray(D.Cond)){if(n<D.Cond.length&&D.Cond[n]){o=D.RGB;break}}else if(this.IsNumber(D.Cond)&&D.Cond){o=D.RGB;break}}o&&(s.Value=u,s.RGB=o)}}return a},this.FILLRGN2=function(e){let t=[],a={DrawData:t,DrawType:"FILLRGN2"};if(e.length<4)return a;for(var r=e[0],i=e[1],n=[],s=2;s<e.length&&s+1<e.length;s+=2)n.push({Cond:e[s],Color:e[s+1]});for(s=0;s<this.SymbolData.Data.Data.length;++s){t[s]=null;var u={Value:null,Value2:null,Color:null};for(var o in n){var l=n[o];if(Array.isArray(l.Cond)){if(s<l.Cond.length&&l.Cond[s]){u.Color=l.Color;break}}else if(this.IsNumber(l.Cond)&&l.Cond){u.Color=l.Color;break}}if(u.Color){if(Array.isArray(r)){if(s>=r.length)continue;if(!this.IsNumber(r[s]))continue;u.Value=r[s]}else{if(!this.IsNumber(r))continue;u.Value=r}if(Array.isArray(i)){if(s>=i.length)continue;if(!this.IsNumber(i[s]))continue;u.Value2=i[s]}else{if(!this.IsNumber(i))continue;u.Value2=i}t[s]=u}}return a},this.FLOATRGN=function(e){let t=[],a={DrawData:t,DrawType:"FLOATRGN"};if(e.length<4)return a;for(var r=e[0],i=e[1],n=[],s=2;s<e.length&&s+1<e.length;s+=2)n.push({Cond:e[s],Color:e[s+1]});for(s=0;s<this.SymbolData.Data.Data.length;++s){t[s]=null;var u={Value:null,Value2:null,Color:null};for(var o in n){var l=n[o];if(Array.isArray(l.Cond)){if(s<l.Cond.length&&l.Cond[s]){u.Color=l.Color;break}}else if(this.IsNumber(l.Cond)&&l.Cond){u.Color=l.Color;break}}if(u.Color){if(Array.isArray(r)){if(s>=r.length)continue;if(!this.IsNumber(r[s]))continue;u.Value=r[s]}else{if(!this.IsNumber(r))continue;u.Value=r}if(Array.isArray(i)){if(s>=i.length)continue;if(!this.IsNumber(i[s]))continue;u.Value2=i[s]}else{if(!this.IsNumber(i))continue;u.Value2=i}t[s]=u}}return a},this.FILLBGRGN=function(e,t){let a=[],r={DrawData:a,DrawType:1==e?"FILLTOPRGN":"FILLBOTTOMRGN"};if(t.length<3)return r;for(var i=t[0],n=[],s=1;s<t.length&&s+1<t.length;s+=2)n.push({Cond:t[s],Color:t[s+1]});for(s=0;s<this.SymbolData.Data.Data.length;++s){a[s]=null;var u={Value:null,Color:null};for(var o in n){var l=n[o];if(Array.isArray(l.Cond)){if(s<l.Cond.length&&l.Cond[s]){u.Color=l.Color;break}}else if(this.IsNumber(l.Cond)&&l.Cond){u.Color=l.Color;break}}if(u.Color){if(Array.isArray(i)){if(s>=i.length)continue;if(!this.IsNumber(i[s]))continue;u.Value=i[s]}else{if(!this.IsNumber(i))continue;u.Value=i}a[s]=u}}return r},this.FILLVERTICALRGN=function(e){let t=[],a={DrawData:t,DrawType:"FILLVERTICALRGN"};if(e.length<2)return a;for(var r=[],i=0;i<e.length&&i+1<e.length;i+=2)r.push({Cond:e[i],Color:e[i+1]});for(i=0;i<this.SymbolData.Data.Data.length;++i){t[i]=null;var n={Color:null};for(var s in r){var u=r[s];if(Array.isArray(u.Cond)){if(i<u.Cond.length&&u.Cond[i]){n.Color=u.Color;break}}else if(this.IsNumber(u.Cond)&&u.Cond){n.Color=u.Color;break}}n.Color&&(t[i]=n)}return a},this.DRAWGBK=function(e,t,a,r){let i={Color:[],Angle:r};t&&i.Color.push(t),a&&i.Color.push(a);let n={DrawData:null,DrawType:"DRAWGBK"};if(Array.isArray(e))for(var s in e){if(e[s]){n.DrawData=i;break}}else e&&(n.DrawData=i);return n},this.DRAWGBK2=function(e,t,a,r){let i={Color:[],Angle:r};t&&i.Color.push(t),a&&i.Color.push(a);let n={DrawData:null,DrawType:"DRAWGBK2"};if(Array.isArray(e)){for(var s in i.Data=[],e){var u=e[s];i.Data[s]=u?1:0}n.DrawData=i}else e&&(n.DrawData=i,n.DrawType="DRAWGBK");return n},this.DRAWTEXT_LINE=function(e,t,a,r,i,n,s){let u={Text:{Title:a,Color:r},Line:{Type:n,Color:s}};i<=0&&(i=12),u.Text.Font=i*GetDevicePixelRatio()+"px 微软雅黑";let o={DrawData:null,DrawType:"DRAWTEXT_LINE"};if(Array.isArray(e))for(var l in e){if(e[l]){Array.isArray(t)?u.Price=t[l]:u.Price=t,o.DrawData=u;break}}else e&&(Array.isArray(t)?u.Price=t[0]:u.Price=t,o.DrawData=u);return o},this.DRAWRECTREL=function(e,t,a,r,i){let n={Rect:{Left:e,Top:t,Right:a,Bottom:r},Color:i};return 0==i&&(n.Color=null),{DrawData:n,DrawType:"DRAWRECTREL"}},this.DRAWOVERLAYLINE=function(e,t,a){let r={Data:e,MainData:t};return a&&"string"==typeof a&&(r.Title=a),{DrawData:r,DrawType:"DRAWOVERLAYLINE"}},this.DRAWSL=function(e,t,a,r,i){let n={Data:[],Option:[]},s={DrawData:n,DrawType:"DRAWSL"};var u=this.IsNumber(t);if(Array.isArray(e))for(var o in e)n[o]=null,e[o]&&(u?(n.Data[o]=t,n.Option[o]={Slope:a,Length:r,Direct:i}):o<t.length&&this.IsNumber(t[o])&&(n.Data[o]=t[o],n.Option[o]={Slope:a,Length:r,Direct:i}));else if(e){var l=this.SymbolData.Data.Data.length;for(o=0;o<l;++o)n[o]=null,u?(n.Data[o]=t,n.Option[o]={Slope:a,Length:r,Direct:i}):o<t.length&&this.IsNumber(t[o])&&(n.Data[o]=t[o],n.Option[o]={Slope:a,Length:r,Direct:i})}return s}}JSAlgorithm.prototype.IsNumber=function(e){return null!=e&&!isNaN(e)},JSAlgorithm.prototype.IsDivideNumber=function(e){return null!=e&&(!isNaN(e)&&0!=e)},JSAlgorithm.MOD=function(e,t){if(e<0&&t<0||e>=0&&t>=0)return parseInt(e)==e&&parseInt(t)==t?e%t:i=parseFloat((e-Math.floor(e/t)*t).toFixed(1));var a=Math.abs(e),r=Math.abs(t),i=Math.abs(Math.abs(t)*(Math.floor(a/r)+1)-Math.abs(e));return t<0&&(i=-i),i},JSDraw.prototype.CalculateDrawLine=function(e){e.List=[];for(var t=e.Start.ID;t<=e.End.ID;++t)e.List.push(t);let a=Math.abs(e.Start.Value-e.End.Value),r=e.List.length-1;var i=[];if(i.push({ID:e.Start.ID,Value:e.Start.Value}),e.Start.Value>e.End.Value)for(t=1;t<e.List.length-1;++t){var n=a*(e.List.length-1-t)/r+e.End.Value;i.push({ID:e.List[t],Value:n})}else for(t=1;t<e.List.length-1;++t){n=a*t/r+e.Start.Value;i.push({ID:e.List[t],Value:n})}return i.push({ID:e.End.ID,Value:e.End.Value}),i},JSDraw.prototype.IsNumber=function(e){return null!=e&&!isNaN(e)},JSDraw.prototype.IsDrawFunction=function(e){return!!new Set(["STICKLINE","DRAWTEXT","SUPERDRAWTEXT","DRAWLINE","DRAWBAND","DRAWKLINE","DRAWKLINE_IF","PLOYLINE","POLYLINE","DRAWNUMBER","DRAWNUMBER_FIX","DRAWICON","DRAWCHANNEL","PARTLINE","DRAWTEXT_FIX","DRAWGBK","DRAWTEXT_LINE","DRAWRECTREL","DRAWOVERLAYLINE","FILLRGN","FILLRGN2","FILLTOPRGN","FILLBOTTOMRGN","FILLVERTICALRGN","FLOATRGN","DRAWSL","DRAWGBK2"]).has(e)},JSDraw.prototype.RemoveZero=function(e){for(;e.length>0;){var t=e.length-1,a=e[t];if("0"!=a){if("."==a){e=e.substr(0,t);break}break}e=e.substr(0,t)}return e};var DYNAINFO_ARGUMENT_ID={YCLOSE:3,OPEN:4,HIGH:5,LOW:6,CLOSE:7,VOL:8,AMOUNT:10,AMPLITUDE:13,INCREASE:14,EXCHANGERATE:37};function JSSymbolData(e,t,a){this.AST=e,this.Execute=a,this.Symbol="600000.sh",this.Name,this.Data=null,this.PeriodData=new Map,this.IsApiPeriod=!1,this.SourceData=null,this.MarketValue=null,this.Period=0,this.Right=0,this.DataType=0,this.IsBeforeData=!1,this.DayCount,this.Arguments=[],this.KLineApiUrl=g_JSComplierResource.Domain+"/API/KLine2",this.MinuteKLineApiUrl=g_JSComplierResource.Domain+"/API/KLine3",this.RealtimeApiUrl=g_JSComplierResource.Domain+"/API/stock",this.HistoryMinuteApiUrl=g_JSChartResource.Domain+"/API/StockMinuteData",this.StockHistoryDayApiUrl=g_JSComplierResource.Domain+"/API/StockHistoryDay",this.StockHistoryDay3ApiUrl=g_JSComplierResource.Domain+"/API/StockHistoryDay3",this.StockHistoryDay2ApiUrl=g_JSComplierResource.Domain+"/API/StockHistoryDay2",this.StockNewsAnalysisApiUrl=g_JSComplierResource.CacheDomain+"/cache/newsanalyze",this.HKToSHSZApiUrl=[g_JSComplierResource.CacheDomain+"/cache/historyday/all/hk2shsz.json",g_JSComplierResource.CacheDomain+"/cache/analyze/hk2shsz/hk2shsz.json",g_JSComplierResource.Domain+"/API/HKToSHSZMinuteData",g_JSComplierResource.CacheDomain+"/cache/analyze/hk2szshanalyze"],this.MaxRequestDataCount=1e3,this.MaxRequestMinuteDayCount=5,this.KLineDateTimeRange,this.LatestData,this.IndexData,this.LatestIndexData,this.MarginData=new Map,this.HKToSHSZData=new Map,this.NewsAnalysisData=new Map,this.ExtendData=new Map,this.UserData=new Map,this.CustomAPIData=new Map,this.ScriptIndexOutData=new Map,this.OtherSymbolData=new Map,this.StockData=new Map,this.SectionFinanceData=new Map,this.ThrowSFPeirod=new Set,this.NetworkFilter,t&&(t.HQDataType&&(this.DataType=t.HQDataType),t.Data&&(this.Data=t.Data,this.DataType!=HQ_DATA_TYPE.MINUTE_ID&&this.DataType!=HQ_DATA_TYPE.MULTIDAY_MINUTE_ID&&this.DataType!=HQ_DATA_TYPE.HISTORY_MINUTE_ID&&(this.Period=t.Data.Period,this.Right=t.Data.Right)),t.SourceData&&(this.SourceData=t.SourceData),t.Symbol&&(this.Symbol=t.Symbol),t.Name&&(this.Name=t.Name),t.MaxRequestDataCount>0&&(this.MaxRequestDataCount=t.MaxRequestDataCount),t.MaxRequestMinuteDayCount>0&&(this.MaxRequestMinuteDayCount=t.MaxRequestMinuteDayCount),t.KLineApiUrl&&(this.KLineApiUrl=t.KLineApiUrl),t.Right&&(this.Right=t.Right),t.Period&&(this.Period=t.Period),!0===t.IsBeforeData&&(this.IsBeforeData=t.IsBeforeData),t.NetworkFilter&&(this.NetworkFilter=t.NetworkFilter),t.DayCount>0&&(this.DayCount=t.DayCount),t.Arguments&&(this.Arguments=t.Arguments),t.KLineRange&&(this.KLineDateTimeRange=t.KLineRange),t.IsApiPeriod&&(this.IsApiPeriod=t.IsApiPeriod)),this.RecvError=function(e){throw JSConsole.Complier.Log("[JSSymbolData::RecvError] ajax error.",e.status),{FunctionName:"RecvError",Request:e}},this.GetLatestData=function(){if(this.LatestData)return this.Execute.RunNextJob();var e=this;if(this.NetworkFilter){var t={Name:"JSSymbolData::GetLatestData",Explain:"DYNAINFO()",Request:{Url:e.RealtimeApiUrl,Type:"POST",Data:{symbol:[this.Symbol],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(t){e.RecvLatestData(t),e.Execute.RunNextJob()}),1==t.PreventDefault)return}JSNetwork.HttpRequest({url:e.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(t){e.RecvLatestData(t),e.Execute.RunNextJob()},error:function(t){e.RecvError(t)}})},this.RecvLatestData=function(e){if(!e.stock||1!=e.stock.length)return;let t=e.stock[0];this.LatestData={Symbol:t.symbol,Name:t.name,Date:t.date,Time:t.time,YClose:t.yclose,Price:t.price,Open:t.open,High:t.high,Low:t.low,Vol:t.vol,Amount:t.amount,Increase:t.increase,Exchangerate:t.exchangerate,Amplitude:t.amplitude},JSConsole.Complier.Log("[JSSymbolData::RecvLatestData]",this.LatestData)},this.GetLatestCacheData=function(e){if(!this.LatestData)return null;switch(e){case DYNAINFO_ARGUMENT_ID.YCLOSE:return this.LatestData.YClose;case DYNAINFO_ARGUMENT_ID.OPEN:return this.LatestData.Open;case DYNAINFO_ARGUMENT_ID.HIGH:return this.LatestData.High;case DYNAINFO_ARGUMENT_ID.LOW:return this.LatestData.Low;case DYNAINFO_ARGUMENT_ID.VOL:return this.LatestData.Vol;case DYNAINFO_ARGUMENT_ID.AMOUNT:return this.LatestData.Amount;case DYNAINFO_ARGUMENT_ID.INCREASE:return this.LatestData.Increase;case DYNAINFO_ARGUMENT_ID.EXCHANGERATE:return this.LatestData.Exchangerate;case DYNAINFO_ARGUMENT_ID.AMPLITUDE:return this.LatestData.Amplitude;case DYNAINFO_ARGUMENT_ID.CLOSE:return this.LatestData.Price;default:return null}},this.GetLatestIndexData=function(){if(this.LatestIndexData)return this.Execute.RunNextJob();var e=this;if(this.NetworkFilter){var t={Name:"JSSymbolData::GetLatestIndexData",Explain:"最新大盘数据",Request:{Url:e.RealtimeApiUrl,Type:"POST",Data:{symbol:["000001.sh"],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(t){e.RecvLatestIndexData(t),e.Execute.RunNextJob()}),1==t.PreventDefault)return}JSNetwork.HttpRequest({url:e.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"],symbol:["000001.sh"]},type:"post",dataType:"json",async:!0,success:function(t){e.RecvLatestIndexData(t),e.Execute.RunNextJob()},error:function(t){e.RecvError(t)}})},this.RecvLatestIndexData=function(e){if(!e.stock||1!=e.stock.length)return;let t=e.stock[0];this.LatestIndexData={Symbol:t.symbol,Name:t.name,Date:t.date,Time:t.time,YClose:t.yclose,Price:t.price,Open:t.open,High:t.high,Low:t.low,Vol:t.vol,Amount:t.amount,Increase:t.increase,Amplitude:t.amplitude},JSConsole.Complier.Log("[JSSymbolData::RecvLatestIndexData]",this.LatestIndexData)},this.GetLatestIndexCacheData=function(e){if(!this.LatestIndexData)return null;switch(e){case"FROMOPEN":var t=parseInt(this.LatestIndexData.Time/100),a=60*parseInt(t/100)+t%100;return a<=565?0:a<570?1:a<=690?a-570+1:a<780?121:a<=900?122+a-780:242;default:return null}},this.GetVolRateData=function(e,t){var a=e.ID.toString()+"-VolRate-"+this.Symbol;if(this.ExtendData.has(a))return this.Execute.RunNextJob();var r=this;JSNetwork.HttpRequest({url:r.RealtimeApiUrl,data:{field:["name","symbol","avgvol5","date"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(e){r.RecvVolRateData(e,a),r.Execute.RunNextJob()},error:function(e){r.RecvError(e)}})},this.RecvVolRateData=function(e,t){if(e.stock&&1==e.stock.length){var a={AvgVol5:e.stock[0].avgvol5,Date:e.stock[0].date};this.ExtendData.set(t,a),JSConsole.Complier.Log("[JSSymbolData::RecvVolRateData]",a)}},this.GetVolRateCacheData=function(e){var t=JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_VOLR_DATA.toString()+"-VolRate-"+this.Symbol;t&&this.ExtendData.has(t)||this.Execute.ThrowUnexpectedNode(e,"不支持VOLR");for(var a=[],r=this.ExtendData.get(t),i=r.AvgVol5/241,n=0,s=0,u=0;s<this.Data.Data.length;++s){a[s]=null;var o=this.Data.Data[s],l=o.DateTime;if(l){var D=l.split(" ");if(2==D.length)parseInt(D[0])==r.Date&&(n+=o.Vol,i>0&&(a[s]=n/(u+1)/i*100),++u)}}return a},this.GetGroupData=function(e){var t=e.ID.toString()+"-Group-"+this.Symbol;if(this.ExtendData.has(t))return this.Execute.RunNextJob();var a=this;if(this.NetworkFilter){var r={Name:"JSSymbolData::GetGroupData",Explain:"HYBLOCK|DYBLOCK",Request:{Url:a.RealtimeApiUrl,Type:"POST",Data:{symbol:[this.Symbol],field:["name","symbol","industry","concept","region"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(e){a.RecvGroupData(e,t),a.Execute.RunNextJob()}),1==r.PreventDefault)return}JSNetwork.HttpRequest({url:a.RealtimeApiUrl,data:{field:["name","symbol","industry","concept","region"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(e){a.RecvGroupData(e,t),a.Execute.RunNextJob()},error:function(e){a.RecvError(e)}})},this.RecvGroupData=function(e,t){if(e.stock&&1==e.stock.length){var a=e.stock[0],r=a.industry,i=a.concept,n=a.region,s={Industry:[],Concept:[],Region:[]};if(r)for(var u in r){var o=r[u];s.Industry.push({Name:o.name,Symbol:o.symbol})}if(i)for(var u in i){o=i[u];s.Concept.push({Name:o.name,Symbol:o.symbol})}if(n)for(var u in n){o=n[u];s.Region.push({Name:o.name,Symbol:o.symbol})}this.ExtendData.set(t,s)}},this.GetIndexData=function(){if(this.IndexData)return this.Execute.RunNextJob();var e=this;if(ChartData.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var t={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:e.Period,Request:{Url:e.KLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],symbol:"000001.sh",start:-1,count:e.MaxRequestDataCount+500}},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(t){e.RecvIndexHistroyData(t),e.Execute.RunNextJob()}),1==t.PreventDefault)return}JSNetwork.HttpRequest({url:e.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],symbol:"000001.sh",start:-1,count:e.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(t){e.RecvIndexHistroyData(t),e.Execute.RunNextJob()},error:function(t){e.RecvError(t)}})}else if(ChartData.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){t={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:e.Period,Request:{Url:e.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:"000001.sh",start:-1,count:e.MaxRequestDataCount+5}},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(t){e.RecvIndexMinuteHistroyData(t),e.Execute.RunNextJob()}),1==t.PreventDefault)return}JSNetwork.HttpRequest({url:e.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:"000001.sh",start:-1,count:e.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(t){e.RecvIndexMinuteHistroyData(t),e.Execute.RunNextJob()},error:function(t){e.RecvError(t)}})}},this.RecvIndexHistroyData=function(e){JSConsole.Complier.Log("[JSSymbolData::RecvIndexHistroyData] recv data",e);let t=this.JsonDataToHistoryData(e);this.IndexData=new ChartData,this.IndexData.DataType=0,this.IndexData.Data=t;var a=this.SourceData.GetOverlayData(this.IndexData.Data);if(this.IndexData.Data=a,ChartData.IsDayPeriod(this.Period,!1)){let e=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=e}},this.RecvIndexMinuteHistroyData=function(e){JSConsole.Complier.Log("[JSSymbolData::RecvIndexMinuteHistroyData] recv data",e);let t=this.JsonDataToMinuteHistoryData(e);if(this.IndexData=new ChartData,this.IndexData.DataType=1,this.IndexData.Data=t,ChartData.IsMinutePeriod(this.Period,!1)){let e=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=e}},this.GetOtherSymbolParam=function(e){var t=e.split("$");if(!new Set(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]).has(t[1]))return null;var a=t[0];if(6==a.length)"6"==a[0]||"5"==a[0]||"8"==a[0]||"9"==a[0]?a+=".SH":"0"!=a[0]&&"1"!=a[0]&&"2"!=a[0]&&"3"!=a[0]||(a+=".SZ");else if(0==a.indexOf("SZ"))a=a.substr(2)+".SZ";else if(0==a.indexOf("SH"))a=a.substr(2)+".SH";else{if(!(a.indexOf("_")>0))return null;var r=a.split("_");a=`${r[1]}.${r[0]}`}return{Symbol:a.toLowerCase(),DataName:t[1]}},this.GetOtherSymbolData=function(e){var t=this.Symbol;if(e.Literal){if(!(r=this.GetOtherSymbolParam(e.Literal.toUpperCase()))){var a=e.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,`${e.Literal} Error.`)}t=r.Symbol}else{var r;if((r=e.Args).length>0){var i=r[0];if(i.Type==Syntax.Literal)t=i.Value;else if(i.Type==Syntax.Identifier){var n=!1;for(var s in this.Arguments){const e=this.Arguments[s];if(e.Name==i.Name){t=e.Value,n=!0;break}}if(!n){a=e.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,`${e.FunctionName}() Error: can\'t read ${i.Name}`)}}}}if(e.Symbol=t.toLowerCase(),e.Symbol==this.Symbol)return this.Execute.RunNextJob();if(this.OtherSymbolData.has(e.Symbol))return this.Execute.RunNextJob();var u=this;if(this.DataType==HQ_DATA_TYPE.KLINE_ID&&ChartData.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var o=this.Data.GetDateRange(),l={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Request:{Data:{symbol:e.Symbol,right:u.Right,period:u.Period,dateRange:o}},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(t){u.RecvOtherSymbolKData(t,e),u.Execute.RunNextJob()}),1==l.PreventDefault)return}JSNetwork.HttpRequest({url:u.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:u.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(t){u.RecvOtherSymbolKDayData(t,e),u.Execute.RunNextJob()},error:function(e){u.RecvError(e)}})}else if(ChartData.IsMinutePeriod(this.Period,!0)||this.DataType==HQ_DATA_TYPE.MINUTE_ID||this.DataType==HQ_DATA_TYPE.MULTIDAY_MINUTE_ID){if(this.NetworkFilter){o=this.Data.GetDateRange(),l={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Request:{Data:{symbol:e.Symbol,right:u.Right,period:u.Period,dateRange:o}},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(t){u.RecvOtherSymbolKData(t,e),u.Execute.RunNextJob()}),1==l.PreventDefault)return}JSNetwork.HttpRequest({url:u.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:u.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(t){u.RecvOtherSymbolKMinuteData(t,e),u.Execute.RunNextJob()},error:function(e){u.RecvError(e)}})}},this.RecvOtherSymbolKData=function(e,t){JSConsole.Complier.Log("[JSSymbolData::RecvOtherSymbolKDayData2] recv data",e);var a=new ChartData,r=null,i=this.Period;this.DataType==HQ_DATA_TYPE.KLINE_ID&&ChartData.IsDayPeriod(this.Period,!0)?(r=this.JsonDataToHistoryData(e),a.DataType=0):(r=this.JsonDataToMinuteHistoryData(e),a.DataType=1,this.DataType!=HQ_DATA_TYPE.MINUTE_ID&&this.DataType!=HQ_DATA_TYPE.MULTIDAY_MINUTE_ID||(i=4)),a.Period=this.Period,a.Right=this.Right,a.Data=this.Data.FixKData(r,i),this.OtherSymbolData.set(t.Symbol,a)},this.RecvOtherSymbolKDayData=function(e,t){JSConsole.Complier.Log("[JSSymbolData::RecvOtherSymbolKDayData] recv data",e);let a=this.JsonDataToHistoryData(e);var r=new ChartData;r.DataType=0,r.Data=a;var i=this.SourceData.GetOverlayData(r.Data);if(r.Data=i,ChartData.IsDayPeriod(this.Period,!1)){let e=r.GetPeriodData(this.Period);r.Data=e}this.OtherSymbolData.set(t.Symbol,r)},this.RecvOtherSymbolKMinuteData=function(e,t){JSConsole.Complier.Log("[JSSymbolData::RecvOtherSymbolKMinuteData] recv data",e);let a=this.JsonDataToMinuteHistoryData(e);var r=new ChartData;if(r.DataType=1,r.Data=a,ChartData.IsMinutePeriod(this.Period,!1)){let e=r.GetPeriodData(this.Period);r.Data=e}this.OtherSymbolData.set(t.Symbol,r)},this.GetOtherSymolCacheData=function(e){var t,a;if(e.FunctionName){if(a=e.FunctionName,(r=e.Args).length<=0)return this.GetSymbolCacheData(a);t=r[0].toString().toLowerCase()}else if(e.Literal){var r;if(!(r=this.GetOtherSymbolParam(e.Literal.toUpperCase())))return[];t=r.Symbol,a=r.DataName}if(t==this.Symbol)return this.GetSymbolCacheData(a);if(!this.OtherSymbolData.has(t))return[];var i=this.OtherSymbolData.get(t);t.toUpperCase();switch(a){case"CLOSE":case"C":return i.GetClose();case"VOL":case"V":return i.GetVol();case"OPEN":case"O":return i.GetOpen();case"HIGH":case"H":return i.GetHigh();case"LOW":case"L":return i.GetLow();case"AMOUNT":case"AMO":return i.GetAmount();case"VOLINSTK":return i.GetPosition()}},this.GetIndexCacheData=function(e){if(!this.IndexData)return new Array;switch(e){case"INDEXA":return this.IndexData.GetAmount();case"INDEXC":return this.IndexData.GetClose();case"INDEXH":return this.IndexData.GetHigh();case"INDEXL":return this.IndexData.GetLow();case"INDEXO":return this.IndexData.GetOpen();case"INDEXV":return this.IndexData.GetVol();case"INDEXADV":return this.IndexData.GetUp();case"INDEXDEC":return this.IndexData.GetDown()}},this.GetBlockSymbol=function(e){const t=new Map([["沪深A股","CNA.ci"],["创业板","GEM.ci"],["沪市A股","SHA.ci"],["中小板","SME.ci"],["深市A股","SZA.ci"]]);if(t.has(e))return t.get(e);if(!e)return null;var a=null,r=e.toUpperCase();if(r.indexOf(".SH")>0||r.indexOf(".SZ")>0){if(!new Set(["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]).has(r))return null;a=e.replace(".SH",".sh"),a=e.replace(".SZ",".sz")}else e.indexOf(".CI")>0&&(a=e.replace(".CI",".ci"));return a},this.GetIndexIncreaseData=function(e){var t=null;if(e.IsSelfSymbol)t=this.Symbol;else{if(!e.Args||e.Args.length<=0){var a=e.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,`${e.FunctionName} Error: 参数不能为空`)}t=e.Args[0].Value}var r=this.GetBlockSymbol(t);if(!r){a=e.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,`${e.FunctionName} Error: can\'t support ${t}`)}var i=e.ID.toString()+"-UpCount-"+r,n=e.ID.toString()+"-DownCount-"+r;if(this.ExtendData.has(i)&&this.ExtendData.has(n))return this.Execute.RunNextJob();var s=this;if(this.DataType===HQ_DATA_TYPE.MINUTE_ID||this.DataType===HQ_DATA_TYPE.MULTIDAY_MINUTE_ID){var u=g_JSComplierResource.CacheDomain+"/cache/analyze/increaseanalyze/"+r+".json";JSConsole.Complier.Log("[JSSymbolData::GetIndexIncreaseData] minute Get url=",u),JSNetwork.HttpRequest({url:u,type:"get",dataType:"json",async:!0,success:function(e){s.RecvMinuteIncreaseData(e,{UpKey:i,DownKey:n}),s.Execute.RunNextJob()},error:function(e){s.RecvError(e)}})}else this.DataType===HQ_DATA_TYPE.KLINE_ID&&ChartData.IsDayPeriod(this.Period,!0)?(JSConsole.Complier.Log("[JSSymbolData::GetIndexIncreaseData] K day Get url=",s.KLineApiUrl),JSNetwork.HttpRequest({url:s.KLineApiUrl,data:{symbol:r,start:-1,count:s.MaxRequestDataCount,field:["up","down"]},type:"post",dataType:"json",async:!0,success:function(e){s.RecvHistoryIncreaseData(e,{UpKey:i,DownKey:n}),s.Execute.RunNextJob()},error:function(e){s.RecvError(e)}})):this.Execute.RunNextJob()},this.RecvHistoryIncreaseData=function(e,t){JSConsole.Complier.Log("[JSSymbolData::RecvHistoryIncreaseData] recv data",e);var a,r,i=[],n=[];for(var s in e.data){var u=e.data[s];let t=new SingleData,a=new SingleData;t.Date=u[0],t.Value=u[8],i[s]=t,a.Date=u[0],a.Value=u[9],n[s]=a}a=this.SourceData?this.SourceData.GetFittingData(i):this.Data.GetFittingData(aryData),r=this.SourceData?this.SourceData.GetFittingData(n):this.Data.GetFittingData(aryData),this.ExtendData.set(t.UpKey,a),this.ExtendData.set(t.DownKey,r)},this.RecvMinuteIncreaseData=function(e,t){if(JSConsole.Complier.Log("[JSSymbolData::RecvMinuteIncreaseData] recv data",e),e.minute){var a=e.minute;if(a.time&&a.up&&a.down){var r=[],i=[];if(this.IsBeforeData)for(var n=0,s=0;n<this.Data.Data.length;++n){if(r[n]=null,i[n]=null,!(u=this.Data.Data[n]).Before)if(o=u.DateTime)if(2==(l=o.split(" ")).length)parseInt(l[0])==e.date&&(r[n]=a.up[s],i[n]=a.down[s],++s)}else for(n=0,s=0;n<this.Data.Data.length;++n){var u,o,l;if(r[n]=null,i[n]=null,o=(u=this.Data.Data[n]).DateTime)if(2==(l=o.split(" ")).length)parseInt(l[0])==e.date&&(r[n]=a.up[s],i[n]=a.down[s],++s)}this.ExtendData.set(t.UpKey,r),this.ExtendData.set(t.DownKey,i)}}},this.GetIndexIncreaseCacheData=function(e,t,a){var r,i=this.GetBlockSymbol(t);if(i||this.Execute.ThrowUnexpectedNode(a,"不支持函数"+e+"("+t+")"),"UPCOUNT"==e||"ADVANCE"==e?r=JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-UpCount-"+i:"DOWNCOUNT"!=e&&"DECLINE"!=e||(r=JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-DownCount-"+i),r&&this.ExtendData.has(r)||this.Execute.ThrowUnexpectedNode(a,"不支持函数"+e+"("+t+")"),this.DataType===HQ_DATA_TYPE.MINUTE_ID||this.DataType===HQ_DATA_TYPE.MULTIDAY_MINUTE_ID)return this.ExtendData.get(r);if(this.DataType===HQ_DATA_TYPE.KLINE_ID&&ChartData.IsDayPeriod(this.Period,!0)){var n=this.ExtendData.get(r),s=new ChartData;if(s.Data=n,s.Period=this.Period,s.Period>0){var u=s.GetPeriodSingleData(s.Period);s.Data=u}return s.GetValue()}return null},this.GetSymbolData=function(){if(this.Data)return this.Execute.RunNextJob();let e=this;if(this.DataType!==HQ_DATA_TYPE.MINUTE_ID)if(this.DataType!==HQ_DATA_TYPE.MULTIDAY_MINUTE_ID){if(ChartData.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var t={Name:"JSSymbolData::GetSymbolData",Explain:"日线数据",Request:{Url:e.RealtimeApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:e.MaxRequestDataCount}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(t.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(t.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(t.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(t,function(t){e.RecvHistroyData(t),e.Execute.RunNextJob()}),1==t.PreventDefault)return}JSNetwork.HttpRequest({url:e.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:e.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvHistroyData(t),e.Execute.RunNextJob()},error:function(t){e.RecvError(t)}})}else if(ChartData.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){t={Name:"JSSymbolData::GetSymbolData",Explain:"分钟K线数据",Request:{Url:e.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:e.MaxRequestMinuteDayCount}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(t.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(t.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(t.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(t,function(t){e.RecvMinuteHistroyData(t),e.Execute.RunNextJob()}),1==t.PreventDefault)return}JSNetwork.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:e.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvMinuteHistroyData(t),e.Execute.RunNextJob()},error:function(t){e.RecvError(t)}})}}else JSNetwork.HttpRequest({url:e.HistoryMinuteApiUrl,data:{symbol:e.Symbol,daycount:e.DayCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvMultiDayMinuteData(t),e.Execute.RunNextJob()}});else JSNetwork.HttpRequest({url:e.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","minute","time","minutecount"],symbol:[e.Symbol],start:-1},type:"post",dataType:"json",async:!0,success:function(t){e.RecvMinuteData(t),e.Execute.RunNextJob()}})},this.RecvHistroyData=function(e){JSConsole.Complier.Log("[JSSymbolData::RecvHistroyData] recv data",e);let t=this.JsonDataToHistoryData(e);if(this.Data=new ChartData,this.Data.DataType=0,this.Data.Data=t,this.SourceData=new ChartData,this.SourceData.Data=t,this.Right>0){let e=this.Data.GetRightDate(this.Right);this.Data.Data=e}if(ChartData.IsDayPeriod(this.Period,!1)){let e=this.Data.GetPeriodData(this.Period);this.Data.Data=e}this.Data.Right=this.Right,this.Data.Period=this.Period,this.Name=e.name},this.RecvMinuteHistroyData=function(e){JSConsole.Complier.Log("[JSSymbolData::RecvMinuteHistroyData] recv data",e);let t=this.JsonDataToMinuteHistoryData(e);if(this.Data=new ChartData,this.Data.DataType=1,this.Data.Data=t,this.SourceData=new ChartData,this.SourceData.Data=t,ChartData.IsMinutePeriod(this.Period,!1)){let e=this.Data.GetPeriodData(this.Period);this.Data.Data=e}this.Data.Period=this.Period,this.Name=e.name},this.RecvMinuteData=function(e){JSConsole.Complier.Log("[JSSymbolData::RecvMinuteData] recv data",e);var t=this.JsonDataToMinuteData(e);this.Data=new ChartData,this.Data.DataType=2,this.Data.Data=t,this.Name=e.stock[0].name},this.RecvMultiDayMinuteData=function(e){var t=this.JsonDataToMultiDayMinuteData(e);this.Data=new ChartData,this.Data.DataType=2,this.Data.Data=t,this.Name=e.name},this.GetSymbolCacheData=function(e){if(!this.Data)return new Array;this.Symbol.toUpperCase();switch(e){case"CLOSE":case"C":return this.Data.GetClose();case"VOL":case"V":return this.Data.GetVol();case"OPEN":case"O":return this.Data.GetOpen();case"HIGH":case"H":return this.Data.GetHigh();case"LOW":case"L":return this.Data.GetLow();case"AMOUNT":case"AMO":return this.Data.GetAmount();case"VOLINSTK":return this.Data.GetPosition();case"ZSTJJ":return this.Data.GetAvPrice()}},this.GetSymbolPeriodData=function(e){var t=JSComplierHelper.GetPeriodInfo({Name:e.PeriodName}).Period,a={PeriodID:t,PeriodName:e.PeriodName};if(t==this.Period&&this.Execute.RunNextJob(),this.IsApiPeriod){if(this.PeriodData.has(e.PeriodName))return this.Execute.RunNextJob()}else if(ChartData.IsDayPeriod(t,!0)){if(ChartData.IsDayPeriod(this.Period,!0))return this.Execute.RunNextJob();a={PeriodID:0,PeriodName:"DAY"}}else{if(!ChartData.IsMinutePeriod(t,!0))return this.Execute.RunNextJob();if(ChartData.IsMinutePeriod(this.Period,!0))return this.Execute.RunNextJob();a={PeriodID:4,PeriodName:"MIN1"}}var r=this;if(this.NetworkFilter){var i={Name:"JSSymbolData::GetSymbolPeriodData",Explain:"跨周期数据",Request:{Data:{field:["symbol","name",e.ValueName],period:e.PeriodName,symbol:r.Symbol}},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,function(e){r.RecvSymbolPeriodData(e,a),r.Execute.RunNextJob()}),1==i.PreventDefault)return}if(ChartData.IsMinutePeriod(t,!0))JSNetwork.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:r.Symbol,start:-1,count:r.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(e){r.RecvSymbolPeriodData(e,a),r.Execute.RunNextJob()},error:function(e){r.RecvError(e)}});else{if(!ChartData.IsDayPeriod(t,!0))return this.Execute.RunNextJob();JSNetwork.HttpRequest({url:r.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:r.Symbol,start:-1,count:r.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(e){r.RecvSymbolPeriodData(e,a),r.Execute.RunNextJob()},error:function(e){r.RecvError(e)}})}},this.RecvSymbolPeriodData=function(e,t){if(JSConsole.Complier.Log("[JSSymbolData::RecvSymbolPeriodData] data, periodInfo ",e,t),ChartData.IsDayPeriod(t.PeriodID,!0)){var a=this.JsonDataToHistoryData(e),r=new ChartData;r.DataType=0,r.Data=a,r.Right=0,r.Period=t.PeriodID,this.PeriodData.set(t.PeriodName,r)}else if(ChartData.IsMinutePeriod(t.PeriodID,!0)){a=this.JsonDataToMinuteHistoryData(e);var i=new ChartData;i.DataType=1,i.Data=a,i.Right=0,i.Period=t.PeriodID,this.PeriodData.set(t.PeriodName,i)}},this.GetSymbolPeriodCacheData=function(e,t){var a=JSComplierHelper.GetPeriodInfo({Name:t});if(this.Period==a.Period)return this.GetSymbolCacheData(e);var r=null;if(this.IsApiPeriod){if(!(i=JSComplierHelper.GetPeriodInfo({PeriodID:this.Period})))return null;if(i.Order>a.Order)return null;if(!this.PeriodData.has(t))return null;r=(r=this.PeriodData.get(t)).Data}else{var i;if(!(i=JSComplierHelper.GetPeriodInfo({PeriodID:this.Period})))return null;if(i.Order>a.Order)return null;if(ChartData.IsDayPeriod(a.Period,!0)&&ChartData.IsMinutePeriod(this.Period,!0)){var n=this.PeriodData.get("DAY");r=0==a.Period?n.Data:n.GetPeriodData(a.Period)}else{var s=new ChartData;if(s.Data=this.SourceData.Data,s.Period=this.Period,s.Right=this.Right,ChartData.IsDayPeriod(a.Period,!0)&&s.Right>0){var u=s.GetRightData(s.Right);s.Data=u}r=s.GetPeriodData(a.Period)}}var o=this.Data.ConverPeriod(r,this.Period,a.Period),l=new ChartData;l.Data=o;this.Symbol.toUpperCase();switch(e){case"C":case"CLOSE":return l.GetClose();case"O":case"OPEN":return l.GetOpen();case"H":case"HIGH":return l.GetHigh();case"L":case"LOW":return l.GetLow();case"AMO":case"AMOUNT":return l.GetAmount();case"V":case"VOL":return l.GetVol();case"VOLINSTK":return l.GetPosition();default:return null}},this.GetSymbolPeriodCacheData2=function(e,t,a){var r=JSComplierHelper.GetPeriodInfo({Name:t});if(!r)return null;var i=JSComplierHelper.GetPeriodInfo({PeriodID:this.Period});if(!i)return null;if(i.Order>r.Order)return null;if(i.Period==r.Period)l=this.Data;else{var n;if(this.IsApiPeriod){if(!this.PeriodData.has(t))return null;n=this.PeriodData.get(t)}else if(ChartData.IsMinutePeriod(i.Period,!0)&&ChartData.IsDayPeriod(r.Period,!0)){var s=this.PeriodData.get("DAY");n=0==r.Period?s:s.GetPeriodData(r.Period)}else{var u=new ChartData;if(u.Data=this.SourceData.Data,u.Period=this.Period,u.Right=this.Right,ChartData.IsDayPeriod(r.Period,!0)&&u.Right>0){var o=u.GetRightData(u.Right);u.Data=o}n=u.GetPeriodData(r.Period)}var l,D=this.Data.ConverPeriod(n,this.Period,r.Period);(l=new ChartData).Data=D}if(IFrameSplitOperator.IsPlusNumber(a)){var h=new ChartData;D=l.GetRef(a);h.Data=D,l=h}this.Symbol.toUpperCase();switch(e){case"C":case"CLOSE":return l.GetClose();case"O":case"OPEN":return l.GetOpen();case"H":case"HIGH":return l.GetHigh();case"L":case"LOW":return l.GetLow();case"AMO":case"AMOUNT":return l.GetAmount();case"V":case"VOL":return l.GetVol();case"VOLINSTK":return l.GetPosition();default:return null}},this.GetCurrBarsCount=function(){let e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;for(var t=this.Data.Data.length-1;t>=0;--t)e.push(t+1);return e},this.GetTotalTradeMinuteCount=function(){var e=g_MinuteCoordinateData.GetCoordinateData(this.Symbol);return e&&e.Count>0?e.Count-1:242},this.GetTotalBarsCount=function(){return this.Data.Data.length},this.GetIsLastBar=function(){let e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;let t=this.Data.Data.length;for(var a=0;a<t;++a)a==t-1?e.push(1):e.push(0);return e},this.GetBarStatus=function(){let e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;let t=this.Data.Data.length;for(var a=0;a<t;++a)e[a]=0==a?1:a==t-1?2:0;return e},this.GetMarginCacheData=function(e,t){let a=JS_EXECUTE_JOB_ID.GetMarginJobID(e);return a||this.Execute.ThrowUnexpectedNode(t,"不支持MARGIN("+e+")"),this.MarginData.has(a)?this.MarginData.get(a):[]},this.GetMarginData=function(e){if(this.MarginData.has(e))return this.Execute.RunNextJob();JSConsole.Complier.Log("[JSSymbolData::GetMarginData] jobID=",e);var t=this;let a=["name","date","symbol"];switch(e){case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BALANCE:a.push("margin.balance");break;case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_RATE:a.push("margin.rate");break;case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_NET:a.push("margin.buy");break;case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_NET:a.push("margin.sell")}JSNetwork.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:a,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(a){t.RecvMarginData(a,e),t.Execute.RunNextJob()}})},this.RecvMarginData=function(e,t){if(JSConsole.Complier.Log(e),!e.stock||1!=e.stock.length)return;let a=e.stock[0];var r=new Array,i=[],n=[],s=[];for(var u in a.stockday){var o=a.stockday[u],l=o.margin;if(!l)continue;let e=new SingleData;switch(e.Date=o.date,t){case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BALANCE:if(!this.IsNumber(l.balance))continue;e.Value=l.balance,r.push(e);break;case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_RATE:if(!this.IsNumber(l.rate))continue;e.Value=l.rate,r.push(e);break;case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_NET:var D=l.buy;if(!D)continue;if(!(this.IsNumber(D.balance)&&this.IsNumber(D.amount)&&this.IsNumber(D.repay)&&this.IsNumber(D.net)))continue;e.Value=D.balance,(h=new SingleData).Date=o.date,h.Value=D.amount,(c=new SingleData).Date=o.date,c.Value=D.repay,(C=new SingleData).Date=o.date,C.Value=D.net,r.push(e),i.push(h),n.push(c),s.push(C);break;case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_NET:var h,c,C,E=l.sell;if(!E)continue;if(!(this.IsNumber(E.balance)&&this.IsNumber(E.volume)&&this.IsNumber(E.repay)&&this.IsNumber(E.net)))continue;e.Value=D.balance,(h=new SingleData).Date=o.date,h.Value=D.volume,(c=new SingleData).Date=o.date,c.Value=D.repay,(C=new SingleData).Date=o.date,C.Value=D.net,r.push(e),i.push(h),n.push(c),s.push(C);break;default:continue}}var m=[];for(var u in t===JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BALANCE||t===JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_RATE?m.push({JobID:t,Data:r}):t===JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_BALANCE||t===JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT||t===JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_REPAY||t===JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_NET?(m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_BALANCE,Data:r}),m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT,Data:i}),m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_REPAY,Data:n}),m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_NET,Data:s})):t!==JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_BALANCE&&t!==JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_VOLUME&&t!==JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_REPAY&&t!==JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_NET||(m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_BALANCE,Data:r}),m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_VOLUME,Data:i}),m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_REPAY,Data:n}),m.push({JobID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_NET,Data:s})),m){let e=this.SourceData.GetFittingData(m[u].Data);var A=new ChartData;if(A.Data=e,A.Period=this.Period,A.Period>0){var N=A.GetPeriodSingleData(A.Period);A.Data=N}let t=A.GetValue();this.MarginData.set(m[u].JobID,t)}},this.GetNewsAnalysisCacheData=function(e,t){let a=JS_EXECUTE_JOB_ID.GetNewsAnalysisID(e);return a||this.Execute.ThrowUnexpectedNode(t,"不支持NEWS("+e+")"),this.NewsAnalysisData.has(a)?this.NewsAnalysisData.get(a):[]},this.GetHKToSHSZData=function(e){var t=e.Args,a=this.Symbol;if(t.length>0){var r=t[0];if(r.Type==Syntax.Literal)a=r.Value;else if(r.Type==Syntax.Identifier){var i=!1;for(var n in this.Arguments){const e=this.Arguments[n];if(e.Name==r.Name){a=e.Value,i=!0;break}}if(!i){var s=e.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,`HK2SHSZ() Error: can\'t read ${r.Name}`)}}}e.Symbol=a,1==a||2==a||3==a?this.GetHKToSHSZMarketData(a,e):this.GetHKToSHSZStockData(a,e)},this.GetHKToSHSZStockData=function(e,t){if(this.HKToSHSZData.has(e))return this.Execute.RunNextJob();var a=e.toLowerCase(),r=this,i=`${this.HKToSHSZApiUrl[3]}/${a}.json`;JSNetwork.HttpRequest({url:i,type:"get",dataType:"json",async:!0,success:function(e){r.RecvHKToSHSZStockData(e,t),r.Execute.RunNextJob()},error:function(e){console.warn(`[JSSymbolData::GetHKToSHSZStockData] request url=${i} failed. error=${e.status}`),r.RecvHKToSHSZStockData(null,t),r.Execute.RunNextJob()}})},this.RecvHKToSHSZStockData=function(e,t){if(e){for(var a=e.symbol.toUpperCase(),r=[],i=0;i<e.date.length;++i){var n=new SingleData;n.Date=e.date[i],n.Value=e.vol[i],r.push(n)}var s=this.Data.GetFittingData(r),u=new ChartData;if(u.Data=s,u.Period=this.Period,u.Period>0){var o=u.GetPeriodSingleData(u.Period);u.Data=o}e=u.GetValue();this.HKToSHSZData.set(a,e)}},this.GetHKToSHSZMarketData=function(e,t){if(this.HKToSHSZData.has(e))return this.Execute.RunNextJob();var a,r=0;this.DataType===HQ_DATA_TYPE.MINUTE_ID?r=1:this.DataType==HQ_DATA_TYPE.MULTIDAY_MINUTE_ID?r=2:this.Period<=3&&(r=0),a=this.HKToSHSZApiUrl[r];var i=this;JSConsole.Complier.Log(`[JSSymbolData::GetHKToSHSZMarketData] code=${e} url=${a}, dataType=${r}`),2===r?JSNetwork.HttpRequest({url:a,data:{symbol:this.Symbol,daycount:this.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(e){i.RecvMulitMinuteHKToSHSZData(e,t),i.Execute.RunNextJob()}}):JSNetwork.HttpRequest({url:a,type:"get",dataType:"json",async:!0,success:function(e){0==r?i.RecvHKToSHSZData(e,t):1==r&&i.RecvMinuteHKToSHSZData(e,t),i.Execute.RunNextJob()}})},this.RecvMinuteHKToSHSZData=function(e,t){var a=[],r=[],i=[];if(this.IsBeforeData){for(n in this.SourceData.Data){if(!(D=this.SourceData.Data[n]).Before)break;a.push(null),r.push(null),i.push(null)}for(var n=0;n<e.time.length;++n){if(925!==e.time[n]){var s=(u=e.hk2sh[n])+(o=e.hk2sz[n]);a.push(s),r.push(u),i.push(o)}}}else for(n=0;n<e.time.length;++n){var u,o;e.time[n],s=(u=e.hk2sh[n])+(o=e.hk2sz[n]);a.push(s),r.push(u),i.push(o)}var l=[{Data:a,ID:1},{Data:r,ID:2},{Data:i,ID:3}];for(var n in l){var D=l[n];this.HKToSHSZData.set(D.ID,D.Data)}},this.RecvHKToSHSZData=function(e,t){for(var a=[],r=[],i=[],n=0;n<e.date.length;++n){var s=e.date[n],u=1e6*e.hk2sh[n],o=1e6*e.hk2sz[n],l=u+o;let t=new SingleData;t.Date=s,t.Value=l;let D=new SingleData;D.Date=s,D.Value=u;let h=new SingleData;h.Date=s,h.Value=o,a.push(t),r.push(D),i.push(h)}var D=[{Data:a,ID:1},{Data:r,ID:2},{Data:i,ID:3}];for(var n in D){let e=this.Data.GetFittingData(D[n].Data);var h=new ChartData;if(h.Data=e,h.Period=this.Period,h.Period>0){var c=h.GetPeriodSingleData(h.Period);h.Data=c}let t=h.GetValue();this.HKToSHSZData.set(D[n].ID,t)}},this.RecvMulitMinuteHKToSHSZData=function(e,t){if(e.data&&!(e.data.length<=0)){for(var a=[],r=[],i=[],n=0,s=0;n<this.Data.Data.length&&s<e.data.length;){a[n]=null,r[n]=null,i[n]=null;var u=(N=this.Data.Data[n]).DateTime;if(u){var o=u.split(" ");if(2==o.length){var l=parseInt(o[0]),D=e.data[s];if(!D.minute||D.minute.length<=0)++s;else if(D.date>l)++n;else if(D.date<l)++s;else{for(var h in D.minute){var c=D.minute[h],C=c[1],E=c[2],m=C+E;a[n]=m,r[n]=C,i[n]=E,++n}++s}}else++n}else++n}var A=[{Data:a,ID:1},{Data:r,ID:2},{Data:i,ID:3}];for(var n in A){var N=A[n];this.HKToSHSZData.set(N.ID,N.Data)}}},this.GetHKToSHSZCacheData=function(e,t){return e||(e=this.Symbol),"string"==typeof e&&(e=e.toUpperCase()),this.HKToSHSZData.has(e)?this.HKToSHSZData.get(e):[]},this.GetNewsAnalysisData=function(e){if(this.NewsAnalysisData.has(e))return this.Execute.RunNextJob();var t=this,a=new Map([[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE,"negative"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH,"research"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT,"interact"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,"holderchange"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,"holderchange"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER,"trustholder"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING,"Blocktrading"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS,"companynews"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS,"topmanagers"],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE,"Pledge"]]);if(a.has(e)){var r=a.get(e),i=this.StockNewsAnalysisApiUrl+"/"+r+"/"+this.Symbol+".json";JSNetwork.HttpRequest({url:i,type:"get",dataType:"json",async:!0,success:function(a){t.RecvNewsAnalysisData(a,e),t.Execute.RunNextJob()},error:function(a,r){t.RecvNewsAnalysisDataError(a,r,e),t.Execute.RunNextJob()}})}else this.Execute.RunNextJob()},this.RecvNewsAnalysisDataError=function(e,t,a){JSConsole.Complier.Log("[JSSymbolData::RecvNewsAnalysisDataError] ajax error.",e.status);for(var r=[],i=0;i<this.Data.Data.length;++i){var n=new SingleData;n.Date=this.Data.Data[i].Date,n.Value=0,r.push(n)}var s=new ChartData;s.Data=r,this.NewsAnalysisData.set(a,s.GetValue())},this.RecvNewsAnalysisData=function(e,t){if(e.data&&e.date&&!(e.data.length<=0||e.data.length!=e.date.length))if(JSConsole.Complier.Log("[JSSymbolData::RecvNewsAnalysisData] jobID",t,e.update),t==JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE||t==JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2){for(var a=[],r=[],i=0;i<e.data.length;++i){(n=new SingleData).Date=e.date[i],n.Value=e.data[i],this.IsNumber(n.Value)&&a.push(n),i<e.data2.length&&((n=new SingleData).Date=e.date[i],n.Value=e.data2[i],this.IsNumber(n.Value)&&r.push(n))}let t=this.Data.GetFittingData2(a,0);(s=new ChartData).Data=t,this.NewsAnalysisData.set(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,s.GetValue()),t=this.Data.GetFittingData2(r,0),(s=new ChartData).Data=t,this.NewsAnalysisData.set(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,s.GetValue())}else{for(a=[],i=0;i<e.data.length;++i){var n;(n=new SingleData).Date=e.date[i],n.Value=e.data[i],a.push(n)}let r=this.Data.GetFittingData2(a,0);var s;(s=new ChartData).Data=r,this.NewsAnalysisData.set(t,s.GetValue())}},this.GetSectionFinanceData=function(e){var t=e.SF[0],a=e.SF[1].Period;if(this.SectionFinanceData.has(t))return this.Execute.RunNextJob();JSConsole.Complier.Log(`[JSSymbolData::GetSectionFinanceData] ${a.Year}-${a.Quarter}`);var r="announcement"+a.Quarter,i=this,n=["name","date","symbol",r,"finance"+a.Quarter],s=[r+".year","int32","eq",a.Year.toString()];JSNetwork.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:n,symbol:[this.Symbol],condition:[{item:s}]},type:"post",dataType:"json",async:!0,success:function(t){i.RecvSectionFinanceData(t,e),i.Execute.RunNextJob()}})},this.RecvSectionFinanceData=function(e,t){if(e.stock&&1==e.stock.length){var a=e.stock[0];if(a.stockday&&!(a.stockday.length<=0)){var r=a.stockday[0],i=t.SF[1].Period,n=null;if(1===i.Quarter?n=r.finance1:2===i.Quarter?n=r.finance2:3===i.Quarter?n=r.finance3:4===i.Quarter&&(n=r.finance4),n){e=new Map([[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_01,n.currentassets],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_02,n.monetaryfunds],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_03,n.inventory],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_04,n.currentliabilities],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_05,n.ncurrentliabilities],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_06,n.expenses3],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_07,n.investmentincome],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_08,n.pcnprofit],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_09,n.nnetprofit],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_10,n.npersearning],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_11,n.woewa],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_12,n.inprocess],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_13,n.accdepreciation],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_14,n.mholderprofit],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_15,n.lossexchange],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_16,n.baddebts],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_17,n.fixedassets],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_18,n.curdepreciation],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_19,n.orevenues],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_20,n.moprofit],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_21,n.oprofit],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_22,n.nprofit],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_23,n.areceivable],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_24,n.financialcost],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_25,n.ccfo],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_26,n.totalassets],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_27,n.totalliabilities],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_28,n.totalownersequity],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_29,n.grossmargin],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_30,n.percreserve],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_31,n.peruprofit],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_32,n.persearning],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_33,n.pernetasset],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_34,n.perccfo],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_38,n.alratio],[JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_39,n.profityoy]]);4===i.Quarter&&(e.set(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_35,n.nnprofitincrease),e.set(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_36,n.nnprofitspeed),e.set(JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_37,n.nprofitincrease));var s=t.SF[0];this.SectionFinanceData.set(s,e)}}}},this.GetSectionFinanceCacheData=function(e,t,a,r){var i=JS_EXECUTE_JOB_ID.GetSectionReportPeriod(e,t);i||this.Execute.ThrowUnexpectedNode(r,`不支持FS(${e}, ${t}, \'${a}\') 报告期错误`);var n=JS_EXECUTE_JOB_ID.GetSectionFinanceID(a);n||this.Execute.ThrowUnexpectedNode(r,`不支持FS(${e}, ${t},\'${a}\') 财务数据字段名称错误`);var s=i.Year+"-"+i.Quarter;if(!this.SectionFinanceData.has(s)&&!this.ThrowSFPeirod.has(s)){this.ThrowSFPeirod.add(s);var u={ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_SF,SF:[s,{Period:i,Fields:new Set([n])}]};this.Execute.ThrowDownloadSF(r,u,`FS(${e}, ${t}, \'${a}\') 动态下载`)}if(!this.SectionFinanceData.has(s))return this.Execute.ThrowUnexpectedNode(r,`不支持FS(${e}, ${t}, \'${a}\') 没有这期财务数据`);var o=this.SectionFinanceData.get(s);return o.has(n)||this.Execute.ThrowUnexpectedNode(r,`不支持FS(${e}, ${t}, \'${a}\') 没有这期财务数据字段`),o.get(n)},this.GetFinOne=function(e){var t=this.JobArgumentsToArray(e,3),a=this.GetStockDataKey(e,t);if(this.StockData.has(a))return this.Execute.RunNextJob();var r=this;if(this.NetworkFilter){var i=this.Data.GetDateRange(),n={Name:"JSSymbolData::GetFinOne",Explain:"财务数据FINONE(ID,Y,MMDD)",JobID:e.ID,Request:{Url:r.StockHistoryDayApiUrl,Type:"POST",Data:{Args:t,symbol:this.Symbol,daterange:i}},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,function(t){r.RecvStockValue(t,e,a,1),r.Execute.RunNextJob()}),1==n.PreventDefault)return}new DownloadFinOneData({Job:e,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,Args:t,DataKey:a,Callback:function(e,t,a){r.RecvStockValue(e,t,a,1),r.Execute.RunNextJob()},ErrorCallback:function(e){r.AddStockValueError(a,e)}}).Download()},this.GetStockDataKey=function(e,t){var a=e.FunctionName;if(t.length>0){a+="(";for(var r=0;r<t.length;++r)r>0&&(a+=","),a+=t[r].toString();a+=")"}return a},this.GetFinValue=function(e){var t=this.JobArgumentsToArray(e,1),a=t[0],r=this.GetStockDataKey(e,t);if(this.StockData.has(r))return this.Execute.RunNextJob();var i=this;if(this.NetworkFilter){var n=this.Data.GetDateRange(),s={Name:"JSSymbolData::GetFinValue",Explain:"财务数据FINVALUE(ID)",JobID:e.ID,Request:{Url:i.StockHistoryDayApiUrl,Type:"POST",Data:{id:a,symbol:this.Symbol,daterange:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(t){i.RecvStockValue(t,e,r,0),i.Execute.RunNextJob()}),1==s.PreventDefault)return}new DownloadFinValueData({Job:e,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,Args:t,DataKey:r,Callback:function(e,t,a){i.RecvStockValue(e,t,a,0),i.Execute.RunNextJob()},ErrorCallback:function(e){i.AddStockValueError(r,e)}}).Download()},this.GetFinance=function(e){var t=this.JobArgumentsToArray(e,1),a=t[0],r=this.GetStockDataKey(e,t);if(this.StockData.has(r))return this.Execute.RunNextJob();var i=this;if(this.NetworkFilter){var n=this.Data.GetDateRange(),s={Name:"JSSymbolData::GetFinance",Explain:"财务数据FINANCE(ID)",JobID:e.ID,Request:{Url:i.RealtimeApiUrl,Type:"POST",Data:{id:a,symbol:this.Symbol,daterange:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(t){i.RecvStockValue(t,e,r,0),i.Execute.RunNextJob()}),1==s.PreventDefault)return}new DownloadFinanceData({Job:e,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:t,DataKey:r,Callback:function(e,t,a){i.RecvStockValue(e,t,a,0),i.Execute.RunNextJob()},ErrorCallback:function(e){i.AddStockValueError(r,e)}}).Download()},this.GetGPJYValue=function(e){var t=this.JobArgumentsToArray(e,3),a=this.GetStockDataKey(e,t);if(this.StockData.has(a))return this.Execute.RunNextJob();var r=this,i=1==t[2]?0:2;if(this.NetworkFilter){var n=this.Data.GetDateRange(),s={Name:"JSSymbolData::GetGPJYValue",Explain:"股票交易类数据GPJYVALUE(ID,N,TYPE)",JobID:e.ID,Request:{Url:r.StockHistoryDayApiUrl,Type:"POST",Data:{Args:t,symbol:this.Symbol,daterange:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(t){r.RecvStockValue(t,e,a,i),r.Execute.RunNextJob()}),1==s.PreventDefault)return}new DownloadGPJYValue({Job:e,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,Args:t,DataKey:a,Callback:function(e,t,a){r.RecvStockValue(e,t,a,i),r.Execute.RunNextJob()},ErrorCallback:function(e){r.AddStockValueError(a,e)}}).Download()},this.GetVariantData=function(e){var t=e.VariantName;if(this.StockData.has(t))return this.Execute.RunNextJob();var a=this;if(this.NetworkFilter){var r=this.Data.GetDateRange(),i={Name:"JSSymbolData::GetVariantData",Explain:"变量数据下载",JobID:e.ID,Request:{Url:"www.121287.com",Type:"POST",Data:{VariantName:e.VariantName,symbol:this.Symbol,daterange:r}},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,function(r){a.RecvStockValue(r,e,t,0),a.Execute.RunNextJob()}),1==i.PreventDefault)return}var n;"CAPITAL"!=e.VariantName&&"TOTALCAPITAL"!=e.VariantName&&"EXCHANGE"!=e.VariantName||(n=new DownloadFinanceData({Job:e,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:[e.VariantName],DataKey:t,Callback:function(e,t,r){a.RecvStockValue(e,t,r,0),a.Execute.RunNextJob()},ErrorCallback:function(e){a.AddStockValueError(t,e)}})),n.Download()},this.GetCustomVariantData=function(e){var t=e.VariantName;if(this.StockData.has(t))return this.Execute.RunNextJob();var a=g_JSComplierResource.CustomVariant.Data.get(t),r=this;if(this.NetworkFilter){var i=this.Data.GetDateRange(),n={Name:"JSSymbolData::GetCustomVariantData",Explain:"自定义变量数据下载",JobID:e.ID,Request:{Url:"www.121287.com",Type:"POST",Data:{VariantName:e.VariantName,symbol:this.Symbol,daterange:i}},Self:this,VariantInfo:a,PreventDefault:!1};this.NetworkFilter(n,function(a){a.Error?r.AddStockValueError(t,a.Error):r.RecvStockValue(a.Data,e,t,a.DataType),r.Execute.RunNextJob()})}else this.AddStockValueError(t,`自定义变量${t}下载失败`),this.Execute.RunNextJob()},this.GetCustomFunctionData=function(e){var t=e.FunctionName,a=g_JSComplierResource.CustomFunction.Data.get(t);if(!a.IsDownload)return this.Execute.RunNextJob();if(this.StockData.has(t))return this.Execute.RunNextJob();var r=this;if(this.NetworkFilter){var i=this.Data.GetDateRange(),n={Name:"JSSymbolData::GetCustomFunctionData",Explain:"自定义函数数据下载",JobID:e.ID,Request:{Url:"www.121287.com",Type:"POST",Data:{FunctionName:e.FunctionName,symbol:this.Symbol,daterange:i,JobItem:e}},Self:this,FunctionInfo:a,PreventDefault:!1};this.NetworkFilter(n,function(a){a.Error?r.AddStockValueError(t,a.Error):r.RecvStockValue(a.Data,e,t,a.DataType),r.Execute.RunNextJob()})}else this.AddStockValueError(t,`自定义函数${t}下载失败`),this.Execute.RunNextJob()},this.RecvStockValue=function(e,t,a,r){if(e){if(0==r)if(Array.isArray(e)){var i=this.Data;if(ChartData.IsDayPeriod(this.Period,!0))o=i.GetFittingFinanceData(e);else{if(!ChartData.IsMinutePeriod(this.Period,!0))return;o=i.GetMinuteFittingFinanceData(e)}(l=new ChartData).Data=o;var n=l.GetValue();if("EXCHANGE"==a)for(var s in n){var u=i.Data[s];IFrameSplitOperator.IsPlusNumber(n[s])&&(n[s]=u.Vol/n[s]*100)}this.StockData.set(a,{Data:n})}else this.StockData.set(a,{Data:e.Value});else if(1==r)this.StockData.set(a,{Data:e.Value});else if(2==r){var o,l;i=this.Data;if(ChartData.IsDayPeriod(this.Period,!0))o=i.GetFittingTradeData(e,0);else{if(!ChartData.IsMinutePeriod(this.Period,!0))return;o=i.GetMinuteFittingTradeData(e,0)}(l=new ChartData).Data=o;n=l.GetValue();this.StockData.set(a,{Data:n})}}else JSConsole.Complier.Log(`[JSSymbolData::RecvStockValue] key=${a} data is null`)},this.AddStockValueError=function(e,t){this.StockData.set(e,{Error:t})},this.GetStockCacheData=function(e){var t;if(e.FunctionName)t=this.GetStockDataKey({FunctionName:e.FunctionName},e.Args);else if(e.VariantName)t=e.VariantName;else{if(!e.CustomName)return null;t=e.CustomName}if(!this.StockData.has(t))return null;var a=this.StockData.get(t);return a.Error&&this.Execute.ThrowUnexpectedNode(e.Node,a.Error),a.Data},this.JobArgumentsToArray=function(e,t){var a=e.Args;if(a.length!=t){var r=e.Token;this.Execute.ErrorHandler.ThrowError(r.Index,r.Line,0,`${e.FunctionName}() Error: argument count error.`)}for(var i=[],n=0;n<a.length;++n){var s=a[n];if(IFrameSplitOperator.IsNumber(s))i.push(s);else if(s.Type==Syntax.Literal)i.push(s.Value);else if(s.Type==Syntax.Identifier){var u=!1;for(var o in this.Arguments){const e=this.Arguments[o];if(e.Name==s.Name){i.push(e.Value),u=!0;break}}if(!u){r=e.Token;this.Execute.ErrorHandler.ThrowError(r.Index,r.Line,0,`${e.FunctionName}() Error: can\'t read ${s.Name}`)}}}return i},this.DownloadCustomAPIData=function(e){if(!this.NetworkFilter)return this.Execute.RunNextJob();var t=[];for(var a in e.Args){var r=e.Args[a];if(r.Type==Syntax.Literal)t.push(r.Value);else{if(r.Type!=Syntax.Identifier)return this.Execute.RunNextJob();var i=!1;for(var n in this.Arguments){const e=this.Arguments[n];if(e.Name==r.Name){t.push(e.Value),i=!0;break}}if(!i){var s=e.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,`LoadAPIData() Error: can\'t read ${r.Name}`)}}}var u=this,o={Name:"JSSymbolData::DownloadCustomAPIData",Explain:"下载自定义api数据",Period:this.Period,Right:this.Right,Symbol:this.Symbol,KData:this.Data,Cache:this.CustomAPIData,Args:t,Self:this,PreventDefault:!1};this.NetworkFilter(o,function(e){u.RecvCustomAPIData(e,t),u.Execute.RunNextJob()}),1!=o.PreventDefault&&this.Execute.RunNextJob()},this.RecvCustomAPIData=function(e,t){e&&(1==e.Type?this.RecvCustomAPISingleData(e,t):this.RecvCustomAPIGroupData(e,t))},this.RecvCustomAPIGroupData=function(e,t){if(e&&e.data){var a=e.data,r=this.GenerateCustomAPIKey(t);if(ChartData.IsMinutePeriod(this.Period,!0)){if(!a.date||!a.time)return;var i=a.date;a.time;for(var n in a)if("date"!=n&&"time"!=n)var s=a[n]}else if(ChartData.IsDayPeriod(this.Period,!0)){if(!a.date)return;i=a.date;var u={__Type__:"Object"};for(var n in a)if("date"!=n){s=a[n];if(Array.isArray(s)){var o=this.FittingCustomAPIArray(s,i);u[n]=o}else this.IsNumber(s)&&(u[n]=s)}this.CustomAPIData.set(r,u)}}},this.RecvCustomAPISingleData=function(e,t){var a=e.data,r=this.GenerateCustomAPIKey(t);if(ChartData.IsMinutePeriod(this.Period,!0)){if(!a.date||!a.time)return;var i=a.date;a.time;for(var n in a)if("date"!=n&&"time"!=n)a[n]}else if(ChartData.IsDayPeriod(this.Period,!0)){if(!a.date)return;i=a.date;var s=a.value,u=null;u=Array.isArray(s)?1==e.DataType?this.FittingCustomAPIFinanceArray(s,i):this.FittingCustomAPIArray(s,i):s,this.CustomAPIData.set(r,u)}},this.FittingCustomAPIFinanceArray=function(e,t,a){var r,i=this.Data,n=[];for(var s in e){var u=e[s],o=new SingleData;o.Date=t[s],a&&s<a.length&&(o.Time=a[s]),o.Value=u,n.push(o)}if(ChartData.IsDayPeriod(this.Period,!0))r=i.GetFittingFinanceData(n);else{if(!ChartData.IsMinutePeriod(this.Period,!0))return null;r=i.GetMinuteFittingFinanceData(n)}var l=new ChartData;return l.Data=r,l.GetValue()},this.FittingCustomAPIArray=function(e,t,a){var r,i=this.Data,n=[];for(var s in e){var u=e[s],o=new SingleData;o.Date=t[s],a&&s<a.length&&(o.Time=a[s]),o.Value=u,n.push(o)}if(ChartData.IsDayPeriod(this.Period,!0))r=i.GetFittingData(n);else{if(!ChartData.IsMinutePeriod(this.Period,!0))return null;r=i.GetMinuteFittingData(n)}var l=new ChartData;return l.Data=r,l.GetValue()},this.GenerateCustomAPIKey=function(e){if(e.length<=0)return"__12_EMPTY_ARGS__";var t="";for(var a in e)t.length>0&&(t+=","),t+=e[a];return t},this.GetCustomApiData=function(e){var t=this.GenerateCustomAPIKey(e);return this.CustomAPIData.has(t)?this.CustomAPIData.get(t):(JSConsole.Complier.Log(`[JSSymbolData::GetCustomApiData] can\'t find api data key=[${t}]`),null)},this.ReadArgumentValue=function(e,t){if(t.Name=e.Name,e.Type==Syntax.Literal)return t.Value=e.Value,!0;if(e.Type==Syntax.Identifier){var a=!1;for(var r in this.Arguments){const i=this.Arguments[r];if(i.Name==e.Name)return t.Value=i.Value,a=!0,!0}if(!a)return t.Error=`can\'t read ${e.Name}`,!1}return t.Error=`can\'t read ${e.Name}, type error.`,!1},this.ReadIndexFunctionValue=function(e,t){var a={};if("object"==typeof e){if(!this.ReadArgumentValue(e,a))return t.Error=a.Error,!1}else a.Value=e;var r,i=a.Value.indexOf(".");-1!=i?(t.Name=a.Value.slice(0,i),-1!=(r=a.Value.indexOf("#",i+1))?(t.Out=a.Value.slice(i+1,r),t.Period=a.Value.slice(r+1)):t.Out=a.Value.slice(i+1)):-1!=(r=a.Value.indexOf("#"))?(t.Name=a.Value.slice(0,r),t.Period=a.Value.slice(r+1)):t.Name=a.Value;const n=new Map([["DAY",0],["WEEK",1],["MONTH",2],["SEASON",9],["YEAR",3],["MIN1",4],["MIN5",5],["MIN15",6],["MIN30",7],["MIN60",8]]);if(t.Period){if(!n.has(t.Period))return t.Error=`${t.Period}, 周期错误`,!1;t.PeriodID=n.get(t.Period)}return!0},this.ReadSymbolArgumentValue=function(e,t){var a={};if("object"==typeof e){if(!this.ReadArgumentValue(e,a))return t.Error=a.Error,!1}else a.Value=e;return""==a.Value&&(a.Value=this.Symbol),a.Value.indexOf(".SH")>0?t.Symbol=a.Value.replace(".SH",".sh"):a.Value.indexOf(".SZ")>0?t.Symbol=a.Value.replace(".SZ",".sz"):t.Symbol=a.Value,!0},this.ReadIndexArgumentValue=function(e,t){for(var a in t.Args=[],t.SytemIndex.Args){var r=t.SytemIndex.Args[a];t.Args.push({Value:r.Value,Name:r.Name})}if(e.length>2&&t.SytemIndex.Args&&t.SytemIndex.Args.length>0){a=2;for(var i=0;a<e.length&&i<t.SytemIndex.Args.length;++a,++i){var n={};if("object"==typeof(r=e[a])){if(!this.ReadArgumentValue(r,n))return t.Error=n.Error,!1}else n.Value=r;t.Args[i].Value=n.Value}}return!0},this.GenerateScriptIndexKey=function(e){var t="",a=e.Args;for(var r in a){t.length>0&&(t+=","),t+=a[r].Value.toString()}var i=e.Out?e.Out:"ALL";return`(${e.Symbol},${e.PeriodID}), ${e.Name}(${t})=>${i}`},this.CallScriptIndex=function(e){if(!(e.Args&&e.Args.length>=2)){var t=e.Token;this.Execute.ErrorHandler.ThrowError(t.Index,t.Line,0,`CallScriptIndex() Error: ${e.FunctionName} 参数错误`)}var a={Job:e,PeriodID:this.Period};if(!this.ReadSymbolArgumentValue(e.Args[0],a)){t=e.Token;this.Execute.ErrorHandler.ThrowError(t.Index,t.Line,0,`CallScriptIndex() Error: ${a.Error}`)}if(!this.ReadIndexFunctionValue(e.Args[1],a)){t=e.Token;this.Execute.ErrorHandler.ThrowError(t.Index,t.Line,0,`CallScriptIndex() Error: ${a.Error}`)}var r=(new JSIndexScript).Get(a.Name);if(!r){t=e.Token;this.Execute.ErrorHandler.ThrowError(t.Index,t.Line,0,`CallScriptIndex() ${a.Name} 指标不存在`)}if(a.SytemIndex=r,!this.ReadIndexArgumentValue(e.Args,a)){t=e.Token;this.Execute.ErrorHandler.ThrowError(t.Index,t.Line,0,`CallScriptIndex() ${a.Name} 指标参数错误 : ${a.Error} `)}JSConsole.Complier.Log("[JSSymbolData::CallScriptIndex] call script index",a);var i=null;if(this.Data&&this.Data.Data.length>0){var n=this.Data.Data[0],s=this.Data.Data[this.Data.Data.length-1];i={Start:{Date:n.Date,Time:n.Time},End:{Date:s.Date,Time:s.Time}}}var u={HQDataType:this.DataType,Symbol:a.Symbol,Name:"",Right:this.Right,Period:a.PeriodID,Data:null,SourceData:null,Callback:(e,t,a)=>{this.RecvScriptIndexData(e,t,a),this.Execute.RunNextJob()},CallbackParam:a,Async:!0,MaxRequestDataCount:this.MaxRequestDataCount+60,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount+2,Arguments:a.Args,IsBeforeData:this.IsBeforeData,NetworkFilter:this.NetworkFilter,KLineRange:i};JSComplier.Execute(a.SytemIndex.Script,u,(e,t)=>{this.ExecuteScriptIndexError(e,t)})},this.RecvScriptIndexData=function(e,t,a){var r=this.GenerateScriptIndexKey(t);JSConsole.Complier.Log("[JSSymbolData::RecvScriptIndexData] ",e,t,a,r);var i=a.Data.Data,n=e;if(t.Out){for(var s in e){if((l=e[s]).Name==t.Out){n=[l];break}}var u=this.Data.FitKLineIndex(i,n,this.Period,t.PeriodID);this.ScriptIndexOutData.set(r,u[0].Data)}else{u=this.Data.FitKLineIndex(i,n,this.Period,t.PeriodID);var o={__Type__:"Object"};for(var s in u){var l;o[(l=u[s]).Name]=l.Data}this.ScriptIndexOutData.set(r,o)}},this.ExecuteScriptIndexError=function(e,t){var a=t.Job.Token;this.Execute.ErrorHandler.ThrowError(a.Index,a.Line,0,`CallScriptIndex() ${t.Name} 指标执行错误 : ${e} `)},this.GetScriptIndexOutData=function(e,t){var a={PeriodID:this.Period};this.ReadSymbolArgumentValue(e[0],a)||this.Execute.ThrowUnexpectedNode(t,`STKINDI() 股票代码错误: ${a.Error}`),this.ReadIndexFunctionValue(e[1],a)||this.Execute.ThrowUnexpectedNode(t,`STKINDI() 指标错误: ${a.Error}`);var r=(new JSIndexScript).Get(a.Name);r||this.Execute.ThrowUnexpectedNode(t,`STKINDI() 指标错误: ${a.Name} 指标不存在`),a.SytemIndex=r,this.ReadIndexArgumentValue(e,a)||this.Execute.ThrowUnexpectedNode(t,`STKINDI()  指标参数错误: ${a.Error}`);var i=this.GenerateScriptIndexKey(a);return this.ScriptIndexOutData.has(i)?this.ScriptIndexOutData.get(i):null},this.JsonDataToHistoryData=function(e){for(var t=e.data,a=new Array,r=0;r<t.length;++r){var i=new HistoryData;i.Date=t[r][0],i.Open=t[r][2],i.YClose=t[r][1],i.Close=t[r][5],i.High=t[r][3],i.Low=t[r][4],i.Vol=t[r][6],i.Amount=t[r][7],t[r].length>8&&(i.Up=t[r][8]),t[r].length>9&&(i.Down=t[r][9]),t[r].length>10&&(i.Stop=t[r][10]),t[r].length>11&&(i.Unchanged=t[r][11]),isNaN(i.Open)||i.Open<=0||a.push(i)}return a},this.JsonDataToMinuteHistoryData=function(e){for(var t=e.data,a=new Array,r=0;r<t.length;++r){let e=new HistoryData;e.Date=t[r][0],e.Open=t[r][2],e.YClose=t[r][1],e.Close=t[r][5],e.High=t[r][3],e.Low=t[r][4],e.Vol=t[r][6],e.Amount=t[r][7],e.Time=t[r][8],a.push(e)}for(r=0;r<a.length;++r){var i=a[r];if(null==i&&coninue,isNaN(i.Open)||i.Open<=0||isNaN(i.High)||i.High<=0||isNaN(i.Low)||i.Low<=0||isNaN(i.Close)||i.Close<=0||isNaN(i.YClose)||i.YClose<=0)if(0==r)i.YClose>0&&(i.Open=i.YClose,i.High=i.YClose,i.Low=i.YClose,i.Close=i.YClose);else for(var n=r-1;n>=0;--n){var s=a[n];if(null==s&&coninue,s.Open>0&&s.High>0&&s.Low>0&&s.Close>0){i.YClose<=0&&(i.YClose=s.Close),i.Open=s.Open,i.High=s.High,i.Low=s.Low,i.Close=s.Close;break}}}return a},this.JsonDataToMinuteData=function(e){var t=new Array;for(var a in e.stock[0].minute){var r=e.stock[0].minute[a],i=new MinuteData;i.Close=r.price,i.Open=r.open,i.High=r.high,i.Low=r.low,i.Vol=r.vol,i.Amount=r.amount,i.DateTime=0==a?e.stock[0].date.toString()+" 0925":e.stock[0].date.toString()+" "+r.time.toString(),i.Date=e.stock[0].date,i.Time=r.time,i.Increase=r.increase,i.Risefall=r.risefall,i.AvPrice=r.avprice,t[a]=i}return t},this.JsonDataToMultiDayMinuteData=function(e){var t=e.symbol.toUpperCase(),a=MARKET_SUFFIX_NAME.IsSHSZ(t),r=(MARKET_SUFFIX_NAME.IsChinaFutures(t),[]);for(var i in e.data){var n=[],s=e.data[i],u=s.date,o=s.yclose,l=o,D=null;for(var h in s.minute){var c=s.minute[h];c[2]&&(l=c[2]),(E=new MinuteData).Close=c[2],E.Open=c[1],E.High=c[3],E.Low=c[4],E.Vol=c[5]/100,E.Amount=c[6],7<c.length&&c[7]>0&&(E.AvPrice=c[7],D=c[7]),E.DateTime=u.toString()+" "+c[0].toString(),E.Date=u,E.Time=c[0],E.Close||(E.Close=l,E.Open=E.High=E.Low=E.Close),!E.AvPrice&&D&&(E.AvPrice=D),E.Close&&o?E.Increase=(E.Close-o)/o*100:E.Increase=null,0==h&&(a&&(E.DateTime=u.toString()+" 0925"),E.IsFristData=!0),E.Open<=0&&(E.Open=null),E.Close<=0&&(E.Close=null),E.AvPrice<=0&&(E.AvPrice=null),E.High<=0&&(E.High=null),E.Low<=0&&(E.Low=null),E.AvPrice<=0&&(E.AvPrice=null),n[h]=E}var C=new ChartData;C.Data=n,C.YClose=o,C.Close=s.close,C.Date=u,r.push(C)}for(n=[],i=r.length-1;i>=0;--i){var E=r[i];for(var h in E.Data)n.push(E.Data[h])}return n},this.CODELIKE=function(e){return this.Symbol&&0==this.Symbol.indexOf(e)?1:0},this.NAMELIKE=function(e){return this.Name&&0==this.Name.indexOf(e)?1:0},this.SETCODE=function(){return this.Symbol.indexOf(".sh")?1:(this.Symbol.indexOf(".sz"),0)},this.GetSymbol=function(){return this.Symbol},this.GetName=function(){return this.Name},this.GetIndustry=function(){var e=JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GROUP_DATA.toString()+"-Group-"+this.Symbol;if(!this.ExtendData.has(e))return"";var t=this.ExtendData.get(e);if(!t.Industry||t.Industry.length<=0)return"";var a="";for(var r in t.Industry){var i=t.Industry[r];a.length>0&&(a+=" "),a+=i.Name}return a},this.GetRegion=function(){var e=JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GROUP_DATA.toString()+"-Group-"+this.Symbol;if(!this.ExtendData.has(e))return"";var t=this.ExtendData.get(e);if(!t.Region||t.Region.length<=0)return"";var a="";for(var r in t.Region){var i=t.Region[r];a.length>0&&(a+=" "),a+=i.Name}return a},this.GetConcept=function(){var e=JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GROUP_DATA.toString()+"-Group-"+this.Symbol;if(!this.ExtendData.has(e))return"";var t=this.ExtendData.get(e);if(!t.Concept||t.Concept.length<=0)return"";var a="";for(var r in t.Concept){var i=t.Concept[r];a.length>0&&(a+=" "),a+=i.Name}return a},this.DATE=function(){var e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;for(var t in this.Data.Data){var a=this.Data.Data[t];e[t]=a.Date-19e6}return e},this.YEAR=function(){var e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;for(var t in this.Data.Data){var a=this.Data.Data[t];this.IsNumber(a.Date)?e[t]=parseInt(a.Date/1e4):e[t]=null}return e},this.MONTH=function(){var e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;for(var t in this.Data.Data){var a=this.Data.Data[t];this.IsNumber(a.Date)?e[t]=parseInt(a.Date%1e4/100):e[t]=null}return e},this.TIME=function(){var e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;for(var t in this.Data.Data){var a=this.Data.Data[t];this.IsNumber(a.Time)?e[t]=a.Time:e[t]=0}return e},this.WEEK=function(){var e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;var t=new Date;for(var a in this.Data.Data){var r=this.Data.Data[a];if(e[a]=null,this.IsNumber(r.Date)){var i=parseInt(r.Date/1e4),n=parseInt(r.Date%1e4/100),s=r.Date%100;t.setFullYear(i),t.setMonth(n-1),t.setDate(s),e[a]=t.getDay()}}return e},this.REFDATE=function(e,t){var a=null;if(Array.isArray(t)?t.length>0&&(a=t[t.length-1]):this.IsNumber(t)&&(a=t),null==a)return null;a<5e6&&(a+=19e6);var r=null;for(var i in this.Data.Data)if(this.Data.Data[i].Date==a){r=parseInt(i);break}return null==r||r>=e.length?null:e[r]},this.PERIOD=function(){const e=[5,6,7,11,0,1,2,3,4,5,9];return this.Period>=0&&this.Period<=e.length-1?e[this.Period]:this.Period},this.GetDrawNull=function(){var e=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return e;for(var t in this.Data.Data)e[t]=null;return e}}JSSymbolData.prototype.IsNumber=function(e){return null!=e&&!isNaN(e)},JSSymbolData.prototype.IsDivideNumber=function(e){return null!=e&&(!isNaN(e)&&0!=e)},JSSymbolData.prototype.JsonDataToFinance=function(e){for(var t,a=1;a<=4;++a){switch(a){case 1:var r=e.finance1,i=e.announcement1;break;case 2:r=e.finance2,i=e.announcement2;break;case 3:r=e.finance3,i=e.announcement3;break;case 4:r=e.finance4,i=e.announcement4}r&&i&&this.IsNumber(i.year)&&this.IsNumber(i.quarter)&&(t?t.Announcement.year<i.year&&(t={Date:e.date,Finance:r,Announcement:i}):t={Date:e.date,Finance:r,Announcement:i})}return t};var JS_EXECUTE_DEBUG_LOG=!1,JS_EXECUTE_JOB_ID={JOB_DOWNLOAD_SYMBOL_DATA:1,JOB_DOWNLOAD_INDEX_DATA:2,JOB_DOWNLOAD_SYMBOL_LATEST_DATA:3,JOB_DOWNLOAD_INDEX_INCREASE_DATA:4,JOB_DOWNLOAD_VOLR_DATA:5,JOB_DOWNLOAD_GROUP_DATA:6,JOB_DOWNLOAD_LATEST_INDEX_DATA:8,JOB_DOWNLOAD_OTHER_SYMBOL_DATA:9,JOB_DOWNLOAD_SYMBOL_PERIOD_DATA:10,JOB_DOWNLOAD_FINVALUE:301,JOB_DOWNLOAD_FINONE:302,JOB_DOWNLOAD_FINANCE:303,JOB_DOWNLOAD_GPJYVALUE:304,JOB_DOWNLOAD_VARIANT:305,JOB_DOWNLOAD_MARGIN_BALANCE:1e3,JOB_DOWNLOAD_MARGIN_RATE:1001,JOB_DOWNLOAD_MARGIN_BUY_BALANCE:1010,JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:1011,JOB_DOWNLOAD_MARGIN_BUY_REPAY:1012,JOB_DOWNLOAD_MARGIN_BUY_NET:1013,JOB_DOWNLOAD_MARGIN_SELL_BALANCE:1020,JOB_DOWNLOAD_MARGIN_SELL_VOLUME:1021,JOB_DOWNLOAD_MARGIN_SELL_REPAY:1022,JOB_DOWNLOAD_MARGIN_SELL_NET:1023,JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:2e3,JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:2001,JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:2002,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:2003,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:2004,JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:2005,JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:2006,JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:2007,JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:2008,JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:2009,JOB_DOWNLOAD_HK_TO_SH:2050,JOB_DOWNLOAD_HK_TO_SZ:2051,JOB_DOWNLOAD_HK_TO_SH_SZ:2052,JOB_DOWNLOAD_HK_TO_SHSZ:2053,JOB_CUSTOM_FUNCTION_DATA:6e3,JOB_CUSTOM_VARIANT_DATA:6001,JOB_DOWNLOAD_SECTION_SF:2e4,JOB_DOWNLOAD_SECTION_F_01:20001,JOB_DOWNLOAD_SECTION_F_02:20002,JOB_DOWNLOAD_SECTION_F_03:20003,JOB_DOWNLOAD_SECTION_F_04:20004,JOB_DOWNLOAD_SECTION_F_05:20005,JOB_DOWNLOAD_SECTION_F_06:20006,JOB_DOWNLOAD_SECTION_F_07:20007,JOB_DOWNLOAD_SECTION_F_08:20008,JOB_DOWNLOAD_SECTION_F_09:20009,JOB_DOWNLOAD_SECTION_F_10:20010,JOB_DOWNLOAD_SECTION_F_11:20011,JOB_DOWNLOAD_SECTION_F_12:20012,JOB_DOWNLOAD_SECTION_F_13:20013,JOB_DOWNLOAD_SECTION_F_14:20014,JOB_DOWNLOAD_SECTION_F_15:20015,JOB_DOWNLOAD_SECTION_F_16:20016,JOB_DOWNLOAD_SECTION_F_17:20017,JOB_DOWNLOAD_SECTION_F_18:20018,JOB_DOWNLOAD_SECTION_F_19:20019,JOB_DOWNLOAD_SECTION_F_20:20020,JOB_DOWNLOAD_SECTION_F_21:20021,JOB_DOWNLOAD_SECTION_F_22:20022,JOB_DOWNLOAD_SECTION_F_23:20023,JOB_DOWNLOAD_SECTION_F_24:20024,JOB_DOWNLOAD_SECTION_F_25:20025,JOB_DOWNLOAD_SECTION_F_26:20026,JOB_DOWNLOAD_SECTION_F_27:20027,JOB_DOWNLOAD_SECTION_F_28:20028,JOB_DOWNLOAD_SECTION_F_29:20029,JOB_DOWNLOAD_SECTION_F_30:20030,JOB_DOWNLOAD_SECTION_F_31:20031,JOB_DOWNLOAD_SECTION_F_32:20032,JOB_DOWNLOAD_SECTION_F_33:20033,JOB_DOWNLOAD_SECTION_F_34:20034,JOB_DOWNLOAD_SECTION_F_35:20035,JOB_DOWNLOAD_SECTION_F_36:20036,JOB_DOWNLOAD_SECTION_F_37:20037,JOB_DOWNLOAD_SECTION_F_38:20038,JOB_DOWNLOAD_SECTION_F_39:20039,JOB_DOWNLOAD_CUSTOM_API_DATA:3e4,JOB_EXECUTE_INDEX:30010,JOB_RUN_SCRIPT:1e4,GetMarginJobID:function(e){let t=new Map([[1,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BALANCE],[2,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_RATE],[3,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_BALANCE],[4,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT],[5,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_REPAY],[6,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_NET],[7,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_BALANCE],[8,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_VOLUME],[9,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_REPAY],[10,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_NET]]);return t.has(e)?t.get(e):null},GetNewsAnalysisID:function(e){let t=new Map([[1,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE],[2,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH],[3,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT],[4,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE],[5,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2],[6,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER],[7,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING],[8,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS],[9,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS],[10,JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE]]);return t.has(e)?t.get(e):null},GetSectionFinanceID:function(e){let t=new Map([["流动资产",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_01],["货币资金",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_02],["存货",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_03],["流动负债",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_04],["非流动负债",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_05],["三项费用",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_06],["投资收益",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_07],["归母净利润",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_08],["扣非净利润",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_09],["扣非每股收益",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_10],["加权平均净资产收益",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_11],["在建工程",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_12],["累计折旧",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_13],["少数股东利润",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_14],["汇兑损益",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_15],["坏账计提",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_16],["固定资产",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_17],["当期折旧",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_18],["营业总收入",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_19],["主营业务利润",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_20],["营业利润",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_21],["净利润",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_22],["应收账款",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_23],["财务费用",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_24],["经营性现金流",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_25],["资产总计",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_26],["负债总计",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_27],["所有者权益总计",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_28],["毛利率",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_29],["每股资本公积金",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_30],["每股未分配利润",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_31],["每股收益",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_32],["每股净资产",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_33],["每股经营性现金流",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_34],["扣非净利润涨幅",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_35],["扣非净利润涨速",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_36],["净利润涨幅",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_37],["资产负债率",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_38],["利润同比",JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_F_39]]);return t.has(e)?t.get(e):null},GetSectionReportPeriod:function(e,t){return e>=2e3&&t>=1&&t<=4?{Year:e,Quarter:t}:null}};function JSExecute(e,t){this.AST=e,this.ErrorHandler=new ErrorHandler,this.VarTable=new Map,this.OutVarTable=[],this.Arguments=[],this.ErrorCallback,this.ConstVarTable=new Map([["CLOSE",null],["VOL",null],["OPEN",null],["HIGH",null],["LOW",null],["AMOUNT",null],["C",null],["V",null],["O",null],["H",null],["L",null],["AMO",null],["VOLR",null],["VOLINSTK",null],["ZSTJJ",null],["DATE",null],["YEAR",null],["MONTH",null],["PERIOD",null],["WEEK",null],["TIME",null],["INDEXA",null],["INDEXC",null],["INDEXH",null],["INDEXL",null],["INDEXO",null],["INDEXV",null],["INDEXADV",null],["INDEXDEC",null],["ADVANCE",null],["DECLINE",null],["FROMOPEN",null],["TOTALFZNUM",null],["CURRBARSCOUNT",null],["TOTALBARSCOUNT",null],["ISLASTBAR",null],["BARSTATUS",null],["CAPITAL",null],["TOTALCAPITAL",null],["EXCHANGE",null],["SETCODE",null],["CODE",null],["STKNAME",null],["TQFLAG",null],["HYBLOCK",null],["DYBLOCK",null],["GNBLOCK",null],["DRAWNULL",null]]),this.SymbolData=new JSSymbolData(this.AST,t,this),this.Algorithm=new JSAlgorithm(this.ErrorHandler,this.SymbolData),this.Draw=new JSDraw(this.ErrorHandler,this.SymbolData),this.JobList=[],this.UpdateUICallback=null,this.CallbackParam=null,this.IsSectionMode=!1,t&&(t.Callback&&(this.UpdateUICallback=t.Callback),t.CallbackParam&&(this.CallbackParam=t.CallbackParam),t.Arguments&&(this.Arguments=t.Arguments),t.IsSectionMode&&(this.IsSectionMode=t.IsSectionMode)),this.Execute=function(){for(var e in JSConsole.Complier.Log("[JSExecute::Execute] Load Arguments",this.Arguments),this.Arguments){let t=this.Arguments[e];this.VarTable.set(t.Name,t.Value)}this.RunNextJob()},this.RunNextJob=function(){if(!(this.JobList.length<=0)){JSConsole.Complier.Log("[JSExecute::Execute] JobList",this.JobList);var e=this.JobList.shift();switch(e.ID){case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_DATA:return this.SymbolData.GetSymbolData();case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA:return this.SymbolData.GetSymbolPeriodData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_INDEX_DATA:return this.SymbolData.GetIndexData();case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_LATEST_INDEX_DATA:return this.SymbolData.GetLatestIndexData();case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_INDEX_INCREASE_DATA:return this.SymbolData.GetIndexIncreaseData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_LATEST_DATA:return this.SymbolData.GetLatestData();case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_VOLR_DATA:return this.SymbolData.GetVolRateData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GROUP_DATA:return this.SymbolData.GetGroupData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_OTHER_SYMBOL_DATA:return this.SymbolData.GetOtherSymbolData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_RELEASE_DATE_DATA:return this.SymbolData.GetCompanyReleaseDate(e.ID);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BALANCE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_RATE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_BUY_NET:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_MARGIN_SELL_NET:return this.SymbolData.GetMarginData(e.ID);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:return this.SymbolData.GetNewsAnalysisData(e.ID);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_HK_TO_SHSZ:return this.SymbolData.GetHKToSHSZData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SECTION_SF:return this.SymbolData.GetSectionFinanceData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_FINONE:return this.SymbolData.GetFinOne(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_FINVALUE:return this.SymbolData.GetFinValue(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_FINANCE:return this.SymbolData.GetFinance(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_GPJYVALUE:return this.SymbolData.GetGPJYValue(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_VARIANT:return this.SymbolData.GetVariantData(e);case JS_EXECUTE_JOB_ID.JOB_CUSTOM_VARIANT_DATA:return this.SymbolData.GetCustomVariantData(e);case JS_EXECUTE_JOB_ID.JOB_CUSTOM_FUNCTION_DATA:return this.SymbolData.GetCustomFunctionData(e);case JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_CUSTOM_API_DATA:return this.SymbolData.DownloadCustomAPIData(e);case JS_EXECUTE_JOB_ID.JOB_EXECUTE_INDEX:return this.SymbolData.CallScriptIndex(e);case JS_EXECUTE_JOB_ID.JOB_RUN_SCRIPT:return this.Run()}}},this.ReadSymbolData=function(e,t){switch(e){case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":case"VOLINSTK":case"ZSTJJ":return this.SymbolData.GetSymbolCacheData(e);case"VOLR":return this.SymbolData.GetVolRateCacheData(t);case"INDEXA":case"INDEXC":case"INDEXH":case"INDEXH":case"INDEXO":case"INDEXV":case"INDEXL":case"INDEXADV":case"INDEXDEC":return this.SymbolData.GetIndexCacheData(e);case"CURRBARSCOUNT":return this.SymbolData.GetCurrBarsCount();case"TOTALBARSCOUNT":return this.SymbolData.GetTotalBarsCount();case"TOTALFZNUM":return this.SymbolData.GetTotalTradeMinuteCount();case"ISLASTBAR":return this.SymbolData.GetIsLastBar();case"BARSTATUS":return this.SymbolData.GetBarStatus();case"TOTALCAPITAL":case"CAPITAL":case"EXCHANGE":return this.SymbolData.GetStockCacheData({VariantName:e,Node:t});case"SETCODE":return this.SymbolData.SETCODE();case"CODE":return this.SymbolData.GetSymbol();case"STKNAME":return this.SymbolData.GetName();case"HYBLOCK":return this.SymbolData.GetIndustry();case"DYBLOCK":return this.SymbolData.GetRegion();case"GNBLOCK":return this.SymbolData.GetConcept();case"TIME":return this.SymbolData.TIME();case"DATE":return this.SymbolData.DATE();case"YEAR":return this.SymbolData.YEAR();case"MONTH":return this.SymbolData.MONTH();case"WEEK":return this.SymbolData.WEEK();case"PERIOD":return this.SymbolData.PERIOD();case"FROMOPEN":return this.SymbolData.GetLatestIndexCacheData("FROMOPEN");case"DRAWNULL":return this.SymbolData.GetDrawNull();case"ADVANCE":case"DECLINE":return this.SymbolData.GetIndexIncreaseCacheData(e,this.SymbolData.Symbol,t);case"TQFLAG":return this.SymbolData.Right}},this.ReadCustomVariant=function(e,t){return this.SymbolData.GetStockCacheData({VariantName:e,Node:t})},this.ReadVariable=function(e,t){if(this.ConstVarTable.has(e)){let a=this.ConstVarTable.get(e);return null==a&&(a=this.ReadSymbolData(e,t),this.ConstVarTable.set(e,a)),a}if(g_JSComplierResource.IsCustomVariant(e))return this.ReadCustomVariant(e,t);if(this.VarTable.has(e))return this.VarTable.get(e);if(e.indexOf("#")>0){var a=e.split("#");return this.SymbolData.GetSymbolPeriodCacheData(a[0],a[1])}return this.ThrowUnexpectedNode(t,"变量"+e+"不存在",e),null},this.ReadMemberVariable=function(e){var t=e.Object,a=e.Property;let r;if(!(r=t.Type==Syntax.BinaryExpression||t.Type==Syntax.LogicalExpression?this.VisitBinaryExpression(t):t.Type==Syntax.CallExpression?this.VisitCallExpression(t):this.GetNodeValue(t)))return null;var i=r[a.Name];return i||null},this.SingleDataToArrayData=function(e){let t=this.SymbolData.Data.Data.length,a=[];for(var r=0;r<t;++r)a[r]=e;return a},this.RunAST=function(){for(var e in this.AST||this.ThrowError(),this.AST.Body||this.ThrowError(),this.AST.Body){let u=this.AST.Body[e];if(this.VisitNode(u),u.Type==Syntax.ExpressionStatement&&u.Expression)if(u.Expression.Type==Syntax.AssignmentExpression){if(":"==u.Expression.Operator&&u.Expression.Left){let e=u.Expression.Left.Name,a=this.VarTable.get(e);var t=0;a&&"object"==typeof a&&"Object"==a.__Type__?t=1e3:this.IsSectionMode||Array.isArray(a)||(a="string"==typeof a?this.SingleDataToArrayData(parseFloat(a)):this.SingleDataToArrayData(a)),this.OutVarTable.push({Name:e,Data:a,Type:t})}}else if(u.Expression.Type==Syntax.CallExpression){let r=u.Expression;if(this.Draw.IsDrawFunction(r.Callee.Name)){let e=r.Draw;e.Name=r.Callee.Name,this.OutVarTable.push({Name:e.Name,Draw:e,Type:1})}else{let i=r.Out;a=`__temp_c_${r.Callee.Name}_${e}__`;t=0;Array.isArray(i)||(i=this.SingleDataToArrayData(i)),this.OutVarTable.push({Name:a,Data:i,Type:t,NoneName:!0})}}else if(u.Expression.Type==Syntax.Identifier){let a=u.Expression.Name,r=this.ReadVariable(a,u.Expression);t=0;r&&"object"==typeof r&&"Object"==r.__Type__?t=1e3:this.IsSectionMode||Array.isArray(r)||(r="string"==typeof r?this.SingleDataToArrayData(parseFloat(r)):this.SingleDataToArrayData(r)),a="__temp_i_"+e+"__",this.OutVarTable.push({Name:a,Data:r,Type:t,NoneName:!0})}else if(u.Expression.Type==Syntax.Literal){let r=u.Expression.Value;IFrameSplitOperator.IsString(r)&&r.indexOf("$")>0&&(r=this.SymbolData.GetOtherSymolCacheData({Literal:r})),a="__temp_li_"+e+"__";t=0;this.OutVarTable.push({Name:a,Data:r,Type:t,NoneName:!0})}else if(u.Expression.Type==Syntax.BinaryExpression){var a="__temp_b_"+e+"__";let r=u.Expression.Out;t=0;Array.isArray(r)||(r=this.SingleDataToArrayData(r)),this.OutVarTable.push({Name:a,Data:r,Type:t,NoneName:!0})}else if(u.Expression.Type==Syntax.LogicalExpression){a="__temp_l_"+e+"__";let r=u.Expression.Out;t=0;Array.isArray(r)||(r=this.SingleDataToArrayData(r)),this.OutVarTable.push({Name:a,Data:r,Type:t,NoneName:!0})}else if(u.Expression.Type==Syntax.SequenceExpression){let t,a,o,l,D=!1,h=!1,c=!1,C=!1,E=!1,m=!1,A=!0,N=!1,I=!1,S=!1;var r=!1,i=!1;for(var n in u.Expression.Expression){let s=u.Expression.Expression[n];if(s.Type==Syntax.AssignmentExpression&&":"==s.Operator&&s.Left){t=s.Left.Name;let e=this.VarTable.get(t);Array.isArray(e)||(e=this.SingleDataToArrayData(e),this.VarTable.set(t,e))}else if(s.Type==Syntax.Identifier){let a=s.Name;if("COLORSTICK"===a)D=!0;else if("POINTDOT"===a)h=!0;else if("CIRCLEDOT"===a)c=!0;else if("DOTLINE"===a)I=!0;else if("LINESTICK"===a)C=!0;else if("STICK"===a)E=!0;else if("VOLSTICK"===a)m=!0;else if("DRAWABOVE"===a)i=!0;else if(0==a.indexOf("COLOR"))o=a;else if(0==a.indexOf("LINETHICK"))l=a;else if(0==a.indexOf("NODRAW"))A=!1;else if(0==a.indexOf("EXDATA"))N=!0;else if(0==a.indexOf("LINEOVERLAY"))S=!0;else{t=s.Name;let a=this.ReadVariable(t,s);Array.isArray(a)||(a=this.SingleDataToArrayData(a)),t="__temp_si_"+e+"__",r=!0,this.VarTable.set(t,a)}}else if(s.Type==Syntax.Literal){let e=this.SingleDataToArrayData(s.Value);t=s.Value.toString(),this.VarTable.set(t,e)}else if(s.Type==Syntax.CallExpression)if(this.Draw.IsDrawFunction(s.Callee.Name))(a=s.Draw).Name=s.Callee.Name;else{let a=s.Out;t=`__temp_sc_${s.Callee.Name}_${e}__`,r=!0,this.VarTable.set(t,a)}else if(s.Type==Syntax.BinaryExpression){t="__temp_sb_"+e+"__";let a=s.Out;r=!0,this.VarTable.set(t,a)}}if(h&&t){let e=this.VarTable.get(t);Array.isArray(e)||(e=this.SingleDataToArrayData(e));let a={Name:t,Data:e,Radius:2,Type:3};o&&(a.Color=o),l&&(a.LineWidth=l),this.OutVarTable.push(a)}else if(c&&t){let e=this.VarTable.get(t);Array.isArray(e)||(e=this.SingleDataToArrayData(e));let a={Name:t,Data:e,Radius:1.3,Type:3};o&&(a.Color=o),l&&(a.LineWidth=l),this.OutVarTable.push(a)}else if(C&&t){let e={Name:t,Data:this.VarTable.get(t),Type:4};o&&(e.Color=o),l&&(e.LineWidth=l),this.OutVarTable.push(e)}else if(E&&t){let e={Name:t,Data:this.VarTable.get(t),Type:5};o&&(e.Color=o),l&&(e.LineWidth=l),this.OutVarTable.push(e)}else if(m&&t){let e={Name:t,Data:this.VarTable.get(t),Type:6};o&&(e.Color=o),this.OutVarTable.push(e)}else if(t&&o){let e=this.VarTable.get(t);Array.isArray(e)||(e=this.SingleDataToArrayData(e));let a={Name:t,Data:e,Color:o,Type:0};l&&(a.LineWidth=l),0==A&&(a.IsShow=!1),1==N&&(a.IsExData=!0),1==I&&(a.IsDotLine=!0),1==S&&(a.IsOverlayLine=!0),1==r&&(a.NoneName=!0),this.OutVarTable.push(a)}else if(a){var s={Name:a.Name,Draw:a,Type:1};o&&(s.Color=o),1==I&&(s.IsDotLine=!0),l&&(s.LineWidth=l),i&&(s.IsDrawAbove=!0),this.OutVarTable.push(s)}else if(D&&t){let e={Name:t,Data:this.VarTable.get(t),Color:o,Type:2};l&&(e.LineWidth=l),this.OutVarTable.push(e)}else if(t){let e={Name:t,Data:this.VarTable.get(t),Type:0};o&&(e.Color=o),l&&(e.LineWidth=l),0==A&&(e.IsShow=!1),1==N&&(e.IsExData=!0),1==I&&(e.IsDotLine=!0),1==S&&(e.IsOverlayLine=!0),this.OutVarTable.push(e)}}}return JSConsole.Complier.Log("[JSExecute::Run]",this.VarTable),this.OutVarTable},this.Run=function(){try{let e=this.RunAST();JSConsole.Complier.Log("[JSComplier.Run] execute finish",e),this.UpdateUICallback&&(JSConsole.Complier.Log("[JSComplier.Run] invoke UpdateUICallback."),this.CallbackParam&&this.CallbackParam.Job&&this.CallbackParam.Job.ID==JS_EXECUTE_JOB_ID.JOB_EXECUTE_INDEX?this.UpdateUICallback(e,this.CallbackParam,this.SymbolData):(this.CallbackParam&&this.CallbackParam.Self&&"ScriptIndexConsole"===this.CallbackParam.Self.ClassName&&(this.CallbackParam.JSExecute=this),this.UpdateUICallback(e,this.CallbackParam)))}catch(e){JSConsole.Complier.Log(e),e.Job?(JSConsole.Complier.Log("[JSComplier.Run] download job and reexectue",e.Job),this.JobList.push(e.Job),this.JobList.push({ID:JS_EXECUTE_JOB_ID.JOB_RUN_SCRIPT}),this.Execute()):this.ErrorCallback&&this.ErrorCallback(e,this.CallbackParam)}},this.VisitNode=function(e){switch(e.Type){case Syntax.SequenceExpression:this.VisitSequenceExpression(e);break;case Syntax.ExpressionStatement:this.VisitNode(e.Expression);break;case Syntax.AssignmentExpression:this.VisitAssignmentExpression(e);break;case Syntax.BinaryExpression:case Syntax.LogicalExpression:this.VisitBinaryExpression(e);break;case Syntax.CallExpression:this.VisitCallExpression(e)}},this.VisitSequenceExpression=function(e){for(var t in e.Expression){let a=e.Expression[t];this.VisitNode(a)}},this.VisitCallExpression=function(e){let t=e.Callee.Name,a=[];for(var r in e.Arguments){let t,i=e.Arguments[r];t=i.Type==Syntax.BinaryExpression||i.Type==Syntax.LogicalExpression?this.VisitBinaryExpression(i):i.Type==Syntax.CallExpression?this.VisitCallExpression(i):this.GetNodeValue(i),a.push(t)}if(g_JSComplierResource.IsCustomFunction(t)){var i=this.Algorithm.CallCustomFunction(t,a,this.SymbolData,e);return e.Out=[],e.Draw=null,i&&(i.Out&&(e.Out=i.Out),i.Draw&&(e.Draw=i.Draw)),e.Out}switch(t){case"DYNAINFO":e.Out=this.SymbolData.GetLatestCacheData(a[0]);break;case"STICKLINE":e.Draw=this.Draw.STICKLINE(a[0],a[1],a[2],a[3],a[4]),e.Out=[];break;case"DRAWTEXT":e.Draw=this.Draw.DRAWTEXT(a[0],a[1],a[2]),e.Out=[];break;case"DRAWTEXT_FIX":e.Draw=this.Draw.DRAWTEXT_FIX(a[0],a[1],a[2],a[3],a[4]),e.Out=[];break;case"SUPERDRAWTEXT":e.Draw=this.Draw.SUPERDRAWTEXT(a[0],a[1],a[2],a[3],a[4]),e.Out=[];break;case"DRAWICON":e.Draw=this.Draw.DRAWICON(a[0],a[1],a[2]),e.Out=[];break;case"DRAWLINE":e.Draw=this.Draw.DRAWLINE(a[0],a[1],a[2],a[3],a[4]),e.Out=e.Draw.DrawData;break;case"DRAWBAND":e.Draw=this.Draw.DRAWBAND(a[0],a[1],a[2],a[3]),e.Out=[];break;case"FILLRGN":a.length>=4?e.Draw=this.Draw.FILLRGN2(a):e.Draw=this.Draw.FILLRGN(a[0],a[1],a[2]),e.Out=[];break;case"FLOATRGN":e.Draw=this.Draw.FLOATRGN(a),e.Out=[];break;case"FILLTOPRGN":e.Draw=this.Draw.FILLBGRGN(1,a),e.Out=[];break;case"FILLBOTTOMRGN":e.Draw=this.Draw.FILLBGRGN(0,a),e.Out=[];break;case"FILLVERTICALRGN":e.Draw=this.Draw.FILLVERTICALRGN(a),e.Out=[];break;case"DRAWKLINE":e.Draw=this.Draw.DRAWKLINE(a[0],a[1],a[2],a[3]),e.Out=[];break;case"DRAWKLINE_IF":e.Draw=this.Draw.DRAWKLINE_IF(a[0],a[1],a[2],a[3],a[4]),e.Out=[];break;case"PLOYLINE":case"POLYLINE":e.Draw=this.Draw.POLYLINE(a[0],a[1]),e.Out=e.Draw.DrawData;break;case"DRAWNUMBER":e.Draw=this.Draw.DRAWNUMBER(a[0],a[1],a[2]),e.Out=e.Draw.DrawData.Value;break;case"DRAWNUMBER_FIX":e.Draw=this.Draw.DRAWNUMBER_FIX(a[0],a[1],a[2],a[3],a[4]),e.Out=e.Draw.DrawData.Value;break;case"DRAWCHANNEL":e.Draw=this.Draw.DRAWCHANNEL(a[0],a[1],a[2],a[3],a[4],a[5],a[6]),e.Out=[];break;case"RGB":e.Out=this.Draw.RGB(a[0],a[1],a[2]);break;case"RGBA":e.Out=this.Draw.RGBA(a[0],a[1],a[2],a[3]);break;case"PARTLINE":e.Draw=this.Draw.PARTLINE(a),e.Out=[];break;case"DRAWGBK":e.Draw=this.Draw.DRAWGBK(a[0],a[1],a[2],a[3]),e.Out=[];break;case"DRAWGBK2":e.Draw=this.Draw.DRAWGBK2(a[0],a[1],a[2],a[3]),e.Out=[];break;case"DRAWTEXT_LINE":e.Draw=this.Draw.DRAWTEXT_LINE(a[0],a[1],a[2],a[3],a[4],a[5],a[6]),e.Out=[];break;case"DRAWRECTREL":e.Draw=this.Draw.DRAWRECTREL(a[0],a[1],a[2],a[3],a[4]),e.Out=[];break;case"DRAWOVERLAYLINE":e.Draw=this.Draw.DRAWOVERLAYLINE(a[0],a[1],a[2]),e.Out=e.Draw.DrawData.Data;break;case"DRAWSL":e.Draw=this.Draw.DRAWSL(a[0],a[1],a[2],a[3],a[4]),e.Out=[];break;case"CODELIKE":e.Out=this.SymbolData.CODELIKE(a[0]);break;case"NAMELIKE":case"NAMEINCLUDE":e.Out=this.SymbolData.NAMELIKE(a[1]);break;case"REFDATE":e.Out=this.SymbolData.REFDATE(a[0],a[1]);break;case"FINANCE":case"FINVALUE":e.Out=this.SymbolData.GetStockCacheData({FunctionName:t,Args:a,ArgCount:1,Node:e});break;case"FINONE":case"GPJYVALUE":e.Out=this.SymbolData.GetStockCacheData({FunctionName:t,Args:a,ArgCount:3,Node:e});break;case"MARGIN":e.Out=this.SymbolData.GetMarginCacheData(a[0],e);break;case"HK2SHSZ":e.Out=this.SymbolData.GetHKToSHSZCacheData(a[0],e);break;case"NEWS":e.Out=this.SymbolData.GetNewsAnalysisCacheData(a[0],e);break;case"UPCOUNT":case"DOWNCOUNT":e.Out=this.SymbolData.GetIndexIncreaseCacheData(t,a[0],e);break;case"SF":e.Out=this.SymbolData.GetSectionFinanceCacheData(a[0],a[1],a[2],e);break;case"LOADAPIDATA":e.Out=this.SymbolData.GetCustomApiData(a);break;case"STKINDI":e.Out=this.SymbolData.GetScriptIndexOutData(a,e);break;case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":e.Out=this.SymbolData.GetOtherSymolCacheData({FunctionName:t,Args:a});break;case"COVER_C":case"COVER_O":case"COVER_H":case"COVER_L":case"COVER_A":case"COVER_V":return 2==a.length?this.SymbolData.GetSymbolPeriodCacheData2(JSComplierHelper.GetConvertValueName(t),a[0],a[1]):this.SymbolData.GetSymbolPeriodCacheData(JSComplierHelper.GetConvertValueName(t),a[0]);default:return this.Algorithm.CallFunction(t,a,e,this.SymbolData)}return e.Out},this.VisitAssignmentExpression=function(e){let t=e.Left;t.Type!=Syntax.Identifier&&this.ThrowUnexpectedNode(e);let a=t.Name,r=e.Right,i=null;if(r.Type==Syntax.BinaryExpression||r.Type==Syntax.LogicalExpression)i=this.VisitBinaryExpression(r);else if(r.Type==Syntax.CallExpression)i=this.VisitCallExpression(r);else if(r.Type==Syntax.Literal)i=r.Value,IFrameSplitOperator.IsString(i)&&r.Value.indexOf("$")>0&&(i=this.SymbolData.GetOtherSymolCacheData({Literal:i}));else if(r.Type==Syntax.Identifier)i=this.ReadVariable(r.Name,r);else if(r.Type==Syntax.MemberExpression)i=this.ReadMemberVariable(r);else if(r.Type==Syntax.UnaryExpression)if("-"==r.Operator){var n=this.GetNodeValue(r.Argument);i=this.Algorithm.Subtract(0,n)}else i=r.Argument.Value;JS_EXECUTE_DEBUG_LOG&&JSConsole.Complier.Log("[JSExecute::VisitAssignmentExpression]",a," = ",i),this.VarTable.set(a,i)},this.VisitBinaryExpression=function(e){let t=[];t.push(e);let a=null;for(;0!=t.length;)if((a=t[t.length-1]).Left&&e!=a.Left&&e!=a.Right)t.push(a.Left);else if(a.Right&&e!=a.Right)t.push(a.Right);else{let r=t.pop();if(r.Type==Syntax.BinaryExpression){let e=this.GetNodeValue(r.Left),t=this.GetNodeValue(r.Right);switch(JS_EXECUTE_DEBUG_LOG&&JSConsole.Complier.Log("[JSExecute::VisitBinaryExpression] BinaryExpression",r,e,t),r.Out=null,r.Operator){case"-":r.Out=this.Algorithm.Subtract(e,t);break;case"*":r.Out=this.Algorithm.Multiply(e,t);break;case"/":r.Out=this.Algorithm.Divide(e,t);break;case"+":r.Out=this.Algorithm.Add(e,t);break;case">":r.Out=this.Algorithm.GT(e,t);break;case">=":r.Out=this.Algorithm.GTE(e,t);break;case"<":r.Out=this.Algorithm.LT(e,t);break;case"<=":r.Out=this.Algorithm.LTE(e,t);break;case"==":case"=":r.Out=this.Algorithm.EQ(e,t);break;case"!=":case"<>":r.Out=this.Algorithm.NEQ(e,t)}JS_EXECUTE_DEBUG_LOG&&JSConsole.Complier.Log("[JSExecute::VisitBinaryExpression] BinaryExpression",r)}else if(r.Type==Syntax.LogicalExpression){let e=this.GetNodeValue(r.Left),t=this.GetNodeValue(r.Right);switch(JS_EXECUTE_DEBUG_LOG&&JSConsole.Complier.Log("[JSExecute::VisitBinaryExpression] LogicalExpression",r,e,t),r.Out=null,r.Operator){case"&&":case"AND":r.Out=this.Algorithm.And(e,t);break;case"||":case"OR":r.Out=this.Algorithm.Or(e,t)}JS_EXECUTE_DEBUG_LOG&&JSConsole.Complier.Log("[JSExecute::VisitBinaryExpression] LogicalExpression",r)}e=a}return e.Out},this.GetNodeValue=function(e){switch(e.Type){case Syntax.Literal:return e.Value;case Syntax.UnaryExpression:if("-"==e.Operator){let t=this.GetNodeValue(e.Argument);return this.Algorithm.Subtract(0,t)}return e.Argument.Value;case Syntax.Identifier:return this.ReadVariable(e.Name,e);case Syntax.BinaryExpression:case Syntax.LogicalExpression:return e.Out;case Syntax.CallExpression:return this.VisitCallExpression(e);default:this.ThrowUnexpectedNode(e)}},this.ThrowUnexpectedNode=function(e,t,a){let r=e.Marker,i=t||"执行异常";return this.ErrorHandler.ThrowError(r.Index,r.Line,r.Column,i,a)},this.ThrowDownloadSF=function(e,t,a){let r=e.Marker,i=a;return this.ErrorHandler.ThrowDownloadJob(r.Index,r.Line,r.Column,i,t)},this.ThrowError=function(){}}function JSExplainer(e,t){this.AST=e,this.ErrorHandler=new ErrorHandler,this.ErrorCallback,this.UpdateUICallback,this.CallbackParam,this.JobList=[],this.VarTable=new Map,this.OutVarTable=[],this.ConstVarTable=new Map([["CLOSE","收盘价"],["VOL","成交量"],["OPEN","开盘价"],["HIGH","最高价"],["LOW","最低价"],["AMOUNT","成交量"],["C","收盘价"],["V","成交量"],["O","开盘价"],["H","最高价"],["L","最低价"],["AMO","成交量"],["VOLR","量比"],["VOLINSTK","持仓量"],["ZSTJJ","均价"],["DATE","日期"],["YEAR","年份"],["MONTH","月份"],["PERIOD","周期"],["WEEK","星期"],["TIME","时间"],["INDEXA","大盘成交额"],["INDEXC","大盘收盘价"],["INDEXH","大盘最高价"],["INDEXL","大盘最低价"],["INDEXO","大盘开盘价"],["INDEXV","大盘成交量"],["INDEXADV","大盘上涨家数"],["INDEXDEC","´大盘下跌家数"],["ADVANCE","上涨家数"],["DECLINE","下跌家数"],["FROMOPEN","当前离开盘分钟数"],["TOTALFZNUM","总分钟数"],["CURRBARSCOUNT","到最后交易的周期"],["TOTALBARSCOUNT","总的周期数"],["ISLASTBAR","是否是最后一个周期"],["BARSTATUS","数据位置状态"],["CAPITAL","当前流通股本(手)"],["TOTALCAPITAL","当前总股本(手)"],["EXCHANGE","换手率"],["SETCODE","市场类型"],["CODE","品种代码"],["STKNAME","品种名称"],["TQFLAG","当前复权状态"],["HYBLOCK","所属行业(字串)"],["DYBLOCK","所属地域(字串)"],["GNBLOCK","所属概念(字串)"],["DRAWNULL","无效数据"]]),t&&(t.Callback&&(this.UpdateUICallback=t.Callback),t.CallbackParam&&(this.CallbackParam=t.CallbackParam),t.Arguments&&(this.Arguments=t.Arguments)),this.Run=function(){try{let e=this.RunAST();JSConsole.Complier.Log("[JSExplainer.Run] explain finish",e),this.UpdateUICallback&&(JSConsole.Complier.Log("[JSExplainer.Run] invoke UpdateUICallback."),this.UpdateUICallback(e))}catch(e){JSConsole.Complier.Log("[JSExplainer.Run] throw error ",e),this.ErrorCallback&&this.ErrorCallback(e,this.OutVarTable)}},this.RunAST=function(){for(var e in this.AST||this.ThrowError(),this.AST.Body||this.ThrowError(),this.AST.Body){let o=this.AST.Body[e];if(this.VisitNode(o),o.Type==Syntax.ExpressionStatement&&o.Expression)if(o.Expression.Type==Syntax.AssignmentExpression){if(":"==o.Expression.Operator&&o.Expression.Left){let e=o.Expression.Left.Name,t=`输出${e}: ${this.VarTable.get(e)}`;this.OutVarTable.push({Name:e,Data:t,Type:0})}else if(":="==o.Expression.Operator&&o.Expression.Left){let e=o.Expression.Left.Name,t=`赋值${e}: ${this.VarTable.get(e)}`;this.OutVarTable.push({Name:e,Data:t,Type:0,IsOut:!1})}}else if(o.Expression.Type==Syntax.CallExpression){let r=o.Expression;if(this.IsDrawFunction(r.Callee.Name)){let e=r.Out;var t=r.Callee.Name;this.OutVarTable.push({Name:t,Draw:`输出: ${e}`,Type:1})}else{let t=r.Out;a=`__temp_c_${r.Callee.Name}_${e}__`,this.OutVarTable.push({Name:a,Data:`输出: ${t}`,Type:0,NoneName:!0})}}else if(o.Expression.Type==Syntax.Identifier){let t=o.Expression.Name,a=this.ReadVariable(t,o.Expression);t="__temp_i_"+e+"__",this.OutVarTable.push({Name:t,Data:`输出: ${a}`,Type:0,NoneName:!0})}else if(o.Expression.Type==Syntax.Literal){let t=o.Expression.Value;IFrameSplitOperator.IsString(t)&&t.indexOf("$")>0&&(t=this.GetOtherSymbolExplain({Literal:t},o)),a="__temp_li_"+e+"__";this.OutVarTable.push({Name:a,Data:`输出: ${t}`,Type:0,NoneName:!0})}else if(o.Expression.Type==Syntax.BinaryExpression){var a="__temp_b_"+e+"__";let t=o.Expression.Out;this.OutVarTable.push({Name:a,Data:`输出: ${t}`,Type:0,NoneName:!0})}else if(o.Expression.Type==Syntax.LogicalExpression){a="__temp_l_"+e+"__";let t=o.Expression.Out;this.OutVarTable.push({Name:a,Data:`输出: ${t}`,Type:0,NoneName:!0})}else if(o.Expression.Type==Syntax.SequenceExpression){let t,a,l,D,h,c=!1,C=!1,E=!1,m=!1,A=!1,N=!1,I=!0,S=!1,f=!1,O=!1;var r,i=!1,n=!1;for(var s in o.Expression.Expression){let r=o.Expression.Expression[s];if(r.Type==Syntax.AssignmentExpression&&":"==r.Operator&&r.Left){t=r.Left.Name;let e=this.VarTable.get(t);this.VarTable.set(t,e)}else if(r.Type==Syntax.Identifier){let a=r.Name;if("COLORSTICK"===a)c=!0;else if("POINTDOT"===a)C=!0;else if("CIRCLEDOT"===a)E=!0;else if("DOTLINE"===a)f=!0;else if("LINESTICK"===a)m=!0;else if("STICK"===a)A=!0;else if("VOLSTICK"===a)N=!0;else if("DRAWABOVE"===a)n=!0;else if(0==a.indexOf("COLOR"))D=a;else if(0==a.indexOf("LINETHICK"))h=a;else if(0==a.indexOf("NODRAW"))I=!1;else if(0==a.indexOf("EXDATA"))S=!0;else if(0==a.indexOf("LINEOVERLAY"))O=!0;else{t=r.Name;let a=this.ReadVariable(t,r);t="__temp_si_"+e+"__",i=!0,this.VarTable.set(t,a)}}else if(r.Type==Syntax.Literal){let e=r.Value;t=r.Value.toString(),i=!0,this.VarTable.set(t,e)}else if(r.Type==Syntax.CallExpression)if(this.IsDrawFunction(r.Callee.Name))l=r.Out,a=r.Callee.Name;else{let a=r.Out;t=`__temp_sc_${r.Callee.Name}_${e}__`,i=!0,this.VarTable.set(t,a)}else if(r.Type==Syntax.BinaryExpression){t="__temp_sb_"+e+"__";let a=r.Out;i=!0,this.VarTable.set(t,a)}}if(r=l?`输出: ${l}`:i?`输出: ${this.VarTable.get(t)}`:`输出${t}: ${this.VarTable.get(t)}`,D&&(r+=`,颜色${this.GetColorExplain(D)}`),h&&(r+=`,线段粗细${this.GetLineWidthExplain(h)}`),0==I&&(r+=",不显示"),1==f&&(r+=",画虚线"),1==n&&(r+=",显示在位置之上"),C&&t){let e={Name:t,Data:r+=",画小圆点线",Radius:2,Type:3};this.OutVarTable.push(e)}else if(E&&t){let e={Name:t,Data:r+=",画小圆圈线",Radius:1.3,Type:3};this.OutVarTable.push(e)}else if(m&&t){let e={Name:t,Data:r+=",画出柱状线和指标线",Type:4};this.OutVarTable.push(e)}else if(A&&t){let e={Name:t,Data:r+=",画柱状线",Type:5};this.OutVarTable.push(e)}else if(N&&t){let e={Name:t,Data:r+=",画成交量柱状线",Type:6};this.OutVarTable.push(e)}else if(t&&D){let e={Name:t,Data:r,Color:D,Type:0};this.OutVarTable.push(e)}else if(l){var u={Name:a,Data:r,Type:1};this.OutVarTable.push(u)}else if(c&&t){let e={Name:t,Data:r+=",画彩色柱状线",Color:D,Type:2};this.OutVarTable.push(e)}else if(t){let e={Name:t,Data:r,Type:0};this.OutVarTable.push(e)}}}return JSConsole.Complier.Log("[JSExplainer::Run]",this.VarTable),this.OutVarTable},this.VisitNode=function(e){switch(e.Type){case Syntax.SequenceExpression:this.VisitSequenceExpression(e);break;case Syntax.ExpressionStatement:this.VisitNode(e.Expression);break;case Syntax.AssignmentExpression:this.VisitAssignmentExpression(e);break;case Syntax.BinaryExpression:case Syntax.LogicalExpression:this.VisitBinaryExpression(e);break;case Syntax.CallExpression:this.VisitCallExpression(e)}},this.VisitSequenceExpression=function(e){for(var t in e.Expression){let a=e.Expression[t];this.VisitNode(a)}},this.VisitCallExpression=function(e){let t=e.Callee.Name,a=[];for(var r in e.Arguments){let t,i=e.Arguments[r];t=i.Type==Syntax.BinaryExpression||i.Type==Syntax.LogicalExpression?this.VisitBinaryExpression(i):i.Type==Syntax.CallExpression?this.VisitCallExpression(i):this.GetNodeValue(i),a.push(t)}if(JSConsole.Complier.Log("[JSExplainer::VisitCallExpression]",t,"(",a.toString(),")"),g_JSComplierResource.IsCustomFunction(t)){var i=this.Algorithm.CallCustomFunction(t,a,this.SymbolData,e);return e.Out=[],e.Draw=null,i&&(i.Out&&(e.Out=i.Out),i.Draw&&(e.Draw=i.Draw)),e.Out}return e.Out=this.CallFunctionExplain(t,a,e),e.Out},this.CallFunctionExplain=function(e,t,a){switch(e){case"REF":return`${t[1]}日前的${t[0]}`;case"REFX":return`${t[1]}日后的${t[0]}`;case"REFV":return`${t[1]}日前的(未作平滑处理)${t[0]}`;case"REFXV":return`${t[1]}日后的(未作平滑处理)${t[0]}`;case"REFDATE":return`${t[1]}日${t[0]}`;case"COUNT":return`统计${t[1]}日中满足${t[0]}的天数`;case"BARSLASTCOUNT":return`条件${t[0]}连续成立次数`;case"BARSCOUNT":return`${t[0]}有效数据周期数`;case"BARSLAST":return`上次${t[0]}不为0距今天数`;case"BARSNEXT":return`下次${t[0]}不为0距今天数`;case"BARSSINCEN":return`在${t[1]}周期内首次${t[0]}距今天数`;case"BARSSINCE":return`首次${t[0]}距今天数`;case"HHV":return`${t[1]}日内${t[0]}的最高值`;case"LLV":return`${t[1]}日内${t[0]}的最低值`;case"HHVBARS":return 0==arg[1]?`历史${t[0]}新高距今天数`:`${t[1]}日内${t[0]}新高距今天数`;case"LLVBARS":return 0==arg[1]?`历史${t[0]}新低距今天数`:`${t[1]}日内${t[0]}新低距今天数`;case"HOD":return`${t[1]}日内${t[0]}的高值名次`;case"LOD":return`${t[1]}日内${t[0]}的低值名次`;case"REVERSE":return`${t[0]}的相反数`;case"CALCSTOCKINDEX":return`引用${t[0]}的${t[1]}指标第${t[2]}个输出值`;case"FILTER":return`${t[0]}的${t[1]}日过滤`;case"FILTERX":return`${t[0]}的${t[1]}日反向过滤`;case"SUMBARS":return`${t[0]}累加至${t[1]}的天数`;case"MA":return`${t[0]}的${t[1]}日简单移动平均`;case"SMA":return`${t[0]}的${t[1]}日[${t[2]}日权重]移动平均`;case"MEMA":return`${t[0]}的${t[1]}日平滑移动平均`;case"EMA":case"EXPMA":return`${t[0]}的${t[1]}日指数移动平均`;case"EXPMEMA":return`${t[0]}的${t[1]}日指数平滑移动平均`;case"WMA":return`${t[0]}的${t[1]}日加权移动平均`;case"DMA":return`以${t[1]}为权重${t[0]}的动态移动平均`;case"XMA":return`${t[0]}的${t[1]}日偏移移动平均`;case"RANGE":return`${t[0]}位于${t[1]}和${t[2]}之间`;case"CONST":return`${t[0]}的最后一日值`;case"TOPRANGE":return`当前值是近${t[0]}周期的最大值`;case"LOWRANGE":return`当前值是近${t[0]}周期的最小值`;case"FINDHIGH":return`${t[0]}在${t[1]}日前的${t[2]}天内第${t[3]}个最高价`;case"FINDHIGHBARS":return`${t[0]}在${t[1]}日前的${t[2]}天内第${t[3]}个最高价到当前周期的周期数`;case"FINDLOW":return`${t[0]}在${t[1]}日前的${t[2]}天内第${t[3]}个最低价`;case"FINDLOWBARS":return`${t[0]}在${t[1]}日前的${t[2]}天内第${t[3]}个最低价到当前周期的周期数`;case"SUM":return`${t[0]}${t[1]}日累加`;case"MULAR":return`${t[0]}和${t[1]}日累乘`;case"AMA":return`以${t[1]}为权重${t[0]}的自适应均线`;case"TMA":return`${t[0]}的${t[1]}日[${t[2]}日权重]移动平均`;case"CROSS":return`${t[0]}上穿${t[1]}`;case"LONGCROSS":return`${t[0]}小于${t[1]}保持${t[2]}个交易日后交叉上穿`;case"UPNDAY":return`最近${t[1]}日${t[0]}连涨`;case"DOWNNDAY":return`最近${t[1]}日${t[0]}连跌`;case"NDAY":return`最近${t[2]}日${t[0]}一直大于${t[1]}`;case"EXIST":return`最近${t[1]}日存在${t[0]}`;case"EXISTR":return`从前${t[1]}日到前${t[2]}日存在${t[0]}`;case"EVERY":return`最近${t[1]}日一直存在${t[0]}`;case"LAST":return`从前${t[1]}日到前${t[2]}日持续${t[0]}`;case"NOT":return`${t[0]}取反`;case"IF":case"IFF":case"IFN":return`如果${t[0]},返回${t[1]},否则返回${t[2]}`;case"MAX":return`${t[0]}和${t[1]}的较大值`;case"MIN":return`${t[0]}和${t[1]}的较小值`;case"ACOS":return`${t[0]}的反余弦`;case"ASIN":return`${t[0]}的反正弦`;case"ATAN":return`${t[0]}的反正切`;case"COS":return`${t[0]}的余弦`;case"SIN":return`${t[0]}的正弦`;case"TAN":return`${t[0]}的正切`;case"EXP":return`${t[0]}的指数`;case"LN":return`${t[0]}的自然对数`;case"LOG":return`${t[0]}的对数`;case"SQRT":return`${t[0]}的开方`;case"ABS":return`${t[0]}的绝对值`;case"POW":return`${t[0]}的${t[1]}乘幂`;case"CEILING":return`${t[0]}的向上舍入`;case"FLOOR":return`${t[0]}的向下舍入`;case"INTPART":return`${t[0]}的整数部分`;case"BETWEEN":return`${t[0]}位于${t[1]}和${t[2]}之间`;case"FRACPART":return`${t[0]}的小数部分`;case"ROUND":case"ROUND2":return`对${t[0]}(进行)四舍五入`;case"SIGN":return`${t[0]}的符号`;case"MOD":return`${t[0]}关于${t[1]}的模`;case"RAND":return"随机正整数";case"AVEDEV":return`${t[0]}的${t[1]}日平均绝对偏差`;case"DEVSQ":return`${t[0]}的${t[1]}日数据偏差平方和`;case"FORCAST":return`${t[0]}的${t[1]}日线性回归预测值`;case"SLOPE":return`${t[0]}的${t[1]}日线性回归斜率`;case"STD":return`${t[0]}的${t[1]}日估算标准差`;case"STDP":return`${t[0]}的${t[1]}日总体标准差`;case"STDDEV":return`${t[0]}的${t[1]}日标准偏差`;case"VAR":return`${t[0]}的${t[1]}日估算样本方差`;case"VARP":return`${t[0]}的${t[1]}日总体样本方差`;case"COVAR":return`${t[0]}和${t[1]}的${t[2]}周期的协方差`;case"RELATE":return`${t[0]}和${t[1]}的${t[0]}周期的相关系数`;case"BETA":return"β(Beta)系数";case"BETAEX":return`${t[0]}和${t[1]}的${t[2]}周期的相关放大系数`;case"COST":return`获利盘为${t[0]}%的成本分布`;case"WINNER":return`以${t[0]}计算的获利盘比例`;case"LWINNER":return`最近${t[0]}日那部分成本以${t[1]}价格卖出的获利盘比例`;case"PWINNER":return`${t[0]}日前那部分成本以${t[1]}价格卖出的获利盘比例`;case"COSTEX":return`位于价格${t[0]}和${t[1]}间的成本`;case"PPART":return`${t[0]}日前那部分成本占总成本的比例`;case"PEAK":case"PEAKBARS":case"ZIG":case"ZIGA":case"TROUGH":case"TROUGHBARS":return this.GetZIGExplain(e,t);case"SAR":return`步长为${t[1]}极限值为${t[0]}的${t[2]}日抛物转向`;case"SARTURN":return`步长为${t[1]}极限值为${t[0]}的${t[2]}日抛物转向点`;case"FINANCE":return this.GetFinanceExplain(t);case"DYNAINFO":return this.GetDynainfoExplain(t);case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":return this.GetOtherSymbolExplain({FunctionName:e,Args:t},a);case"PLOYLINE":return`当满足条件${t[0]}时以${t[1]}位置为顶点画折线连接`;case"DRAWLINE":return`当满足条件${t[0]}时,在${t[1]}位置画直线起点，当满足条件${t[2]}时,在${t[3]}位置画直线终点,${t[4]}表示是否延长`;case"DRAWSL":return`当满足条件${t[0]}时,在${t[1]}位置画斜线线性回归,${t[2]}斜率,${t[3]}长度,${t[4]}方向`;case"DRAWKLINE":return"K线";case"DRAWICON":return`当满足条件${t[0]}时,在${t[1]}位置画${t[2]}号图标`;case"DRAWTEXT":return`当满足条件${t[0]}时,在${t[1]}位置书写文字`;case"DRAWTEXT_FIX":return`当满足条件${t[0]}时,在横轴${t[1]}纵轴${t[2]}位置书写文字`;case"DRAWNUMBER":return`当满足条件${t[0]}时,在${t[1]}位置书写数字`;case"DRAWNUMBER_FIX":return`当满足条件${t[0]}时,在横轴${t[1]}纵轴${t[2]}位置书写数字`;case"RGB":return`自定色[${t[0]},${t[1]},${t[2]}]`;case"DRAWBAND":return"画带状线"}},this.GetDynainfoExplain=function(e){const t=new Map([[3,"前收盘价"],[4,"开盘价"],[5,"最高价"],[6,"最低价"],[7,"现价"],[8,"总量"],[9,"现量"],[10,"总金额"],[11,"均价"],[12,"日涨跌"],[13,"振幅"],[14,"涨幅"],[15,"开盘时的成交金额"],[16,"前5日每分钟均量"],[17,"量比"],[18,"上涨家数"],[19,"下跌家数"]]);var a=e[0];return t.has(a)?t.get(a):`即时行情[${a}]`},this.GetFinanceExplain=function(e){const t=new Map([[1,"总股本"],[2,"市场类型"],[3,"沪深品种类型"],[4,"沪深行业代码"],[5,"B股"],[6,"H股"],[7,"流通股本[股]"],[8,"股东人数[户]"],[9,"资产负债率%"],[10,"总资产"],[11,"流动资产"],[12,"固定资产"],[13,"无形资产"],[15,"流动负债"],[16,"少数股东权益"]]);var a=e[0];return t.has(a)?t.get(a):`财务数据[${a}]`},this.GetZIGExplain=function(e,t){var a=t[0];switch(0==a?a="开盘价":1==a?a="最高价":2==a?a="最低价":3==a&&(a="收盘价"),e){case"PEAK":return`${a}的${t[1]}%之字转向的前${t[2]}个波峰值`;case"PEAKBARS":return`${a}的${t[1]}5%之字转向的前${t[2]}个波峰位置`;case"ZIG":return`${a}的${t[1]}的之字转向`;case"ZIGA":return`${a}变化${t[1]}的之字转向`;case"TROUGH":return`${a}的${t[1]}%之字转向的前${t[2]}个波谷值`;case"TROUGHBARS":return`${a}的${t[1]}%之字转向的前${t[2]}个波谷位置`}},this.GetColorExplain=function(e){const t=new Map([["COLORBLACK","黑色"],["COLORBLUE","蓝色"],["COLORGREEN","绿色"],["COLORCYAN","青色"],["COLORRED","红色"],["COLORMAGENTA","洋红色"],["COLORBROWN","棕色"],["COLORLIGRAY","淡灰色"],["COLORGRAY","深灰色"],["COLORLIBLUE","淡蓝色"],["COLORLIGREEN","淡绿色"],["COLORLICYAN","淡青色"],["COLORLIRED","淡红色"],["COLORLIMAGENTA","淡洋红色"],["COLORWHITE","白色"],["COLORYELLOW","黄色"]]);return t.has(e)?t.get(e):0==e.indexOf("COLOR")?"#"+e.substr(5):"rgb(30,144,255)"},this.GetLineWidthExplain=function(e){var t=parseInt(e.replace("LINETHICK",""));return IFrameSplitOperator.IsPlusNumber(t)?t:1},this.SymbolPeriodExplain=function(e,t){const a=new Map([["CLOSE","收盘价"],["C","收盘价"],["VOL","成交量"],["V","成交量"],["OPEN","开盘价"],["O","开盘价"],["HIGH","最高价"],["H","最高价"],["LOW","最低价"],["L","最低价"],["AMOUNT","成交金额"],["AMO","成交金额"],["VOLINSTK","持仓量"]]),r=new Map([["MIN1","1分钟"],["MIN5","5分钟"],["MIN15","15分钟"],["MIN30","30分钟"],["MIN60","60分钟"],["DAY","日"],["WEEK","周"],["MONTH","月"],["SEASON","季"],["YEAR","年"]]);var i=e;a.has(e)&&(i=a.get(e));var n=t;return r.has(t)&&(n=r.get(t)),`${i}[取${n}数据]`},this.GetOtherSymbolExplain=function(e,t){const a=new Map([["CLOSE","收盘价"],["C","收盘价"],["VOL","成交量"],["V","成交量"],["OPEN","开盘价"],["O","开盘价"],["HIGH","最高价"],["H","最高价"],["LOW","最低价"],["L","最低价"],["AMOUNT","成交金额"],["AMO","成交金额"],["VOLINSTK","持仓量"]]);if(e.FunctionName){var r=e.Args,i=a.get(e.FunctionName);return`[${r[0]}]${i}`}if(e.Literal){r=e.Literal.toUpperCase().split("$");return a.has(r[1])?`[${r[0]}]${i=a.get(r[1])}`:""}},this.IsDrawFunction=function(e){return!!new Set(["STICKLINE","DRAWTEXT","SUPERDRAWTEXT","DRAWLINE","DRAWBAND","DRAWKLINE","DRAWKLINE_IF","PLOYLINE","POLYLINE","DRAWNUMBER","DRAWNUMBER_FIX","DRAWICON","DRAWCHANNEL","PARTLINE","DRAWTEXT_FIX","DRAWGBK","DRAWTEXT_LINE","DRAWRECTREL","DRAWOVERLAYLINE","FILLRGN","FILLRGN2","FILLTOPRGN","FILLBOTTOMRGN","FILLVERTICALRGN","FLOATRGN","DRAWSL","DRAWGBK2"]).has(e)},this.VisitAssignmentExpression=function(e){let t=e.Left;t.Type!=Syntax.Identifier&&this.ThrowUnexpectedNode(e);let a=t.Name,r=e.Right,i=null;if(r.Type==Syntax.BinaryExpression||r.Type==Syntax.LogicalExpression)i=this.VisitBinaryExpression(r);else if(r.Type==Syntax.CallExpression)i=this.VisitCallExpression(r);else if(r.Type==Syntax.Literal)i=r.Value,IFrameSplitOperator.IsString(i)&&r.Value.indexOf("$")>0&&(i=this.GetOtherSymbolExplain({Literal:i},e));else if(r.Type==Syntax.Identifier)i=this.ReadVariable(r.Name,r);else if(r.Type==Syntax.MemberExpression)i=this.ReadMemberVariable(r);else if(r.Type==Syntax.UnaryExpression){if("-"==r.Operator)i="-"+this.GetNodeValue(r.Argument);else i=r.Argument.Value}JSConsole.Complier.Log("[JSExplainer::VisitAssignmentExpression]",a," = ",i),this.VarTable.set(a,i)},this.VisitBinaryExpression=function(e){let t=[];t.push(e);let a=null;for(;0!=t.length;)if((a=t[t.length-1]).Left&&e!=a.Left&&e!=a.Right)t.push(a.Left);else if(a.Right&&e!=a.Right)t.push(a.Right);else{let r=t.pop();if(r.Type==Syntax.BinaryExpression){let e=this.GetNodeValue(r.Left),t=this.GetNodeValue(r.Right);JSConsole.Complier.Log("[JSExplainer::VisitBinaryExpression] BinaryExpression",r,e,t),r.Out=null,r.Out=`(${e} ${r.Operator} ${t})`,"收盘价"==e&&"开盘价"==t?">"==r.Operator?r.Out="(收阳线)":"<"==r.Operator?r.Out="(收阴线)":"="==r.Operator&&(r.Out="(平盘)"):"开盘价"==e&&"收盘价"==t&&("<"==r.Operator?r.Out="(收阳线)":">"==r.Operator?r.Out="(收阴线)":"="==r.Operator&&(r.Out="(平盘)")),JSConsole.Complier.Log("[JSExplainer::VisitBinaryExpression] BinaryExpression",r)}else if(r.Type==Syntax.LogicalExpression){let e=this.GetNodeValue(r.Left),t=this.GetNodeValue(r.Right);switch(JSConsole.Complier.Log("[JSExecute::VisitBinaryExpression] LogicalExpression",r,e,t),r.Out=null,r.Operator){case"&&":case"AND":r.Out=`(${e} 并且 ${t})`;break;case"||":case"OR":r.Out=`(${e} 或者 ${t})`}JSConsole.Complier.Log("[JSExplainer::VisitBinaryExpression] LogicalExpression",r)}e=a}return e.Out},this.GetNodeValue=function(e){switch(e.Type){case Syntax.Literal:return e.Value;case Syntax.UnaryExpression:if("-"==e.Operator){return"-"+this.GetNodeValue(e.Argument)}return e.Argument.Value;case Syntax.Identifier:return this.ReadVariable(e.Name,e);case Syntax.BinaryExpression:case Syntax.LogicalExpression:return e.Out;case Syntax.CallExpression:return this.VisitCallExpression(e);default:this.ThrowUnexpectedNode(e)}},this.ReadVariable=function(e,t){if(this.ConstVarTable.has(e)){return this.ConstVarTable.get(e)}if(g_JSComplierResource.IsCustomVariant(e))return this.ReadCustomVariant(e,t);if(this.VarTable.has(e))return this.VarTable.get(e);if(e.indexOf("#")>0){var a=e.split("#");return this.SymbolPeriodExplain(a[0],a[1])}return e},this.ThrowUnexpectedNode=function(e,t){let a=e.Marker,r=t||"执行异常";return this.ErrorHandler.ThrowError(a.Index,a.Line,a.Column,r)},this.ThrowError=function(){}}function JSComplier(){}function timeout(e){return new Promise(t=>{setTimeout(t,e)})}JSComplier.Tokenize=function(e){JSConsole.Complier.Log("[JSComplier.Tokenize]",e);let t=new Tokenizer(e),a=[];try{for(;;){let e=t.GetNextToken();if(!e)break;a.push(e)}}catch(e){}return a},JSComplier.Parse=function(e){JSConsole.Complier.Log("[JSComplier.Parse]",e);let t=new JSParser(e);return t.Initialize(),t.ParseScript()},JSComplier.Execute=function(e,t,a){!function(){try{JSConsole.Complier.Log("[JSComplier.Execute]",e,t),JSConsole.Complier.Log("[JSComplier.Execute] parser .....");let i=new JSParser(e);i.Initialize();let n=i.ParseScript();JSConsole.Complier.Log("[JSComplier.Execute] parser finish.",n),JSConsole.Complier.Log("[JSComplier.Execute] execute .....");let s=new JSExecute(n,t);s.ErrorCallback=a,s.JobList=i.Node.GetDataJobList(),"ScriptIndexConsole"==t.ClassName&&s.JobList.unshift({ID:JS_EXECUTE_JOB_ID.JOB_DOWNLOAD_SYMBOL_DATA}),s.JobList.push({ID:JS_EXECUTE_JOB_ID.JOB_RUN_SCRIPT}),s.Execute(),s.VarTable.clear(),s.ConstVarTable.clear();for(var r=0;r<s.OutVarTable.length;r++)s.OutVarTable[r].Data=[];delete s.SymbolData.Execute,delete s.SymbolData.Data,delete s.SymbolData.SourceData,delete s.SymbolData,delete s.OutVarTable,i=n=s={}}catch(e){JSConsole.Complier.Log(e),a&&a(e,t.CallbackParam)}}(),JSConsole.Complier.Log("[JSComplier.Execute] async execute.")},JSComplier.Explain=function(e,t,a){!function(){try{JSConsole.Complier.Log("[JSComplier.Explain]",e,t),JSConsole.Complier.Log("[JSComplier.Explain] parser .....");let r=new JSParser(e);r.Initialize();let i=r.ParseScript();JSConsole.Complier.Log("[JSComplier.Explain] parser finish.",i),JSConsole.Complier.Log("[JSComplier.Explain] explain .....");let n=new JSExplainer(i,t);n.ErrorCallback=a,n.JobList=r.Node.GetDataJobList(),n.JobList.push({ID:JS_EXECUTE_JOB_ID.JOB_RUN_SCRIPT}),n.Run()}catch(e){JSConsole.Complier.Log(e),a&&a(e,t.CallbackParam)}}(),JSConsole.Complier.Log("[JSComplier.Explain] async explain.")},JSComplier.SetDomain=function(e,t){e&&(g_JSComplierResource.Domain=e),t&&(g_JSComplierResource.CacheDomain=t)},JSComplier.AddIcon=function(e){g_JSComplierResource.CustomDrawIcon.Data.set(e.ID,e)},JSComplier.AddFunction=function(e){if(e&&e.Name){var t=e.Name.toUpperCase();g_JSComplierResource.CustomFunction.Data.set(t,e)}},JSComplier.AddVariant=function(e){if(e&&e.Name){var t=e.Name.toUpperCase();g_JSComplierResource.CustomVariant.Data.set(t,e)}};var HQ_DATA_TYPE={KLINE_ID:0,MINUTE_ID:2,HISTORY_MINUTE_ID:3,MULTIDAY_MINUTE_ID:4};function ScriptIndex(e,t,a,r){this.newMethod=BaseIndex,this.newMethod(e),delete this.newMethod,this.Script=t,this.Arguments=[],this.OutVar=[],this.ID,this.FloatPrecision=2,this.StringFormat,this.KLineType=null,this.InstructionType,this.YSpecificMaxMin=null,this.YSplitScale=null,this.Condition=null,this.OutName=null,this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20,this.LockMinWidth=null,this.TitleFont=g_JSChartResource.TitleFont,this.IsShortTitle=!1,r&&(r.FloatPrecision>=0&&(this.FloatPrecision=r.FloatPrecision),r.StringFormat>0&&(this.StringFormat=r.StringFormat),r.ID&&(this.ID=r.ID),(r.KLineType>=0||-1===r.KLineType)&&(this.KLineType=r.KLineType),r.InstructionType&&(this.InstructionType=r.InstructionType),r.YSpecificMaxMin&&(this.YSpecificMaxMin=r.YSpecificMaxMin),r.YSplitScale&&(this.YSplitScale=r.YSplitScale),r.Condition&&(this.Condition=r.Condition),r.TitleFont&&(this.TitleFont=r.TitleFont),r.IsShortTitle&&(this.IsShortTitle=r.IsShortTitle),r.OutName&&(this.OutName=r.OutName)),r&&r.Lock&&(1==r.Lock.IsLocked&&(this.IsLocked=!0),r.Lock.Callback&&(this.LockCallback=r.Lock.Callback),r.Lock.ID&&(this.LockID=r.Lock.ID),r.Lock.BG&&(this.LockBG=r.Lock.BG),r.Lock.TextColor&&(this.LockTextColor=r.Lock.TextColor),r.Lock.Text&&(this.LockText=r.Lock.Text),r.Lock.Font&&(this.LockFont=r.Lock.Font),r.Lock.Count&&(this.LockCount=r.Lock.Count),r.Lock.MinWidth&&(this.LockMinWidth=r.Lock.MinWidth*GetDevicePixelRatio())),a&&(this.Arguments=a),this.SetLock=function(e){1==e.IsLocked?(this.IsLocked=!0,e.Callback&&(this.LockCallback=e.Callback),e.ID&&(this.LockID=e.ID),e.BG&&(this.LockBG=e.BG),e.TextColor&&(this.LockTextColor=e.TextColor),e.Text&&(this.LockText=e.Text),e.Font&&(this.LockFont=e.Font),e.Count&&(this.LockCount=e.Count),e.MinWidth&&(this.LockMinWidth=e.MinWidth*GetDevicePixelRatio())):(this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20)},this.ExecuteScript=function(e,t,a){this.OutVar=[];let r={HQChart:e,WindowIndex:t,HistoryData:a,Self:this},i=HQ_DATA_TYPE.KLINE_ID;"MinuteChartContainer"===e.ClassName||"MinuteChartHScreenContainer"===e.ClassName?i=e.DayCount>1?HQ_DATA_TYPE.MULTIDAY_MINUTE_ID:HQ_DATA_TYPE.MINUTE_ID:"HistoryMinuteChartContainer"===e.ClassName&&(i=HQ_DATA_TYPE.HISTORY_MINUTE_ID);let n={HQDataType:i,Symbol:e.Symbol,Name:e.Name,Data:a,SourceData:e.SourceData,Callback:this.RecvResultData,CallbackParam:r,Async:!0,MaxRequestDataCount:e.MaxReqeustDataCount,MaxRequestMinuteDayCount:e.MaxRequestMinuteDayCount,Arguments:this.Arguments,Condition:this.Condition,IsBeforeData:e.IsBeforeData,IsApiPeriod:e.IsApiPeriod};if(i===HQ_DATA_TYPE.HISTORY_MINUTE_ID&&(n.TrateDate=e.TradeDate),i===HQ_DATA_TYPE.MULTIDAY_MINUTE_ID&&(n.DayCount=e.DayCount),e.NetworkFilter&&(n.NetworkFilter=e.NetworkFilter),this.Condition&&!this.IsMeetCondition(r,n))return void this.ShowConditionError(r);let s=this.Script;JSComplier.Execute(s,n,e.ScriptErrorCallback)},this.IsMeetCondition=function(e,t){if(JSConsole.Complier.Log("[ScriptIndex::IsMeetCondition] ",this.Condition),this.Condition.Period){if(!this.IsMeetPeriodCondition(e,t))return!1;if(!this.IsMeetIncludeCondition(e,t))return!1}return!0},this.IsMeetPeriodCondition=function(e,t){if(!this.Condition.Period)return!0;for(var a in this.Condition.Period){var r=this.Condition.Period[a];switch(r){case CONDITION_PERIOD.MINUTE_ID:if(t.HQDataType==HQ_DATA_TYPE.MINUTE_ID)return!0;break;case CONDITION_PERIOD.MULTIDAY_MINUTE_ID:if(t.HQDataType==HQ_DATA_TYPE.MULTIDAY_MINUTE_ID)return!0;break;case CONDITION_PERIOD.KLINE_DAY_ID:case CONDITION_PERIOD.KLINE_WEEK_ID:case CONDITION_PERIOD.KLINE_MONTH_ID:case CONDITION_PERIOD.KLINE_YEAR_ID:case CONDITION_PERIOD.KLINE_TWOWEEK_ID:case CONDITION_PERIOD.KLINE_QUARTER_ID:case CONDITION_PERIOD.KLINE_MINUTE_ID:case CONDITION_PERIOD.KLINE_5_MINUTE_ID:case CONDITION_PERIOD.KLINE_15_MINUTE_ID:case CONDITION_PERIOD.KLINE_30_MINUTE_ID:case CONDITION_PERIOD.KLINE_60_MINUTE_ID:if(e.HQChart.Period==r)return!0}}return!1},this.IsMeetIncludeCondition=function(e,t){if(!this.Condition.Include||this.Condition.Include.length<=0)return!0;var a=e.HQChart.Symbol;for(var r in a&&(a=a.toUpperCase()),this.Condition.Include){if(a==this.Condition.Include[r])return!0}return!1},this.ShowConditionError=function(e){var t=e.HQChart,a=e.WindowIndex;t.DeleteIndexPaint(a),0==a&&t.ShowKLine(!0);let r=new ChartLine;r.Canvas=t.Canvas,r.ChartBorder=t.Frame.SubFrame[a].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[a].Frame,r.NotSupportMessage="指标不支持当前品种或周期",t.ChartPaint.push(r),t.Draw()},this.RecvResultData=function(e,t){let a=t.HQChart,r=t.WindowIndex,i=t.HistoryData;if(t.Self.OutVar=e,t.Self.BindData(a,r,i),0==t.Self.IsLocked)t.HQChart.Frame.SubFrame[r].Frame.SetLock(null);else{let e={IsLocked:!0,Callback:t.Self.LockCallback,IndexName:t.Self.Name,ID:t.Self.LockID,BG:t.Self.LockBG,Text:t.Self.LockText,TextColor:t.Self.LockTextColor,Font:t.Self.LockFont,Count:t.Self.LockCount,MinWidth:t.Self.LockMinWidth};t.HQChart.Frame.SubFrame[r].Frame.SetLock(e)}if(t.HQChart.UpdataDataoffset(),t.HQChart.UpdateFrameMaxMin(),t.HQChart.Draw(),a.GetIndexEvent){var n=a.GetIndexEvent();if(n){var s=t.Self,u={OutVar:s.OutVar,WindowIndex:r,Name:s.Name,Arguments:s.Arguments,HistoryData:i,Stock:{Symbol:a.Symbol,Name:a.Name}};n.Callback(n,u,s)}}},this.CreateLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartLine;if(i.Canvas=e.Canvas,i.DrawType=1,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}a.IsDotLine&&(i.IsDotLine=!0),0==a.IsShow&&(i.IsShow=!1);let n=t+1;i.Data.Data=a.Data,a.NoneName?e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,null,i.Color):e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,a.Name,i.Color),e.ChartPaint.push(i)},this.CreateOverlayLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartSubLine;if(i.Canvas=e.Canvas,i.DrawType=1,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}a.IsDotLine&&(i.IsDotLine=!0),0==a.IsShow&&(i.IsShow=!1);let n=t+1;i.Data.Data=a.Data,e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,a.Name,i.Color),e.ChartPaint.push(i)},this.CreateBar=function(e,t,a,r){let i=oldChart(e,a)||new ChartStickLine;i.Canvas=e.Canvas,a.Draw.Width>0?i.Width=a.Draw.Width:i.Width=0,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r);i.Data.Data=a.Draw.DrawData,i.BarType=a.Draw.Type,e.ChartPaint.push(i)},this.CreateText=function(e,t,a,r,i){let n=oldChart(e,a)||new ChartSingleText;n.Canvas=e.Canvas,n.Name=a.Name,n.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,n.ChartFrame=e.Frame.SubFrame[t].Frame,n.ReloadResource(),a.Color?n.Color=this.GetColor(a.Color):n.Color=this.GetDefaultColor(r);a.Draw.Position&&(n.Position=a.Draw.Position),a.Draw.DrawData&&(n.Data.Data=a.Draw.DrawData),n.Text=a.Draw.Text,a.Draw.Direction>0&&(n.Direction=a.Draw.Direction),a.Draw.YOffset>0&&(n.YOffset=a.Draw.YOffset),a.Draw.TextAlign&&(n.TextAlign=a.Draw.TextAlign),e.ChartPaint.push(n)},this.CreateMACD=function(e,t,a,r){let i=oldChart(e,a)||new ChartMACD;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.LineWidth){var n=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(n)&&n>0&&(i.LineWidth=n)}let s=t+1;i.Data.Data=a.Data,e.TitlePaint[s].Data[r]=new DynamicTitleData(i.Data,a.Name,this.GetDefaultColor(r)),e.ChartPaint.push(i)},this.CreatePointDot=function(e,t,a,r){let i=oldChart(e,a)||new ChartPointDot;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.Radius&&(i.Radius=a.Radius),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.Radius=e)}let n=t+1;i.Data.Data=a.Data,e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,a.Name,i.Color),e.ChartPaint.push(i)},this.CreateStick=function(e,t,a,r){let i=oldChart(e,a)||new ChartStick;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}let n=t+1;i.Data.Data=a.Data,e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,a.Name,i.Color),e.ChartPaint.push(i)},this.CreateLineStick=function(e,t,a,r){let i=oldChart(e,a)||new ChartLineStick;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}let n=t+1;i.Data.Data=a.Data,e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,a.Name,i.Color),e.ChartPaint.push(i)},this.CreateStraightLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartLine;if(i.DrawType=1,i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}let n=t+1;i.Data.Data=a.Draw.DrawData,"DRAWLINE"==a.Name&&(e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,null,i.Color)),e.ChartPaint.push(i)},this.CreateVolStick=function(e,t,a,r,i){let n=oldChart(e,a)||new ChartVolStick;n.Canvas=e.Canvas,n.Name=a.Name,n.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,n.ChartFrame=e.Frame.SubFrame[t].Frame,n.KLineDrawType=e.KLineDrawType,a.Color?n.Color=this.GetColor(a.Color):n.Color=this.GetDefaultColor(r);let s=t+1;n.Data.Data=a.Data,n.HistoryData=i,e.TitlePaint[s].Data[r]=new DynamicTitleData(n.Data,a.Name,n.Color),e.ChartPaint.push(n)},this.CreateBand=function(e,t,a,r){let i=oldChart(e,a)||new ChartBand;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.FirstColor=a.Draw.Color[0],i.SecondColor=a.Draw.Color[1],i.Data.Data=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreateFillRGN=function(e,t,a,r){let i=oldChart(e,a)||new ChartLineArea;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data.Data=a.Draw.DrawData,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),e.ChartPaint.push(i)},this.CreateFillRGN2=function(e,t,a,r){let i=oldChart(e,a)||new ChartFillRGN;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data.Data=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreateFillBGRGN=function(e,t,a,r){let i=oldChart(e,a)||new ChartFillBGRGN;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data.Data=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreateFLOATRGN=function(e,t,a,r){let i=oldChart(e,a)||new ChartFLOATRGN;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data.Data=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreateKLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartKLine;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data.Data=a.Draw.DrawData,i.IsShowMaxMinPrice=!1,i.IsShowKTooltip=!1,a.Color&&(i.UnchagneColor=i.DownColor=i.UpColor=this.GetColor(a.Color)),e.ChartPaint.push(i)},this.CreatePolyLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartLine;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.IsDotLine&&(i.IsDotLine=!0),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}let n=t+1;i.Data.Data=a.Draw.DrawData,e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data," ",i.Color),e.ChartPaint.push(i)},this.CreateChartSlopeLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartSlopeLine;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.IsDotLine&&(i.IsDotLine=!0),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}let n=t+1;i.Data.Data=a.Draw.DrawData.Data,i.Option=a.Draw.DrawData.Option,e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,null,i.Color),e.ChartPaint.push(i)},this.CreateBackgroud=function(e,t,a,r){let i=oldChart(e,a)||new ChartBackground;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Draw&&a.Draw.DrawData){var n=a.Draw.DrawData;i.Color=n.Color,i.ColorAngle=n.Angle,n.Data&&(i.Data.Data=n.Data)}e.ChartPaint.push(i)},this.CreateTextLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartTextLine;if(i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Draw&&a.Draw.DrawData){var n=a.Draw.DrawData;i.Text=n.Text,i.Line=n.Line,i.Price=n.Price}e.ChartPaint.push(i)},this.CreateNumberText=function(e,t,a,r){let i=oldChart(e,a)||new ChartSingleText;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.TextAlign="center",a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.IsDrawAbove?i.Direction=1:i.Direction=2,a.Draw.Position&&(i.Position=a.Draw.Position);i.Data.Data=a.Draw.DrawData.Value,i.Text=a.Draw.DrawData.Text,e.ChartPaint.push(i)},this.CreateIcon=function(e,t,a,r){let i=oldChart(e,a)||new ChartSingleText;i.Canvas=e.Canvas,i.TextAlign="center",i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame;i.Data.Data=a.Draw.DrawData;var n=a.Draw.Icon;1==n.IconFont?i.IconFont={Family:n.Family,Text:n.Symbol,Color:n.Color}:(i.Text=n.Symbol,a.Color?i.Color=this.GetColor(a.Color):n.Color?i.Color=n.Color:i.Color="rgb(0,0,0)"),e.ChartPaint.push(i)},this.CreateChannel=function(e,t,a,r){let i=oldChart(e,a)||new ChartChannel;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Draw.AreaColor?i.AreaColor=a.Draw.AreaColor:a.Color?i.AreaColor=this.GetColor(a.Color):i.AreaColor=this.GetDefaultColor(r),a.Draw.Border.Color?i.LineColor=a.Draw.Border.Color:i.LineColor=null,a.Draw.Border.Dotted&&(i.LineDotted=a.Draw.Border.Dotted),a.Draw.Border.Width>0&&(i.LineWidth=a.Draw.Border.Width),i.Data.Data=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreatePartLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartPartLine;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data.Data=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreateMultiLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartMultiLine;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data=e.ChartPaint[0].Data,i.Lines=a.Draw.DrawData,a.Draw.LineDash&&(i.LineDash=a.Draw.LineDash),e.ChartPaint.push(i)},this.CreateMultiBar=function(e,t,a,r){let i=oldChart(e,a)||new ChartMultiBar;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data=e.ChartPaint[0].Data,i.Bars=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreateMultiText=function(e,t,a,r){let i=oldChart(e,a)||new ChartMultiText;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data=e.ChartPaint[0].Data,i.Texts=a.Draw.DrawData,e.ChartPaint.push(i)},this.CreateMultiSVGIcon=function(e,t,a,r){let i=oldChart(e,a)||new ChartMultiSVGIcon;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data=e.ChartPaint[0].Data,i.Family=a.Draw.DrawData.Family,i.Icon=a.Draw.DrawData.Icon,e.ChartPaint.push(i)},this.CreateColorKLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartColorKLine;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Data=e.ChartPaint[0].Data,i.KLineColor=a.Draw.DrawData.KLine,a.Color&&(i.Color=a.Color),e.ChartPaint.push(i)},this.CreateRectangle=function(e,t,a,r){let i=oldChart(e,a)||new ChartRectangle;i.Canvas=e.Canvas,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,i.Color=[a.Draw.DrawData.Color],i.Rect=a.Draw.DrawData.Rect,a.Color&&(i.BorderColor=this.GetColor(a.Color)),e.ChartPaint.push(i)},this.CreateScriptOverlayLine=function(e,t,a,r){let i=oldChart(e,a)||new ChartOverlayLine;if(i.Canvas=e.Canvas,i.DrawType=1,i.Name=a.Name,i.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,i.ChartFrame=e.Frame.SubFrame[t].Frame,a.Color?i.Color=this.GetColor(a.Color):i.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(i.LineWidth=e)}a.IsDotLine&&(i.IsDotLine=!0),0==a.IsShow&&(i.IsShow=!1);let n=t+1;i.Data.Data=a.Draw.DrawData.Data,i.MainData.Data=a.Draw.DrawData.MainData,a.Draw.DrawData.Title&&(e.TitlePaint[n].Data[r]=new DynamicTitleData(i.Data,a.Draw.DrawData.Title,i.Color)),e.ChartPaint.push(i)},this.CreateSelfKLine=function(e,t,a){let r=oldChart(e,"Self Kline")||new ChartKLine;r.Canvas=e.Canvas,r.Name="Self Kline",r.ChartBorder=e.Frame.SubFrame[t].Frame.ChartBorder,r.ChartFrame=e.Frame.SubFrame[t].Frame,r.Data=a,r.IsShowMaxMinPrice=!1,r.IsShowKTooltip=!1,r.DrawType=this.KLineType,e.ChartPaint.push(r)},this.BindInstructionData=function(e,t,a){if(!(null==this.OutVar||this.OutVar.length<0)){var r="";for(var i in this.Arguments){let e=this.Arguments[i];r.length>0&&(r+=","),r+=e.Value.toString()}if(r.length>0&&(r="("+r+")"),2==this.InstructionType){let t=this.OutVar[this.OutVar.length-1];return e.SetInstructionData(this.InstructionType,{Data:t.Data,Name:this.Name,Param:r,ID:this.ID}),!0}if(1==this.InstructionType){var n,s;for(var i in this.OutVar){let e=this.OutVar[i];"ENTERLONG"==e.Name?n=e.Data:"EXITLONG"==e.Name&&(s=e.Data)}return e.SetInstructionData(this.InstructionType,{Buy:n,Sell:s,Name:this.Name,Param:r,ID:this.ID}),!0}}},this.BindData=function(e,t,a){if(0==t&&this.InstructionType)return void this.BindInstructionData(e,t,a);if(e.DeleteIndexPaint(t),0==t&&e.ShowKLine(!0),null==this.OutVar||this.OutVar.length<0)return;for(var r in null!=this.KLineType&&(0===this.KLineType||1===this.KLineType||2===this.KLineType?this.CreateSelfKLine(e,t,a):-1===this.KLineType&&0==t&&e.ShowKLine(!1)),t>=1&&e.Frame&&(e.Frame.SubFrame[t].Frame.YSplitOperator.FloatPrecision=this.FloatPrecision,this.YSpecificMaxMin&&(e.Frame.SubFrame[t].Frame.YSpecificMaxMin=this.YSpecificMaxMin),this.YSplitScale&&(e.Frame.SubFrame[t].Frame.YSplitScale=this.YSplitScale)),this.OutVar){let n=this.OutVar[r];if(!0!==n.IsExData&&1e3!=n.Type){if(0==n.Type)n.IsOverlayLine?this.CreateOverlayLine(e,t,n,r):this.CreateLine(e,t,n,r);else if(1==n.Type)switch(n.Draw.DrawType){case"STICKLINE":this.CreateBar(e,t,n,r);break;case"DRAWTEXT":case"SUPERDRAWTEXT":this.CreateText(e,t,n,r);break;case"DRAWLINE":this.CreateStraightLine(e,t,n,r);break;case"DRAWBAND":this.CreateBand(e,t,n,r);break;case"FILLRGN":this.CreateFillRGN(e,t,n,r);break;case"FILLRGN2":this.CreateFillRGN2(e,t,n,r);break;case"FILLTOPRGN":case"FILLBOTTOMRGN":case"FILLVERTICALRGN":this.CreateFillBGRGN(e,t,n,r);break;case"FLOATRGN":this.CreateFLOATRGN(e,t,n,r);break;case"DRAWKLINE":case"DRAWKLINE_IF":this.CreateKLine(e,t,n,r);break;case"POLYLINE":this.CreatePolyLine(e,t,n,r);break;case"DRAWGBK":case"DRAWGBK2":this.CreateBackgroud(e,t,n,r);break;case"DRAWTEXT_LINE":this.CreateTextLine(e,t,n,r);break;case"DRAWNUMBER":case"DRAWNUMBER_FIX":case"DRAWTEXT_FIX":this.CreateNumberText(e,t,n,r);break;case"DRAWICON":this.CreateIcon(e,t,n,r);break;case"DRAWCHANNEL":this.CreateChannel(e,t,n,r);break;case"PARTLINE":this.CreatePartLine(e,t,n,r);break;case"DRAWRECTREL":this.CreateRectangle(e,t,n,r);break;case"DRAWOVERLAYLINE":this.CreateScriptOverlayLine(e,t,n,r);break;case"DRAWSL":this.CreateChartSlopeLine(e,t,n,r);break;case"MULTI_LINE":this.CreateMultiLine(e,t,n,r);break;case"MULTI_BAR":this.CreateMultiBar(e,t,n,r);break;case"MULTI_TEXT":this.CreateMultiText(e,t,n,r);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(e,t,n,r);break;case"COLOR_KLINE":this.CreateColorKLine(e,t,n,r);break;case"KLINE_BG":this.CreateBackgroud(e,t,n,r)}else 2==n.Type?this.CreateMACD(e,t,n,r):3==n.Type?this.CreatePointDot(e,t,n,r):4==n.Type?this.CreateLineStick(e,t,n,r):5==n.Type?this.CreateStick(e,t,n,r):6==n.Type&&this.CreateVolStick(e,t,n,r,a);var i=e.TitlePaint[t+1];i&&i.Data&&r<i.Data.length&&(this.StringFormat>0&&(i.Data[r].StringFormat=this.StringFormat),this.FloatPrecision>=0&&(i.Data[r].FloatPrecision=this.FloatPrecision),this.OutName&&this.OutName.length>0&&this.Arguments&&this.Arguments.length>0&&i.SetDynamicOutName(this.OutName,this.Arguments))}}let n=t+1;if(e.TitlePaint[n].Title=this.Name,!this.IsShortTitle){let t="";for(var r in this.Arguments){let e=this.Arguments[r];t.length>0&&(t+=","),t+=e.Value.toString()}t.length>0&&(e.TitlePaint[n].Title=this.Name+"("+t+")")}return this.TitleFont&&(e.TitlePaint[n].Font=this.TitleFont),!0},this.GetDefaultColor=function(e){let t=null;return g_JSChartResource&&g_JSChartResource.Index&&g_JSChartResource.Index.LineColor&&(t=g_JSChartResource.Index.LineColor),t&&Array.isArray(t)||(t=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"]),t[parseInt(e)%(t.length-1)]},this.GetColor=function(e){let t=new Map([["COLORBLACK","rgb(0,0,0)"],["COLORBLUE","rgb(18,95,216)"],["COLORGREEN","rgb(25,158,0)"],["COLORCYAN","rgb(0,255,198)"],["COLORRED","rgb(238,21,21)"],["COLORMAGENTA","rgb(255,0,222)"],["COLORBROWN","rgb(149,94,15)"],["COLORLIGRAY","rgb(218,218,218)"],["COLORGRAY","rgb(133,133,133)"],["COLORLIBLUE","rgb(94,204,255)"],["COLORLIGREEN","rgb(183,255,190)"],["COLORLICYAN","rgb(154,255,242)"],["COLORLIRED","rgb(255,172,172)"],["COLORLIMAGENTA","rgb(255,145,241)"],["COLORWHITE","rgb(255,255,255)"],["COLORYELLOW","rgb(255,198,0)"]]);return t.has(e)?t.get(e):0==e.indexOf("COLOR")?"#"+e.substr(5):"rgb(30,144,255)"}}function OverlayScriptIndex(e,t,a,r){this.newMethod=ScriptIndex,this.newMethod(e,t,a,r),delete this.newMethod,this.OverlayIndex=null,this.BindData=function(e,t,a){if(!this.OverlayIndex||1!=this.OverlayIndex.IsOverlay)return;if(this.OverlayIndex.Frame.ChartPaint=[],null==this.OutVar||this.OutVar.length<0)return;var r={Data:[],Title:this.Name};let i="";for(var n in this.Arguments){let e=this.Arguments[n];i.length>0&&(i+=","),i+=e.Value.toString()}i.length>0&&(r.Title=this.Name+"("+i+")");var s=t+1,u=e.TitlePaint[s];for(var n in u.OverlayIndex.set(this.OverlayIndex.Identify,r),this.OverlayIndex.Frame.Frame.Title=r.Title,this.OutVar){let r=this.OutVar[n];if(!0!==r.IsExData)if(0==r.Type)this.CreateLine(e,t,r,n);else if(1==r.Type)switch(r.Draw.DrawType){case"STICKLINE":this.CreateBar(e,t,r,n);break;case"DRAWTEXT":case"SUPERDRAWTEXT":this.CreateText(e,t,r,n);break;case"DRAWLINE":this.CreateStraightLine(e,t,r,n);break;case"DRAWBAND":this.CreateBand(e,t,r,n);break;case"DRAWKLINE":case"DRAWKLINE_IF":this.CreateKLine(e,t,r,n);break;case"POLYLINE":this.CreatePolyLine(e,t,r,n);break;case"DRAWNUMBER":case"DRAWNUMBER_FIX":case"DRAWTEXT_FIX":this.CreateNumberText(e,t,r,n);break;case"DRAWICON":this.CreateIcon(e,t,r,n);break;case"DRAWCHANNEL":this.CreateChannel(e,t,r,n);break;case"DRAWTEXT_LINE":this.CreateTextLine(e,t,r,n);break;case"MULTI_LINE":this.CreateMultiLine(e,t,r,n);break;case"MULTI_BAR":this.CreateMultiBar(e,t,r,n);break;case"MULTI_TEXT":this.CreateMultiText(e,t,r,n);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(e,t,r,n)}else 2==r.Type?this.CreateMACD(e,t,r,n):3==r.Type?this.CreatePointDot(e,t,r,n):4==r.Type?this.CreateLineStick(e,t,r,n):5==r.Type?this.CreateStick(e,t,r,n):6==r.Type&&this.CreateVolStick(e,t,r,n,a)}return!0},this.RecvResultData=function(e,t){let a=t.HQChart,r=t.WindowIndex,i=t.HistoryData;t.Self.OutVar=e,t.Self.BindData(a,r,i),t.HQChart.UpdataDataoffset(),t.HQChart.UpdateFrameMaxMin(),t.HQChart.Draw();var n=a.GetOverlayIndexEvent();if(n){var s=t.Self,u={OutVar:s.OutVar,WindowIndex:r,Name:s.Name,Arguments:s.Arguments,HistoryData:i,Identify:s.OverlayIndex.Identify,Stock:{Symbol:a.Symbol,Name:a.Name}};n.Callback(n,u,s)}},this.CreateLine=function(e,t,a,r){debug&&console.log("CreateOverlayLine");var i=this.OverlayIndex,n=i.Frame;let s=new ChartLine;if(s.Canvas=e.Canvas,s.DrawType=1,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(line.LineWidth=e)}0==a.IsShow&&(line.IsShow=!1);let u=t+1;s.Data.Data=a.Data,e.TitlePaint[u].OverlayIndex.get(i.Identify).Data[r]=new DynamicTitleData(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateBar=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartStickLine;s.Canvas=e.Canvas,a.Draw.Width>0?s.Width=a.Draw.Width:s.Width=1,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r);s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateText=function(e,t,a,r,i){var n=this.OverlayIndex,s=n.Frame;let u=new ChartSingleText;u.Canvas=e.Canvas,u.Name=a.Name,u.ChartBorder=s.Frame.ChartBorder,u.ChartFrame=s.Frame,u.Identify=n.Identify,u.ReloadResource(),a.Color?u.Color=this.GetColor(a.Color):u.Color=this.GetDefaultColor(r);a.Draw.Position&&(u.Position=a.Draw.Position),a.Draw.DrawData&&(u.Data.Data=a.Draw.DrawData),u.Text=a.Draw.Text,a.Draw.Direction>0&&(u.Direction=a.Draw.Direction),a.Draw.YOffset>0&&(u.YOffset=a.Draw.YOffset),a.Draw.TextAlign&&(u.TextAlign=a.Draw.TextAlign),s.ChartPaint.push(u)},this.CreateMACD=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartMACD;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify;let u=t+1;s.Data.Data=a.Data,e.TitlePaint[u].OverlayIndex.get(i.Identify).Data[r]=new DynamicTitleData(s.Data,a.Name,this.GetDefaultColor(r)),n.ChartPaint.push(s)},this.CreatePointDot=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartPointDot;if(s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r),a.Radius&&(s.Radius=a.Radius),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(s.Radius=e)}let u=t+1;s.Data.Data=a.Data,e.TitlePaint[u].OverlayIndex.get(i.Identify).Data[r]=new DynamicTitleData(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateStick=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartStick;if(s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(s.LineWidth=e)}let u=t+1;s.Data.Data=a.Data,e.TitlePaint[u].OverlayIndex.get(i.Identify).Data[r]=new DynamicTitleData(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateLineStick=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartLineStick;if(s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(s.LineWidth=e)}let u=t+1;s.Data.Data=a.Data,e.TitlePaint[u].OverlayIndex.get(i.Identify).Data[r]=new DynamicTitleData(s.Data,a.Name,s.Color),n.ChartPaint.push(s)},this.CreateStraightLine=function(e,t,a,r){debug&&console.log("CreateOverlayStraightLine");var i=this.OverlayIndex,n=i.Frame;let s=new ChartLine;if(s.DrawType=1,s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(s.LineWidth=e)}s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateVolStick=function(e,t,a,r,i){var n=this.OverlayIndex,s=n.Frame;let u=new ChartVolStick;u.Canvas=e.Canvas,u.Name=a.Name,u.ChartBorder=s.Frame.ChartBorder,u.ChartFrame=s.Frame,u.Identify=n.Identify,u.KLineDrawType=e.KLineDrawType,a.Color?u.Color=this.GetColor(a.Color):u.Color=this.GetDefaultColor(r);let o=t+1;u.Data.Data=a.Data,u.HistoryData=i,e.TitlePaint[o].OverlayIndex.get(n.Identify).Data[r]=new DynamicTitleData(u.Data,a.Name,u.Color),s.ChartPaint.push(u)},this.CreateBand=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartBand;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.FirstColor=a.Draw.Color[0],s.SecondColor=a.Draw.Color[1],s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateKLine=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartKLine;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.Data.Data=a.Draw.DrawData,s.IsShowMaxMinPrice=!1,s.IsShowKTooltip=!1,a.Color&&(s.UnchagneColor=s.DownColor=s.UpColor=this.GetColor(a.Color)),n.ChartPaint.push(s)},this.CreatePolyLine=function(e,t,a,r){debug&&console.log("CreateOverlayPolyLine");var i=this.OverlayIndex,n=i.Frame;let s=new ChartLine;if(s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r),a.LineWidth){let e=parseInt(a.LineWidth.replace("LINETHICK",""));!isNaN(e)&&e>0&&(s.LineWidth=e)}let u=t+1;s.Data.Data=a.Draw.DrawData,e.TitlePaint[u].OverlayIndex.get(i.Identify).Data[r]=new DynamicTitleData(line.Data," ",line.Color),n.ChartPaint.push(s)},this.CreateNumberText=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartSingleText;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.TextAlign="center",a.Color?s.Color=this.GetColor(a.Color):s.Color=this.GetDefaultColor(r),a.IsDrawAbove?s.Direction=1:s.Direction=2,a.Draw.Position&&(s.Position=a.Draw.Position);s.Data.Data=a.Draw.DrawData.Value,s.Text=a.Draw.DrawData.Text,n.ChartPaint.push(s)},this.CreateTextLine=function(e,t,a,r){var i=this.OverlayIndex.Frame;let n=new ChartTextLine;if(n.Canvas=e.Canvas,n.Name=a.Name,n.ChartBorder=i.Frame.ChartBorder,n.ChartFrame=i.Frame,a.Draw&&a.Draw.DrawData){var s=a.Draw.DrawData;n.Text=s.Text,n.Line=s.Line,n.Price=s.Price}e.ChartPaint.push(n)},this.CreateIcon=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartSingleText;s.Canvas=e.Canvas,s.TextAlign="center",s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify;s.Data.Data=a.Draw.DrawData;var u=a.Draw.Icon;1==u.IconFont?s.IconFont={Family:u.Family,Text:u.Symbol,Color:u.Color}:(s.Text=u.Symbol,a.Color?s.Color=this.GetColor(a.Color):u.Color?s.Color=u.Color:s.Color="rgb(0,0,0)"),n.ChartPaint.push(s)},this.CreateChannel=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartChannel;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,a.Draw.AreaColor?s.AreaColor=a.Draw.AreaColor:a.Color?s.AreaColor=this.GetColor(a.Color):s.AreaColor=this.GetDefaultColor(r),a.Draw.Border.Color?s.LineColor=a.Draw.Border.Color:s.LineColor=null,a.Draw.Border.Dotted&&(s.LineDotted=a.Draw.Border.Dotted),a.Draw.Border.Width>0&&(s.LineWidth=a.Draw.Border.Width),s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreatePartLine=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartPartLine;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.Data.Data=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiLine=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartMultiLine;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.Data=e.ChartPaint[0].Data,s.Lines=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiBar=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartMultiBar;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.Data=e.ChartPaint[0].Data,s.Bars=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiText=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartMultiText;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.Data=e.ChartPaint[0].Data,s.Texts=a.Draw.DrawData,n.ChartPaint.push(s)},this.CreateMultiSVGIcon=function(e,t,a,r){var i=this.OverlayIndex,n=i.Frame;let s=new ChartMultiSVGIcon;s.Canvas=e.Canvas,s.Name=a.Name,s.ChartBorder=n.Frame.ChartBorder,s.ChartFrame=n.Frame,s.Identify=i.Identify,s.Data=e.ChartPaint[0].Data,s.Family=a.Draw.DrawData.Family,s.Icon=a.Draw.DrawData.Icon,n.ChartPaint.push(s)},this.CreateSelfKLine=function(e,t,a){var r=this.OverlayIndex,i=r.Frame;let n=new ChartKLine;n.Canvas=e.Canvas,n.Name="Self Kline",n.ChartBorder=i.Frame.ChartBorder,n.ChartFrame=i.Frame,n.Identify=r.Identify,n.Data=a,n.IsShowMaxMinPrice=!1,n.IsShowKTooltip=!1,n.DrawType=this.KLineType,i.ChartPaint.push(n)},this.GetDefaultColor=function(e){let t=["rgb(24,71,178)","rgb(42,230,215)","rgb(252,96,154)","rgb(0,128,255)","rgb(229,0,79)","rgb(68,114,196)","rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)"];return t[parseInt(e)%(t.length-1)]}}function APIScriptIndex(e,t,a,r,i){this.newMethod=i?OverlayScriptIndex:ScriptIndex,this.newMethod(e,t,a,r),delete this.newMethod,this.IsOverlayIndex=1==i,this.ApiUrl,this.HQDataType,this.Version=1,r.API&&(r.API.Url&&(this.ApiUrl=r.API.Url),r.API.Name&&(this.Name=this.ID=r.API.Name),r.API.ID&&(this.ID=r.API.ID),r.API.Version>0&&(this.Version=r.API.Version)),this.ExecuteScript=function(e,t,a){JSConsole.Complier.Log("[APIScriptIndex::ExecuteScript] name, Arguments ",this.Name,this.Arguments);let r=HQ_DATA_TYPE.KLINE_ID;var i=null;"MinuteChartContainer"===e.ClassName||"MinuteChartHScreenContainer"===e.ClassName?r=e.DayCount>1?HQ_DATA_TYPE.MULTIDAY_MINUTE_ID:HQ_DATA_TYPE.MINUTE_ID:"HistoryMinuteChartContainer"===e.ClassName?r=HQ_DATA_TYPE.HISTORY_MINUTE_ID:i=a.GetDateRange();var n,s=[];if(this.Arguments)for(var u in this.Arguments){var o=this.Arguments[u];s.push({name:o.Name,value:o.Value})}e.GetRequestDataCount&&(n=e.GetRequestDataCount());var l=this,D={indexname:this.ID,symbol:e.Symbol,script:this.Script,args:s,period:e.Period,right:e.Right,hqdatatype:r};if(i&&(D.DateRange=i),n&&(D.maxdatacount=n.MaxRequestDataCount,D.maxminutedaycount=n.MaxRequestMinuteDayCount),r!=HQ_DATA_TYPE.MULTIDAY_MINUTE_ID&&r!=HQ_DATA_TYPE.MINUTE_ID||(D.daycount=e.DayCount),this.HQDataType=r,e.NetworkFilter){var h={Name:"APIScriptIndex::ExecuteScript",Explain:"指标计算",Request:{Url:l.ApiUrl,Type:"POST",Data:D},Self:this,HQChart:e,PreventDefault:!1};if(e.NetworkFilter(h,function(r){2==l.Version?l.RecvAPIData2(r,e,t,a):l.RecvAPIData(r,e,t,a)}),1==h.PreventDefault)return}JSNetwork.HttpRequest({url:l.ApiUrl,data:D,type:"post",dataType:"json",async:!0,success:function(r){l.RecvAPIData(r,e,t,a)},error:function(e){l.RecvError(e)}})},this.RecvAPIData2=function(e,t,a,r){if(JSConsole.Complier.Log("[APIScriptIndex::RecvAPIData2] recv data ",this.Name,e),this.HQDataType==HQ_DATA_TYPE.KLINE_ID&&(this.OutVar=this.ConvertToLocalData(e,t),JSConsole.Complier.Log("[APIScriptIndex::RecvAPIData2] conver to OutVar ",this.OutVar)),this.BindData(t,a,r),t.UpdataDataoffset(),t.UpdateFrameMaxMin(),t.Draw(),t.GetIndexEvent){var i=t.GetIndexEvent();if(i){e={OutVar:this.OutVar,WindowIndex:a,Name:this.Name,Arguments:this.Arguments,HistoryData:r,Stock:{Symbol:t.Symbol,Name:t.Name}};i.Callback(i,e,this)}}},this.ConvertToLocalData=function(e,t){var a=e.OutVar,r=t.ChartPaint[0].Data;if(ChartData.IsDayPeriod(e.Period,!0))var i=r.GetAPIDataIndex(e.Date);else i=r.GetAPIDataIndex(e.Date,e.Time);var n=[];for(var s in a){var u={Type:(E=a[s]).Type,Name:E.Name};if(0==E.Type){u.Data=[];for(var o=0;o<i.length;++o){(p=i[o]).Index<0?u.Data[o]=null:u.Data[o]=E.Data[p.Index]}u.Name&&u.Name.indexOf("@NODRAW@")>=0&&(u.Name=u.Name.replace("@NODRAW@",""))}else{if(1!=E.Type)continue;u.Name=E.DrawType,u.Draw={DrawType:E.DrawType};var l=E.Draw;switch(E.DrawType){case"STICKLINE":var D=[];for(o=0;o<i.length;++o){if(D[o]=null,!((_=(p=i[o]).Index)<0)){var h=l.Price[_],c=l.Price2[_];IFrameSplitOperator.IsNumber(h)&&IFrameSplitOperator.IsNumber(c)&&(D[o]={Value:h,Value2:c})}}u.Draw.DrawData=D,u.Draw.Width=l.Width,u.Draw.Type=l.Empty;break;case"DRAWTEXT":D=[];var C=[];for(o=0;o<i.length;++o){if(D[o]=null,!((_=(p=i[o]).Index)<0)){h=l.Price[_];if(IFrameSplitOperator.IsNumber(h)&&(D[o]=h),Array.isArray(l.Text)){var E=l.Text[_];IFrameSplitOperator.IsString(E)&&(C[o]=E)}}}Array.isArray(l.Text)?u.Draw.Text=C:u.Draw.Text=l.Text,u.Draw.DrawData=D;break;case"DRAWNUMBER":for(D={Value:[],Text:[]},o=0;o<i.length;++o){if(D.Value[o]=null,D.Text[o]=null,!((_=(p=i[o]).Index)<0)){h=l.Price[_];var m=l.Number[_];IFrameSplitOperator.IsNumber(h)&&IFrameSplitOperator.IsNumber(m)&&(D.Value[o]=h,D.Text[o]=m.toFixed(2))}}u.Draw.DrawData=D;break;case"DRAWBAND":for(D=[],o=0;o<i.length;++o){if(D[o]=null,!((_=(p=i[o]).Index)<0)){h=l.Val1[_],c=l.Val2[_];IFrameSplitOperator.IsNumber(h)&&IFrameSplitOperator.IsNumber(c)&&(D[o]={Value:h,Value2:c})}}u.Draw.DrawData=D,u.Draw.Color=[l.Color1.toLowerCase(),l.Color2.toLowerCase()];break;case"DRAWKLINE":for(D=[],o=0;o<i.length;++o){E={Open:null,High:null,Low:null,Close:null};if(D[o]=E,!((_=(p=i[o]).Index)<0)){var A=l.High[_],N=l.Low[_],I=l.Open[_],S=l.Close[_];IFrameSplitOperator.IsPlusNumber(A)&&IFrameSplitOperator.IsPlusNumber(N)&&IFrameSplitOperator.IsPlusNumber(I)&&IFrameSplitOperator.IsPlusNumber(S)&&(E.Open=I,E.Close=S,E.High=A,E.Low=N)}}u.Draw.DrawData=D;break;case"DRAWTEXT_FIX":for(D={Value:[],Text:[]},o=0;o<i.length;++o){if(D.Value[o]=0,D.Text[o]=null,!((_=(p=i[o]).Index)<0))l.Cond[_]&&(D.Value[o]=1,D.Text[o]=l.Text)}u.Draw.DrawData=D,u.Draw.Position={X:l.X,Y:l.Y,Type:l.Type};break;case"DRAWNUMBER_FIX":for(D={Value:[],Text:[]},o=0;o<i.length;++o){if(D.Value[o]=null,D.Text[o]=null,!((_=(p=i[o]).Index)<0)){var f=l.Number[_];IFrameSplitOperator.IsNumber(f)&&(D.Value[o]=f,D.Text[o]=IFrameSplitOperator.RemoveZero(f.toFixed(2)))}}u.Draw.DrawData=D,u.Draw.Position={X:l.X,Y:l.Y,Type:l.Type};break;case"DRAWICON":var O=g_JSComplierResource.GetDrawIcon(l.Type);O||g_JSComplierResource.GetDrawTextIcon(l.Type),O||(O={Symbol:"🚩"}),u.Draw.Icon=O;for(D=[],o=0;o<i.length;++o){if(D[o]=null,!((_=(p=i[o]).Index)<0)){f=l.Price[_];IFrameSplitOperator.IsNumber(f)&&(D[o]=f)}}u.Draw.DrawData=D;break;case"PARTLINE":for(D=[],o=0;o<i.length;++o){if(D[o]={Value:null,RGB:null},!((_=(p=i[o]).Index)<0)){var d=l.Color[_];if(IFrameSplitOperator.IsString(d)){f=l.Price[_];IFrameSplitOperator.IsNumber(f)&&(D[o].Value=f,D[o].RGB=d)}}}u.Draw.DrawData=D;break;case"FILLRGN":for(D=[],o=0;o<i.length;++o){var p,_;if(D[o]=null,!((_=(p=i[o]).Index)<0)){d=l.Color[_];if(IFrameSplitOperator.IsString(d)){f=l.Price[_];if(IFrameSplitOperator.IsNumber(f)){var T=l.Price2[_];IFrameSplitOperator.IsNumber(T)&&(D[o]={Value:f,Value2:T,Color:d})}}}}u.Draw.DrawData=D,u.Draw.DrawType="FILLRGN2";break;default:continue}}for(var s in E.Attribute){var y=E.Attribute[s];switch(y){case"COLORSTICK":u.Type=2;break;case"POINTDOT":u.Radius=2,u.Type=3;break;case"CIRCLEDOT":u.Radius=1.3,u.Type=3;break;case"DOTLINE":u.IsDotLine=!0;break;case"DRAWABOVE":u.IsDrawAbove=!0;break;case"LINESTICK":u.Type=4;break;case"STICK":u.Type=5;break;case"VOLSTICK":u.Type=6;break;case"NODRAW":u.IsShow=!1;break;case"NONE_OUT_NAME":u.NoneName=!0}0==y.indexOf("COLOR")?u.Color=y:0==y.indexOf("LINETHICK")&&(u.LineWidth=y)}n.push(u)}return n},this.RecvAPIData=function(e,t,a,r){if(JSConsole.Complier.Log("[APIScriptIndex::RecvAPIData] recv data ",this.Name,e),0==e.code){if(e.outdata&&e.outdata.name&&(this.Name=e.outdata.name),e.outdata.args)for(var i in this.Arguments=[],e.outdata.args){var n=e.outdata.args[i];this.Arguments.push({Name:n.name,Value:n.value})}if(this.HQDataType==HQ_DATA_TYPE.KLINE_ID?(this.OutVar=this.FittingData(e.outdata,t),JSConsole.Complier.Log("[APIScriptIndex::RecvAPIData] conver to OutVar ",this.OutVar)):this.OutVar=this.FittingMinuteData(e.outdata,t),this.BindData(t,a,r),0==this.IsLocked)t.Frame.SubFrame[a].Frame.SetLock(null);else{let e={IsLocked:!0,Callback:this.LockCallback,IndexName:this.Name,ID:this.LockID,BG:this.LockBG,Text:this.LockText,TextColor:this.LockTextColor,Font:this.LockFont,Count:this.LockCount,MinWidth:this.LockMinWidth};t.Frame.SubFrame[a].Frame.SetLock(e)}if(t.UpdataDataoffset(),t.UpdateFrameMaxMin(),t.Draw(),t.GetIndexEvent){var s=t.GetIndexEvent();if(s){e={OutVar:this.OutVar,WindowIndex:a,Name:this.Name,Arguments:this.Arguments,HistoryData:r,Stock:{Symbol:t.Symbol,Name:t.Name}};s.Callback(s,e,this)}}}},this.FittingArray=function(e,t,a,r,i){var n,s=r.ChartPaint[0].Data,u=[];for(var o in e){var l=e[o],D=new SingleData;D.Date=t[o],a&&o<a.length&&(D.Time=a[o]),D.Value=l,u.push(D)}n=ChartData.IsDayPeriod(r.Period,!0)?s.GetFittingData(u):s.GetMinuteFittingData(u);var h=new ChartData;return h.Data=n,1==i?h.GetObject():h.GetValue()},this.FittingMultiLine=function(e,t,a,r){var i=r.ChartPaint[0].Data;if(ChartData.IsDayPeriod(r.Period,!0)){var n=[];for(var s in e){var u=e[s];for(var o in u.Point){var l=u.Point[o];n.push(l)}}return n.sort(function(e,t){return e.Date-t.Date}),i.GetDateIndex(n),e}if(ChartData.IsMinutePeriod(r.Period,!0)){n=[];for(var s in e){u=e[s];for(var o in u.Point){l=u.Point[o];n.push(l)}}return n.sort(function(e,t){return e.Date==t.Date?e.Time-t.Time:e.Date-t.Date}),i.GetDateTimeIndex(n),e}return null},this.FittingMultiText=function(e,t,a,r){var i=r.ChartPaint[0].Data;return ChartData.IsDayPeriod(r.Period,!0)?(e.sort(function(e,t){return e.Date-t.Date}),i.GetDateIndex(e),e):ChartData.IsMinutePeriod(r.Period,!0)?(e.sort(function(e,t){return e.Date==t.Date?e.Time-t.Time:e.Date-t.Date}),i.GetDateTimeIndex(e),e):null},this.FittingData=function(e,t){var a=e.outvar,r=e.date,i=e.time,n=(t.ChartPaint[0].Data,[]);for(var s in a){var u={Name:(c=a[s]).name,Type:c.type};if(c.color&&(u.Color=c.color),c.data)u.Data=this.FittingArray(c.data,r,i,t),c.color&&(u.Color=c.color),c.linewidth>=1&&(u.LineWidth=c.linewidth),0==c.isshow&&(u.IsShow=!1),1==c.isexdata&&(u.IsExData=!0),n.push(u);else if(c.Draw){var o=c.Draw,l={};if("DRAWICON"==o.DrawType)l.Icon=o.Icon,l.Name=o.Name,l.DrawType=o.DrawType,l.DrawData=this.FittingArray(o.DrawData,r,i,t),u.Draw=l,n.push(u);else if("DRAWTEXT"==o.DrawType)l.Text=o.Text,l.Name=o.Name,l.DrawType=o.DrawType,l.DrawData=this.FittingArray(o.DrawData,r,i,t),u.Draw=l,n.push(u);else if("STICKLINE"==o.DrawType)l.Name=o.Name,l.Type=o.Type,l.Width=o.Width,l.DrawType=o.DrawType,l.DrawData=this.FittingArray(o.DrawData,r,i,t,1),u.Draw=l,n.push(u);else if("MULTI_LINE"==o.DrawType)l.Text=o.Text,l.Name=o.Name,l.DrawType=o.DrawType,l.DrawData=this.FittingMultiLine(o.DrawData,r,i,t),u.Draw=l,o.LineDash&&(l.LineDash=o.LineDash),n.push(u);else if("MULTI_BAR"==o.DrawType)l.Text=o.Text,l.Name=o.Name,l.DrawType=o.DrawType,l.DrawData=this.FittingMultiLine(o.DrawData,r,i,t),u.Draw=l,n.push(u);else if("MULTI_TEXT"==o.DrawType)l.Text=o.Text,l.Name=o.Name,l.DrawType=o.DrawType,l.DrawData=this.FittingMultiText(o.DrawData,r,i,t),u.Draw=l,n.push(u);else if("MULTI_SVGICON"==o.DrawType)l.Text=o.Text,l.Name=o.Name,l.DrawType=o.DrawType,l.DrawData={Icon:this.FittingMultiText(o.DrawData.Icon,r,i,t),Family:o.DrawData.Family},u.Draw=l,n.push(u);else if("COLOR_KLINE"==o.DrawType){l.Text=o.Text,l.Name=o.Name,l.DrawType=o.DrawType;var D=this.FittingMultiText(o.DrawData.KLine,r,i,t),h=new Map;for(var s in D){var c=D[s];h.set(c.Index,c)}l.DrawData={KLine:h},o.Color&&(u.Color=o.Color),u.Draw=l,n.push(u)}else"KLINE_BG"==o.DrawType&&(l.Name=o.Name,l.DrawType=o.DrawType,l.DrawData={},l.DrawData.Color=o.Color,l.DrawData.Angle=o.Angle,l.DrawData.Data=this.FittingKLineBG(o.DrawData,t),u.Draw=l,u.Name=o.DrawType,n.push(u))}}return n},this.FittingKLineBG=function(e,t){var a=t.ChartPaint[0].Data,r=[];if(ChartData.IsDayPeriod(t.Period,!0)){for(var i=!1,n=0,s=0;n<a.Data.length;){r[n]=0;var u=a.Data[n];if(s>=e.length)++n;else(o=e[s]).Date<u.Date?++s:o.Date>u.Date?++n:(i=!0,r[n]=1,++s,++n)}if(i)return r}else if(ChartData.IsMinutePeriod(t.Period,!0)){for(i=!1,n=0,s=0;n<a.Data.length;){r[n]=0;var o;u=a.Data[n];if(s>=e.length)++n;else(o=e[s]).Date<u.Date||o.Date==u.Date&&o.Time<u.Time?++s:o.Date>u.Date||o.Date==u.Date&&o.Time>u.Time?++n:(i=!0,r[n]=1,++s,++n)}if(i)return r}return null},this.FittingMinuteData=function(e,t){var a=e.outvar,r=e.date,i=e.time,n=[];for(var s in a){item=a[s];var u={Name:item.name,Type:item.type};item.data&&(u.Data=this.FittingMinuteArray(item.data,r,i,t),item.color&&(u.Color=item.color),item.linewidth>=1&&(u.LineWidth=item.linewidth),0==item.isshow&&(u.IsShow=!1),1==item.isexdata&&(u.IsExData=!0),n.push(u))}return n},this.FittingMinuteArray=function(e,t,a,r){var i=r.SourceData,n=[];for(var s in e){var u=e[s],o=new SingleData;o.Date=t[s],a&&s<a.length&&(o.Time=a[s]),o.Value=u,n.push(o)}var l=i.GetMinuteFittingData(n),D=new ChartData;return D.Data=l,D.GetValue()}}function LocalJsonDataIndex(e,t,a){this.newMethod=ScriptIndex,this.newMethod(e,null,t,null),delete this.newMethod,this.JsonData,a.JsonData&&(this.JsonData=a.JsonData),this.RequestData=function(e,t,a){if(!this.JsonData)return console.warn("[LocalJsonDataIndex::RequestData] JsonData is null"),void(param.HQChart.ScriptErrorCallback&&param.HQChart.ScriptErrorCallback("json 数据不能为空"));this.OutVar=this.FittingData(this.JsonData,a),this.BindData(e,t,a)},this.FittingData=function(e,t){for(i in outVar=e.OutVar,date=e.Date,time=e.Time,result=[],outVar)if(item=outVar[i],JSConsole.Complier.Log("[LocalJsonDataIndex::FittingData] item",item),0==item.Type||3==item.Type){var a=[];for(j in outVarItem={Name:item.Name,Type:item.Type},item.Data){var r=new SingleData;r.Date=date[j],time&&j<time.length&&(r.Time=time[j]),r.Value=item.Data[j],a.push(r)}if(t.Period<4)var n=t.GetFittingData(a);else n=t.GetMinuteFittingData(a);var s=new ChartData;s.Data=n,outVarItem.Data=s.GetValue(),result.push(outVarItem)}else console.warn("[LocalJsonDataIndex::FittingData] can\'t support ",item.Name,item.Type);return result}}function ScriptIndexConsole(e){this.ID,this.Name,this.Script,this.Arguments=[],this.ClassName="ScriptIndexConsole",this.ErrorCallback,this.FinishCallback,this.IsSectionMode=!1,e&&(e.Name&&(this.Name=e.Name),e.Script&&(this.Script=e.Script),e.ID&&(this.ID=e.ID),e.Args&&(this.Arguments=e.Args),e.ErrorCallback&&(this.ErrorCallback=e.ErrorCallback),e.FinishCallback&&(this.FinishCallback=e.FinishCallback),e.IsSectionMode&&(this.IsSectionMode=e.IsSectionMode)),this.ExecuteScript=function(e){this.OutVar=[];let t={Self:this},a={HQDataType:e.HQDataType,Symbol:e.Stock.Symbol,Name:e.Stock.Name,Period:e.Period,Right:e.Right,Callback:this.RecvResultData,CallbackParam:t,Async:!0,MaxRequestDataCount:e.Request.MaxDataCount,MaxRequestMinuteDayCount:e.Request.MaxMinuteDayCount,Arguments:this.Arguments,IsSectionMode:this.IsSectionMode,ClassName:"ScriptIndexConsole"};e.HQDataType===HQ_DATA_TYPE.HISTORY_MINUTE_ID&&(a.TrateDate=e.Request.TradeDate),e.HQDataType==HQ_DATA_TYPE.MULTIDAY_MINUTE_ID&&(a.DayCount=e.DayCount);let r=this.Script;JSComplier.Execute(r,a,this.ErrorCallback)},this.RecvResultData=function(e,t){var a=t.Self,r=t.JSExecute,i=null;r.SymbolData.Data&&(i=r.SymbolData.Data.GetDate());var n={Out:e,Date:i,Stock:{Name:r.SymbolData.Name,Symbol:r.SymbolData.Symbol},Index:{Name:a.Name,ID:a.ID}};r.SymbolData.DataType==HQ_DATA_TYPE.MULTIDAY_MINUTE_ID||r.SymbolData.DataType==HQ_DATA_TYPE.MINUTE_ID?n.Time=r.SymbolData.Data.GetTime():r.SymbolData.DataType==HQ_DATA_TYPE.KLINE_ID&&ChartData.IsMinutePeriod(r.SymbolData.Period,!0)&&(n.Time=r.SymbolData.Data.GetTime()),a.FinishCallback&&a.FinishCallback(n,t.JSExecute)}}function DownloadFinValueData(e){this.Url=e.Url,this.Job=e.Job,this.Symbol=e.Symbol,this.Args=e.Args,this.DataKey=e.DataKey,this.RecvCallback=e.Callback,this.ErrorCallback=e.ErrorCallback,this.Download=function(){var e=this,t=this.GetFieldList();if(!t)return message=`${this.Job.FunctionName}(${this.Args[0]}) can\'t support.`,this.ErrorCallback(message),void e.RecvCallback(null,e.Job,e.DataKey);JSNetwork.HttpRequest({url:this.Url,data:{field:t,symbol:[this.Symbol],condition:[{item:["finance","doc","exists","true"]}],start:0,end:200},type:"post",dataType:"json",async:!0,success:function(t){var a=e.ToHQChartData(t);a&&a.sort(function(e,t){return e.Date-t.Date}),e.RecvCallback(a,e.Job,e.DataKey)}})},this.ToHQChartData=function(e){if(!e.stock||1!=e.stock.length)return null;var t=[],a=new Set,r=e.stock[0];for(var i in r.stockday){var n,s=r.stockday[i];if(s.announcement1)(n=this.ToHQChartItemData(s.announcement1,s.finance1,s))&&!a.has(n.Date)&&(t.push(n),a.add(n.Date));if(s.announcement2)(n=this.ToHQChartItemData(s.announcement2,s.finance2,s))&&!a.has(n.Date)&&(t.push(n),a.add(n.Date));if(s.announcement3)(n=this.ToHQChartItemData(s.announcement3,s.finance3,s))&&!a.has(n.Date)&&(t.push(n),a.add(n.Date));if(s.announcement4)(n=this.ToHQChartItemData(s.announcement4,s.finance4,s))&&!a.has(n.Date)&&(t.push(n),a.add(n.Date))}return t},this.ToHQChartItemData=function(e,t,a){var r=this.Args[0],i=1e4*e.year;switch(e.quarter){case 1:i+=331;break;case 2:i+=630;break;case 3:i+=930;break;case 4:i+=1231;break;default:return null}var n={Date:i,Value:0};switch(r){case 0:n.Value=i%1e6;break;case 1:n.Value=t.persearning;break;case 3:n.Value=t.peruprofit;break;case 4:n.Value=t.pernetasset;break;case 5:n.Value=t.percreserve;break;case 6:n.Value=t.woewa;break;case 7:n.Value=t.perccfo;break;case 8:n.Value=t.monetaryfunds;break;case 11:n.Value=t.areceivable}return n},this.GetFieldList=function(){switch(this.Args[0]){case 0:return["finance.date"];case 1:return["finance.persearning"];case 3:return["finance.peruprofit"];case 4:return["finance.pernetasset"];case 5:return["finance.percreserve"];case 6:return["finance.woewa"];case 7:return["finance.perccfo"];case 8:return["finance.monetaryfunds"];case 11:return["finance.areceivable"];default:return null}}}function DownloadFinOneData(e){this.newMethod=DownloadFinValueData,this.newMethod(e),delete this.newMethod,this.Download=function(){var e=this,t=this.GetFieldList();if(!t)return message=`${this.Job.FunctionName}(${this.Args[0]}, ${this.Args[1]}, ${this.Args[2]}) can\'t support.`,this.ErrorCallback(message),void e.RecvCallback(null,e.Job,e.DataKey);var a=[{item:["finance","doc","exists","true"]}],r=this.Args[1],i=this.Args[2],n=0,s=3,u=null;0==r&&0==i||(0==r&&i<300?(n=i,s=200):0==i&&r<1e3?u=r:r>1909&&(331==i?(a=[{item:["announcement1.year","int32","eq",r]},{item:["finance1","doc","exists","true"]}],t.push("announcement1.year"),t.push("announcement1.quarter")):630==i?(a=[{item:["announcement2.year","int32","eq",r]},{item:["finance2","doc","exists","true"]}],t.push("announcement2.year"),t.push("announcement2.quarter")):930==i?(a=[{item:["announcement3.year","int32","eq",r]},{item:["finance3","doc","exists","true"]}],t.push("announcement4.year"),t.push("announcement4.quarter")):(a=[{item:["announcement4.year","int32","eq",r]},{item:["finance4","doc","exists","true"]}],t.push("announcement4.year"),t.push("announcement4.quarter")))),JSNetwork.HttpRequest({url:this.Url,data:{field:t,symbol:[this.Symbol],condition:a,start:0,end:s},type:"post",dataType:"json",async:!0,success:function(t){var a=e.ToHQChartData(t),r=null;a&&a.length>0&&(a.sort(function(e,t){return t.Date-e.Date}),r=null==u?a[n]:e.GetPreYearData(a,u)),e.RecvCallback(r,e.Job,e.DataKey)}})},this.GetPreYearData=function(e,t){if(331!=t&&630!=t&&930!=t&&1231!=t){for(var a=e[0].Date%1e3,r=(i=1,0);i<e.length;++i){if((n=e[i]).Date%1e4==a&&++r==t)return n}return null}for(var i in e){var n;if((n=e[i]).Date%1e4==t)return n}}}function DownloadFinanceData(e){this.Url=e.Url,this.RealtimeUrl=e.RealtimeUrl,this.Job=e.Job,this.Symbol=e.Symbol,this.Args=e.Args,this.DataKey=e.DataKey,this.RecvCallback=e.Callback,this.ErrorCallback=e.ErrorCallback,this.Download=function(){var e=this.Args[0];switch(e){case 1:case 7:case"EXCHANGE":this.DownloadHistoryData(e);break;case 9:case 18:case 30:case 32:case 33:case 34:case 38:case 40:case 41:case 42:case 43:case"CAPITAL":case"TOTALCAPITAL":case 100:default:this.DownloadRealtimeData(e)}},this.DownloadRealtimeData=function(e){var t=this,a=this.GetFieldList();if(!a)return this.Job.FunctionName2?message=`${this.Job.FunctionName2} can\'t support.`:this.Job.FunctionName?message=`${this.Job.FunctionName}(${this.Args[0]}) can\'t support.`:message=`${this.Args[0]} can\'t support.`,this.ErrorCallback(message),void t.RecvCallback(null,t.Job,t.DataKey);JSNetwork.HttpRequest({url:this.RealtimeUrl,data:{field:a,symbol:[this.Symbol],condition:[],start:0,end:10},type:"post",dataType:"json",async:!0,success:function(e){var a=t.RealtimeDataToHQChartData(e);t.RecvCallback(a,t.Job,t.DataKey)}})},this.DownloadHistoryData=function(e){var t=this,a=this.GetFieldList();if(!a)return message=`${this.Job.FunctionName}(${this.Args[0]}) can\'t support.`,this.ErrorCallback(message),void t.RecvCallback(null,t.Job,t.DataKey);JSNetwork.HttpRequest({url:this.Url,data:{field:a,symbol:[this.Symbol],condition:[],start:0,end:200},type:"post",dataType:"json",async:!0,success:function(e){var a=t.ToHQChartData(e);a&&a.sort(function(e,t){return e.Date-t.Date}),t.RecvCallback(a,t.Job,t.DataKey)}})},this.GetFieldList=function(){switch(this.Args[0]){case 1:return["capital.total","capital.date"];case 7:case"EXCHANGE":return["capital.a","capital.date"];case 9:return["finance.peruprofit","symbol","date"];case 18:return["finance.percreserve","symbol","date"];case 30:return["finance.nprofit","symbol","date"];case 32:return["finance.peruprofit","symbol","date"];case 33:return["finance.persearning","symbol","date"];case 34:return["finance.pernetasset","symbol","date"];case 38:return["finance.persearning","symbol","date"];case 40:return["capital.a","capital.date","symbol","date","price"];case 41:return["capital.total","capital.date","symbol","date","price"];case"CAPITAL":return["capital.a","capital.date","symbol","date"];case"TOTALCAPITAL":return["capital.total","capital.date","symbol","date"];case 42:return["company.releasedate","symbol","date"];case 43:return["dividendyield","symbol","date"];case 100:return["shareholder","symbol","date"];default:return null}},this.RealtimeDataToHQChartData=function(e,t){if(!e.stock||1!=e.stock.length)return null;var a=e.stock[0],r=(t=this.Args[0],a.date);switch(t){case 9:return a.finance?{Date:r,Value:a.finance.peruprofit}:null;case 18:return a.finance?{Date:r,Value:a.finance.percreserve}:null;case 30:return a.finance?{Date:r,Value:a.finance.nprofit}:null;case 32:return a.finance?{Date:r,Value:a.finance.peruprofit}:null;case 33:return a.finance?{Date:r,Value:a.finance.persearning}:null;case 34:return a.finance?{Date:r,Value:a.finance.pernetasset}:null;case 38:return a.finance?{Date:r,Value:a.finance.persearning}:null;case 40:return a.capital?{Date:r,Value:a.capital.a*a.price}:null;case 41:return a.capital?{Date:r,Value:a.capital.total*a.price}:null;case 42:if(!a.company)return null;var i=a.company.releasedate,n=parseInt(i/1e4),s=parseInt(i%1e4/100),u=new Date(n,s-1,i%100),o=new Date;return{Date:r,Value:parseInt((o.getTime()-u.getTime())/864e5)+1};case 43:return a.dividendyield?{Date:r,Value:a.dividendyield.quarter4}:null;case 100:return a.shareholder?{Date:r,Value:a.shareholder.count}:null;case"CAPITAL":return a.capital?{Date:r,Value:a.capital.a/100}:null;case"TOTALCAPITAL":return a.capital?{Date:r,Value:a.capital.total/100}:null}},this.ToHQChartData=function(e){if(!e.stock||1!=e.stock.length)return null;var t=[],a=new Set,r=e.stock[0],i=this.Args[0];for(var n in r.stockday){var s=r.stockday[n],u=this.ToHQChartItemData(s,i);u&&!a.has(u.Date)&&(t.push(u),a.add(u.Date))}return t},this.ToHQChartItemData=function(e,t){if(!e)return null;var a=e.date;switch(t){case 1:return e.capital?{Date:a,Value:e.capital.total}:null;case 7:case"EXCHANGE":return e.capital?{Date:a,Value:e.capital.a}:null;default:return null}}}function DownloadGPJYValue(e){this.Url=e.Url,this.RealtimeUrl=e.RealtimeUrl,this.Job=e.Job,this.Symbol=e.Symbol,this.Args=e.Args,this.DataKey=e.DataKey,this.RecvCallback=e.Callback,this.ErrorCallback=e.ErrorCallback,this.Download=function(){var e=this,t=this.GetFieldList();if(!t)return message=`${this.Job.FunctionName}(${this.Args[0]}, ${this.Args[1]}, ${this.Args[2]}) can\'t support.`,this.ErrorCallback(message),void e.RecvCallback(null,e.Job,e.DataKey,!0);JSNetwork.HttpRequest({url:this.Url,data:{field:t,symbol:[this.Symbol],orderfield:"date",order:-1,start:0,end:5},type:"post",dataType:"json",async:!0,success:function(t){var a=e.ToHQChartData(t);a&&a.length>0&&a.sort(function(e,t){return e.Date-t.Date}),e.RecvCallback(a,e.Job,e.DataKey)}})},this.GetFieldList=function(){switch(this.Args[0]){case 1:return["shareholder","date","symbol"];case 2:return["tradedetail.buy","tradedetail.sell","date","symbol"];case 3:return["margin","date","symbol"];case 4:return["blocktrading.amount","blocktrading.price","date","symbol"];default:return null}},this.ToHQChartData=function(e){if(!e.stock||1!=e.stock.length)return null;var t=[],a=new Set,r=e.stock[0],i=this.Args[0],n=this.Args[1];for(var s in r.stockday){var u=r.stockday[s],o=this.ToHQChartItemData(u,i,n);o&&!a.has(o.Date)&&(t.push(o),a.add(o.Date))}return t},this.ToHQChartItemData=function(e,t,a){if(!e)return null;var r=e.date;switch(t){case 1:return e.shareholder?{Date:r,Value:e.shareholder.count}:null;case 2:return!e.tradedetail&&e.tradedetail[0]?null:0==a?{Date:r,Value:e.tradedetail[0].buy}:{Date:r,Value:e.tradedetail[0].sell};case 3:if(!e.margin)return null;if(0==a){if(e.margin.buy)return{Date:r,Value:e.margin.buy.balance}}else if(e.margin.sell)return{Date:r,Value:e.margin.sell.balance};return null;case 4:return e.blocktrading?0==a?{Date:r,Value:e.blocktrading.price}:{Date:r,Value:e.blocktrading.amount}:null;default:return null}}}ScriptIndexConsole.SetDomain=function(e,t){JSComplier.SetDomain(e,t)};var enlargeminutechart=1;function getlastminute(){return 0==minutedata.length?0:minutedata[minutedata.length-1][0]}function updatelastminute(t){if(minutedata.length>0)for(var e=minutedata.length-1,a=e;a>=0;a--)if(minutedata[a][0]==t[0][0]){for(var i=a;i<=e;i++)minutedata.pop();a=0}else minutedata[a][0]<t[0][0]&&(a=0);return Array.prototype.push.apply(minutedata,t),debug&&console.log("minutedata",minutedata),minutedata}function datetime(t){var e=new Date(1e3*t),a=e.toTimeString(),i=e.getFullYear(),r=e.getMonth()+1,n=e.getDate();return i.toString()+(r<10?"0"+r:r)+(n<10?"0"+n:n)+" "+a.substr(0,2)+a.substr(3,2)}function zoomup(t){var e={};e.Index=parseInt(Math.abs(t.CursorIndex-.5).toFixed(0)),t.Frame.ZoomUp(e)&&(t.CursorIndex=e.Index,t.UpdatePointByCursorIndex(),t.UpdataDataoffset(),t.UpdateFrameMaxMin(),t.Draw(),t.ShowTooltipByKeyDown(),t.StopDragTimer())}function zoomdown(t){var e={};e.Index=parseInt(Math.abs(t.CursorIndex-.5).toFixed(0)),t.Frame.ZoomDown(e)&&(t.CursorIndex=e.Index,t.UpdatePointByCursorIndex(),t.UpdataDataoffset(),t.UpdateFrameMaxMin(),t.Draw(),t.ShowTooltipByKeyDown(),t.StopDragTimer())}function pan(t,e,a){var i=0;(i=t.Frame.XPointCount?t.Frame.XPointCount:t.Frame.SubFrame[0].Frame.XPointCount)||(i=50),(a&&t.DataMove(1e8,!0)||!a&&t.DataMove(.8*i,e))&&(t.UpdataDataoffset(),t.UpdatePointByCursorIndex(),t.UpdateFrameMaxMin(),t.ResetFrameXYSplit(),t.Draw())}if(window.minutedata=[],window.chartdata=[],!JSConsole)var JSConsole={Chart:{Log:console.log},Complier:{Log:console.log}};function JSChart(t,e){this.DivElement=t,this.DivToolElement=null,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jschart-drawing",this.CanvasElement.id=Guid(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),t.hasChildNodes()&&JSConsole.Chart.Log("[JSChart::JSChart] divElement hasChildNodes",t.childNodes),t.appendChild(this.CanvasElement),this.OffscreenCanvasElement,1==e&&(this.OffscreenCanvasElement=document.createElement("canvas")),this.ModifyIndexDialog=new ModifyIndexDialog(t),this.ChangeIndexDialog=new ChangeIndexDialog(t),this.MinuteDialog=new MinuteDialog(t),this.OnSize=function(t){var e=parseInt(this.DivElement.style.height.replace("px",""));this.ToolElement&&(e-=this.ToolElement.style.height.replace("px","")),this.CanvasElement.height=e,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var a=GetDevicePixelRatio();this.CanvasElement.height*=a,this.CanvasElement.width*=a,this.OffscreenCanvasElement&&(this.OffscreenCanvasElement.height=this.CanvasElement.height,this.OffscreenCanvasElement.width=this.CanvasElement.width),JSConsole.Chart.Log(`[JSChart::OnSize] devicePixelRatio=${window.devicePixelRatio}, height=${this.CanvasElement.height}, width=${this.CanvasElement.width}`),this.JSChartContainer&&(this.JSChartContainer.OnSize&&t&&1==t.Type?this.JSChartContainer.OnSize():(this.JSChartContainer.Frame&&this.JSChartContainer.Frame.SetSizeChage(!0),this.JSChartContainer.Draw()))},this.AdjustChartBorder=function(t){var e=GetDevicePixelRatio();t.Frame.ChartBorder.Left*=e,t.Frame.ChartBorder.Right*=e,t.Frame.ChartBorder.Top*=e,t.Frame.ChartBorder.Bottom*=e},this.AdjustTitleHeight=function(t){var e=GetDevicePixelRatio();for(var a in t.Frame.SubFrame)t.Frame.SubFrame[a].Frame.ChartBorder.TitleHeight*=e;t.ChartCorssCursor.TextHeight*=e},this.CreateKLineChartContainer=function(t){debug&&console.log("CreateKLineChartContainer",t);var e=null;(e="历史K线图横屏"===t.Type?new KLineChartHScreenContainer(this.CanvasElement):new KLineChartContainer(this.CanvasElement,this.OffscreenCanvasElement),t.NetworkFilter&&(e.NetworkFilter=t.NetworkFilter),e.ModifyIndexDialog=this.ModifyIndexDialog,e.ChangeIndexDialog=this.ChangeIndexDialog,e.MinuteDialog=this.MinuteDialog,1==t.IsShowRightMenu&&(e.RightMenu=new KLineRightMenu(this.DivElement)),t.ScriptError&&(e.ScriptErrorCallback=t.ScriptError),e.SelectRectRightMenu=new KLineSelectRightMenu(this.DivElement),1==t.EnableScrollUpDown&&(e.EnableScrollUpDown=t.EnableScrollUpDown),1==t.DisableMouse&&(e.DisableMouse=t.DisableMouse),t.TouchMoveMinAngle&&(e.TouchMoveMinAngle=t.TouchMoveMinAngle),t.KLine&&(t.KLine.DragMode>=0&&(e.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(e.Right=t.KLine.Right),t.KLine.Period>=0&&(e.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(e.MaxReqeustDataCount=t.KLine.MaxReqeustDataCount),t.KLine.Info&&t.KLine.Info.length>0&&e.SetKLineInfo(t.KLine.Info,!1),t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),0==t.KLine.KLineDoubleClick&&(e.MinuteDialog=this.MinuteDialog=null),null!=t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),0==t.KLine.IsShowTooltip&&(e.IsShowTooltip=!1),t.KLine.MaxRequestMinuteDayCount>0&&(e.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(e.KLineDrawType=t.KLine.DrawType),t.KLine.FirstShowDate>19910101&&(e.CustomShow={Date:t.KLine.FirstShowDate,PageSize:t.KLine.PageSize}),t.KLine.RightSpaceCount>0&&(e.RightSpaceCount=t.KLine.RightSpaceCount),t.KLine.ZoomType>0&&(e.ZoomType=t.KLine.ZoomType),t.KLine.DataWidth>=1&&(e.KLineSize={DataWidth:t.KLine.DataWidth})),t.EnableFlowCapital)&&(1==(i=t.EnableFlowCapital).BIT&&(e.EnableFlowCapital.BIT=i.BIT));if(IFrameSplitOperator.IsBool(t.EnableBorderDrag)&&(e.EnableBorderDrag=t.EnableBorderDrag),t.Page&&(t.Page.Day&&1==t.Page.Day.Enable&&(e.Page.Day.Enable=!0),t.Page.Minute&&1==t.Page.Minute.Enable&&(e.Page.Minute.Enable=!0)),t.DragDownload&&(t.DragDownload.Day&&1==t.DragDownload.Day.Enable&&(e.DragDownload.Day.Enable=!0),t.DragDownload.Minute&&1==t.DragDownload.Minute.Enable&&(e.DragDownload.Minute.Enable=!0)),t.Language&&("CN"===t.Language?e.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID:"EN"===t.Language&&(e.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_ENGLISH_ID)),t.SourceDatatLimit&&e.SetSourceDatatLimit(t.SourceDatatLimit),t.DrawPicture&&t.DrawPicture.StorageKey&&e.ChartDrawStorage&&e.ChartDrawStorage.Load(t.DrawPicture.StorageKey),t.DrawTool&&t.DrawTool.StorageKey&&e.ChartDrawStorage&&e.ChartDrawStorage.Load(t.DrawTool.StorageKey),t.StepPixel>0&&(e.StepPixel=t.StepPixel),t.ZoomStepPixel>0&&(e.ZoomStepPixel=t.ZoomStepPixel),1==t.IsApiPeriod&&(e.IsApiPeriod=t.IsApiPeriod),!t.Windows||t.Windows.length<=0)return null;if(e.Create(t.Windows.length,t.Listener),t.Border&&(IFrameSplitOperator.IsNumber(t.Border.Left)?e.Frame.ChartBorder.Left=t.Border.Left:t.Border.Left=e.Frame.ChartBorder.Left,IFrameSplitOperator.IsNumber(t.Border.Right)?e.Frame.ChartBorder.Right=t.Border.Right:t.Border.Right=e.Frame.ChartBorder.Right,IFrameSplitOperator.IsNumber(t.Border.Top)?e.Frame.ChartBorder.Top=t.Border.Top:t.Border.Top=e.Frame.ChartBorder.Top,IFrameSplitOperator.IsNumber(t.Border.Bottom)?e.Frame.ChartBorder.Bottom=t.Border.Bottom:t.Border.Bottom=e.Frame.ChartBorder.Bottom),this.AdjustChartBorder(e),t.KLine&&t.KLine.PageSize>0){let a=e.GetMaxMinPageSize();a.Max>10&&a.Max<t.KLine.PageSize?e.PageSize=a.Max:a.Min>10&&a.Min>t.KLine.PageSize?e.PageSize=a.Min:e.PageSize=t.KLine.PageSize}if(!0===t.IsCorssOnlyDrawKLine&&(e.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),!0===t.CorssCursorTouchEnd&&(e.CorssCursorTouchEnd=t.CorssCursorTouchEnd),1==t.IsClickShowCorssCursor&&(e.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(e.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(e.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(e.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),!1===t.CorssCursorInfo.IsShowCorss&&(e.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),1==t.CorssCursorInfo.IsShowClose&&(e.ChartCorssCursor.IsShowClose=t.CorssCursorInfo.IsShowClose),t.CorssCursorInfo.PressTime&&(e.PressTime=t.CorssCursorInfo.PressTime),t.CorssCursorInfo.HPenType>0&&(e.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(e.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType),t.CorssCursorInfo.DateFormatType>0&&(e.ChartCorssCursor.StringFormatX.DateFormatType=t.CorssCursorInfo.DateFormatType)),t.CorssCursor={},t.CorssCursor.TitleHeight=e.ChartCorssCursor.TextHeight,IFrameSplitOperator.IsObjectExist(t.SplashTitle)&&(e.ChartSplashPaint.SplashTitle=t.SplashTitle),t.Frame)for(var a in t.Frame){var i=t.Frame[a];e.Frame.SubFrame[a]&&(i.SplitCount&&(e.Frame.SubFrame[a].Frame.YSplitOperator.SplitCount=i.SplitCount),i.StringFormat&&(e.Frame.SubFrame[a].Frame.YSplitOperator.StringFormat=i.StringFormat),IFrameSplitOperator.IsNumber(i.FloatPrecision)&&(e.Frame.SubFrame[a].Frame.YSplitOperator.FloatPrecision=i.FloatPrecision),i.Custom&&(e.Frame.SubFrame[a].Frame.YSplitOperator.Custom=i.Custom),IFrameSplitOperator.IsNumber(i.SplitType)&&(e.Frame.SubFrame[a].Frame.YSplitOperator.SplitType=i.SplitType),isNaN(i.Height)||(e.Frame.SubFrame[a].Height=i.Height),!1!==i.IsShowLeftText&&!0!==i.IsShowLeftText||(e.Frame.SubFrame[a].Frame.IsShowYText[0]=i.IsShowLeftText,e.Frame.SubFrame[a].Frame.YSplitOperator.IsShowLeftText=i.IsShowLeftText),!1!==i.IsShowRightText&&!0!==i.IsShowRightText||(e.Frame.SubFrame[a].Frame.IsShowYText[1]=i.IsShowRightText,e.Frame.SubFrame[a].Frame.YSplitOperator.IsShowRightText=i.IsShowRightText),i.TopSpace>=0&&(e.Frame.SubFrame[a].Frame.ChartBorder.TopSpace=i.TopSpace),i.BottomSpace>=0&&(e.Frame.SubFrame[a].Frame.ChartBorder.BottomSpace=i.BottomSpace),i.RightTextPosition>0&&(e.Frame.SubFrame[a].Frame.YTextPosition[1]=i.RightTextPosition),i.LeftTextPosition>0&&(e.Frame.SubFrame[a].Frame.YTextPosition[0]=i.LeftTextPosition),0==i.IsShowXLine&&(e.Frame.SubFrame[a].Frame.IsShowXLine=i.IsShowXLine),0==i.IsShowYLine&&(e.Frame.SubFrame[a].Frame.IsShowYLine=i.IsShowYLine),i.YCoordinateType>0&&(e.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=i.YCoordinateType),1==i.IsYReverse&&(e.Frame.SubFrame[0].Frame.CoordinateType=1),i.DefaultYMaxMin&&(e.Frame.SubFrame[a].Frame.YSplitOperator.DefaultYMaxMin=i.DefaultYMaxMin),IFrameSplitOperator.IsBool(i.EnableRemoveZero)&&(e.Frame.SubFrame[a].Frame.YSplitOperator.EnableRemoveZero=i.EnableRemoveZero),IFrameSplitOperator.IsPlusNumber(i.MinYDistance)&&(e.Frame.SubFrame[a].Frame.MinYDistance=i.MinYDistance),IFrameSplitOperator.IsNumber(i.BorderLine)&&(e.Frame.SubFrame[a].Frame.BorderLine=i.BorderLine))}if(t.KLine&&(0==t.KLine.ShowKLine&&(e.ChartPaint[0].IsShow=!1),t.KLine.InfoPosition>0&&(e.ChartPaint[0].InfoPosition=t.KLine.InfoPosition),0==t.KLine.IsShowMaxMinPrice&&(e.ChartPaint[0].IsShowMaxMinPrice=t.KLine.IsShowMaxMinPrice)),t.KLineTitle&&(0==t.KLineTitle.IsShowName&&(e.TitlePaint[0].IsShowName=!1),0==t.KLineTitle.IsShowSettingInfo&&(e.TitlePaint[0].IsShowSettingInfo=!1),0==t.KLineTitle.IsShow&&(e.TitlePaint[0].IsShow=!1)),t.Overlay)for(var a in t.Overlay){i=t.Overlay[a];e.OverlaySymbol(i.Symbol,i)}if(t.ExtendChart)for(var a in t.ExtendChart){i=t.ExtendChart[a];e.CreateExtendChart(i.Name,i)}let r=new JSIndexScript;if(t.ColorIndex){i=t.ColorIndex;let a=r.Get(i.Index);a&&(a.ID=i.Index,e.ColorIndex=new ScriptIndex(a.Name,a.Script,a.Args,a))}if(t.TradeIndex){i=t.TradeIndex;let a=r.Get(i.Index);a&&(a.ID=i.Index,e.TradeIndex=new ScriptIndex(a.Name,a.Script,a.Args,a))}for(var a in t.Windows){if((i=t.Windows[a]).Script)e.WindowIndex[a]=new ScriptIndex(i.Name,i.Script,i.Args,i);else if(i.JsonData)e.WindowIndex[a]=new JsonDataIndex(i.Name,i.Script,i.Args,i);else if(i.Local&&i.Local.Data)e.WindowIndex[a]=new LocalJsonDataIndex(i.Local.Name,i.Local.Args,{JsonData:i.Local.Data});else if(i.API){var n=i.API;e.WindowIndex[a]=new APIScriptIndex(n.Name,n.Script,n.Args,i)}else{let t=JSIndexMap.Get(i.Index);if(t)e.WindowIndex[a]=t.Create(),e.CreateWindowIndex(a);else{let t=r.Get(i.Index);if(!t)continue;i.Lock&&(t.Lock=i.Lock),t.ID=i.Index;var s=t.Args;i.Args&&(s=i.Args),i.IsShortTitle&&(t.IsShortTitle=i.IsShortTitle),i.TitleFont&&(t.TitleFont=i.TitleFont),e.WindowIndex[a]=new ScriptIndex(t.Name,t.Script,s,t),i.StringFormat>0&&(e.WindowIndex[a].StringFormat=i.StringFormat),i.FloatPrecision>=0&&(e.WindowIndex[a].FloatPrecision=i.FloatPrecision)}}null!=i.Modify&&(e.Frame.SubFrame[a].Frame.ModifyIndex=i.Modify),null!=i.Change&&(e.Frame.SubFrame[a].Frame.ChangeIndex=i.Change),null!=i.Close&&(e.Frame.SubFrame[a].Frame.CloseIndex=i.Close),null!=i.Overlay&&(e.Frame.SubFrame[a].Frame.OverlayIndex=i.Overlay),1==i.IsDrawTitleBG&&(e.Frame.SubFrame[a].Frame.IsDrawTitleBG=i.IsDrawTitleBG),IFrameSplitOperator.IsNumber(i.TitleHeight)?e.Frame.SubFrame[a].Frame.ChartBorder.TitleHeight=i.TitleHeight:i.TitleHeight=e.Frame.SubFrame[a].Frame.ChartBorder.TitleHeight,0==i.IsShowTitleArraw&&(e.Frame.SubFrame[a].Frame.IsShowTitleArraw=!1),0==i.IsShowIndexName&&(e.Frame.SubFrame[a].Frame.IsShowIndexName=!1),i.IndexParamSpace>=0&&(e.Frame.SubFrame[a].Frame.IndexParamSpace=i.IndexParamSpace)}for(var a in t.OverlayIndexFrameWidth>40&&(e.OverlayIndexFrameWidth=t.OverlayIndexFrameWidth),t.OverlayIndex){if(!((i=t.OverlayIndex[a]).Windows>=e.Frame.SubFrame.length)){var o=JSON.stringify(i),h=JSON.parse(o);i.Index&&(h.IndexName=i.Index),i.Windows>=0&&(h.WindowIndex=i.Windows),e.CreateOverlayWindowsIndex(h)}}return this.AdjustTitleHeight(e),e},this.CreateCustomKLineChartContainer=function(t){var e=new CustomKLineChartContainer(this.CanvasElement);if(e.ModifyIndexDialog=this.ModifyIndexDialog,e.ChangeIndexDialog=this.ChangeIndexDialog,e.MinuteDialog=this.MinuteDialog,1==t.IsShowRightMenu&&(e.RightMenu=new KLineRightMenu(this.DivElement)),t.KLine&&(t.KLine.DragMode>=0&&(e.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(e.Right=t.KLine.Right),t.KLine.Period>=0&&(e.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(e.MaxReqeustDataCount=t.KLine.MaxReqeustDataCount),t.KLine.Info&&t.KLine.Info.length>0&&e.SetKLineInfo(t.KLine.Info,!1),t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),0==t.KLine.KLineDoubleClick&&(e.MinuteDialog=this.MinuteDialog=null),null!=t.KLine.IndexTreeApiUrl&&(e.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),t.KLine.PageSize>0&&(e.PageSize=t.KLine.PageSize),0==t.KLine.IsShowTooltip&&(e.IsShowTooltip=!1)),t.CustomStock&&(e.CustomStock=t.CustomStock),t.QueryDate&&(e.QueryDate=t.QueryDate),!t.Windows||t.Windows.length<=0)return null;if(e.Create(t.Windows.length),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),0==t.IsShowCorssCursorInfo&&(e.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.Frame)for(var a in t.Frame){(r=t.Frame[a]).SplitCount&&(e.Frame.SubFrame[a].Frame.YSplitOperator.SplitCount=r.SplitCount),r.StringFormat&&(e.Frame.SubFrame[a].Frame.YSplitOperator.StringFormat=r.StringFormat)}t.KLineTitle&&(0==t.KLineTitle.IsShowName&&(e.TitlePaint[0].IsShowName=!1),0==t.KLineTitle.IsShowSettingInfo&&(e.TitlePaint[0].IsShowSettingInfo=!1));let i=new JSIndexScript;for(var a in t.Windows){var r;if((r=t.Windows[a]).Script)e.WindowIndex[a]=new ScriptIndex(r.Name,r.Script,r.Args,r);else{let t=JSIndexMap.Get(r.Index);if(t)e.WindowIndex[a]=t.Create(),e.CreateWindowIndex(a);else{let t=i.Get(r.Index);if(!t)continue;r.Lock&&(t.Lock=r.Lock),e.WindowIndex[a]=new ScriptIndex(t.Name,t.Script,t.Args,t)}}null!=r.Modify&&(e.Frame.SubFrame[a].Frame.ModifyIndex=r.Modify),null!=r.Change&&(e.Frame.SubFrame[a].Frame.ChangeIndex=r.Change),isNaN(r.TitleHeight)||(e.Frame.SubFrame[a].Frame.ChartBorder.TitleHeight=r.TitleHeight)}return e},this.CreateMinuteChartContainer=function(t){var e=null;e="分钟走势图横屏"===t.Type?new MinuteChartHScreenContainer(this.CanvasElement):new MinuteChartContainer(this.CanvasElement),t.NetworkFilter&&(e.NetworkFilter=t.NetworkFilter),e.ModifyIndexDialog=this.ModifyIndexDialog,e.ChangeIndexDialog=this.ChangeIndexDialog;var a=2;if(t.Windows&&t.Windows.length>0&&(a+=t.Windows.length),1==t.EnableScrollUpDown&&(e.EnableScrollUpDown=t.EnableScrollUpDown),1==t.DisableMouse&&(e.DisableMouse=t.DisableMouse),t.ScriptError&&(e.ScriptErrorCallback=t.ScriptError),t.Minute&&0==t.Minute.IsShowTooltip&&(e.IsShowTooltip=!1),t.Language&&("CN"===t.Language?e.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID:"EN"===t.Language&&(e.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_ENGLISH_ID)),t.Info&&t.Info.length>0&&e.SetMinuteInfo(t.Info,!1),t.DrawTool&&t.DrawTool.StorageKey&&e.ChartDrawStorage&&e.ChartDrawStorage.Load(t.DrawTool.StorageKey),e.Create(a,t.Listener),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(e.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(e.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(e.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),!1===t.CorssCursorInfo.IsShowCorss&&(e.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.RightTextFormat>0&&(e.ChartCorssCursor.TextFormat.Right=t.CorssCursorInfo.RightTextFormat),1==t.CorssCursorInfo.IsOnlyDrawMinute&&(e.ChartCorssCursor.IsOnlyDrawMinute=t.CorssCursorInfo.IsOnlyDrawMinute)),t.MinuteInfo&&e.CreateMinuteInfo(t.MinuteInfo),1==t.IsShowRightMenu&&(e.RightMenu=new MinuteRightMenu(this.DivElement)),t.DayCount>1&&(e.DayCount=t.DayCount),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top),isNaN(t.Border.Bottom)||(e.Frame.ChartBorder.Bottom=t.Border.Bottom)),t.SplashTitle&&(e.ChartSplashPaint.SplashTitle=t.SplashTitle),IFrameSplitOperator.IsBool(t.EnableBorderDrag)&&(e.EnableBorderDrag=t.EnableBorderDrag),this.AdjustChartBorder(e),t.Frame){for(var i in t.Frame){var r=t.Frame[i];e.Frame.SubFrame[i]&&(r.SplitCount&&(e.Frame.SubFrame[i].Frame.YSplitOperator.SplitCount=r.SplitCount),r.StringFormat&&(e.Frame.SubFrame[i].Frame.YSplitOperator.StringFormat=r.StringFormat),0==r.IsShowLeftText&&(e.Frame.SubFrame[i].Frame.IsShowYText[0]=r.IsShowLeftText,e.Frame.SubFrame[i].Frame.YSplitOperator.IsShowLeftText=r.IsShowLeftText),0==r.IsShowRightText&&(e.Frame.SubFrame[i].Frame.IsShowYText[1]=r.IsShowRightText,e.Frame.SubFrame[i].Frame.YSplitOperator.IsShowRightText=r.IsShowRightText),r.Height>=0&&(e.Frame.SubFrame[i].Height=r.Height),r.Custom&&(e.Frame.SubFrame[i].Frame.YSplitOperator.Custom=r.Custom),r.RightTextFormat>0&&(e.Frame.SubFrame[i].Frame.YSplitOperator.RightTextFormat=r.RightTextFormat),IFrameSplitOperator.IsNumber(r.BorderLine)&&(e.Frame.SubFrame[i].Frame.BorderLine=r.BorderLine))}e.UpdateXShowText()}if(t.ExtendChart)for(var i in t.ExtendChart){r=t.ExtendChart[i];e.CreateExtendChart(r.Name,r)}if(t.Overlay)for(var i in t.Overlay){r=t.Overlay[i];e.OverlaySymbol(r.Symbol,r)}if(t.MinuteLine&&(0==t.MinuteLine.IsDrawAreaPrice&&(e.ChartPaint[0].IsDrawArea=!1),0==t.MinuteLine.IsShowLead&&(e.IsShowLead=!1),0==t.MinuteLine.IsShowAveragePrice&&(e.ChartPaint[1].IsShow=!1,e.TitlePaint[0].IsShowAveragePrice=!1),t.MinuteLine.SplitType>0&&(e.Frame.SubFrame[0].Frame.YSplitOperator.SplitType=t.MinuteLine.SplitType)),t.MinuteTitle){r=t.MinuteTitle;IFrameSplitOperator.IsBool(r.IsShowName)&&(e.TitlePaint[0].IsShowName=r.IsShowName),IFrameSplitOperator.IsBool(r.IsShowDate)&&(e.TitlePaint[0].IsShowDate=r.IsShowDate),IFrameSplitOperator.IsBool(r.IsShowTime)&&(e.TitlePaint[0].IsShowTime=r.IsShowTime)}!0===t.CorssCursorTouchEnd&&(e.CorssCursorTouchEnd=t.CorssCursorTouchEnd),!0===t.IsShowBeforeData&&(e.IsShowBeforeData=t.IsShowBeforeData);let n=new JSIndexScript;for(var i in t.Windows){var s=2+parseInt(i);if((r=t.Windows[i]).Script)e.WindowIndex[s]=new ScriptIndex(r.Name,r.Script,r.Args);else if(r.API){var o=r.API;e.WindowIndex[s]=new APIScriptIndex(o.Name,o.Script,o.Args,r)}else{var h=JSIndexMap.Get(r.Index);if(h)e.WindowIndex[s]=h.Create(),e.CreateWindowIndex(s);else{let t=n.Get(r.Index);if(!t)continue;t.ID=r.Index;var l=t.Args;r.Args&&(l=r.Args),e.WindowIndex[s]=new ScriptIndex(t.Name,t.Script,l,t),r.StringFormat>0&&(e.WindowIndex[s].StringFormat=r.StringFormat),r.FloatPrecision>=0&&(e.WindowIndex[s].FloatPrecision=r.FloatPrecision)}}null!=r.Modify&&(e.Frame.SubFrame[s].Frame.ModifyIndex=r.Modify),null!=r.Change&&(e.Frame.SubFrame[s].Frame.ChangeIndex=r.Change),null!=r.Close&&(e.Frame.SubFrame[s].Frame.CloseIndex=r.Close),isNaN(r.TitleHeight)||(e.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight=r.TitleHeight)}if(this.AdjustTitleHeight(e),t.Function){var C=t.Function;C.RequestMinuteData&&(e.RequestMinuteData=C.RequestMinuteData),C.RecvMinuteData&&(e.RecvMinuteData=C.RecvMinuteData)}return e},this.CreateHistoryMinuteChartContainer=function(t){var e=new HistoryMinuteChartContainer(this.CanvasElement),a=2;t.Windows&&t.Windows.length>0&&(a+=t.Windows.length),e.Create(a),0==t.IsShowCorssCursorInfo&&(e.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top),isNaN(t.Border.Bottom)||(e.Frame.ChartBorder.Bottom=t.Border.Bottom));let i=new JSIndexScript;for(var r in t.Windows){var n=t.Windows[r];if(n.Script)e.WindowIndex[2+parseInt(r)]=new ScriptIndex(n.Name,n.Script,n.Args);else{var s=JSIndexMap.Get(n.Index);if(s)e.WindowIndex[2+parseInt(r)]=s.Create(),e.CreateWindowIndex(2+parseInt(r));else{let t=i.Get(n.Index);if(!t)continue;e.WindowIndex[2+parseInt(r)]=new ScriptIndex(t.Name,t.Script,t.Args)}}isNaN(n.TitleHeight)||(e.Frame.SubFrame[2+parseInt(r)].Frame.ChartBorder.TitleHeight=n.TitleHeight)}return e.TradeDate=20181009,t.HistoryMinute.TradeDate&&(e.TradeDate=t.HistoryMinute.TradeDate),null!=t.HistoryMinute.IsShowName&&(e.TitlePaint[0].IsShowName=t.HistoryMinute.IsShowName),null!=t.HistoryMinute.IsShowDate&&(e.TitlePaint[0].IsShowDate=t.HistoryMinute.IsShowDate),e},this.CreateKLineTrainChartContainer=function(t){var e="K线训练横屏"==t.Type,a=new KLineTrainChartContainer(this.CanvasElement,e);if(t.NetworkFilter&&(a.NetworkFilter=t.NetworkFilter),1==t.IsApiPeriod&&(a.IsApiPeriod=t.IsApiPeriod),a.ModifyIndexDialog=this.ModifyIndexDialog,a.ChangeIndexDialog=this.ChangeIndexDialog,t.ScriptError&&(a.ScriptErrorCallback=t.ScriptError),t.KLine&&(t.KLine.Right>=0&&(a.Right=t.KLine.Right),t.KLine.Period>=0&&(a.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(a.MaxReqeustDataCount=t.KLine.MaxReqeustDataCount),t.KLine.Info&&t.KLine.Info.length>0&&a.SetKLineInfo(t.KLine.Info,!1),t.KLine.PageSize>0&&(a.PageSize=t.KLine.PageSize),0==t.KLine.IsShowTooltip&&(a.IsShowTooltip=!1),t.KLine.MaxRequestMinuteDayCount>0&&(a.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(a.KLineDrawType=t.KLine.DrawType),t.KLine.RightSpaceCount>0&&(a.RightSpaceCount=t.KLine.RightSpaceCount)),t.Train&&(t.Train.DataCount&&(a.TrainDataCount=t.Train.DataCount),t.Train.Callback&&(a.TrainCallback=t.Train.Callback),t.Train.StartDate&&(a.TrainStartDate=t.Train.StartDate)),!t.Windows||t.Windows.length<=0)return null;if(a.Create(t.Windows.length),t.Border&&(isNaN(t.Border.Left)||(a.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(a.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(a.Frame.ChartBorder.Top=t.Border.Top),isNaN(t.Border.Bottom)||(a.Frame.ChartBorder.Bottom=t.Border.Bottom)),this.AdjustChartBorder(a),0==t.IsShowCorssCursorInfo&&(a.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),!0===t.IsCorssOnlyDrawKLine&&(a.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),!0===t.CorssCursorTouchEnd&&(a.CorssCursorTouchEnd=t.CorssCursorTouchEnd),1==t.IsClickShowCorssCursor&&(a.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(a.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(a.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(a.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),!1===t.CorssCursorInfo.IsShowCorss&&(a.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),1==t.CorssCursorInfo.IsShowClose&&(a.ChartCorssCursor.IsShowClose=t.CorssCursorInfo.IsShowClose),t.CorssCursorInfo.PressTime&&(a.PressTime=t.CorssCursorInfo.PressTime),t.CorssCursorInfo.HPenType>0&&(a.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(a.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType)),t.CorssCursor={},t.CorssCursor.TitleHeight=a.ChartCorssCursor.TextHeight,t.Frame)for(var i in t.Frame){var r=t.Frame[i];a.Frame.SubFrame[i]&&(r.SplitCount&&(a.Frame.SubFrame[i].Frame.YSplitOperator.SplitCount=r.SplitCount),r.StringFormat&&(a.Frame.SubFrame[i].Frame.YSplitOperator.StringFormat=r.StringFormat),IFrameSplitOperator.IsNumber(r.FloatPrecision)&&(a.Frame.SubFrame[i].Frame.YSplitOperator.FloatPrecision=r.FloatPrecision),r.Custom&&(a.Frame.SubFrame[i].Frame.YSplitOperator.Custom=r.Custom),IFrameSplitOperator.IsNumber(r.SplitType)&&(a.Frame.SubFrame[i].Frame.YSplitOperator.SplitType=r.SplitType),r.Height>0&&(a.Frame.SubFrame[i].Height=r.Height),0==r.IsShowLeftText&&(a.Frame.SubFrame[i].Frame.YSplitOperator.IsShowLeftText=r.IsShowLeftText),0==r.IsShowRightText&&(a.Frame.SubFrame[i].Frame.YSplitOperator.IsShowRightText=r.IsShowRightText))}if(t.KLine&&(0==t.KLine.ShowKLine&&(a.ChartPaint[0].IsShow=!1),t.KLine.InfoPosition>0&&(a.ChartPaint[0].InfoPosition=t.KLine.InfoPosition),0==t.KLine.IsShowMaxMinPrice&&(a.ChartPaint[0].IsShowMaxMinPrice=t.KLine.IsShowMaxMinPrice)),t.KLineTitle&&(0==t.KLineTitle.IsShowName&&(a.TitlePaint[0].IsShowName=!1),0==t.KLineTitle.IsShowSettingInfo&&(a.TitlePaint[0].IsShowSettingInfo=!1),0==t.KLineTitle.IsShow&&(a.TitlePaint[0].IsShow=!1)),t.ExtendChart)for(var i in t.ExtendChart){r=t.ExtendChart[i];a.CreateExtendChart(r.Name,r)}let n=new JSIndexScript;for(var i in t.Windows){if((r=t.Windows[i]).Script)a.WindowIndex[i]=new ScriptIndex(r.Name,r.Script,r.Args,r);else{let t=JSIndexMap.Get(r.Index);if(t)a.WindowIndex[i]=t.Create(),a.CreateWindowIndex(i);else{let t=n.Get(r.Index);if(!t)continue;r.Lock&&(t.Lock=r.Lock),a.WindowIndex[i]=new ScriptIndex(t.Name,t.Script,t.Args,t)}}null!=r.Modify&&(a.Frame.SubFrame[i].Frame.ModifyIndex=r.Modify),null!=r.Change&&(a.Frame.SubFrame[i].Frame.ChangeIndex=r.Change),null!=r.Close&&(a.Frame.SubFrame[i].Frame.CloseIndex=r.Close),isNaN(r.TitleHeight)||(a.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight=r.TitleHeight)}return this.AdjustTitleHeight(a),a},this.SetOption=function(t){debug&&console.log("------------------------------------------SetOption-------------------------------",t);var e=null;switch(t.Type){case"历史K线图":case"历史K线图横屏":e=this.CreateKLineChartContainer(t),window.chartdata.Kchart=e;break;case"自定义指数历史K线图":e=this.CreateCustomKLineChartContainer(t);break;case"分钟走势图":case"分钟走势图横屏":e=this.CreateMinuteChartContainer(t),window.chartdata.Mchart=e;break;case"历史分钟走势图":e=this.CreateHistoryMinuteChartContainer(t);break;case"K线训练":case"K线训练横屏":e=this.CreateKLineTrainChartContainer(t);break;case"简单图形":return this.CreateSimpleChart(t);case"饼图":case"雷达图":return this.CreatePieChart(t);case"地图":return this.CreateMapChart(t);default:return!1}if(!e)return!1;for(var a in null!=t.IsAutoUpdate&&(e.IsAutoUpdate=t.IsAutoUpdate),t.AutoUpdateFrequency>0&&(e.AutoUpdateFrequency=t.AutoUpdateFrequency),t.EventCallback){var i=t.EventCallback[a];e.AddEventCallback(i)}t.Symbol?(e.Draw(),e.ChangeSymbol(t.Symbol),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()):(e.DrawEmpty(),this.JSChartContainer=e,this.DivElement.JSChart=this)},this.CreateSimpleChart=function(t){var e=new SimlpleChartContainer(this.CanvasElement);t.MainDataControl&&(e.MainDataControl=t.MainDataControl),e.Create(),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),e.Draw(),e.RequestData(),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreatePieChart=function(t){var e=new PieChartContainer(this.CanvasElement);t.MainDataControl&&(e.MainDataControl=t.MainDataControl),t.Radius&&(e.Radius=t.Radius),e.Create(),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),this.AdjustChartBorder(e),t.Frame&&0==t.Frame[0].IsShowBorder&&(e.Frame.IsShowBorder=t.Frame[0].IsShowBorder),e.Draw(),e.RequestData(),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreateMapChart=function(t){var e=new MapChartContainer(this.CanvasElement);t.MainDataControl&&(e.MainDataControl=t.MainDataControl),e.Create(),t.Border&&(isNaN(t.Border.Left)||(e.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(e.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(e.Frame.ChartBorder.Top=t.Border.Top)),e.Draw(),e.RequestData(),this.JSChartContainer=e,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreateToolbar=function(t){},this.CreateSettingDiv=function(t){},this.Focus=function(){this.CanvasElement&&this.CanvasElement.focus()},this.ChangeSymbol=function(t){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(t)},this.ChangeIndex=function(t,e,a){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeIndex&&this.JSChartContainer.ChangeIndex(t,e,a)},this.ChangeScriptIndex=function(t,e,a){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeScriptIndex&&this.JSChartContainer.ChangeScriptIndex(t,e,a)},this.ChangePyScriptIndex=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangePyScriptIndex&&this.JSChartContainer.ChangePyScriptIndex(t,e)},this.GetIndexInfo=function(){return this.JSChartContainer&&"function"==typeof this.JSChartContainer.GetIndexInfo?this.JSChartContainer.GetIndexInfo():[]},this.ChangeInstructionIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeInstructionIndex&&this.JSChartContainer.ChangeInstructionIndex(t)},this.ChangeInstructionScriptIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeInstructionIndex&&this.JSChartContainer.ChangeInstructionScriptIndex(t)},this.CancelInstructionIndex=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.CancelInstructionIndex&&this.JSChartContainer.CancelInstructionIndex()},this.ChangePeriod=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangePeriod&&this.JSChartContainer.ChangePeriod(t,e)},this.ChangeRight=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeRight&&this.JSChartContainer.ChangeRight(t)},this.OverlaySymbol=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.OverlaySymbol&&this.JSChartContainer.OverlaySymbol(t,e)},this.DeleteOverlaySymbol=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.DeleteOverlaySymbol&&this.JSChartContainer.DeleteOverlaySymbol(t)},this.SetFirstShowDate=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetFirstShowDate&&this.JSChartContainer.SetFirstShowDate(t)},this.ChangeKLineDrawType=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeKLineDrawType&&this.JSChartContainer.ChangeKLineDrawType(t,e)},this.ChangeIndexWindowCount=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeIndexWindowCount&&this.JSChartContainer.ChangeIndexWindowCount(t,e)},this.ClearOverlaySymbol=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ClearOverlaySymbol&&this.JSChartContainer.ClearOverlaySymbol()},this.DeleteKLineInfo=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.DeleteKLineInfo&&this.JSChartContainer.DeleteKLineInfo(t)},this.ClearKLineInfo=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ClearKLineInfo&&this.JSChartContainer.ClearKLineInfo()},this.AddKLineInfo=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.AddKLineInfo&&this.JSChartContainer.AddKLineInfo(t,e)},this.ChangMainDataControl=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetMainDataConotrl&&this.JSChartContainer.SetMainDataConotrl(t)},this.AddOverlayIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.AddOverlayIndex&&this.JSChartContainer.AddOverlayIndex(t)},this.DeleteOverlayWindowsIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.DeleteOverlayWindowsIndex&&this.JSChartContainer.DeleteOverlayWindowsIndex(t)},this.StopAutoUpdate=function(){this.JSChartContainer&&"function"==typeof this.JSChartContainer.StopAutoUpdate&&this.JSChartContainer.StopAutoUpdate()},this.SetDepthMapData=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetDepthMapData&&this.JSChartContainer.SetDepthMapData(t,e)},this.ForceLandscape=function(t){this.JSChartContainer&&(JSConsole.Chart.Log("[JSChart::ForceLandscape] bForceLandscape="+t),this.JSChartContainer.IsForceLandscape=t)},this.LockIndex=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.LockIndex&&(JSConsole.Chart.Log("[JSChart:LockIndex] lockData",t),this.JSChartContainer.LockIndex(t))},this.ChangeTradeDate=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeTradeDate&&(JSConsole.Chart.Log("[JSChart:ChangeTradeDate] date",t),this.JSChartContainer.ChangeTradeDate(t))},this.ChangeDayCount=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeDayCount&&(JSConsole.Chart.Log("[JSChart:ChangeDayCount] count",t),this.JSChartContainer.ChangeDayCount(t))},this.StartAnimation=function(t){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.StartAnimation)return JSConsole.Chart.Log("[JSChart:StartAnimation] start."),this.JSChartContainer.StartAnimation(t)},this.StopAnimation=function(){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.StopAnimation)return JSConsole.Chart.Log("[JSChart:StopAnimation] start."),this.JSChartContainer.StopAnimation()},this.SaveToImage=function(t,e){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.SaveToImage)return this.JSChartContainer.SaveToImage(t,e)},this.SaveToImageUrl=function(t,e){if(this.JSChartContainer&&"function"==typeof this.JSChartContainer.SaveToImageUrl)return this.JSChartContainer.SaveToImageUrl(t,e)},this.AddEventCallback=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.AddEventCallback&&(JSConsole.Chart.Log("[JSChart:AddEventCallback] ",t),this.JSChartContainer.AddEventCallback(t))},this.SetLanguage=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetLanguage&&(JSConsole.Chart.Log("[JSChart:SetLanguage] ",t),this.JSChartContainer.SetLanguage(t))},this.ChangeIndexTemplate=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ChangeIndexTemplate&&(JSConsole.Chart.Log("[JSChart:ChangeIndexTemplate] ",t),this.JSChartContainer.ChangeIndexTemplate(t))},this.SetChartDrawOption=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.SetChartDrawOption&&(JSConsole.Chart.Log("[JSChart:SetChartDrawOption] ",t),this.JSChartContainer.SetChartDrawOption(t))},this.CreateChartDrawPicture=function(t,e){this.JSChartContainer&&"function"==typeof this.JSChartContainer.CreateChartDrawPicture&&(JSConsole.Chart.Log("[JSChart:CreateChartDrawPicture] ",t),this.JSChartContainer.CreateChartDrawPicture(t,e))},this.ClearChartDrawPicture=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ClearChartDrawPicture&&this.JSChartContainer.ClearChartDrawPicture(t)},this.ReloadResource=function(t){this.JSChartContainer&&"function"==typeof this.JSChartContainer.ReloadResource&&(JSConsole.Chart.Log("[JSChart:ReloadResource] "),this.JSChartContainer.ReloadResource(t))}}JSChart.Init=function(t){var e=new JSChart(t);return e.OnSize(),e},JSChart.SetDomain=function(t,e){t&&(g_JSChartResource.Domain=t),e&&(g_JSChartResource.CacheDomain=e)},JSChart.SetPyIndexDomain=function(t){t&&(g_JSChartResource.PyIndexDomain=t)},JSChart.SetStyle=function(t){t&&g_JSChartResource.SetStyle(t)},JSChart.SetTextResource=function(t,e){g_JSChartLocalization.SetTextResource(t,e)},JSChart.GetLocalization=function(){return g_JSChartLocalization},JSChart.GetDevicePixelRatio=function(){return GetDevicePixelRatio()},JSChart.CreateGuid=function(){return Guid()},JSChart.GetResource=function(){return g_JSChartResource},JSChart.GetMinuteTimeStringData=function(){return g_MinuteTimeStringData},JSChart.GetMinuteCoordinateData=function(){return g_MinuteCoordinateData},JSChart.GetKLineZoom=function(){return ZOOM_SEED},JSChart.GetDivTooltipDataFormat=function(){return g_DivTooltipDataForamt},JSChart.SetUSATimeType=function(t){g_NYMEXTimeData.TimeType=t,g_COMEXTimeData.TimeType=t,g_NYBOTTimeData.TimeType=t,g_CBOTTimeData.TimeType=t},JSChart.GetChinaFuturesTimeData=function(){return g_FuturesTimeData},JSChart.AddPeriodCallback=function(t){g_DataPlus.AddPeriodCallback(t)},JSChart.RemovePeriodCallback=function(t){g_DataPlus.RemovePeriodCallback(t)},JSChart.RegisterDrawPicture=function(t){return IChartDrawPicture.RegisterDrawPicture(t)},JSChart.RegisterDrawPictureIonFont=function(t){return IChartDrawPicture.RegisterIonFont(t)};var JSCHART_EVENT_ID={RECV_KLINE_MATCH:1,RECV_INDEX_DATA:2,RECV_HISTROY_DATA:3,RECV_TRAIN_MOVE_STEP:4,CHART_STATUS:5,BARRAGE_PLAY_END:6,RECV_OVERLAY_INDEX_DATA:7,DBCLICK_KLINE:8,RECV_START_AUTOUPDATE:9,RECV_STOP_AUTOUPDATE:10,ON_CONTEXT_MENU:11,ON_TITLE_DRAW:12,ON_SELECT_RECT:13,RECV_MINUTE_DATA:14,ON_CLICK_INDEXTITLE:15,RECV_KLINE_UPDATE_DATA:16,ON_CLICK_DRAWPICTURE:17,ON_FINISH_DRAWPICTURE:18,ON_INDEXTITLE_DRAW:19,ON_CUSTOM_VERTICAL_DRAW:20,RECV_KLINE_MANUAL_UPDATE_DATA:21,ON_ENABLE_SPLASH_DRAW:22,ON_CLICK_CHART_PAINT:23,ON_DRAW_MINUTE_LAST_POINT:24},JSCHART_OPERATOR_ID={OP_SCROLL_LEFT:1,OP_SCROLL_RIGHT:2,OP_ZOOM_OUT:3,OP_ZOOM_IN:4,OP_GOTO_HOME:5,OP_GOTO_END:6,OP_LEFT_ZOOM_OUT:7,OP_LEFT_ZOOM_IN:8,OP_RIGHT_ZOOM_OUT:9,OP_RIGHT_ZOOM_IN:10},JSCHART_DRAG_ID={DISABLE_DRAG_ID:0,CLICK_TOUCH_MODE_ID:3};function JSChartContainer(t,e){this.ClassName="JSChartContainer";this.Frame,this.ChartPaint=new Array,this.ChartPaintEx=[],this.ChartInfo=new Array,this.ChartInfoPaint,this.ExtendChartPaint=new Array,this.TitlePaint=new Array,this.OverlayChartPaint=new Array,this.ChartDrawPicture=new Array,this.ChartDrawStorage,this.ChartDrawOption={IsLockScreen:!1,Zoom:5},this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture=null,this.ChartPictureMenu,this.ChartCorssCursor,this.IsClickShowCorssCursor=!1,this.ChartSplashPaint=null,e?(this.Canvas=e.getContext("2d"),this.OffscreenCanvasElement=e,this.ShowCanvas=t.getContext("2d")):(this.Canvas=t.getContext("2d"),this.ShowCanvas=null),this.UIElement=t,this.MouseDrag,this.DragMode=1,this.EnableBorderDrag=!0,this.BorderDrag,this.TouchStatus={CorssCursorShow:!1},this.DragTimer,this.EnableScrollUpDown=!1,this.CursorIndex=0,this.LastPoint=new Point,this.IsForceLandscape=!1,this.CorssCursorTouchEnd=!1,this.StepPixel=4,this.ZoomStepPixel=5,this.TouchMoveMinAngle=70,this.EnableAnimation=!1,this.Tooltip=document.createElement("div"),this.Tooltip.className="jschart-tooltip",this.Tooltip.style.background=g_JSChartResource.TooltipBGColor,this.Tooltip.style.opacity=g_JSChartResource.TooltipAlpha,this.Tooltip.id=Guid(),t.parentNode.appendChild(this.Tooltip),this.IsShowTooltip=!0,this.SelectRect=document.createElement("div"),this.SelectRect.className="jschart-selectrect",this.SelectRect.style.background=g_JSChartResource.SelectRectBGColor,this.SelectRect.id=Guid(),this.SelectRect.oncontextmenu=function(){return!1},t.parentNode.appendChild(this.SelectRect),this.SelectRectRightMenu,this.FrameSplitData=new Map,this.FrameSplitData.set("double",new SplitData),this.FrameSplitData.set("price",new PriceSplitData),this.mapEvent=new Map,this.IsOnTouch=!1,this.TouchDrawCount=0,this.DisableMouse=!1,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.PressTime=500,this.NetworkFilter,this.LastMouseStatus={},this.ClickDownPoint,this.AddEventCallback=function(t){if(t&&t.event&&t.callback){var e={Callback:t.callback,Source:t};this.mapEvent.set(t.event,e)}},this.RemoveEventCallback=function(t){this.mapEvent.has(t)&&this.mapEvent.delete(t)},this.GetEventCallback=function(t){return this.mapEvent.has(t)?this.mapEvent.get(t):null},this.GetIndexEvent=function(){return this.GetEventCallback(JSCHART_EVENT_ID.RECV_INDEX_DATA)},this.GetOverlayIndexEvent=function(){return this.GetEventCallback(JSCHART_EVENT_ID.RECV_OVERLAY_INDEX_DATA)},t.onmousemove=(t=>{this.UIOnMouseMove(t)}),t.oncontextmenu=(t=>this.UIOnContextMenu(t)),t.ondblclick=(t=>{this.UIOnDblClick(t)}),t.onmousedown=(t=>{this.UIOnMouseDown(t)}),t.onmouseout=(t=>{this.UIOnMounseOut(t)}),this.UIOnMouseMove=function(t){var e=GetDevicePixelRatio(),a=(t.clientX-this.UIElement.getBoundingClientRect().left)*e,i=(t.clientY-this.UIElement.getBoundingClientRect().top)*e;if(!(this.ChartSplashPaint&&1==this.ChartSplashPaint.IsEnableSplash||1==this.DisableMouse||this.BorderDrag)){var r={X:a,Y:i,IsInClient:this.IsMouseOnClient(a,i)};this.LastMouseStatus.OnMouseMove=r,this.OnMouseMove(a,i,t)}},this.IsMouseOnClient=function(t,e){return this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),this.Canvas.isPointInPath(t,e)},this.UIOnContextMenu=function(t){var e=t.clientX-this.UIElement.getBoundingClientRect().left,a=t.clientY-this.UIElement.getBoundingClientRect().top;return"function"==typeof this.OnRightMenu&&this.OnRightMenu(e,a,t),!1},this.UIOnDblClick=function(t){var e=t.clientX-this.UIElement.getBoundingClientRect().left,a=t.clientY-this.UIElement.getBoundingClientRect().top;this.OnDoubleClick(e,a,t)},this.UIOnMouseDown=function(t){if(this.ClickDownPoint={X:t.clientX,Y:t.clientY},this.IsOnTouch=!0,this.BorderDrag=null,this.TryClickLock){var e=GetDevicePixelRatio(),a=(t.clientX-this.UIElement.getBoundingClientRect().left)*e,i=(t.clientY-this.UIElement.getBoundingClientRect().top)*e;if(this.TryClickLock(a,i))return}if(this.HideSelectRect(),this.SelectRectRightMenu&&this.SelectRectRightMenu.Hide(),this.ChartPictureMenu&&this.ChartPictureMenu.Hide(),this.EnableBorderDrag&&this.Frame){e=GetDevicePixelRatio(),a=(t.clientX-this.UIElement.getBoundingClientRect().left)*e,i=(t.clientY-this.UIElement.getBoundingClientRect().top)*e;var r=this.Frame.PtInFrameBorder(a,i);r&&r.Index>=0&&(this.UIElement.style.cursor="n-resize",this.BorderDrag={Index:r.Index},JSConsole.Chart.Log("[JSChartContainer::UIOnMouseDown] DragBorder ",r))}if(0!=this.DragMode){var n={Click:{},LastMove:{}};if(n.Click.X=t.clientX,n.Click.Y=t.clientY,n.LastMove.X=t.clientX,n.LastMove.Y=t.clientY,this.MouseDrag=n,this.SelectChartDrawPicture=null,this.BorderDrag);else if(this.CurrentChartDrawPicture){2==this.CurrentChartDrawPicture.Status?this.SetChartDrawPictureThirdPoint(n.Click.X,n.Click.Y):(this.SetChartDrawPictureFirstPoint(n.Click.X,n.Click.Y),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo())}else{var s={};e=GetDevicePixelRatio();if(s.X=(t.clientX-this.UIElement.getBoundingClientRect().left)*e,s.Y=(t.clientY-this.UIElement.getBoundingClientRect().top)*e,this.GetChartDrawPictureByPoint(s)){s.ChartDrawPicture.Status=20,s.ChartDrawPicture.ValueToPoint(),s.ChartDrawPicture.MovePointIndex=s.PointIndex,this.CurrentChartDrawPicture=s.ChartDrawPicture,this.SelectChartDrawPicture=s.ChartDrawPicture;var o=this.GetEventCallback(JSCHART_EVENT_ID.ON_CLICK_DRAWPICTURE);if(o&&o.Callback){var h={DrawPicture:s.ChartDrawPicture};o.Callback(o,h,this)}else this.OnSelectChartPicture(s.ChartDrawPicture)}}document.onmousemove=(t=>{this.DocOnMouseMove(t)}),document.onmouseup=(t=>{this.DocOnMouseUp(t)})}},this.DocOnMouseMove=function(e){if(!this.ChartSplashPaint||1!=this.IsEnableSplash){var a=this.MouseDrag;if(a){var i=Math.abs(a.LastMove.X-e.clientX);if(this.BorderDrag&&this.BorderDrag.Index>=0){if(Math.abs(a.LastMove.Y-e.clientY)<5)return;var r=e.clientY-a.LastMove.Y;this.OnMoveFromeBorder(this.BorderDrag.Index,r),a.LastMove.X=e.clientX,a.LastMove.Y=e.clientY}else if(this.CurrentChartDrawPicture){var n=this.CurrentChartDrawPicture;if(1==n.Status||2==n.Status){if(Math.abs(a.LastMove.X-e.clientX)<5&&Math.abs(a.LastMove.Y-e.clientY)<5)return;this.SetChartDrawPictureSecondPoint(e.clientX,e.clientY)&&this.DrawDynamicInfo()}else if(3==n.Status)this.SetChartDrawPictureThirdPoint(e.clientX,e.clientY)&&this.DrawDynamicInfo();else if(20==n.Status){if(Math.abs(a.LastMove.X-e.clientX)<5&&Math.abs(a.LastMove.Y-e.clientY)<5)return;this.MoveChartDrawPicture(e.clientX-a.LastMove.X,e.clientY-a.LastMove.Y)&&this.DrawDynamicInfo()}a.LastMove.X=e.clientX,a.LastMove.Y=e.clientY}else if(1==this.DragMode){if(i<5)return;var s=!0;a.LastMove.X<e.clientX&&(s=!1),this.UIElement.style.cursor="pointer",this.DataMove(i,s)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):this.DragDownloadData&&this.DragDownloadData(),a.LastMove.X=e.clientX,a.LastMove.Y=e.clientY}else if(2==this.DragMode){var o=Math.abs(a.LastMove.Y-e.clientY);if(i<5&&o<5)return;var h=a.Click.X-t.getBoundingClientRect().left,l=a.Click.Y-t.getBoundingClientRect().top,C=e.clientX-t.getBoundingClientRect().left,u=e.clientY-t.getBoundingClientRect().top;this.ShowSelectRect(h,l,C,u),a.LastMove.X=e.clientX,a.LastMove.Y=e.clientY}}}},this.DocOnMouseUp=function(e){document.onmousemove=null,document.onmouseup=null;var a=!0;if(this.CurrentChartDrawPicture){var i=this.CurrentChartDrawPicture;2==i.Status||1==i.Status||3==i.Status?(i.PointStatus=i.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():a=!1):20==i.Status&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}else if(2==this.DragMode){var r=this.MouseDrag,n=new SelectRectData;if(n.XStart=r.Click.X-t.getBoundingClientRect().left,n.XEnd=r.LastMove.X-t.getBoundingClientRect().left,n.JSChartContainer=this.JSChartContainer,n.Stock={Symbol:this.Symbol,Name:this.Name},this.GetSelectRectData(n)){var s=this.GetEventCallback(JSCHART_EVENT_ID.ON_SELECT_RECT);if(s&&s.Callback){var o={X:r.LastMove.X-t.getBoundingClientRect().left,Y:r.LastMove.Y-t.getBoundingClientRect().top,SelectData:n};s.Callback(s,o,this)}this.SelectRectRightMenu&&(e.data={Chart:this,X:r.LastMove.X-t.getBoundingClientRect().left,Y:r.LastMove.Y-t.getBoundingClientRect().top,SelectData:n},this.SelectRectRightMenu.DoModal(e))}else this.TryClickPaintEvent(e)}else this.TryClickPaintEvent(e);JSConsole.Chart.Log("[KLineChartContainer::document.onmouseup]",e),this.UIElement.style.cursor="default",this.MouseDrag=null,this.ClickDownPoint=null,this.IsOnTouch=!1,this.BorderDrag&&this.BorderDrag.Index>=0&&this.Frame.SaveSubFrameHeightRate(),this.BorderDrag=null,!0===a&&(this.CurrentChartDrawPicture=null)},this.UIOnMounseOut=function(t){JSConsole.Chart.Log("[KLineChartContainer::UIOnMounseOut]",t),this.UIOnMouseMove(t)},this.TryClickPaintEvent=function(e){var a=this.GetEventCallback(JSCHART_EVENT_ID.ON_CLICK_CHART_PAINT);if(a&&a.Callback&&this.ClickDownPoint.X==e.clientX&&this.ClickDownPoint.Y==e.clientY){var i=GetDevicePixelRatio(),r=(e.clientX-t.getBoundingClientRect().left)*i,n=(e.clientY-t.getBoundingClientRect().top)*i,s=new TooltipData,o=null;for(var h in this.ChartPaint){if(this.ChartPaint[h].GetTooltipData(r,n,s)){o={Symbol:this.Symbol,Name:this.Name};break}}if(!s.Data)for(var h in this.OverlayChartPaint){if(this.OverlayChartPaint[h].GetTooltipData(r,n,s)){o={Symbol:s.ChartPaint.Symbol,Name:s.ChartPaint.Title};break}}if(s.Data){var l={X:e.clientX,Y:e.clientY,Stock:o,Tooltip:s};return a.Callback(a,l,this),!0}}return!1},this.IsPhoneDragging=function(t){var e=t.changedTouches.length,a=t.touches.length;return 1==e&&1==a},this.IsPhonePinching=function(t){var e=t.changedTouches.length,a=t.touches.length;return(1==e||2==e)&&2==a},this.PreventTouchEvent=function(t){t.cancelable&&t.preventDefault(),t.stopPropagation()},this.GetToucheData=function(t,e){for(var a=new Array,i=GetDevicePixelRatio(),r=0;r<t.touches.length;++r){var n=t.touches[r];e?a.push({clientX:n.clientY*i,clientY:n.clientX*i,pageX:n.pageY*i,pageY:n.pageX*i}):a.push({clientX:n.clientX*i,clientY:n.clientY*i,pageX:n.pageX*i,pageY:n.pageY*i})}return a},this.IsSingleTouch=function(t){return 1==t.touches.length},this.StopDragTimer=function(){IFrameSplitOperator.IsNumber(this.DragTimer)&&(clearTimeout(this.DragTimer),this.DragTimer=null)},this.GetMoveAngle=function(t,e){var a=Math.abs(t.X-e.X),i=Math.abs(t.Y-e.Y);return 180*Math.atan(a/i)/Math.PI},t.ontouchstart=(t=>{this.OnTouchStart(t)}),t.ontouchmove=(t=>{this.OnTouchMove(t)}),t.ontouchend=(t=>{this.OnTouchEnd(t)}),this.OnTouchStart=function(t){this.IsTouchMove=!1,this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer();var e=this.IsSingleTouch(t);if((0==this.EnableScrollUpDown||!e||this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow)&&t.cancelable&&t.preventDefault(),this.IsPhoneDragging(t)){if(this.TryClickLock||this.TryClickIndexTitle){var a=this.GetToucheData(t,this.IsForceLandscape),i=(o=this.PointAbsoluteToRelative(a[0].clientX,a[0].clientY,!0)).X,r=o.Y;if(this.TryClickLock&&this.TryClickLock(i,r))return;if(this.TryClickIndexTitle&&this.TryClickIndexTitle(i,r))return}var n=!0;this.ChartDrawOption.IsLockScreen?n=!1:this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&(n=!1):this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID?n=!1:e||(n=!1);var s={Click:{},LastMove:{}};a=this.GetToucheData(t,this.IsForceLandscape);s.Click.X=a[0].clientX,s.Click.Y=a[0].clientY,s.LastMove.X=a[0].clientX,s.LastMove.Y=a[0].clientY,this.MouseDrag=s,this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null;if(this.CurrentChartDrawPicture)return 2==this.CurrentChartDrawPicture.Status?this.SetChartDrawPictureThirdPoint(s.Click.X,s.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(s.Click.X,s.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),void(t.cancelable&&t.preventDefault());var o,h={X:(o=this.PointAbsoluteToRelative(a[0].clientX,a[0].clientY,!0)).X,Y:o.Y};GetDevicePixelRatio();if(this.GetChartDrawPictureByPoint(h)){h.ChartDrawPicture.Status=20,h.ChartDrawPicture.ValueToPoint(),h.ChartDrawPicture.MovePointIndex=h.PointIndex,h.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=h.ChartDrawPicture,this.SelectChartDrawPicture=h.ChartDrawPicture;let e=this.GetEventCallback(JSCHART_EVENT_ID.ON_CLICK_DRAWPICTURE);if(e&&e.Callback){let t={DrawPicture:h.ChartDrawPicture};e.Callback(e,t,this)}return void(t.cancelable&&t.preventDefault())}if(n){var l=this;this.DragTimer=setTimeout(function(){if(s.Click.X==s.LastMove.X&&s.Click.Y==s.LastMove.Y){l.MouseDrag;l.MouseDrag=null,l.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&(l.TouchStatus.CorssCursorShow=!0),l.MoveCorssCursor(s.Click,t)}},l.PressTime)}this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID||(this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(s.Click,t)):this.IsClickShowCorssCursor&&this.MoveCorssCursor(s.Click,t))}else if(this.IsPhonePinching(t)){var C={Start:{},Last:{}};a=this.GetToucheData(t,this.IsForceLandscape);C.Start={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},C.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},this.PhonePinch=C,this.SelectChartDrawPicture=null}},this.OnTouchMove=function(e){this.IsTouchMove=!0;var a=this.GetToucheData(e,this.IsForceLandscape);if(this.IsPhoneDragging(e)){var i=this.MouseDrag;if(null==i)this.IsForceLandscape&&(y=t.getBoundingClientRect().width-a[0].clientY),this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:a[0].clientX,Y:a[0].clientY},e);else{var r=this.GetMoveAngle(i.LastMove,{X:a[0].clientX,Y:a[0].clientY}),n=Math.abs(i.LastMove.X-a[0].clientX),s=Math.abs(i.LastMove.Y-a[0].clientY);n=parseInt(n);var o=this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow;if(this.CurrentChartDrawPicture){var h=this.CurrentChartDrawPicture;if(1==h.Status||2==h.Status){if(n<5&&s<5)return;this.SetChartDrawPictureSecondPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo()}else if(3==h.Status)this.SetChartDrawPictureThirdPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo();else if(20==h.Status){if(n<5&&s<5)return;this.MoveChartDrawPicture(a[0].clientX-i.LastMove.X,a[0].clientY-i.LastMove.Y,!0)&&this.DrawDynamicInfo()}i.LastMove.X=a[0].clientX,i.LastMove.Y=a[0].clientY}else if(o){this.MouseDrag;this.MouseDrag=null,this.MoveCorssCursor(i.Click,e)}else if(1==this.DragMode||0==o){if((s>0&&n<=3||r<=this.TouchMoveMinAngle)&&1==this.EnableScrollUpDown)return void this.StopDragTimer();if(n<5||r<=this.TouchMoveMinAngle)return void this.PreventTouchEvent(e);var l=!0;i.LastMove.X<a[0].clientX&&(l=!1),this.DataMove(n,l)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):this.DragDownloadData&&this.DragDownloadData(),i.LastMove.X=a[0].clientX,i.LastMove.Y=a[0].clientY}}}else if(this.IsPhonePinching(e)){if(this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID)return;this.PreventTouchEvent(e);var C=this.PhonePinch;if(!C)return;var u=Math.abs(a[0].pageY-a[1].pageY)-Math.abs(C.Last.Y-C.Last.Y2),D=Math.abs(a[0].pageX-a[1].pageX)-Math.abs(C.Last.X-C.Last.X2),d=this.ZoomStepPixel;if(Math.abs(u)<d&&Math.abs(D)<d)return;var c=u;if(Math.abs(u)<d&&(c=D),c>0){if((m={}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(m))return;this.CursorIndex=m.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}else{var m;if((m={}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(m))return;this.CursorIndex=m.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}C.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY}}this.PreventTouchEvent(e)},this.OnTouchEnd=function(t){JSConsole.Chart.Log("[KLineChartContainer:OnTouchEnd]",t);var e=!0;if(this.CurrentChartDrawPicture){var a=this.CurrentChartDrawPicture;2==a.Status||1==a.Status||3==a.Status?(a.PointStatus=a.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():e=!1):20==a.Status&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}this.IsOnTouch=!1,!0===e&&(this.CurrentChartDrawPicture=null),this.StopDragTimer(),this.OnTouchFinished(),this.TouchDrawCount=0},this.MoveCorssCursor=function(t,e){var a=GetDevicePixelRatio(),i=t.X-this.UIElement.getBoundingClientRect().left*a,r=t.Y-this.UIElement.getBoundingClientRect().top*a;this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&(this.TouchStatus.CorssCursorShow=!0),this.OnMouseMove(i,r,e)},this.DrawEmpty=function(){this.UIElement.width<=0||this.UIElement.height<=0||(this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Frame&&(this.Frame.ScreenImageData=null,this.Frame.Draw()))},this.Draw=function(){if(this.ChartCorssCursor&&(this.ChartCorssCursor.Status=0),!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var t=GetDevicePixelRatio();if(this.Canvas.lineWidth=t,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)return this.Frame.Draw(),void this.ChartSplashPaint.Draw();if(this.Frame.SetDrawDepthMap(()=>{for(var t in this.ExtendChartPaint){var e=this.ExtendChartPaint[t];e.IsCallbackDraw&&e.Draw()}}),this.Frame.Draw(),this.Frame.DrawCustomVertical){var e=this.GetEventCallback(JSCHART_EVENT_ID.ON_CUSTOM_VERTICAL_DRAW);this.Frame.DrawCustomVertical(e)}for(var a in this.Frame.CalculateLock(),this.ChartPaint){(n=this.ChartPaint[a]).IsDrawFirst&&n.Draw()}for(var a in this.ChartPaint){(n=this.ChartPaint[a]).IsDrawFirst||n.Draw()}for(var a in this.ChartPaintEx){(n=this.ChartPaintEx[a]).Draw()}for(var a in this.OverlayChartPaint){(n=this.OverlayChartPaint[a]).Draw()}for(var a in this.Frame.DrawOveraly&&this.Frame.DrawOveraly(),this.ExtendChartPaint){(n=this.ExtendChartPaint[a]).IsCallbackDraw||(n.IsDynamic||0!=n.IsAnimation||n.Draw())}for(var a in this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.Frame.DrawCustomHorizontal&&this.Frame.DrawCustomHorizontal(),this.ChartInfoPaint&&this.ChartInfoPaint.Draw(),this.Frame.DrawLock(),this.Frame.Snapshot(),this.ExtendChartPaint){(n=this.ExtendChartPaint[a]).IsCallbackDraw||n.IsDynamic&&!1===n.DrawAfterTitle&&n.Draw()}null==this.LastPoint.X&&null==this.LastPoint.Y||this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex,this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&this.ChartCorssCursor.Draw():!0===this.CorssCursorTouchEnd&&this.MouseDrag||1==this.CorssCursorTouchEnd&&0==this.IsOnTouch||this.ChartCorssCursor.Draw());var i=this.GetEventCallback(JSCHART_EVENT_ID.ON_TITLE_DRAW),r=this.GetEventCallback(JSCHART_EVENT_ID.ON_INDEXTITLE_DRAW);for(var a in this.TitlePaint){(n=this.TitlePaint[a]).IsDynamic&&(n.CursorIndex=this.CursorIndex,"DynamicChartTitlePainting"==n.ClassName?n.OnDrawEvent=r:n.OnDrawEvent=i,n.OnDrawEvent&&(n.OnDrawEvent.FunctionName="Draw",n.OnDrawEvent.PointPosition=null),n.Draw())}for(var a in this.ExtendChartPaint){(n=this.ExtendChartPaint[a]).IsCallbackDraw||n.IsDynamic&&!0===n.DrawAfterTitle&&0==n.IsAnimation&&n.Draw()}if(this.EnableAnimation)for(var a in this.ExtendChartPaint){!0===(n=this.ExtendChartPaint[a]).IsAnimation&&n.Draw()}for(var a in this.ChartDrawPicture){var n;(n=this.ChartDrawPicture[a]).Draw()}if(this.CurrentChartDrawPicture&&10!=this.CurrentChartDrawPicture.Status&&this.CurrentChartDrawPicture.Draw(),this.OffscreenToShowCanvas(),this.mapEvent.has(JSCHART_EVENT_ID.CHART_STATUS)){var s=this.mapEvent.get(JSCHART_EVENT_ID.CHART_STATUS),o={};"function"==typeof this.GetChartStatus&&(o=this.GetChartStatus()),s.Callback(s,o,this)}++this.TouchDrawCount}},this.OffscreenToShowCanvas=function(){this.ShowCanvas&&(this.ShowCanvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.ShowCanvas.drawImage(this.OffscreenCanvasElement,0,0))},this.DrawDynamicInfo=function(t){if(null!=this.Frame.ScreenImageData){var e=!1;if(this.ChartCorssCursor&&(null==this.ChartCorssCursor.PointX&&null==this.ChartCorssCursor.PointY||(e=!0)),0==(e=!0))for(var a in this.ExtendChartPaint){if(!(r=this.ExtendChartPaint[a]).IsCallbackDraw&&(r.IsDynamic&&r.IsEraseBG)){e=!0;break}}for(var a in e&&this.Canvas.putImageData(this.Frame.ScreenImageData,0,0),this.ExtendChartPaint){(r=this.ExtendChartPaint[a]).IsCallbackDraw||r.IsDynamic&&!1===r.DrawAfterTitle&&0==r.IsAnimation&&r.Draw()}this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex,t&&0==t.Corss||(this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&this.ChartCorssCursor.Draw():!1===this.IsOnTouch&&!0===this.CorssCursorTouchEnd||this.CurrentChartDrawPicture||this.ChartCorssCursor.Draw()));var i=null;for(var a in t&&"OnMouseMove"==t.ParentFunction&&t.Point&&(i=this.Frame.PtInFrame(t.Point.X,t.Point.Y)),this.TitlePaint){(r=this.TitlePaint[a]).IsDynamic&&(r.CursorIndex=this.CursorIndex,r.OnDrawEvent&&(r.OnDrawEvent.FunctionName="DrawDynamicInfo",r.OnDrawEvent.PointPosition=i),r.Draw())}for(var a in this.ExtendChartPaint){(r=this.ExtendChartPaint[a]).IsCallbackDraw||("KLineTooltipPaint"==r.ClassName&&t&&0==t.Tooltip||r.IsDynamic&&!0===r.DrawAfterTitle&&r.Draw())}if(this.EnableAnimation)for(var a in this.ExtendChartPaint){!0===(r=this.ExtendChartPaint[a]).IsAnimation&&r.Draw()}for(var a in this.ChartDrawPicture){var r;(r=this.ChartDrawPicture[a]).Draw()}this.CurrentChartDrawPicture&&10!=this.CurrentChartDrawPicture.Status&&this.CurrentChartDrawPicture.Draw(),this.OffscreenToShowCanvas(),++this.TouchDrawCount}},this.DrawAnimation=function(){if(this.EnableAnimation){if(this.Frame.ScreenImageData&&!this.IsOnTouch){for(var t in this.ExtendChartPaint){var e=this.ExtendChartPaint[t];!0===e.IsAnimation&&(e.IsMoveStep=!0)}this.DrawDynamicInfo()}var a=this;window.requestAnimationFrame(function(){a.DrawAnimation()})}},this.StartAnimation=function(t){var e=!1,a=null;for(var i in this.ExtendChartPaint){var r=this.ExtendChartPaint[i];if("BarragePaint"===r.ClassName){e=!0,a=r.BarrageList;break}}if(!e){var n=new BarragePaint;n.Canvas=this.Canvas,n.ChartBorder=this.Frame.ChartBorder,n.ChartFrame=this.Frame,n.HQChart=this,n.SetOption(t),this.ExtendChartPaint.push(n),a=n.BarrageList}this.EnableAnimation=!0;var s=this;return window.requestAnimationFrame(function(){s.DrawAnimation()}),a},this.StopAnimation=function(){this.EnableAnimation=!1,this.DrawDynamicInfo()},this.OnMouseMove=function(t,e,a){if(this.LastPoint.X=t,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(t),this.EnableBorderDrag&&this.Frame){var i=this.Frame.PtInFrameBorder(t,e);if(i&&i.Index>=0)return void(this.UIElement.style.cursor="n-resize")}var r=!1;if(this.CurrentChartDrawPicture)this.CurrentChartDrawPicture.SetLastPoint&&this.CurrentChartDrawPicture.SetLastPoint({X:t,Y:e}),r=!0;else{var n={};n.X=t,n.Y=e,this.GetChartDrawPictureByPoint(n)?(100===n.PointIndex?this.UIElement.style.cursor="move":this.UIElement.style.cursor="pointer",r=!0):this.MouseDrag||(this.UIElement.style.cursor="default")}var s={ParentFunction:"OnMouseMove",Point:{X:t,Y:e}};if(this.DrawDynamicInfo(s),this.IsShowTooltip&&0==r){var o=new TooltipData;for(var h in this.ChartPaint){if(this.ChartPaint[h].GetTooltipData(t,e,o))break}if(this.ChartInfoPaint&&this.ChartInfoPaint.GetTooltipData(t,e,o),!o.Data)for(var h in this.OverlayChartPaint){if(this.OverlayChartPaint[h].GetTooltipData(t,e,o))break}if(o.Data){var l=a.clientX-this.UIElement.getBoundingClientRect().left,C=a.clientY-this.UIElement.getBoundingClientRect().top;this.ShowTooltip(l,C,o)}else this.HideTooltip()}},this.OnKeyDown=function(t){switch(t.keyCode?t.keyCode:t.which){case 37:if(this.CursorIndex<=.99999){if(!this.DataMoveLeft()){this.DragDownloadData&&this.DragDownloadData();break}this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown();break;case 39:var e=0;if(e=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex+1>=e){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}else{var a=null;if(!(a=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data))break;if(this.CursorIndex+a.DataOffset+1>=a.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}break;case 38:if((i={ZoomType:this.ZoomType}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(i))break;this.CursorIndex=i.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown();break;case 40:var i;if((i={ZoomType:this.ZoomType}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(i))break;this.CursorIndex=i.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown();break;case 46:if(!this.SelectChartDrawPicture)break;var r=this.SelectChartDrawPicture;JSConsole.Chart.Log(r,"drawPicturedrawPicturedrawPicture"),this.SelectChartDrawPicture=null,this.ClearChartDrawPicture(r);break;default:return}t.preventDefault?t.preventDefault():t.returnValue=!1},this.OnDoubleClick=function(t,e,a){},this.OnMoveFromeBorder=function(t,e){this.Frame&&this.Frame.OnMoveFromeBorder(t,e)&&(this.Frame.ReDrawToolbar(),this.Draw())},this.IsKLineContainer=function(){return"KLineChartContainer"==this.ClassName||"KLineChartHScreenContainer"==this.ClassName||"KLineTrainChartContainer"==this.ClassName||"CustomKLineChartContainer"==this.ClassName},this.UpdatePointByCursorIndex=function(t){var e={X:null,Y:null};e.X=this.Frame.GetXFromIndex(this.CursorIndex);var a=Math.trunc(Math.abs(this.CursorIndex-.5));this.IsKLineContainer()&&(a=this.CursorIndex);var i=this.Frame.Data;if(i.DataOffset+a<i.Data.length){var r=i.Data[i.DataOffset+a].Close;e.Y=this.Frame.GetYFromData(r)}if(1==t&&this.ChartCorssCursor)if(1==this.ChartCorssCursor.Status);else{this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);a=Math.abs(this.CursorIndex-.5);a=parseInt(a.toFixed(0)),this.IsKLineContainer()&&(a=this.CursorIndex),this.LastPoint.Y=null}else 2==t&&this.ChartCorssCursor?(this.LastPoint.Y=null,this.LastPoint.X=null):(this.LastPoint.X=e.X,this.LastPoint.Y=e.Y)},this.ShowTooltipByKeyDown=function(){var t=Math.abs(this.CursorIndex-.5);t=parseInt(t.toFixed(0)),"KLineChartContainer"!=this.ClassName&&"KLineTrainChartContainer"!=this.ClassName||(t=this.CursorIndex);var e=this.Frame.Data,a=new TooltipData;a.Data=e.Data[e.DataOffset+t],a.ChartPaint=this.ChartPaint[0];var i=GetDevicePixelRatio();0===i&&(i=1),this.ShowTooltip(this.LastPoint.X/i,this.LastPoint.Y/i,a)},this.ShowTooltip=function(t,e,a){},this.HideTooltip=function(){this.Tooltip.style.display="none"},this.ShowSelectRect=function(t,e,a,i){var r=t,n=e,s=this.Frame.ChartBorder.GetRight(),o=this.Frame.ChartBorder.GetLeft();t>s&&(t=s),a>s&&(a=s),t<o&&(t=o),a<o&&(a=o),t>a&&(r=a),e>i&&(n=i);var h=Math.abs(t-a),l=Math.abs(e-i);this.SelectRect.style.width=h+"px",this.SelectRect.style.height=l+"px",this.SelectRect.style.position="absolute",this.SelectRect.style.left=r+"px",this.SelectRect.style.top=n+"px",this.SelectRect.style.display="block"},this.UpdateSelectRect=function(t,e){if(this.ChartPaint[0].Data){var a=this.ChartPaint[0].Data.DataOffset,i=t-a,r=e-a,n=this.Frame.GetXFromIndex(i),s=this.Frame.GetXFromIndex(r);JSConsole.Chart.Log("[JSChartContainer::UpdateSelectRect]",t,e,n,s);var o=GetScrollPosition();this.SelectRect.style.left=n+o.Left+"px",this.SelectRect.style.width=s-n+"px"}},this.HideSelectRect=function(){this.SelectRect.style.display="none"},this.ResetFrameXYSplit=function(){"function"==typeof this.Frame.ResetXYSplit&&this.Frame.ResetXYSplit()},this.UpdateFrameMaxMin=function(){var t=new Array,e=new Array;for(var a in this.ChartPaint){0!=(o=this.ChartPaint[a]).IsShow&&e.push(this.ChartPaint[a])}for(var a in this.OverlayChartPaint)e.push(this.OverlayChartPaint[a]);for(var a in e){var i=e[a],r=i.GetMaxMin();if(null!=r&&null!=r.Max&&null!=r.Min){var n=null;for(var s in t)if(t[s].Frame==i.ChartFrame){n=t[s];break}n?(n.Range.Max<r.Max&&(n.Range.Max=r.Max),n.Range.Min>r.Min&&(n.Range.Min=r.Min)):((n={}).Frame=i.ChartFrame,n.Range=r,t.push(n))}}for(var a in t){var o;(o=t[a]).Frame&&o.Range&&(null!=o.Range.Max&&null!=o.Range.Min&&(o.Frame.YSpecificMaxMin?(o.Frame.HorizontalMax=o.Frame.YSpecificMaxMin.Max,o.Frame.HorizontalMin=o.Frame.YSpecificMaxMin.Min):(o.Frame.HorizontalMax=o.Range.Max,o.Frame.HorizontalMin=o.Range.Min),o.Frame.XYSplit=!0))}for(var a in this.Frame.SubFrame){var h=this.Frame.SubFrame[a];for(var s in h.OverlayIndex){h.OverlayIndex[s].UpdateFrameMaxMin()}}},this.DataMoveLeft=function(){var t=null;return!!(t=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data)&&(!(t.DataOffset<=0)&&(--t.DataOffset,!0))},this.DataMoveRight=function(){var t=null;if(!(t=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data))return!1;var e=0;return!!(e=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount)&&(!(e+t.DataOffset>=t.Data.length)&&(++t.DataOffset,!0))},this.UpdataDataoffset=function(){var t=null;if(t=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data){for(var e in debug&&console.log("UpdataDataoffset",this,t),this.ChartPaint){(s=this.ChartPaint[e]).Data&&(s.Data.DataOffset=t.DataOffset,debug&&console.log("   +++++++ChartPaint",t.DataOffset,s))}for(var e in this.OverlayChartPaint){(s=this.OverlayChartPaint[e]).Data&&(s.Data.DataOffset=t.DataOffset,debug&&console.log("   +++++++OverlayChartPaint",t.DataOffset,s))}for(var e in this.Frame.SubFrame){var a=this.Frame.SubFrame[e];for(var i in a.OverlayIndex){var r=a.OverlayIndex[i];for(var n in r.ChartPaint){var s;(s=r.ChartPaint[n]).Data&&(s.Data.DataOffset=t.DataOffset,debug&&console.log("   +++++++SubFrame",t.DataOffset,s))}}}}},this.DataMove=function(t,e){var a=t;if((t=parseInt(t/this.StepPixel))<=0)return!1;var i=null;if(!(i=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data))return!1;var r=0;if(!(r=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount))return!1;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&this.Frame.SubFrame[0].Frame){var n=this.Frame.SubFrame[0].Frame;(n.DataWidth<=1||n.DistanceWidth<=1)&&(t=a*this.StepPixel)}if(e){if(this.RightSpaceCount>0){if(r+i.DataOffset>=i.Data.length+this.RightSpaceCount-1)return!1;i.DataOffset+=t,i.DataOffset+r>=i.Data.length+this.RightSpaceCount&&(i.DataOffset=i.Data.length-(r-this.RightSpaceCount))}else{if(r+i.DataOffset>=i.Data.length)return!1;i.DataOffset+=t,i.DataOffset+r>=i.Data.length&&(i.DataOffset=i.Data.length-r)}return i.DataOffset=Math.trunc(i.DataOffset),window.chartdata[i.Period].DataOffset=i.DataOffset,!0}return!(i.DataOffset<=0)&&(i.DataOffset-=t,i.DataOffset<0&&(i.DataOffset=0),i.DataOffset=Math.trunc(i.DataOffset),window.chartdata[i.Period].DataOffset=i.DataOffset,!0)},this.GetSubFrameIndex=function(t,e){if(!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return-1;for(var a in this.Frame.SubFrame){var i=this.Frame.SubFrame[a].Frame,r=i.ChartBorder.GetLeft(),n=i.ChartBorder.GetTop(),s=i.ChartBorder.GetHeight(),o=i.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(r,n,o,s),this.Canvas.isPointInPath(t,e))return parseInt(a)}return 0},this.GetDataIndexByPoint=function(t){var e=this.Frame;this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&(e=this.Frame.SubFrame[0].Frame);var a=null;if((a=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data)&&e){var i=parseInt(e.GetXData(t));return a.DataOffset+i}},this.GetSelectRectData=function(t){if(Math.abs(t.XStart-t.XEnd)<5)return!1;var e=null;if(!(e=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data))return!1;var a=this.GetDataIndexByPoint(t.XStart),i=this.GetDataIndexByPoint(t.XEnd);return!(Math.abs(a-i)<2)&&(t.Data=e,a>i?(t.Start=i,t.End=a):(t.Start=a,t.End=i),!0)},this.GetChartDrawPictureByPoint=function(t){for(var e in this.ChartDrawPicture){var a=this.ChartDrawPicture[e],i=a.IsPointIn(t.X,t.Y);if(!1!==i&&i>=0)return t.ChartDrawPicture=a,t.PointIndex=i,!0}return!1},this.SaveToImage=function(t,e){if(this.UIElement.width<=0||this.UIElement.height<=0)return null;if(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)return null;JSConsole.Chart.Log("[JSChartContainer::SaveToImage]",this.UIElement);var a="rgb(255,255,255)";e&&(a=e),this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Canvas.fillStyle=a,this.Canvas.fillRect(0,0,this.UIElement.width,this.UIElement.height);var i=GetDevicePixelRatio();for(var r in this.Canvas.lineWidth=i,this.Frame.Draw(),this.ChartPaint){(n=this.ChartPaint[r]).IsDrawFirst&&n.Draw()}for(var r in this.ChartPaint){(n=this.ChartPaint[r]).IsDrawFirst||n.Draw()}for(var r in this.ChartPaintEx){(n=this.ChartPaintEx[r]).Draw()}for(var r in this.OverlayChartPaint){(n=this.OverlayChartPaint[r]).Draw()}for(var r in this.ExtendChartPaint){(n=this.ExtendChartPaint[r]).IsDynamic||0!=n.IsAnimation||n.Draw()}for(var r in this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.Frame.DrawLock(),this.ExtendChartPaint){(n=this.ExtendChartPaint[r]).IsDynamic&&!1===n.DrawAfterTitle&&n.Draw()}for(var r in null==this.LastPoint.X&&null==this.LastPoint.Y||this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex),this.TitlePaint){(n=this.TitlePaint[r]).IsDynamic&&(n.CursorIndex=this.CursorIndex,n.Draw())}for(var r in this.ExtendChartPaint){(n=this.ExtendChartPaint[r]).IsDynamic&&!0===n.DrawAfterTitle&&0==n.IsAnimation&&n.Draw()}if(this.EnableAnimation)for(var r in this.ExtendChartPaint){!0===(n=this.ExtendChartPaint[r]).IsAnimation&&n.Draw()}for(var r in this.ChartDrawPicture){var n;(n=this.ChartDrawPicture[r]).Draw()}this.CurrentChartDrawPicture&&10!=this.CurrentChartDrawPicture.Status&&this.CurrentChartDrawPicture.Draw();var s=this.UIElement.toDataURL(t||"image/png",1);return JSConsole.Chart.Log("[JSChartContainer::SaveToImage] data= ",s),s},this.SaveToImageUrl=function(t,e){t||(t={Format:"image/png",ColorGB:"rgb(255,255,255)"});var a={Base64:this.SaveToImage(t.Format,t.ColorGB),BucketName:"downloadcache",Path:"hqchart/hq_snapshot"},i=g_JSChartResource.Domain+"/API/FileUploadForBase64";JSNetwork.HttpRequest({url:i,method:"POST",dataType:"json",data:a,success:function(t){JSConsole.Chart.Log("[JSChartContainer::SaveToImageUrl] recv data",t);var a={Path:t.relativeurl,Domain:"https://opensourcedownload.zealink.com"};a.Url=`${a.Domain}/${a.Path}`,e&&e(!0,a,"")},error:function(t){JSConsole.Chart.Log("[JSChartContainer::SaveToImageUrl] error ",t),e&&e(!1,null,"upload failed")}})},this.SetLanguage=function(t){var e=null;switch(t){case"EN":e=JSCHART_LANGUAGE_ID.LANGUAGE_ENGLISH_ID;break;case"CN":e=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID;break;default:return void console.warn(`[JSChartContainer::SetLanguage] language=${t} error`)}if(this.LanguageID!=e){for(var a in this.LanguageID=e,this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID),this.TitlePaint){var i=this.TitlePaint[a];i&&(i.LanguageID=this.LanguageID)}this.Frame&&this.Frame.SetLanguage&&this.Frame.SetLanguage(this.LanguageID),this.Frame.SetSizeChage(!0),this.Draw()}},this.ReloadTiltePaintResource=function(t){for(var e in this.TitlePaint){var a=this.TitlePaint[e];a.ReloadResource&&a.ReloadResource(t)}},this.ReloadResource=function(t){this.ReloadBorder(t),this.ReloadTiltePaintResource(t.Resource),this.ReloadChartPaint(t.Resource),this.ReloadFrame(t.Resource),this.ReloadChartCorssCursor(t,t.Resource),t.Update&&this.Update?this.Update({UpdateCursorIndexType:2}):1==t.Draw&&this.Draw()},this.ReloadBorder=function(t){if(t){var e=GetDevicePixelRatio();if(t.Border){var a=t.Border;IFrameSplitOperator.IsNumber(a.Left)&&(this.Frame.ChartBorder.Left=a.Left*e),IFrameSplitOperator.IsNumber(a.Right)&&(this.Frame.ChartBorder.Right=a.Right*e),IFrameSplitOperator.IsNumber(a.Top)&&(this.Frame.ChartBorder.Top=a.Top*e),IFrameSplitOperator.IsNumber(a.Bottom)&&(this.Frame.ChartBorder.Bottom=a.Bottom*e)}for(var i in t.Windows){a=t.Windows[i];if(!(i>=this.Frame.SubFrame.length)){var r=this.Frame.SubFrame[i].Frame.ChartBorder;IFrameSplitOperator.IsNumber(a.TitleHeight)&&(r.TitleHeight=a.TitleHeight*e)}}for(var i in t.Frame){a=t.Frame[i];if(!(i>=this.Frame.SubFrame.length)){r=this.Frame.SubFrame[i].Frame.ChartBorder;a.TopSpace>=0&&(r.TopSpace=a.TopSpace*e),a.BottomSpace>=0&&(r.BottomSpace=a.BottomSpace*e)}}}},this.ReloadFrame=function(t){for(var e in this.Frame.SubFrame){var a=this.Frame.SubFrame[e].Frame;a&&a.ReloadResource&&a.ReloadResource(t)}},this.ReloadChartPaint=function(t){for(var e in this.ChartPaint){var a=this.ChartPaint[e];a&&a.ReloadResource&&a.ReloadResource(t)}},this.ReloadChartCorssCursor=function(t,e){var a=GetDevicePixelRatio();if(t&&t.CorssCursor){var i=t.CorssCursor;IFrameSplitOperator.IsNumber(i.TitleHeight)&&(this.ChartCorssCursor.TextHeight=i.TitleHeight*a)}this.ChartCorssCursor.ReloadResource&&this.ChartCorssCursor.ReloadResource(e)},this.SetDepthMapData=function(t,e){for(var a in t){var i=t[a];for(var r in this.ExtendChartPaint){var n=this.ExtendChartPaint[r];if(n.ID==i.ID){n.Data=i.Data;break}}}e&&this.Draw()},this.PointAbsoluteToRelative=function(t,e,a){var i={X:t,Y:e},r=GetDevicePixelRatio(),n=this.UIElement.getBoundingClientRect();return a?(i.X=t-n.left*r,i.Y=e-n.top*r):(i.X=(t-n.left)*r,i.Y=(e-n.top)*r),i},this.SetChartDrawPictureFirstPoint=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;if(!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return!1;var r=this.PointAbsoluteToRelative(t,e,a),n=r.X,s=r.Y;for(var o in this.Frame.SubFrame){var h=this.Frame.SubFrame[o].Frame,l=h.ChartBorder.GetLeft(),C=h.ChartBorder.GetTopEx(),u=h.ChartBorder.GetHeight(),D=h.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(l,C,D,u),this.Canvas.isPointInPath(n,s)){i.Frame=h;break}}return!!i.Frame&&(i.Point[0]=new Point,i.Point[0].X=n,i.Point[0].Y=s,i.Status=1,!0)},this.SetChartDrawPictureSecondPoint=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;var r=this.PointAbsoluteToRelative(t,e,a);return i.Point[1]=new Point,i.Point[1].X=r.X,i.Point[1].Y=r.Y,i.Status=2,!0},this.SetChartDrawPictureThirdPoint=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;var r=this.PointAbsoluteToRelative(t,e,a);return i.Point[2]=new Point,i.Point[2].X=r.X,i.Point[2].Y=r.Y,i.Status=3,!0},this.MoveChartDrawPicture=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;var r=GetDevicePixelRatio();a&&(r=1);var n=t*r,s=e*r;return i.Move(n,s),!0},this.FinishChartDrawPicturePoint=function(){var t=this.CurrentChartDrawPicture;if(!t)return!1;if(t.PointCount!=t.Point.length)return!1;t.Status=10,t.PointToValue(),this.ChartDrawPicture.push(t),this.CurrentChartDrawPicture=null;let e=this.GetEventCallback(JSCHART_EVENT_ID.ON_FINISH_DRAWPICTURE);if(e&&e.Callback){let a={DrawPicture:t};e.Callback(e,a,this)}else t.FinishedCallback&&t.FinishedCallback(t);return this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(t),!0},this.OnSelectChartPicture=function(t){JSConsole.Chart.Log("[JSChartContainer::OnSelectChartPicture",t),this.ChartPictureMenu||(this.ChartPictureMenu=new ChartPictureSettingMenu(this.UIElement.parentNode));var e={data:{ChartPicture:t,HQChart:this}};this.ChartPictureMenu.DoModal(e)},this.FinishMoveChartDrawPicture=function(){var t=this.CurrentChartDrawPicture;return!!t&&(t.PointCount==t.Point.length&&(t.Status=10,t.PointToValue(),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(t),this.CurrentChartDrawPicture=null,!0))},this.ClearChartDrawPicture=function(t){if(t)for(var e in this.ChartDrawPicture)this.ChartDrawPicture[e]==t&&(this.ChartDrawStorage&&this.ChartDrawStorage.DeleteDrawData(t),this.ChartDrawPicture.splice(e,1),this.Draw());else this.ChartDrawPicture=[],this.ChartDrawStorage&&this.ChartDrawStorage.Clear(),this.Draw()},this.SetChartDrawOption=function(t){IFrameSplitOperator.IsBool(t.IsLockScreen)&&(this.ChartDrawOption.IsLockScreen=t.IsLockScreen),IFrameSplitOperator.IsNumber(t.Zoom)&&t.Zoom>=0&&(this.ChartDrawOption.Zoom=t.Zoom)},this.EnableShowCorssCursorLine=function(t){this.ChartCorssCursor&&(this.ChartCorssCursor.IsShowCorss=t)}}function GetDevicePixelRatio(){return"undefined"==typeof window?1:window.devicePixelRatio||1}function IsPhoneWeb(){var t=navigator.userAgent;const e=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod");for(var a=0;a<e.length;a++)if(t.indexOf(e[a])>0)return!0;return!1}function OnKeyDown(t){this.JSChartContainer&&this.JSChartContainer.OnKeyDown&&this.JSChartContainer.OnKeyDown(t)}function OnWheel(t){this.JSChartContainer&&this.JSChartContainer.OnWheel&&this.JSChartContainer.OnWheel(t)}function ToFixed(t,e){var a=1;if(isNaN(t))return t;t<0&&(a=-1);var i=Math.pow(10,e),r=Math.round(Math.abs(t)*i)/i*a;if(/^(\d+(?:\.\d+)?)(e)([\-]?\d+)$/.test(r))var n=r.toFixed2(e);else n=r.toString();var s=n.indexOf(".");for(s<0&&e>0&&(s=n.length,n+=".");n.length<=s+e;)n+="0";return n}function Guid(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"guid"+(t()+t())+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function GetScrollPosition(){var t={},e=0,a=0;return document.documentElement&&document.documentElement.scrollTop?(e=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(e=document.body.scrollTop,a=document.body.scrollLeft),t.Top=e,t.Left=a,t}function ToFixedPoint(t){return parseInt(t)+.5}function ToFixedRect(t){return.5+t<<0}function Point(){this.X,this.Y}function SelectRectData(){this.Data,this.JSChartContainer,this.Start,this.End,this.XStart,this.XEnd}function CoordinateInfo(){this.Value,this.Message=new Array,this.TextColor=g_JSChartResource.FrameSplitTextColor,this.Font=g_JSChartResource.FrameSplitTextFont,this.LineColor=g_JSChartResource.FrameSplitPen,this.LineType=1}function ChartBorder(){this.UIElement,this.Left=50,this.Right=80,this.Top=50,this.Bottom=50,this.TitleHeight=24,this.TopSpace=0,this.BottomSpace=0,this.GetChartWidth=function(){return this.UIElement.width},this.GetChartHeight=function(){return this.UIElement.height},this.GetLeft=function(){return this.Left},this.GetRight=function(){return this.UIElement.width-this.Right},this.GetTop=function(){return this.Top},this.GetTopEx=function(){return this.Top+this.TitleHeight+this.TopSpace},this.GetTopTitle=function(){return this.Top+this.TitleHeight},this.GetBottom=function(){return this.UIElement.height-this.Bottom},this.GetBottomEx=function(){return this.UIElement.height-this.Bottom-this.BottomSpace},this.GetWidth=function(){return this.UIElement.width-this.Left-this.Right},this.GetHeight=function(){return this.UIElement.height-this.Top-this.Bottom},this.GetHeightEx=function(){return this.UIElement.height-this.Top-this.Bottom-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetRightEx=function(){return this.UIElement.width-this.Right-this.TitleHeight-this.TopSpace},this.GetWidthEx=function(){return this.UIElement.width-this.Left-this.Right-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetLeftEx=function(){return this.Left+this.BottomSpace},this.GetRightTitle=function(){return this.UIElement.width-this.Right-this.TitleHeight},this.GetTitleHeight=function(){return this.TitleHeight}}function IChartFramePainting(){this.HorizontalInfo=new Array,this.VerticalInfo=new Array,this.ClassName="IChartFramePainting",this.Canvas,this.Identify,this.ChartBorder,this.PenBorder=g_JSChartResource.FrameBorderPen,this.TitleBGColor=g_JSChartResource.FrameTitleBGColor,this.IsShow=!0,this.SizeChange=!0,this.XYSplit=!0,this.HorizontalMax,this.HorizontalMin,this.XPointCount=10,this.YSplitOperator,this.XSplitOperator,this.Data,this.IsLocked=!1,this.LockPaint=null,this.YSpecificMaxMin=null,this.IsShowBorder=!0,this.IsShowTitleArraw=!0,this.IsShowIndexName=!0,this.IndexParamSpace=2,this.BorderLine=null,this.Draw=function(){this.DrawFrame(),this.DrawBorder(),this.SizeChange=!1,this.XYSplit=!1},this.DrawFrame=function(){},this.DrawBorder=function(){if(this.IsShowBorder){var t=ToFixedPoint(this.ChartBorder.GetLeft()),e=ToFixedPoint(this.ChartBorder.GetTop()),a=ToFixedPoint(this.ChartBorder.GetRight()),i=ToFixedPoint(this.ChartBorder.GetBottom()),r=a-t,n=i-e;null==this.BorderLine?(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(t,e,r,n)):IFrameSplitOperator.IsPlusNumber(this.BorderLine)&&(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),(1&this.BorderLine)>0&&(this.Canvas.moveTo(t,e),this.Canvas.lineTo(a,e)),(2&this.BorderLine)>0&&(this.Canvas.moveTo(t,i),this.Canvas.lineTo(a,i)),(4&this.BorderLine)>0&&(this.Canvas.moveTo(t,e),this.Canvas.lineTo(t,i)),(8&this.BorderLine)>0&&(this.Canvas.moveTo(a,e),this.Canvas.lineTo(a,i)),this.Canvas.stroke())}},this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var t=ToFixedPoint(this.ChartBorder.GetLeft()),e=ToFixedPoint(this.ChartBorder.GetTop()),a=ToFixedPoint(this.ChartBorder.GetRight())-t,i=ToFixedPoint(this.ChartBorder.GetTopTitle())-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(t,e,a,i)}},this.DrawLock=function(){this.IsLocked&&(null==this.LockPaint&&(this.LockPaint=new ChartLock),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!0))},this.CalculateLock=function(){this.IsLocked&&(null==this.LockPaint&&(this.LockPaint=new ChartLock),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!1))},this.SetLock=function(t){t?(this.IsLocked=!0,this.LockPaint||(this.LockPaint=new ChartLock),t.Callback&&(this.LockPaint.Callback=t.Callback),t.IndexName&&(this.LockPaint.IndexName=t.IndexName),t.ID&&(this.LockPaint.LockID=t.ID),t.BG&&(this.LockPaint.BGColor=t.BG),t.Text&&(this.LockPaint.Title=t.Text),t.TextColor&&(this.LockPaint.TextColor=t.TextColor),t.Font&&(this.LockPaint.Font=t.Font),t.Count&&(this.LockPaint.LockCount=t.Count),t.MinWidth>0&&(this.LockPaint.MinWidth=t.MinWidth)):this.IsLocked=!1},this.GetLockRect=function(){return this.IsLocked&&this.LockPaint?this.LockPaint.LockRect:null},this.ReloadResource=function(t){for(var e in t||(this.PenBorder=g_JSChartResource.FrameBorderPen,this.TitleBGColor=g_JSChartResource.FrameTitleBGColor),this.HorizontalInfo){(a=this.HorizontalInfo[e]).Font&&(a.Font=g_JSChartResource.FrameSplitTextFont),a.TextColor&&(a.TextColor=g_JSChartResource.FrameSplitTextColor),a.LineColor&&(a.LineColor=g_JSChartResource.FrameSplitPen)}for(var e in this.VerticalInfo){var a;(a=this.VerticalInfo[e]).Font&&(a.Font=g_JSChartResource.FrameSplitTextFont),a.TextColor&&(a.TextColor=g_JSChartResource.FrameSplitTextColor),a.LineColor&&(a.LineColor=g_JSChartResource.FrameSplitPen)}}}function NoneFrame(){this.newMethod=IChartFramePainting,this.newMethod(),delete this.newMethod,this.ClassName="NoneFrame",this.Snapshot=function(){},this.SetSizeChage=function(t){this.SizeChange=t,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}}}function AverageWidthFrame(){this.newMethod=IChartFramePainting,this.newMethod(),delete this.newMethod,this.ClassName="AverageWidthFrame",this.DataWidth=50*GetDevicePixelRatio(),this.DistanceWidth=10*GetDevicePixelRatio(),this.MinXDistance=30*GetDevicePixelRatio(),this.MinYDistance=12*GetDevicePixelRatio(),this.CoordinateType=0,this.IsShowYText=[!0,!0],this.XBottomOffset=g_JSChartResource.Frame.XBottomOffset,this.YTextTopOffset=g_JSChartResource.Frame.YTopOffset,this.YTextPosition=[0,0],this.IsShowXLine=!0,this.IsShowYLine=!0,this.DrawDepthMapCallback,this.DrawFrame=function(){if(this.XPointCount>0){let t=this.ChartBorder.GetWidth()/(6*this.XPointCount);this.DistanceWidth=2*t,this.DataWidth=4*t}this.DrawHorizontal(),this.DrawVertical()},this.GetYFromData=function(t,e){if(this.Logarithmic&&this.GetYLogarithmicFromData)return this.GetYLogarithmicFromData(t,e);if(!1===e){if(1==this.CoordinateType){var a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+a}a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-a}if(1==this.CoordinateType){if(t<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+a}if(t<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetTopEx();a=this.ChartBorder.GetHeightEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-a},this.DrawHorizontal=function(){for(var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottom(),i=this.ChartBorder.GetTopTitle(),r=this.ChartBorder.Right,n=this.ChartBorder.Left>10&&!0===this.IsShowYText[0]&&2!=this.YTextPosition[0],s=r>10&&!0===this.IsShowYText[1]&&2!=this.YTextPosition[1],o=null,h=this.HorizontalInfo.length-1;h>=0;--h){var l=this.HorizontalInfo[h],C=this.GetYFromData(l.Value);if(!(null!=C&&null!=o&&Math.abs(C-o)<this.MinYDistance)){C!=a&&this.IsShowYLine&&(this.Canvas.strokeStyle=l.LineColor,2==l.LineType?(this.Canvas.save(),this.Canvas.setLineDash([5,5]),this.Canvas.beginPath(),this.Canvas.moveTo(t,ToFixedPoint(C)),this.Canvas.lineTo(e,ToFixedPoint(C)),this.Canvas.stroke(),this.Canvas.restore()):g_JSChartResource.FrameYLineDash?(this.Canvas.save(),this.Canvas.setLineDash(g_JSChartResource.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(t,ToFixedPoint(C)),this.Canvas.lineTo(e,ToFixedPoint(C)),this.Canvas.stroke(),this.Canvas.restore()):(this.Canvas.beginPath(),this.Canvas.moveTo(t,ToFixedPoint(C)),this.Canvas.lineTo(e,ToFixedPoint(C)),this.Canvas.stroke()));var u=C;C>=a-2?this.Canvas.textBaseline="bottom":C<=i+2?(this.Canvas.textBaseline="top",u+=this.YTextTopOffset):this.Canvas.textBaseline="middle",null!=l.Message[0]&&n&&(null!=l.Font&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="right",this.Canvas.fillText(l.Message[0],t-2,u)),null!=l.Message[1]&&s&&(null!=l.Font&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="left",this.Canvas.fillText(l.Message[1],e+2,u)),o=C}}},this.DrawInsideHorizontal=function(){if(!0!==this.IsHScreen&&(!1!==this.IsShowYText[0]||!1!==this.IsShowYText[1])){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottom(),i=this.ChartBorder.GetTopTitle(),r=this.ChartBorder.Right,n=this.ChartBorder.Left,s=(this.ChartBorder.TitleHeight,(n<10||2==this.YTextPosition[0])&&!0===this.IsShowYText[0]),o=(r<10||2==this.YTextPosition[1])&&!0===this.IsShowYText[1];if(s||o)for(var h=GetDevicePixelRatio(),l=null,C=this.HorizontalInfo.length-1;C>=0;--C){var u=this.HorizontalInfo[C],D=this.GetYFromData(u.Value);if(!(null!=D&&null!=l&&Math.abs(D-l)<this.MinYDistance)){if(null!=u.Message[0]&&s){null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="left";var d=D;D>=a-2?this.Canvas.textBaseline="bottom":D<=i+2?(this.Canvas.textBaseline="top",d+=this.YTextTopOffset):this.Canvas.textBaseline="middle";var c={X:t,Y:d,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:u.Message[0]}};this.IsOverlayMaxMin&&this.IsOverlayMaxMin(c)||this.Canvas.fillText(u.Message[0],t+1*h,d)}if(null!=u.Message[1]&&o){null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="right";d=D;D>=a-2?this.Canvas.textBaseline="bottom":D<=i+2?(this.Canvas.textBaseline="top",d+=this.YTextTopOffset):this.Canvas.textBaseline="middle";c={X:e-this.Canvas.measureText(u.Message[1]).width,Y:d,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:u.Message[1]}};this.IsOverlayMaxMin&&this.IsOverlayMaxMin(c)||this.Canvas.fillText(u.Message[1],e-1*h,d)}l=D}}}},this.GetXFromIndex=function(t){var e=this.XPointCount;return 1==e?0==t?this.ChartBorder.GetLeft():this.ChartBorder.GetRight():e<=0?this.ChartBorder.GetLeft():t>=e?this.ChartBorder.GetRight():this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*t/e},this.DrawVertical=function(){var t=this.ChartBorder.GetTopTitle(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetRight();GetDevicePixelRatio();if(!(this.ChartBorder.Bottom<=5*GetDevicePixelRatio())){var i=null,r=null;for(var n in this.VerticalInfo){var s=this.GetXFromIndex(this.VerticalInfo[n].Value);if(s>a)break;if(!(null!=i&&Math.abs(s-i)<this.MinXDistance)){if(this.VerticalInfo[n].LineType>0&&this.IsShowXLine&&(this.Canvas.strokeStyle=this.VerticalInfo[n].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(s),t),this.Canvas.lineTo(ToFixedPoint(s),e),this.Canvas.stroke()),null!=this.VerticalInfo[n].Message[0]){null!=this.VerticalInfo[n].Font&&(this.Canvas.font=this.VerticalInfo[n].Font);var o=0;this.Canvas.fillStyle=this.VerticalInfo[n].TextColor;var h=this.Canvas.measureText(this.VerticalInfo[n].Message[0]).width;s<h/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",o=s):s+h/2>=this.ChartBorder.GetChartWidth()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",o=s-h):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",o=s-h/2),(null==r||o>r)&&(this.Canvas.fillText(this.VerticalInfo[n].Message[0],s,e+this.XBottomOffset),r=o+h)}i=s}}}},this.GetYData=function(t,e){return this.Logarithmic&&this.GetYLogarithmicFromData?this.GetYLogarithmicData(t):1==this.CoordinateType?0==e?(t-this.ChartBorder.GetTopEx())/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:t<this.ChartBorder.GetTopEx()?this.HorizontalMin:t>this.ChartBorder.GetBottomEx()?this.HorizontalMax:(t-this.ChartBorder.GetTopEx())/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:0==e?(this.ChartBorder.GetBottomEx()-t)/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:t<this.ChartBorder.GetTopEx()?this.HorizontalMax:t>this.ChartBorder.GetBottomEx()?this.HorizontalMin:(this.ChartBorder.GetBottomEx()-t)/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(t){return t<=this.ChartBorder.GetLeft()?0:t>=this.ChartBorder.GetRight()?this.XPointCount:(t-this.ChartBorder.GetLeft())*(1*this.XPointCount/this.ChartBorder.GetWidth())},this.DrawCustomItem=function(t){if((t.Message[1]||t.Message[0])&&!(t.Value>this.HorizontalMax||t.Value<this.HorizontalMin)){var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRight(),i=this.ChartBorder.GetBottom(),r=this.ChartBorder.GetTopTitle(),n=this.ChartBorder.Right,s=this.ChartBorder.Left;this.ChartBorder.TitleHeight;this.IsHScreen&&(s=this.ChartBorder.Top,n=this.ChartBorder.Bottom,r=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom());var o=GetDevicePixelRatio(),h=18*o,l=this.GetYFromData(t.Value);if(t.Message[0])if(s<10){null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var C=this.Canvas.measureText(t.Message[0]).width+2*o,u=t.LineColor;if((c=this.RGBToStruct(t.LineColor))&&(u=`rgba(${c.R}, ${c.G}, ${c.B}, ${g_JSChartResource.FrameLatestPrice.BGAlpha})`),this.Canvas.fillStyle=u,this.IsHScreen){var D=r,d=l-h/2-1*o;this.Canvas.fillRect(d,D,h,C),this.DrawHScreenText({X:l,Y:D},{Text:t.Message[0],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),this.DrawLine(D+C,i,l,t.LineColor,t.LineType)}else{D=l-h/2-1*o,d=e+1*o;this.Canvas.fillRect(d,D,C,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[0],d+1*o,l),this.DrawLine(d+C,a,l,t.LineColor,t.LineType)}}else{null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";C=this.Canvas.measureText(t.Message[0]).width+2*o;if(this.Canvas.fillStyle=t.LineColor,this.IsHScreen){D=r-C,d=l-h/2-1*o;this.Canvas.fillRect(d,D,h,C),this.DrawHScreenText({X:l,Y:D},{Text:t.Message[0],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),this.DrawLine(D+C,i,l,t.LineColor,t.LineType)}else{D=l-h/2-1*o;this.Canvas.fillRect(e-C,D,C,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[0],e-1*o,l),this.DrawLine(e,a,l,t.LineColor,t.LineType)}}else if(t.Message[1])if(n<10){null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var c;C=this.Canvas.measureText(t.Message[1]).width+2*o,u=t.LineColor;if((c=this.RGBToStruct(t.LineColor))&&(u=`rgba(${c.R}, ${c.G}, ${c.B}, ${g_JSChartResource.FrameLatestPrice.BGAlpha})`),this.Canvas.fillStyle=u,this.IsHScreen){D=i-C,d=l-h/2-1*o;this.Canvas.fillRect(d,D,h,C),this.DrawHScreenText({X:l,Y:D},{Text:t.Message[1],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),this.DrawLine(r,D,l,t.LineColor,t.LineType)}else{D=l-h/2-1*o,d=a-C;this.Canvas.fillRect(d,D,C,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[1],d+1*o,l),this.DrawLine(e,d,l,t.LineColor,t.LineType)}}else{null!=t.Font&&(this.Canvas.font=t.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";C=this.Canvas.measureText(t.Message[1]).width+2*o;if(this.Canvas.fillStyle=t.LineColor,this.IsHScreen){D=i,d=l-h/2-1*o;this.Canvas.fillRect(d,D,h,C),this.DrawHScreenText({X:l,Y:D},{Text:t.Message[1],Color:t.TextColor,XOffset:1*o,YOffset:2*o}),this.DrawLine(r,D,l,t.LineColor,t.LineType)}else{D=l-h/2-1*o;this.Canvas.fillRect(a,D,C,h),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(t.Message[1],a+1*o,l),this.DrawLine(e,a,l,t.LineColor,t.LineType)}}}},this.DrawDotLine=function(t,e,a,i){var r=GetDevicePixelRatio();this.Canvas.save(),this.Canvas.strokeStyle=i,this.Canvas.setLineDash([5*r,5*r]),this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(ToFixedPoint(a),t),this.Canvas.lineTo(ToFixedPoint(a),e)):(this.Canvas.moveTo(t,ToFixedPoint(a)),this.Canvas.lineTo(e,ToFixedPoint(a))),this.Canvas.stroke(),this.Canvas.restore()},this.DrawLine=function(t,e,a,i,r){-1!=r&&(0==r?(this.Canvas.strokeStyle=i,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(ToFixedPoint(a),t),this.Canvas.lineTo(ToFixedPoint(a),e)):(this.Canvas.moveTo(t,ToFixedPoint(a)),this.Canvas.lineTo(e,ToFixedPoint(a))),this.Canvas.stroke()):this.DrawDotLine(t,e,a,i))},this.DrawHScreenText=function(t,e){this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=e.Color,this.Canvas.save(),this.Canvas.translate(t.X,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e.Text,e.XOffset,e.YOffset),this.Canvas.restore()},this.RGBToStruct=function(t){if(/^(rgb|RGB)/.test(t)){var e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),a={};return 3!=e.length?null:(a.R=Number(e[0]),a.G=Number(e[1]),a.B=Number(e[2]),a)}return null}}function MinuteFrame(){this.newMethod=AverageWidthFrame,this.newMethod(),delete this.newMethod,this.ClassName="MinuteFrame",this.DataWidth=1*GetDevicePixelRatio(),this.DistanceWidth=1*GetDevicePixelRatio(),this.MinuteCount=243,this.IsBeforeData=!1,this.BeforeBGColor=g_JSChartResource.Minute.BeforeBGColor,this.CustomHorizontalInfo=[],this.RightFrame=null,this.ToolbarID=Guid(),this.ReDrawToolbar=!1,this.ModifyIndex=!0,this.ChangeIndex=!0,this.CloseIndex=!0,this.ModifyIndexEvent,this.ChangeIndexEvent,this.ToolbarRect=null,this.LastCalculateStatus={Width:0,XPointCount:0},this.DrawFrame=function(){this.SplitXYCoordinate(),this.IsBeforeData&&this.DrawBeforeDataBG(),this.DrawTitleBG(),this.DrawHorizontal(),this.DrawVertical(),1!=this.SizeChange&&1!=this.ReDrawToolbar||(this.DrawToolbar(),this.ReDrawToolbar=!1)},this.SuperDrawBorder=this.DrawBorder,this.DrawBorder=function(){if(this.IsShowBorder&&(this.SuperDrawBorder(),1==this.Identify)){var t=ToFixedPoint(this.ChartBorder.GetLeft()),e=ToFixedPoint(this.ChartBorder.GetTop()),a=ToFixedPoint(this.ChartBorder.GetRight());this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(t,e),this.Canvas.lineTo(a,e),this.Canvas.save(),this.Canvas.lineWidth=2*GetDevicePixelRatio(),this.Canvas.stroke(),this.Canvas.restore()}},this.DrawToolbar=function(){if(this.Identify<2)return;if(!this.ChartBorder.UIElement)return;var t=document.getElementById(this.ToolbarID);if(t&&0==this.SizeChange&&0==this.ReDrawToolbar)return;if(t||((t=document.createElement("div")).className="klineframe-toolbar",t.id=this.ToolbarID,t.oncontextmenu=function(){return!1},t.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(t)),!this.ModifyIndex&&!this.ChangeIndex&&!this.OverlayIndex)return void("none"!=t.style.display&&(t.style.display="none"));var e=GetDevicePixelRatio(),a=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px","")),i=(parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px","")),this.ChartBorder.GetTitleHeight()),r=a-this.ChartBorder.Right/e-100,n=this.ChartBorder.GetTop()/e;if(this.ToolbarRect&&this.ToolbarRect.Left==r&&this.ToolbarRect.Top==n&&100==this.ToolbarRect.Width&&this.ToolbarRect.Height==i/e)return;this.ToolbarRect={Left:r,Top:n,Width:100,Height:i/e};var s="<span class=\'index_param icon iconfont icon-index_param\' id=\'modifyindex\' style=\'cursor:pointer;margin-left:2px;margin-right:2px;\' title=\'调整指标参数\'></span><span class=\'index_change icon iconfont icon-change_index\' id=\'changeindex\' style=\'cursor:pointer;margin-left:2px;margin-right:2px;\' title=\'切换指标\'></span>";this.CloseIndex&&(s+="<span class=\'index_close icon iconfont icon-close\' id=\'closeindex\' style=\'cursor:pointer;margin-left:2px;margin-right:2px;\' title=\'关闭指标窗口\'></span>"),t.style.left=r+"px",t.style.top=n+"px",t.style.width="100px",t.style.height=i/e+"px",t.innerHTML=s;this.ChartBorder.UIElement.JSChartContainer,this.Identify;this.ModifyIndex?"function"==typeof this.ModifyIndexEvent&&$("#"+t.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):$("#"+t.id+" .index_param").hide(),this.ChangeIndex?"function"==typeof this.ChangeIndexEvent&&$("#"+t.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):$("#"+t.id+" .index_change").hide(),$("#"+t.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},function(t){var e=t.data.Chart,a=t.data.Identify;e.RemoveIndexWindow(a)}),t.style.display="block"},this.ClearToolbar=function(){var t=document.getElementById(this.ToolbarID);t&&this.ChartBorder.UIElement.parentNode.removeChild(t)},this.DrawBeforeDataBG=function(){var t=ToFixedPoint(this.ChartBorder.GetLeft()),e=ToFixedPoint(this.ChartBorder.GetTopEx()),a=this.GetXFromIndex(14)-t,i=ToFixedPoint(this.ChartBorder.GetBottom())-e;this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(t,e,a,i)},this.SplitXYCoordinate=function(){0!=this.XYSplit&&(null!=this.YSplitOperator&&this.YSplitOperator.Operator(),null!=this.XSplitOperator&&this.XSplitOperator.Operator())},this.GetXFromIndex=function(t){var e=this.XPointCount-1;return 1==e?0==t?this.ChartBorder.GetLeft():this.ChartBorder.GetRight():e<=0?this.ChartBorder.GetLeft():t>=e?this.ChartBorder.GetRight():this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*t/e},this.GetXData=function(t){var e=this.XPointCount-1;return e<0&&(e=0),t<=this.ChartBorder.GetLeft()?0:t>=this.ChartBorder.GetRight()?e:(t-this.ChartBorder.GetLeft())*(1*e/this.ChartBorder.GetWidth())},this.DrawCustomHorizontal=function(){for(var t in this.CustomHorizontalInfo){var e=this.CustomHorizontalInfo[t];switch(e.Type){case 0:case 1:this.DrawCustomItem(e)}}}}function OverlayMinuteFrame(){this.newMethod=MinuteFrame,this.newMethod(),delete this.newMethod,this.ClassName="OverlayMinuteFrame",this.IsShow=!0,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow,this.SizeChange=!1,this.XYSplit=!1}}function MinuteHScreenFrame(){this.newMethod=MinuteFrame,this.newMethod(),delete this.newMethod,this.ClassName="MinuteHScreenFrame",this.IsHScreen=!0,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var t=ToFixedPoint(this.ChartBorder.GetRightEx()),e=ToFixedPoint(this.ChartBorder.GetTop()),a=ToFixedPoint(this.ChartBorder.GetBottom()),i=this.ChartBorder.TitleHeight,r=a-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(t,e,i,r)}},this.DrawToolbar=function(){},this.DrawBeforeDataBG=function(){var t=ToFixedPoint(this.ChartBorder.GetLeft()),e=ToFixedPoint(this.ChartBorder.GetRightEx()),a=ToFixedPoint(this.ChartBorder.GetTop()),i=e-t,r=this.GetXFromIndex(14)-a;this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(t,a,i,r)},this.GetYData=function(t){return t<this.ChartBorder.GetLeft()?this.HorizontalMin:t>this.ChartBorder.GetRightEx()?this.HorizontalMax:(t-this.ChartBorder.GetLeft())/this.ChartBorder.GetWidthEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(t){var e=this.XPointCount-1;return e<0&&(e=0),t<=this.ChartBorder.GetTop()?0:t>=this.ChartBorder.GetBottom()?e:(t-this.ChartBorder.GetTop())*(1*e/this.ChartBorder.GetHeight())},this.GetXFromIndex=function(t){var e=this.XPointCount-1;return 1==e?0==t?this.ChartBorder.GetTop():this.ChartBorder.GetBottom():e<=0?this.ChartBorder.GetTop():t>=e?this.ChartBorder.GetBottom():this.ChartBorder.GetTop()+this.ChartBorder.GetHeight()*t/e},this.GetYFromData=function(t){if(t<=this.HorizontalMin)return this.ChartBorder.GetLeft();if(t>=this.HorizontalMax)return this.ChartBorder.GetRightEx();var e=this.ChartBorder.GetWidthEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetLeft()+e},this.DrawHorizontal=function(){for(var t=this.ChartBorder.GetTop(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetLeft(),i=this.ChartBorder.GetRight(),r=this.ChartBorder.Top,n=this.ChartBorder.Bottom,s=null,o=this.HorizontalInfo.length-1;o>=0;--o){var h=this.HorizontalInfo[o],l=this.GetYFromData(h.Value);if(!(null!=l&&Math.abs(l-s)<this.MinYDistance)){if(this.Canvas.strokeStyle=h.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(l),t),this.Canvas.lineTo(ToFixedPoint(l),e),this.Canvas.stroke(),l>=i-2)this.Canvas.textBaseline="top",l=i;else if(l<=a+2){if(this.Canvas.textBaseline="bottom",null!=(l=a)&&Math.abs(l-s)<2*this.MinYDistance)continue}else this.Canvas.textBaseline="middle";if(null!=h.Message[0]&&r>10){null!=h.Font&&(this.Canvas.font=h.Font),this.Canvas.fillStyle=h.TextColor,this.Canvas.textAlign="right";var C=l,u=t;this.Canvas.save(),this.Canvas.translate(C,u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.Message[0],-2,0),this.Canvas.restore()}if(null!=h.Message[1]&&n>10){null!=h.Font&&(this.Canvas.font=h.Font),this.Canvas.fillStyle=h.TextColor,this.Canvas.textAlign="left";C=l,u=e;this.Canvas.save(),this.Canvas.translate(C,u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.Message[1],2,0),this.Canvas.restore()}s=l}}},this.DrawVertical=function(){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightEx(),a=this.ChartBorder.GetBottom(),i=null;for(var r in this.VerticalInfo){var n=this.GetXFromIndex(this.VerticalInfo[r].Value);if(n>a)break;if(!(null!=i&&Math.abs(n-i)<this.MinXDistance)){if(this.Canvas.strokeStyle=this.VerticalInfo[r].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t,ToFixedPoint(n)),this.Canvas.lineTo(e,ToFixedPoint(n)),this.Canvas.stroke(),null!=this.VerticalInfo[r].Message[0]){null!=this.VerticalInfo[r].Font&&(this.Canvas.font=this.VerticalInfo[r].Font),this.Canvas.fillStyle=this.VerticalInfo[r].TextColor;var s=this.Canvas.measureText(this.VerticalInfo[r].Message[0]).width;n<s/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):n+s/2>=this.ChartBorder.GetChartHeight()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var o=t,h=n;this.Canvas.save(),this.Canvas.translate(o,h),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[r].Message[0],0,0),this.Canvas.restore()}i=n}}},this.DrawInsideHorizontal=function(){if(!1!==this.IsShowYText[0]||!1!==this.IsShowYText[1]){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightEx(),a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom(),r=this.ChartBorder.Top,n=this.ChartBorder.Bottom;this.ChartBorder.TitleHeight;if(r<10*(s=GetDevicePixelRatio())&&!0===this.IsShowYText[0]||n<10*s&&!0===this.IsShowYText[1])for(var s=GetDevicePixelRatio(),o=null,h=this.HorizontalInfo.length-1;h>=0;--h){var l=this.HorizontalInfo[h],C=this.GetYFromData(l.Value);if(!(null!=C&&null!=o&&Math.abs(C-o)<this.MinYDistance)){if(null!=l.Message[0]&&r<10*s&&!0===this.IsShowYText[0]){null!=l.Font&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline=C>=e-2?"top":C<=t+2?"bottom":"middle";this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,l.Message[0];var u=C,D=a;this.Canvas.save(),this.Canvas.translate(u,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.Message[0],-2,0),this.Canvas.restore()}if(null!=l.Message[1]&&n<10*s&&!0===this.IsShowYText[1]){null!=l.Font&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline=C>=e-2?"top":C<=t+2?"bottom":"middle";this.Canvas.measureText(l.Message[1]).width,this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,l.Message[1],u=C,D=i;this.Canvas.save(),this.Canvas.translate(u,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.Message[1],2,0),this.Canvas.restore()}o=C}}}}}function KLineFrame(){this.newMethod=AverageWidthFrame,this.newMethod(),delete this.newMethod,this.ClassName="KLineFrame",this.ToolbarID=Guid(),this.ModifyIndex=!0,this.ChangeIndex=!0,this.CloseIndex=!0,this.OverlayIndex=!1,this.ModifyIndexEvent,this.ChangeIndexEvent,this.ToolbarRect=null,this.ReDrawToolbar=!1,this.LastCalculateStatus={Width:0,XPointCount:0},this.CustomHorizontalInfo=[],this.IsDrawTitleBG=!1,this.CustomVerticalInfo=[],this.DrawCustomVerticalEvent,this.RightSpaceCount=0,this.Logarithmic=null,this.DrawToolbar=function(){if("undefined"==typeof $)return;if(!this.ChartBorder.UIElement||!this.ChartBorder.UIElement.parentNode)return;var t=document.getElementById(this.ToolbarID);if(t&&0==this.SizeChange&&0==this.ReDrawToolbar)return;if(t||((t=document.createElement("div")).className="klineframe-toolbar",t.id=this.ToolbarID,t.oncontextmenu=function(){return!1},t.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(t)),!(this.ModifyIndex||this.ChangeIndex||this.OverlayIndex||this.CloseIndex))return void("none"!=t.style.display&&(t.style.display="none"));var e=GetDevicePixelRatio(),a=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px","")),i=(parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px","")),this.ChartBorder.GetTitleHeight()),r=a-this.ChartBorder.Right/e-100,n=this.ChartBorder.GetTop()/e;if(this.ToolbarRect&&this.ToolbarRect.Left==r&&this.ToolbarRect.Top==n&&100==this.ToolbarRect.Width&&this.ToolbarRect.Height==i/e)return;this.ToolbarRect={Left:r,Top:n,Width:100,Height:i/e};var s="<span class=\'index_param icon iconfont icon-index_param\' id=\'modifyindex\' style=\'cursor:pointer;margin-left:2px;margin-right:2px;\' title=\'调整指标参数\'></span><span class=\'index_change icon iconfont icon-change_index\' id=\'changeindex\' style=\'cursor:pointer;margin-left:2px;margin-right:2px;\' title=\'切换指标\'></span><span class=\'index_overlay icon iconfont icon-overlay_index\' id=\'overlayindex\' style=\'cursor:pointer;margin-left:2px;margin-right:2px;\' title=\'叠加指标\'></span>";0!==this.Identify&&this.CloseIndex&&(s+="<span class=\'index_close icon iconfont icon-close\' id=\'closeindex\' style=\'cursor:pointer;margin-left:2px;margin-right:2px;\' title=\'关闭指标窗口\'></span>"),t.style.left=r+"px",t.style.top=n+"px",t.style.width="100px",t.style.height=i/e+"px",t.innerHTML=s;this.ChartBorder.UIElement.JSChartContainer,this.Identify;this.ModifyIndex?"function"==typeof this.ModifyIndexEvent&&$("#"+t.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):$("#"+t.id+" .index_param").hide(),this.ChangeIndex?"function"==typeof this.ChangeIndexEvent&&$("#"+t.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):$("#"+t.id+" .index_change").hide(),this.OverlayIndex?$("#"+t.id+" .index_overlay").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!0},this.ChangeIndexEvent):$("#"+t.id+" .index_overlay").hide(),$("#"+t.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},function(t){var e=t.data.Chart,a=t.data.Identify;e.RemoveIndexWindow(a)}),t.style.display="block"},this.ClearToolbar=function(){var t=document.getElementById(this.ToolbarID);t&&this.ChartBorder.UIElement.parentNode.removeChild(t)},this.DrawFrame=function(){if(this.SplitXYCoordinate(),1==this.SizeChange){var t=this.ZoomIndex;this.CalculateDataWidth(),debug&&console.log("CalculateDataWidth ("+t+") out ("+this.ZoomIndex+"  "+this.DataWidth+"  "+this.DistanceWidth+")"),this.Logarithmic&&this.SplitLogarithmicXYCoordinate()}this.DrawDepthMapCallback&&this.DrawDepthMapCallback(),this.DrawTitleBG(),this.DrawHorizontal(),this.DrawVertical(),1!=this.SizeChange&&1!=this.ReDrawToolbar||(this.DrawToolbar(),this.ReDrawToolbar=!1)},this.GetXFromIndex=function(t,e){if(!1===e)if(t>=0)for(var a=this.ChartBorder.GetLeft()+g_JSChartResource.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,i=1;i<=t;++i)a+=this.DistanceWidth+this.DataWidth;else{a=this.ChartBorder.GetLeft()-(this.DistanceWidth/2+this.DataWidth+this.DistanceWidth);var r=Math.abs(t);for(i=1;i<r;++i)a-=this.DistanceWidth+this.DataWidth}else{t<0&&(t=0),t>this.xPointCount-1&&(t=this.xPointCount-1);for(a=this.ChartBorder.GetLeft()+g_JSChartResource.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,i=1;i<=t;++i)a+=this.DistanceWidth+this.DataWidth}return a},this.GetXData=function(t,e){var a=this.DistanceWidth,i=this.DataWidth,r=this.ChartBorder.GetLeft()+g_JSChartResource.FrameLeftMargin;if(0==e){if(t<this.ChartBorder.GetLeft()){for(var n=-1,s=this.ChartBorder.GetLeft()-(a/2+i+a);n>-1e4&&!(s<=t);)s-=i+a,--n;return n}for(n=0,s=r+a/2+i+a;n<1e4&&!(s>=t);)s+=i+a,++n;return n}if(t<=this.ChartBorder.GetLeft())return 0;if(t>=this.ChartBorder.GetRight())return this.XPointCount-1;var o=this.ChartBorder.GetRight()-g_JSChartResource.FrameRightMargin;for(n=0,s=r+a/2+i+a;s<o&&n<1e4&&n+1<this.XPointCount&&!(s>=t);)s+=i+a,++n;return n},this.CalculateDataWidth=function(){if(!(this.XPointCount<2)){var t=this.GetFrameWidth()-g_JSChartResource.FrameMargin;if(this.ZoomIndex>=0&&this.LastCalculateStatus.Width==t&&this.LastCalculateStatus.XPointCount==this.XPointCount){var e=this.DistanceWidth/2+g_JSChartResource.FrameLeftMargin+(this.DataWidth+this.DistanceWidth)*(this.XPointCount-1);this.DataWidth,this.DistanceWidth,this.XPointCount;if(e<=t)return}this.LastCalculateStatus.Width=t,this.LastCalculateStatus.XPointCount=this.XPointCount;for(var a=0;a<ZOOM_SEED.length;++a)if((ZOOM_SEED[a][0]+ZOOM_SEED[a][1])*this.XPointCount<t)return this.ZoomIndex=a,this.DataWidth=ZOOM_SEED[a][0],this.DistanceWidth=ZOOM_SEED[a][1],this.TrimKLineDataWidth(t),void JSConsole.Chart.Log("[KLineFrame::CalculateDataWidth] ZOOM_SEED, DataWidth, DistanceWidth, XPointCount",ZOOM_SEED[this.ZoomIndex],this.DataWidth,this.DistanceWidth,this.XPointCount);this.ZoomIndex=ZOOM_SEED.length-1,this.DataWidth=t/this.XPointCount,this.DistanceWidth=0}},this.OnSize=function(t){for(var e=this.GetFrameWidth()-g_JSChartResource.FrameMargin,a=0,i=this.DistanceWidth/2+g_JSChartResource.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);i<e;i+=this.DataWidth+this.DistanceWidth,++a);return t.CurCount=this.XPointCount,t.CalcCount=a,t.DataWidth=this.DataWidth,t.DistanceWidth=this.DistanceWidth,t.Changed=!1,this.LastCalculateStatus.Width=e,t.CurCount==t.CalcCount?t:(this.XPointCount=a,this.LastCalculateStatus.XPointCount=this.XPointCount,this.Data&&(this.Data.DataOffset+=t.CurCount-t.CalcCount,this.Data.DataOffset<0&&(this.Data.DataOffset=0),t.Changed=!0),t)},this.SetDataWidth=function(t){var e=ZOOM_SEED.length-1;for(var a in ZOOM_SEED){if(ZOOM_SEED[a][0]<=t){e=parseInt(a)-1;break}}this.ZoomIndex=e,this.DataWidth=ZOOM_SEED[this.ZoomIndex][0],this.DistanceWidth=ZOOM_SEED[this.ZoomIndex][1];for(var i=this.GetFrameWidth()-g_JSChartResource.FrameMargin,r=0,n=this.DistanceWidth/2+g_JSChartResource.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);n<=i;n+=this.DataWidth+this.DistanceWidth,++r);return this.XPointCount=r,this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=i,{XPointCount:this.XPointCount,DataWidth:this.DataWidth,DistanceWidth:this.DistanceWidth}},this.TrimKLineDataWidth=function(t){var e=ZOOM_SEED[this.ZoomIndex][0],a=ZOOM_SEED[this.ZoomIndex][1];if(1!=e||0!=a)for(;;){if((this.DistanceWidth+this.DataWidth)*this.XPointCount+this.DistanceWidth>t){this.DistanceWidth-=.01;break}this.DistanceWidth+=.01}else this.DataWidth=t/this.XPointCount},this.IsOverlayMaxMin=function(t){if(!this.ChartKLine)return!1;if(!this.ChartKLine.Max||!this.ChartKLine.Min)return!1;var e=this.Canvas.measureText(t.Text.Value).width+4;"right"===t.Text.TextAlign&&(t.X-=e);var a=this.ChartKLine.Max,i=this.ChartKLine.Min,r=!1,n=!1;if(a.X>=t.X&&a.X<=t.X+e){var s=a.Y+20,o=a.Y-20;(s>=t.Y-20&&s<=t.Y+20||o>=t.Y-20&&o<=t.Y+20)&&(r=!0)}if(1==r)return!0;if(i.X>=t.X&&i.X<=t.X+e){s=i.Y+20,o=i.Y-20;(s>=t.Y-20&&s<=t.Y+20||o>=t.Y-20&&o<=t.Y+20)&&(n=!0)}return r||n},this.SplitXYCoordinate=function(){0!=this.XYSplit&&(null!=this.YSplitOperator&&this.YSplitOperator.Operator(),null!=this.XSplitOperator&&this.XSplitOperator.Operator(),this.Logarithmic&&this.SplitLogarithmicXYCoordinate())},this.SplitLogarithmicXYCoordinate=function(){for(var t=this.Logarithmic.Up,e=this.Logarithmic.Down,a=0,i=0,r=Math.max(t.length,e.length),n=[],s=0;s<r;++s)n[s]=2*s;s=0;for(var o=n.length-1;s<t.length;++s,--o){(c=t[s]).LogHeight=n[o],a+=c.LogHeight,++i}for(s=0,o=n.length-1;s<e.length;++s,--o){(c=e[s]).LogHeight=n[o],a+=c.LogHeight,++i}var h=2*GetDevicePixelRatio(),l=this.ChartBorder.GetTopEx(),C=this.ChartBorder.GetBottomEx(),u=(C-l-a*h)/i;if(1==this.CoordinateType){var D=l;for(s=e.length-1;s>=0;--s){(c=e[s]).Height=u+h*c.LogHeight,c.Top=D,c.Bottom=c.Top+c.Height,D=c.Bottom}var d=C;for(s=t.length-1;s>=0;--s){(c=t[s]).Height=u+h*c.LogHeight,c.Bottom=d,c.Top=d-c.Height,d=c.Top}}else{for(D=l,s=t.length-1;s>=0;--s){(c=t[s]).Height=u+h*c.LogHeight,c.Top=D,c.Bottom=c.Top+c.Height,D=c.Bottom}for(d=C,s=e.length-1;s>=0;--s){var c;(c=e[s]).Height=u+h*c.LogHeight,c.Bottom=d,c.Top=d-c.Height,d=c.Top}}JSConsole.Chart.Log("[KLineFrame::SplitLogarithmicXYCoordinate]",this.Logarithmic)},this.GetYLogarithmicFromData=function(t,e){if(1==this.CoordinateType){if(t<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();if(t>this.Logarithmic.OpenPrice){var a=this.Logarithmic.Up;for(var i in a){if(t>=(s=a[i]).Start&&t<=s.End){var r=(s.Bottom-s.Top)*(t-s.Start)/(s.End-s.Start);return s.Top+r}}}else{var n=this.Logarithmic.Down;for(var i in n){if(t>=(s=n[i]).Start&&t<=s.End){r=(s.Bottom-s.Top)*(t-s.Start)/(s.End-s.Start);return s.Top+r}}}}else{if(t<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetTopEx();if(t>this.Logarithmic.OpenPrice){a=this.Logarithmic.Up;for(var i in a){if(t>=(s=a[i]).Start&&t<=s.End){r=(s.Bottom-s.Top)*(t-s.Start)/(s.End-s.Start);return s.Bottom-r}}}else{n=this.Logarithmic.Down;for(var i in n){var s;if(t>=(s=n[i]).Start&&t<=s.End){r=(s.Bottom-s.Top)*(t-s.Start)/(s.End-s.Start);return s.Bottom-r}}}}},this.GetYLogarithmicData=function(t){if(1==this.CoordinateType){if(t<this.ChartBorder.GetTopEx())return this.HorizontalMin;if(t>this.ChartBorder.GetBottomEx())return this.HorizontalMax;var e=this.Logarithmic.Up;for(var a in e){if(t>=(r=e[a]).Top&&t<=r.Bottom)return(t-r.Top)/r.Height*(r.End-r.Start)+r.Start}var i=this.Logarithmic.Down;for(var a in i){if(t>=(r=i[a]).Top&&t<=r.Bottom)return(t-r.Top)/r.Height*(r.End-r.Start)+r.Start}}else{if(t<this.ChartBorder.GetTopEx())return this.HorizontalMax;if(t>this.ChartBorder.GetBottomEx())return this.HorizontalMin;e=this.Logarithmic.Up;for(var a in e){if(t>=(r=e[a]).Top&&t<=r.Bottom)return(r.Bottom-t)/r.Height*(r.End-r.Start)+r.Start}i=this.Logarithmic.Down;for(var a in i){var r;if(t>=(r=i[a]).Top&&t<=r.Bottom)return(r.Bottom-t)/r.Height*(r.End-r.Start)+r.Start}}},this.CalculateCount=function(t){var e=this.GetFrameWidth()-g_JSChartResource.FrameMargin;return parseInt(e/(ZOOM_SEED[t][0]+ZOOM_SEED[t][1]))},this.ZoomUp=function(t){if(this.ZoomIndex<=0)return!1;if(this.Data.DataOffset<0)return!1;var e=this.Data.Data.length,a=e+this.RightSpaceCount,i=0,r=this.Data.DataOffset+this.XPointCount-1,n=this.Data.DataOffset+t.Index;r>=e&&(i=r-(this.Data.Data.length-1),r=this.Data.Data.length-1,i>this.RightSpaceCount&&(i=this.RightSpaceCount));var s=this.CalculateCount(this.ZoomIndex-1);JSConsole.Chart.Log(`[KLineFrame::ZoomUp] old status. XPointCount=${this.XPointCount} ZoomIndex=${this.ZoomIndex} DataCount= ${this.Data.Data.length} rightSpaceCount=${i}`);var o=!1;if(--this.ZoomIndex,1==t.IsLockRight){var h=this.Data.DataOffset+this.XPointCount;if(s>h)s=h,this.XPointCount=s,this.Data.DataOffset=0;else{var l=r-(s-i)+1;this.XPointCount=s,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(s>=a)this.XPointCount=s,this.Data.DataOffset=0,o=!0,JSConsole.Chart.Log(`[KLineFrame::ZoomUp] Show all data. XPointCount=${this.XPointCount} ZoomIndex=${this.ZoomIndex} DataCount= ${e}`);else{l=r-(s-i)+1;if(1==t.ZoomType){var C=this.XPointCount-s+1,u=parseInt(t.Index/this.XPointCount*C);this.Data.DataOffset+u<e&&(l=this.Data.DataOffset+u)}this.XPointCount=s,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0),JSConsole.Chart.Log(`[KLineFrame::ZoomUp] calculate. XPointCount=${this.XPointCount} ZoomIndex=${this.ZoomIndex} DataCount= ${e} DataOffset=${this.Data.DataOffset}`)}if(this.DataWidth=ZOOM_SEED[this.ZoomIndex][0],this.DistanceWidth=ZOOM_SEED[this.ZoomIndex][1],!o){var D=this.GetFrameWidth()-g_JSChartResource.FrameMargin;this.TrimKLineDataWidth(D)}return this.LastCalculateStatus.XPointCount=this.XPointCount,t.Index=n-this.Data.DataOffset,window.chartdata[this.Data.Period]={DataOffset:this.Data.DataOffset,XPointCount:this.XPointCount,ZoomIndex:this.ZoomIndex},debug&&console.log(window.chartdata[this.Data.Period]),!0},this.ZoomDown=function(t){if(this.ZoomIndex+1>=ZOOM_SEED.length)return!1;if(this.Data.DataOffset<0)return!1;var e=this.Data.Data.length,a=e+this.RightSpaceCount,i=0,r=this.Data.DataOffset+this.XPointCount-1;r>=this.Data.Data.length&&(i=r-(this.Data.Data.length-1),r=this.Data.Data.length-1,i>this.RightSpaceCount&&(i=this.RightSpaceCount));var n=this.CalculateCount(this.ZoomIndex+1),s=this.Data.DataOffset+t.Index;JSConsole.Chart.Log(`[KLineFrame::ZoomDown] old status. XPointCount=${this.XPointCount} ZoomIndex=${this.ZoomIndex} DataCount= ${this.Data.Data.length} lastCursorIndex=${s} rightSpaceCount=${i}`);var o=!1;if(++this.ZoomIndex,1==t.IsLockRight){var h=this.Data.DataOffset+this.XPointCount;if(n>h)n=h,this.XPointCount=n,this.Data.DataOffset=0;else{var l=r-(n-i)+1;this.XPointCount=n,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(n>=a)this.XPointCount=n,this.Data.DataOffset=0,o=!0,JSConsole.Chart.Log(`[KLineFrame::ZoomDown] Show all data. XPointCount=${this.XPointCount} ZoomIndex=${this.ZoomIndex} DataCount= ${e}`);else{l=r-(n-i)+1;if(1==t.ZoomType){var C=n-this.XPointCount+1,u=parseInt(t.Index/this.XPointCount*C);(l=this.Data.DataOffset-u)+(n-this.RightSpaceCount)>=e&&(l=this.Data.DataOffset-C)}this.XPointCount=n,this.Data.DataOffset=l,this.Data.DataOffset<0&&(this.Data.DataOffset=0),JSConsole.Chart.Log(`[KLineFrame::ZoomDown] calculate. XPointCount=${this.XPointCount} ZoomIndex=${this.ZoomIndex} DataCount= ${e} DataOffset=${this.Data.DataOffset}`)}if(this.DataWidth=ZOOM_SEED[this.ZoomIndex][0],this.DistanceWidth=ZOOM_SEED[this.ZoomIndex][1],!o){var D=this.GetFrameWidth()-g_JSChartResource.FrameMargin;this.TrimKLineDataWidth(D)}return this.LastCalculateStatus.XPointCount=this.XPointCount,t.Index=s-this.Data.DataOffset,window.chartdata[this.Data.Period]={DataOffset:this.Data.DataOffset,XPointCount:this.XPointCount,ZoomIndex:this.ZoomIndex},debug&&console.log(window.chartdata[this.Data.Period]),!0},this.GetFrameWidth=function(){return this.IsHScreen?this.ChartBorder.GetHeight():this.ChartBorder.GetWidth()},this.DrawCustomHorizontal=function(){for(var t in this.CustomHorizontalInfo){var e=this.CustomHorizontalInfo[t];switch(e.Type){case 0:case 1:this.DrawCustomItem(e)}}},this.DrawCustomVerticalItem=function(t){this.Canvas.save(),1==t.Data.Line.Type&&this.Canvas.setLineDash([5,5]),this.Canvas.strokeStyle=t.Data.Line.Color,this.Canvas.beginPath(),t.IsHScreen?(this.Canvas.moveTo(t.Top,ToFixedPoint(t.X)),this.Canvas.lineTo(t.Bottom,ToFixedPoint(t.X))):(this.Canvas.moveTo(ToFixedPoint(t.X),t.Top),this.Canvas.lineTo(ToFixedPoint(t.X),t.Bottom)),this.Canvas.stroke(),this.Canvas.restore()},this.DrawCustomVertical=function(){if(this.CustomVerticalInfo&&!(this.CustomVerticalInfo.length<=0)&&this.Data){var t=this.IsHScreen,e=this.ChartBorder.GetTopEx(),a=this.ChartBorder.GetBottomEx(),i=this.DataWidth,r=this.DistanceWidth,n=this.ChartBorder.GetLeft()+r/2+2;t&&(n=this.ChartBorder.GetTop()+r/2+2,e=this.ChartBorder.GetLeftEx(),a=this.ChartBorder.GetRightEx());for(var s=0,o=this.Data.DataOffset;o<this.Data.Data.length&&s<this.XPointCount;++o,++s,n+=i+r){var h=this.Data.Data[o];for(var l in this.CustomVerticalInfo){if(0==(u=this.CustomVerticalInfo[l]).Type){if(IFrameSplitOperator.IsNumber(u.Time)){if(h.Date!=u.Date||h.Time!=u.Time)continue}else if(h.Date!=u.Date)continue;var C={X:(D=n)+(n+i-D)/2,Top:e,Bottom:a,Data:u,IsHScreen:t};this.DrawCustomVerticalItem(C),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,C,this);break}}}for(o=1;s<this.XPointCount;++o,++s,n+=i+r)for(var l in this.CustomVerticalInfo){var u;if(1==(u=this.CustomVerticalInfo[l]).Type&&u.Space==o){var D;C={X:(D=n)+(n+i-D)/2,Top:e,Bottom:a,Data:u,IsHScreen:t};this.DrawCustomVerticalItem(C),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,C,this);break}}}}}function OverlayKLineFrame(){this.newMethod=KLineFrame,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineFrame",this.MainFrame=null,this.RightOffset=50,this.PenBorder=g_JSChartResource.OverlayFrame.BolderPen,this.IsShow=!0,this.Title=null,this.TitleColor=g_JSChartResource.OverlayFrame.TitleColor,this.TitleFont=g_JSChartResource.OverlayFrame.TitleFont,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1},this.DrawTitle=function(){if(this.Title){var t=this.ChartBorder.GetTopTitle(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetRight();a+=this.RightOffset,this.Canvas.fillStyle=this.TitleColor,this.Canvas.font=this.TitleFont,this.Canvas.textAlign="center",this.Canvas.textBaseline="top";var i=a-2,r=t+(e-t)/2;this.Canvas.save(),this.Canvas.translate(i,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Title,0,0),this.Canvas.restore()}},this.SplitXYCoordinate=function(){0!=this.XYSplit&&null!=this.YSplitOperator&&this.YSplitOperator.Operator()},this.DrawHorizontal=function(){this.ChartBorder.GetLeft();var t=this.ChartBorder.GetRight(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetTopTitle(),i=this.ChartBorder.Right;t+=this.RightOffset;for(var r=null,n=this.HorizontalInfo.length-1;n>=0;--n){var s=this.HorizontalInfo[n],o=this.GetYFromData(s.Value);null!=o&&Math.abs(o-r)<this.MinYDistance||(this.Canvas.textBaseline=o>=e-2?"bottom":o<=a+2?"top":"middle",this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(t-2,ToFixedPoint(o)),this.Canvas.lineTo(t,ToFixedPoint(o)),this.Canvas.stroke(),null!=s.Message[1]&&i>10&&(null!=s.Font&&(this.Canvas.font=s.Font),this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="left",this.Canvas.fillText(s.Message[1],t+2,o)),r=o)}},this.DrawVertical=function(){var t=this.ChartBorder.GetTopEx(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottomEx();e+=this.RightOffset,this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(e),ToFixedPoint(t)),this.Canvas.lineTo(ToFixedPoint(e),ToFixedPoint(a)),this.Canvas.stroke()}}function KLineHScreenFrame(){this.newMethod=KLineFrame,this.newMethod(),delete this.newMethod,this.ClassName="KLineHScreenFrame",this.IsHScreen=!0,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var t=ToFixedPoint(this.ChartBorder.GetRightTitle()),e=ToFixedPoint(this.ChartBorder.GetTop()),a=ToFixedPoint(this.ChartBorder.GetBottom()),i=this.ChartBorder.TitleHeight,r=a-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(t,e,i,r)}},this.DrawToolbar=function(){},this.GetYFromData=function(t){if(t<=this.HorizontalMin)return this.ChartBorder.GetLeftEx();if(t>=this.HorizontalMax)return this.ChartBorder.GetRightEx();var e=this.ChartBorder.GetWidthEx()*(t-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetLeftEx()+e},this.DrawHorizontal=function(){for(var t=this.ChartBorder.GetTop(),e=this.ChartBorder.GetBottom(),a=this.ChartBorder.Top,i=this.ChartBorder.Bottom,r=this.ChartBorder.GetLeft(),n=(this.ChartBorder.GetRight(),null),s=GetDevicePixelRatio(),o=a>10*s&&!0===this.IsShowYText[0]&&2!=this.YTextPosition[0],h=i>10*s&&!0===this.IsShowYText[1]&&2!=this.YTextPosition[1],l=this.HorizontalInfo.length-1;l>=0;--l){var C=this.HorizontalInfo[l],u=this.GetYFromData(C.Value);if(!(null!=u&&Math.abs(u-n)<this.MinYDistance)){if(u!=r&&(this.Canvas.strokeStyle=C.LineColor,g_JSChartResource.FrameYLineDash?(this.Canvas.save(),this.Canvas.setLineDash(g_JSChartResource.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(u),t),this.Canvas.lineTo(ToFixedPoint(u),e),this.Canvas.stroke(),this.Canvas.restore()):(this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(u),t),this.Canvas.lineTo(ToFixedPoint(u),e),this.Canvas.stroke())),null!=C.Message[0]&&o){null!=C.Font&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var D=u,d=t;this.Canvas.save(),this.Canvas.translate(D,d),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[0],-2,0),this.Canvas.restore()}if(null!=C.Message[1]&&h){null!=C.Font&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";D=u,d=e;this.Canvas.save(),this.Canvas.translate(D,d),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[1],2,0),this.Canvas.restore()}n=u}}},this.DrawInsideHorizontal=function(){if(!1!==this.IsShowYText[0]||!1!==this.IsShowYText[1]){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightEx(),a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom(),r=this.ChartBorder.Top,n=this.ChartBorder.Bottom,s=(this.ChartBorder.TitleHeight,(r<10*(h=GetDevicePixelRatio())||2==this.YTextPosition[0])&&!0===this.IsShowYText[0]),o=(n<10*h||2==this.YTextPosition[1])&&!0===this.IsShowYText[1];if(s||o)for(var h=GetDevicePixelRatio(),l=null,C=this.HorizontalInfo.length-1;C>=0;--C){var u=this.HorizontalInfo[C],D=this.GetYFromData(u.Value);if(!(null!=D&&null!=l&&Math.abs(D-l)<this.MinYDistance)){if(null!=u.Message[0]&&s){null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline=D>=e-2?"top":D<=t+2?"bottom":"middle";this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,u.Message[0];var d=D,c=a;this.Canvas.save(),this.Canvas.translate(d,c),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[0],-2,0),this.Canvas.restore()}if(null!=u.Message[1]&&o){null!=u.Font&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline=D>=e-2?"top":D<=t+2?"bottom":"middle";this.Canvas.measureText(u.Message[1]).width,this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,u.Message[1],d=D,c=i;this.Canvas.save(),this.Canvas.translate(d,c),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[1],2,0),this.Canvas.restore()}l=D}}}},this.GetXFromIndex=function(t){t<0&&(t=0),t>this.xPointCount-1&&(t=this.xPointCount-1);for(var e=this.ChartBorder.GetTop()+g_JSChartResource.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,a=1;a<=t;++a)e+=this.DistanceWidth+this.DataWidth;return e},this.DrawVertical=function(){var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightTitle(),a=this.ChartBorder.GetBottom(),i=null;for(var r in this.VerticalInfo){var n=this.GetXFromIndex(this.VerticalInfo[r].Value);if(n>=a)break;if(!(null!=i&&Math.abs(n-i)<80)){if(this.Canvas.strokeStyle=this.VerticalInfo[r].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t,ToFixedPoint(n)),this.Canvas.lineTo(e,ToFixedPoint(n)),this.Canvas.stroke(),null!=this.VerticalInfo[r].Message[0]){null!=this.VerticalInfo[r].Font&&(this.Canvas.font=this.VerticalInfo[r].Font),this.Canvas.fillStyle=this.VerticalInfo[r].TextColor,n<this.Canvas.measureText(this.VerticalInfo[r].Message[0]).width/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var s=t,o=n;this.Canvas.save(),this.Canvas.translate(s,o),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[r].Message[0],0,0),this.Canvas.restore()}i=n}}},this.GetYData=function(t){return t<this.ChartBorder.GetLeftEx()?this.HorizontalMin:t>this.ChartBorder.GetRightEx()?this.HorizontalMax:(t-this.ChartBorder.GetLeftEx())/this.ChartBorder.GetWidthEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(t){if(t<=this.ChartBorder.GetTop())return 0;if(t>=this.ChartBorder.GetBottom())return this.XPointCount-1;for(var e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom(),i=this.DistanceWidth,r=this.DataWidth,n=0,s=e+i/2+r+i;s<a&&n<1e4&&n+1<this.XPointCount&&!(s>t);)s+=r+i,++n;return n}}function OverlayKLineHScreenFrame(){this.newMethod=KLineHScreenFrame,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineHScreenFrame",this.MainFrame=null,this.RightOffset=50,this.PenBorder=g_JSChartResource.OverlayFrame.BolderPen,this.IsShow=!0,this.Title=null,this.TitleColor=g_JSChartResource.OverlayFrame.TitleColor,this.TitleFont=g_JSChartResource.OverlayFrame.TitleFont,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1},this.DrawTitle=function(){},this.SplitXYCoordinate=function(){0!=this.XYSplit&&null!=this.YSplitOperator&&this.YSplitOperator.Operator()},this.DrawHorizontal=function(){},this.DrawVertical=function(){}}function SubFrameItem(){this.Frame,this.Height,this.OverlayIndex=[],this.Interval=60}function OverlayIndexItem(){this.Frame,this.ChartPaint=[],this.Identify=Guid(),this.Scprit,this.UpdateFrameMaxMin=function(){var t={Max:null,Min:null};if(this.Frame.YSpecificMaxMin)t.Max=this.Frame.YSpecificMaxMin.Max,t.Min=this.Frame.YSpecificMaxMin.Min;else for(var e in this.ChartPaint){var a=this.ChartPaint[e].GetMaxMin();IFrameSplitOperator.IsNumber(a.Max)&&(null==t.Max||t.Max<a.Max)&&(t.Max=a.Max),IFrameSplitOperator.IsNumber(a.Min)&&(null==t.Min||t.Min>a.Min)&&(t.Min=a.Min)}null!=t.Max&&null!=t.Min&&(this.Frame.HorizontalMax=t.Max,this.Frame.HorizontalMin=t.Min,this.Frame.XYSplit=!0)}}function HQTradeFrame(){this.SubFrame=new Array,this.SizeChange=!0,this.ChartBorder,this.Canvas,this.ScreenImageData,this.Data,this.Position,this.SizeChange=!0,this.MinSubFrameHeight=g_JSChartResource.DragSubFrameBorder.MinFrameHeight,this.DragBorderHeight=g_JSChartResource.DragSubFrameBorder.TopBorderHeight,this.OnMoveFromeBorder=function(t,e){if(this.SubFrame.length<=0)return!1;for(var a=this.SubFrame[t],i=null,r=t+1;r<this.SubFrame.length;++r){var n=this.SubFrame[r];if(n.Height>0){i=n;break}}if(!a||!i)return!1;var s=a.Frame.ChartBorder.Bottom,o=i.Frame.ChartBorder.Top;a.Frame.ChartBorder.Bottom-=e,i.Frame.ChartBorder.Top+=e;var h=a.Frame.ChartBorder.GetHeightEx(),l=i.Frame.ChartBorder.GetHeightEx();return!(h<this.MinSubFrameHeight&&e<0||l<this.MinSubFrameHeight&&e>0)||(a.Frame.ChartBorder.Bottom=s,i.Frame.ChartBorder.Top=o,!1)},this.ReDrawToolbar=function(){for(var t in this.SubFrame)this.SubFrame[t].Frame.ReDrawToolbar=!0},this.SaveSubFrameHeightRate=function(){var t=this.ChartBorder.GetHeight();for(var e in this.SubFrame){var a=this.SubFrame[e],i=a.Frame.ChartBorder.GetHeight()/t*100;a.Height=i}},this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){var t=this.ChartBorder.GetTop(),e=this.ChartBorder.GetHeight(),a=0;for(var i in this.SubFrame){a+=(r=this.SubFrame[i]).Height}for(var i in this.SubFrame){var r;(r=this.SubFrame[i]).Frame.ChartBorder.Top=t,r.Frame.ChartBorder.Left=this.ChartBorder.Left,r.Frame.ChartBorder.Right=this.ChartBorder.Right;var n=e*(r.Height/a)+t;r.Frame.ChartBorder.Bottom=this.ChartBorder.GetChartHeight()-n,t=n}}},this.CalculateChartBorder2=function(){if(!(this.SubFrame.length<=0)){var t=this.ChartBorder.Top,e=this.ChartBorder.Bottom,a=this.ChartBorder.GetHeight(),i=0;for(var r in this.SubFrame){i+=(s=this.SubFrame[r]).Height}var n=0;for(var r in this.SubFrame){var s;(s=this.SubFrame[r]).Frame.ChartBorder.Top=t,s.Frame.ChartBorder.Left=this.ChartBorder.Left,s.Frame.ChartBorder.Right=this.ChartBorder.Right,s.Frame.ChartBorder.X=this.ChartBorder.X,s.Frame.ChartBorder.Y=this.ChartBorder.Y,s.Frame.ChartBorder.Width=this.ChartBorder.Width,s.Frame.ChartBorder.Height=this.ChartBorder.Height;var o=a*(s.Height/i);n+=o,e=this.ChartBorder.Bottom+(a-n),s.Frame.ChartBorder.Bottom=e,t+=o}}},this.Draw=function(){for(var t in!0===this.SizeChange&&this.CalculateChartBorder(),this.SubFrame){var e=this.SubFrame[t];if(!(e.Height<=0)){e.Frame.Draw();var a=e.Interval;for(var i in e.OverlayIndex){var r=e.OverlayIndex[i];r.Frame.DataWidth=e.Frame.DataWidth,r.Frame.DistanceWidth=e.Frame.DistanceWidth,r.Frame.XPointCount=e.Frame.XPointCount,r.ChartPaint.length>0&&r.Frame.IsShow&&(r.Frame.RightOffset=a,r.Frame.Draw(),a+=e.Interval)}}}this.SizeChange=!1},this.DrawOveraly=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];for(var a in e.OverlayIndex){var i=e.OverlayIndex[a];for(var r in i.ChartPaint)i.ChartPaint[r].IsShow&&i.ChartPaint[r].Draw()}}},this.DrawLock=function(){for(var t in this.SubFrame){this.SubFrame[t].Frame.DrawLock()}},this.CalculateLock=function(){for(var t in this.SubFrame){this.SubFrame[t].Frame.CalculateLock()}},this.DrawInsideHorizontal=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];e.Frame.DrawInsideHorizontal&&e.Frame.DrawInsideHorizontal()}},this.DrawCustomHorizontal=function(){for(var t in this.SubFrame){var e=this.SubFrame[t];e.Frame.DrawCustomHorizontal&&e.Frame.DrawCustomHorizontal()}},this.DrawCustomVertical=function(t){for(var e in this.SubFrame){var a=this.SubFrame[e];a.Frame.DrawCustomVerticalEvent=t,a.Frame.DrawCustomVertical&&a.Frame.DrawCustomVertical()}},this.SetSizeChage=function(t){for(var e in this.SizeChange=t,this.SubFrame){var a=this.SubFrame[e];for(var i in a.Frame.SizeChange=t,a.OverlayIndex){var r=a.OverlayIndex[i];r.Frame&&(r.Frame.SizeChange=t)}}this.ChartBorder.UIElement&&(this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight})},this.SetDrawDepthMap=function(t){for(var e in this.SubFrame){this.SubFrame[e].Frame.DrawDepthMapCallback=t}},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.GetXData=function(t){return this.SubFrame[0].Frame.GetXData(t)},this.GetYData=function(t,e){var a;for(var i in this.SubFrame){var r=this.SubFrame[i],n=r.Frame.ChartBorder.GetLeft(),s=r.Frame.ChartBorder.GetTopEx(),o=r.Frame.ChartBorder.GetWidth(),h=r.Frame.ChartBorder.GetHeightEx();if(r.Frame.Canvas.beginPath(),r.Frame.Canvas.rect(n,s,o,h),r.Frame.Canvas.isPointInPath(n,t)){a=r.Frame,e&&(e.FrameID=parseInt(i));break}}if(null!=a){a.RightFrame&&(e.RightYValue=a.RightFrame.GetYData(t));var l=a.GetYData(t);if(1==a.YSplitOperator.CoordinateType){var C=a.YSplitOperator.GetFirstOpenPrice();e.RightYValue=((l-C)/C*100).toFixed(2)+"%"}return l}},this.PtInFrame=function(t,e){for(var a in this.SubFrame){var i=this.SubFrame[a],r=i.Frame.ChartBorder.GetLeft(),n=i.Frame.ChartBorder.GetTop(),s=i.Frame.ChartBorder.GetWidth(),o=i.Frame.ChartBorder.GetHeight();if(i.Frame.Canvas.beginPath(),i.Frame.Canvas.rect(r,n,s,o),i.Frame.Canvas.isPointInPath(t,e))return parseInt(a)}return-1},this.GetXFromIndex=function(t){return this.SubFrame[0].Frame.GetXFromIndex(t)},this.GetYFromData=function(t){return this.SubFrame[0].Frame.GetYFromData(t)},this.ZoomUp=function(t){if("00"==window.chartdata.viewperiod){var e=!1,a=this.SubFrame[0].Frame,i=this.ChartBorder.GetWidth()/GetDevicePixelRatio();return debug&&console.log("::::::::::::::::::::::zoomup",window.chartdata["00"].DataOffset,this.Data.DataOffset,a.Data.DataOffset,a.XPointCount,a.MinuteCount,i,this),enlargeminutechart>=1&&enlargeminutechart<7&&(e=!0,enlargeminutechart++),enlargeminutechart<1&&(e=!0,enlargeminutechart+=.1),1==e&&(minutecount=Math.trunc(i/enlargeminutechart),this.Data.DataOffset=Math.max(0,Math.min(a.Data.Data.length,this.Data.DataOffset+a.XPointCount)-minutecount),a.XPointCount=minutecount),e&&debug&&console.log("::::::::::::::::::::::result",this.Data.DataOffset,a.XPointCount),e}e=this.SubFrame[0].Frame.ZoomUp(t);return this.UpdateAllFrame(),e},this.ZoomDown=function(t){if("00"==window.chartdata.viewperiod){var e=!1,a=this.SubFrame[0].Frame,i=this.ChartBorder.GetWidth()/GetDevicePixelRatio();return debug&&console.log("::::::::::::::::::::::zoomdown",window.chartdata["00"].DataOffset,this.Data.DataOffset,a.Data.DataOffset,a.XPointCount,a.MinuteCount,i,this),enlargeminutechart>.2&&enlargeminutechart<=1&&(e=!0,enlargeminutechart-=.1),enlargeminutechart>1&&(e=!0,enlargeminutechart--),1==e&&(minutecount=Math.trunc(i/enlargeminutechart),this.Data.DataOffset=a.Data.DataOffset=window.chartdata["00"].DataOffset=Math.max(0,Math.min(a.Data.Data.length,this.Data.DataOffset+a.XPointCount)-minutecount),a.XPointCount=minutecount),e&&debug&&console.log("::::::::::::::::::::::result",this.Data.DataOffset,a.XPointCount),e}e=this.SubFrame[0].Frame.ZoomDown(t);return this.UpdateAllFrame(),e},this.ResetXYSplit=function(){for(var t in this.SubFrame)this.SubFrame[t].Frame.XYSplit=!0},this.SetLanguage=function(t){for(var e in this.SubFrame){var a=this.SubFrame[e];a&&a.Frame&&(a.Frame.YSplitOperator&&(a.Frame.YSplitOperator.LanguageID=t),a.Frame.XSplitOperator&&(a.Frame.XSplitOperator.LanguageID=t))}},this.GetCurrentPageSize=function(){if(this.SubFrame.length<=0)return null;var t=this.SubFrame[0];return t&&t.Frame?t.Frame.XPointCount:null},this.OnSize=function(){var t={};return this.SubFrame[0].Frame.OnSize(t),this.UpdateAllFrame(),t},this.SetDataWidth=function(t){var e=this.SubFrame[0].Frame.SetDataWidth(t);return this.UpdateAllFrame(),e},this.UpdateAllFrame=function(){for(var t=this.SubFrame[0].Frame,e=0;e<this.SubFrame.length;++e){var a=this.SubFrame[e];for(var i in e>0&&(a.Frame.XPointCount=t.XPointCount,a.Frame.ZoomIndex=t.ZoomIndex,a.Frame.DataWidth=t.DataWidth,a.Frame.DistanceWidth=t.DistanceWidth,a.Frame.LastCalculateStatus.Width=t.LastCalculateStatus.Width,a.Frame.LastCalculateStatus.XPointCount=t.LastCalculateStatus.XPointCount),a.OverlayIndex){var r=this.SubFrame[e].OverlayIndex[i];r.Frame.XPointCount=t.XPointCount,r.Frame.ZoomIndex=t.ZoomIndex,r.Frame.DataWidth=t.DataWidth,r.Frame.DistanceWidth=t.DistanceWidth,r.Frame.LastCalculateStatus.Width=t.LastCalculateStatus.Width,r.Frame.LastCalculateStatus.XPointCount=t.LastCalculateStatus.XPointCount}}},this.PtInFrameBorder=function(t,e){for(var a=this.DragBorderHeight,i=0;i<this.SubFrame.length-1;++i){var r=this.SubFrame[i];if(!(r.Frame.Heigh<=0)){var n=r.Frame.ChartBorder.GetBottom(),s=r.Frame.ChartBorder.GetLeft(),o=r.Frame.ChartBorder.GetRight();if(r.Frame.Canvas.beginPath(),r.Frame.Canvas.rect(s,n-a/2,o-s,a),r.Frame.Canvas.isPointInPath(t,e))return{Index:i,Bottom:!0}}}return null}}function HQTradeHScreenFrame(){this.newMethod=HQTradeFrame,this.newMethod(),delete this.newMethod,this.IsHScreen=!0,this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){var t=this.ChartBorder.Right,e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetWidth(),i=0;for(var r in this.SubFrame){i+=(n=this.SubFrame[r]).Height}for(var r in this.SubFrame){var n;(n=this.SubFrame[r]).Frame.ChartBorder.Top=this.ChartBorder.Top,n.Frame.ChartBorder.Bottom=this.ChartBorder.Bottom;var s=a*(n.Height/i);n.Frame.ChartBorder.Right=t,n.Frame.ChartBorder.Left=e-s,t+=s,e-=s}}},this.GetYData=function(t,e){var a;for(var i in this.SubFrame){var r=this.SubFrame[i],n=r.Frame.ChartBorder.GetLeftEx(),s=r.Frame.ChartBorder.GetTop(),o=r.Frame.ChartBorder.GetWidthEx(),h=r.Frame.ChartBorder.GetHeight();if(r.Frame.Canvas.beginPath(),r.Frame.Canvas.rect(n,s,o,h),r.Frame.Canvas.isPointInPath(t,s)){a=r.Frame,e&&(e.FrameID=i);break}}if(null!=a)return a.GetYData(t)}}function SimpleChartFrame(){this.newMethod=AverageWidthFrame,this.newMethod(),delete this.newMethod,this.ScreenImageData,this.Position,this.DrawFrame=function(){if(this.XPointCount>0){let t=this.ChartBorder.GetWidth()/(6*this.XPointCount);this.DistanceWidth=2*t,this.DataWidth=4*t}this.SplitXYCoordinate(),this.DrawHorizontal(),this.DrawVertical()},this.GetXFromIndex=function(t){t<0&&(t=0),t>this.xPointCount-1&&(t=this.xPointCount-1);for(var e=this.ChartBorder.GetLeft()+2+this.DistanceWidth/2+this.DataWidth/2,a=1;a<=t;++a)e+=this.DistanceWidth+this.DataWidth;return e},this.SplitXYCoordinate=function(){0!=this.XYSplit&&(null!=this.YSplitOperator&&this.YSplitOperator.Operator(),null!=this.XSplitOperator&&this.XSplitOperator.Operator())},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.SetSizeChage=function(t){this.SizeChange=t,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}}}function HistoryData(){this.Date,this.YClose,this.Open,this.Close,this.High,this.Low,this.Vol,this.Amount,this.Time,this.FlowCapital=0,this.Position=null,this.YFClose=null,this.FClose=null,this.Stop,this.Up,this.Down,this.Unchanged}function MinuteData(){this.Close,this.Open,this.High,this.Low,this.Vol,this.Amount,this.DateTime,this.Increase,this.Risefall,this.AvPrice,this.Lead=null,this.Time,this.Date,this.Position=null}function SingleData(){this.Date,this.Time,this.Value}Number.prototype.toFixed2=Number.prototype.toFixed,Number.prototype.toFixed=function(t){return ToFixed(this,t)},HistoryData.Copy=function(t){var e=new HistoryData;return e.Date=t.Date,e.YClose=t.YClose,e.Open=t.Open,e.Close=t.Close,e.High=t.High,e.Low=t.Low,e.Vol=t.Vol,e.Amount=t.Amount,e.Time=t.Time,e.FlowCapital=t.FlowCapital,e.Position=t.Position,e.YFClose=t.YFClose,e.FClose=t.FClose,e.Stop=t.Stop,e.Up=t.Up,e.Down=t.Down,e.Unchanged=t.Unchanged,e},HistoryData.CopyTo=function(t,e){t.Date=e.Date,t.YClose=e.YClose,t.Open=e.Open,t.Close=e.Close,t.High=e.High,t.Low=e.Low,t.Vol=e.Vol,t.Amount=e.Amount,t.Time=e.Time,t.FlowCapital=e.FlowCapital,t.Position=e.Position,t.YFClose=e.YFClose,t.FClose=e.FClose,t.Stop=e.Stop,t.Up=e.Up,t.Down=e.Down,t.Unchanged=e.Unchanged},HistoryData.CopyRight=function(t,e){var a=new HistoryData;return a.Date=t.Date,a.YClose=t.YClose*e,a.Open=t.Open*e,a.Close=t.Close*e,a.High=t.High*e,a.Low=t.Low*e,a.Vol=t.Vol,a.Amount=t.Amount,a.FlowCapital=t.FlowCapital,a.Position=t.Position,a.YFClose=t.YFClose,a.FClose=t.FClose,a};var KLINE_INFO_TYPE={INVESTOR:1,ANNOUNCEMENT:2,PFORECAST:3,ANNOUNCEMENT_QUARTER_1:4,ANNOUNCEMENT_QUARTER_2:5,ANNOUNCEMENT_QUARTER_3:6,ANNOUNCEMENT_QUARTER_4:7,RESEARCH:8,BLOCKTRADING:9,TRADEDETAIL:10,ANNOUNCEMENT_EX_START:100,ANNOUNCEMENT_EX_END:200};function KLineInfoData(){this.ID,this.Date,this.Title,this.InfoType,this.ExtendData}function DataPlus(){this.PeriodCallback=new Map,this.GetPeriodCallback=function(t){return this.PeriodCallback.has(t)?this.PeriodCallback.get(t):null},this.AddPeriodCallback=function(t){if(IFrameSplitOperator.IsNumber(t.Period)&&t.Callback){var e={Period:t.Period,Callback:t.Callback};this.PeriodCallback.set(t.Period,e)}},this.RemovePeriodCallback=function(t){this.PeriodCallback.has(t.ID)&&this.PeriodCallback.delete(t.ID)}}DataPlus.GetMinutePeriodData=null;var g_DataPlus=new DataPlus;function ChartData(){this.Data=new Array,this.DataOffset=0,this.Period=0,this.Right=0,this.Symbol,this.Data2=new Array,this.GetCloseMA=function(t){for(var e=new Array,a=0,i=this.Data.length;a<i;a++)if(a<t)e[a]=null;else{for(var r=0,n=0;n<t;n++)r+=this.Data[a-n].Close;e[a]=r/t}return e},this.GetVolMA=function(t){for(var e=new Array,a=0,i=this.Data.length;a<i;a++)if(a<t)e[a]=null;else{for(var r=0,n=0;n<t;n++)r+=this.Data[a-n].Vol;e[a]=r/t}return e},this.GetAmountMA=function(t){for(var e=new Array,a=0,i=this.Data.length;a<i;a++)if(a<t)e[a]=null;else{for(var r=0,n=0;n<t;n++)r+=this.Data[a-n].Amount;e[a]=r/t}return e},this.GetClose=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Close;return t},this.GetYClose=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].YClose;return t},this.GetHigh=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].High;return t},this.GetLow=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Low;return t},this.GetOpen=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Open;return t},this.GetVol=function(t){var e=1;IFrameSplitOperator.IsNumber(t)>0&&(e=t);var a=new Array;for(var i in this.Data)a[i]=this.Data[i].Vol/e;return a},this.GetAmount=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Amount;return t},this.GetPosition=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Position;return t},this.GetLead=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Lead;return t},this.GetDate=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Date;return t},this.GetTime=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].Time;return t},this.GetUp=function(){var t=[];for(var e in this.Data)t[e]=this.Data[e].Up;return t},this.GetDown=function(){var t=[];for(var e in this.Data)t[e]=this.Data[e].Down;return t},this.GetYear=function(){var t=new Array;for(var e in this.Data)t[e]=parseInt(this.Data[e].Date/1e4);return t},this.GetMonth=function(){var t=new Array;for(var e in this.Data)t[e]=parseInt(this.Data[e].Date%1e4/100);return t},this.GetAvPrice=function(){var t=new Array;for(var e in this.Data){var a=this.Data[e].AvPrice;IFrameSplitOperator.IsNumber(a)?t[e]=a:t[e]=0}return t},this.GetDateRange=function(){if(!this.Data||this.Data.length<=0)return null;var t=this.Data[0],e=this.Data[this.Data.length-1],a={Start:{Date:t.Date},End:{Date:e.Date}};return IFrameSplitOperator.IsNumber(t.Time)&&(a.Start.Time=t.Time),IFrameSplitOperator.IsNumber(e.Time)&&(a.End.Time=e.Time),a},this.GetMinutePeriodData=function(t){if(DataPlus.GetMinutePeriodData)return DataPlus.GetMinutePeriodData(t,this.Data,this);var e=new Array,a=5;if(5==t)a=5;else if(6==t)a=15;else if(7==t)a=30;else if(8==t)a=60;else if(11==t)a=120;else if(12==t)a=240;else{if(0!=t)return t>CUSTOM_MINUTE_PERIOD_START&&t<=CUSTOM_MINUTE_PERIOD_END?(a=t-CUSTOM_MINUTE_PERIOD_START,this.GetMinuteCustomPeriodData(a)):this.Data;a=1440}for(var i=!1,r=null,n=null,s=0;s<this.Data.length;){i=!0;for(var o=0;o<a&&s<this.Data.length;++s){i&&(r=new HistoryData,e.push(r),i=!1);var h=this.Data[s];if(null!=h){if((925!=h.Time||null!=n&&924==n)&&(930!=h.Time||null!=n&&929==n)&&(1300!=h.Time||null!=n&&1259==n)&&++o,r.Date=h.Date,r.Time=h.Time,n=r.Time,null!=h.Open&&null!=h.Close&&(null==r.Open||null==r.Close?(r.Open=h.Open,r.High=h.High,r.Low=h.Low,r.YClose=h.YClose,r.Close=h.Close,r.Vol=h.Vol,r.Amount=h.Amount,r.FlowCapital=h.FlowCapital,r.Position=h.Position,r.YFClose=h.YFClose,r.FClose=h.FClose):(r.High<h.High&&(r.High=h.High),r.Low>h.Low&&(r.Low=h.Low),r.Close=h.Close,r.Vol+=h.Vol,null!=h.Amount&&(r.Amount+=h.Amount),r.Position=h.Position,r.FlowCapital=h.FlowCapital,r.FClose=h.FClose),s+1<this.Data.length)){var l=this.Data[s+1];if(l&&l.Date!=h.Date){++s;break}}}else++o}}return e},this.GetMinuteCustomPeriodData=function(t){for(var e=new Array,a=t,i=!1,r=null,n=0;n<this.Data.length;){i=!0;for(var s=0;s<a&&n<this.Data.length;++n,++s){i&&(r=new HistoryData,e.push(r),i=!1);var o=this.Data[n];null!=o&&(r.Date=o.Date,r.Time=o.Time,null!=o.Open&&null!=o.Close&&(null==r.Open||null==r.Close?(r.Open=o.Open,r.High=o.High,r.Low=o.Low,r.YClose=o.YClose,r.Close=o.Close,r.Vol=o.Vol,r.Amount=o.Amount,r.FlowCapital=o.FlowCapital,r.Position=o.Position,r.YFClose=o.YFClose,r.FClose=o.FClose):(r.High<o.High&&(r.High=o.High),r.Low>o.Low&&(r.Low=o.Low),r.Close=o.Close,r.Vol+=o.Vol,null!=o.Amount&&(r.Amount+=o.Amount),r.Position=o.Position,r.FlowCapital=o.FlowCapital,r.FClose=o.FClose)))}}return e},this.GetDayPeriodData=function(t){if(t>CUSTOM_DAY_PERIOD_START&&t<=CUSTOM_DAY_PERIOD_END)return this.GetDayCustomPeriodData(t-CUSTOM_DAY_PERIOD_START);var e=MARKET_SUFFIX_NAME.IsBIT(this.Symbol),a=new Array,i=0,r=2,n=null;for(var s in this.Data){var o=!1,h=this.Data[s];switch(t){case 1:if(e)var l=ChartData.GetSunday(h.Date);else l=ChartData.GetFirday(h.Date);l!=i&&(o=!0,i=l);break;case 21:if(e)l=ChartData.GetSunday(h.Date);else l=ChartData.GetFirday(h.Date);l!=i&&(++r>=2&&(o=!0,r=0),i=l);break;case 2:parseInt(h.Date/100)!=parseInt(i/100)&&(o=!0,i=h.Date);break;case 3:parseInt(h.Date/1e4)!=parseInt(i/1e4)&&(o=!0,i=h.Date);break;case 9:var C=ChartData.GetQuarter(h.Date);C=10*parseInt(h.Date/1e4)+C;var u=ChartData.GetQuarter(i);C!=(u=10*parseInt(i/1e4)+u)&&(o=!0,i=h.Date)}if(o){if((n=new HistoryData).Date=h.Date,a.push(n),null==h.Open||null==h.Close)continue;n.Open=h.Open,n.High=h.High,n.Low=h.Low,n.YClose=h.YClose,n.Close=h.Close,n.Vol=h.Vol,n.Amount=h.Amount,n.FlowCapital=h.FlowCapital,n.Position=h.Position,n.YFClose=h.YFClose,n.FClose=h.FClose}else{if(null==n)continue;if(null==h.Open||null==h.Close)continue;null==n.Open||null==n.Close?(n.Open=h.Open,n.High=h.High,n.Low=h.Low,n.YClose=h.YClose,n.Close=h.Close,n.Vol=h.Vol,n.Amount=h.Amount,n.FlowCapital=h.FlowCapital,n.Position=h.Position,n.YFClose=h.YFClose,n.FClose=h.FClose):(n.High<h.High&&(n.High=h.High),n.Low>h.Low&&(n.Low=h.Low),n.Close=h.Close,n.Vol+=h.Vol,null!=h.Amount&&(n.Amount+=h.Amount),n.Position=h.Position,n.FlowCapital=h.FlowCapital,n.Date=h.Date,n.FClose=h.FClose)}}return a},this.GetDayCustomPeriodData=function(t){for(var e=[],a=t,i=!1,r=null,n=0;n<this.Data.length;){i=!0;for(var s=0;s<a&&n<this.Data.length;++n,++s){i&&(r=new HistoryData,e.push(r),i=!1);var o=this.Data[n];null!=o&&(r.Date=o.Date,null!=o.Open&&null!=o.Close&&(null==r.Open||null==r.Close?(r.Open=o.Open,r.High=o.High,r.Low=o.Low,r.YClose=o.YClose,r.Close=o.Close,r.Vol=o.Vol,r.Amount=o.Amount,r.FlowCapital=o.FlowCapital,r.Position=o.Position,r.YFClose=o.YFClose,r.FClose=o.FClose):(r.High<o.High&&(r.High=o.High),r.Low>o.Low&&(r.Low=o.Low),r.Close=o.Close,r.Vol+=o.Vol,null!=o.Amount&&(r.Amount+=o.Amount),r.Position=o.Position,r.FlowCapital=o.FlowCapital,r.FClose=o.FClose)))}}return e},this.GetPeriodData=function(t){var e=g_DataPlus.GetPeriodCallback(t);if(e)return e.Callback(t,this.Data,this);if(MARKET_SUFFIX_NAME.IsBIT(this.Symbol)&&(5==t||6==t||7==t||8==t||t>CUSTOM_MINUTE_PERIOD_START&&t<=CUSTOM_MINUTE_PERIOD_END)){var a=5;return 5==t?a=5:6==t?a=15:7==t?a=30:8==t?a=60:11==t?a=120:12==t?a=240:t>CUSTOM_MINUTE_PERIOD_START&&t<=CUSTOM_MINUTE_PERIOD_END&&(a=t-CUSTOM_MINUTE_PERIOD_START),this.GetMinuteCustomPeriodData(a)}return debug&&console.log("GetPeriodData",t),1==t||2==t||3==t||9==t||21==t||t>CUSTOM_DAY_PERIOD_START&&t<=CUSTOM_DAY_PERIOD_END?this.GetDayPeriodData(t):5==t||6==t||7==t||8==t||11==t||12==t||t>CUSTOM_MINUTE_PERIOD_START&&t<=CUSTOM_MINUTE_PERIOD_END?this.GetMinutePeriodData(t):0==t?this.GetMinutePeriodData(t):void 0},this.GetRightDate=function(t){var e=[];if(this.Data.length<=0)return e;if(1==t){var a=this.Data.length-1,i=1,r=this.Data[a].YClose;for(e[a]=HistoryData.Copy(this.Data[a]),--a;a>=0&&r==this.Data[a].Close;--a)e[a]=HistoryData.Copy(this.Data[a]),r=this.Data[a].YClose;for(;a>=0;--a){var n=this.Data[a].Close;r!=n&&0!=n&&(i*=r/n),e[a]=HistoryData.CopyRight(this.Data[a],i),r=this.Data[a].YClose}}else if(2==t){a=0,i=1;var s=this.Data[a].Close;for(e[a]=HistoryData.Copy(this.Data[a]),++a;a<this.Data.length&&s==this.Data[a].YClose;++a)e[a]=HistoryData.Copy(this.Data[a]),s=this.Data[a].Close;for(;a<this.Data.length;++a)s!=this.Data[a].YClose&&(i*=s/this.Data[a].YClose),e[a]=HistoryData.CopyRight(this.Data[a],i),s=this.Data[a].Close}return e},this.GetRightData=this.GetRightDate,this.GetOverlayData=function(t,e){for(var a=[],i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date;if(r>=t.length)a[i]=new HistoryData,a[i].Date=n,++i;else{var s=t[r].Date;s==n?(a[i]=new HistoryData,a[i].Date=t[r].Date,a[i].YClose=t[r].YClose,a[i].Open=t[r].Open,a[i].High=t[r].High,a[i].Low=t[r].Low,a[i].Close=t[r].Close,a[i].Vol=t[r].Vol,a[i].Amount=t[r].Amount,a[i].Stop=t[r].Stop,a[i].Up=t[r].Up,a[i].Down=t[r].Down,a[i].Unchanged=t[r].Unchanged,++r,++i):s<n?++r:(a[i]=new HistoryData,a[i].Date=n,++i)}}return a},this.GetOverlayMinuteData=function(t,e){for(var a=[],i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date,s=this.Data[i].Time;if(r>=t.length)a[i]=new HistoryData,a[i].Date=n,a[i].Time=s,++i;else{var o=t[r].Date,h=t[r].Time;o==n&&h==s?(a[i]=new HistoryData,a[i].Date=t[r].Date,a[i].Time=t[r].Time,a[i].YClose=t[r].YClose,a[i].Open=t[r].Open,a[i].High=t[r].High,a[i].Low=t[r].Low,a[i].Close=t[r].Close,a[i].Vol=t[r].Vol,a[i].Amount=t[r].Amount,a[i].Stop=t[r].Stop,a[i].Up=t[r].Up,a[i].Down=t[r].Down,a[i].Unchanged=t[r].Unchanged,++r,++i):o<n||o==n&&h<s?++r:(a[i]=new HistoryData,a[i].Date=n,a[i].Time=s,++i)}}return a},this.GetFittingData=function(t){for(var e=new Array,a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date;if(i>=t.length)e[a]=null,++a;else{var n=t[i].Date;if(n==r){var s=new SingleData;s.Date=t[i].Date,s.Value=t[i].Value,e[a]=s,++i,++a}else n<r?++i:(e[a]=new SingleData,e[a].Date=r,++a)}}return e},this.GetFittingData2=function(t,e){for(var a=new Array,i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date;if(r>=t.length)a[i]=new SingleData,a[i].Date=n,a[i].Value=e,++i;else{var s=t[r].Date;if(s==n){var o=new SingleData;o.Date=t[r].Date,o.Value=t[r].Value,a[i]=o,++r,++i}else s<n?++r:(a[i]=new SingleData,a[i].Date=n,a[i].Value=e,++i)}}return a},this.GetDateIndex=function(t){for(var e=0,a=0;e<this.Data.length;){var i=this.Data[e].Date;if(a>=t.length)break;var r=t[a];r.Date==i?(r.Index=e,++a):r.Date<i?++a:++e}},this.GetDateTimeIndex=function(t){for(var e=0,a=0;e<this.Data.length;){var i=this.Data[e].Date,r=this.Data[e].Time;if(a>=t.length)break;var n=t[a];n.Date==i&&n.Time==r?(n.Index=e,++a):n.Date<i||n.Date==i&&n.Time<r?++a:++e}},this.GetMinuteFittingData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date,n=this.Data[a].Time;if(i>=t.length){e[a]=null,++a;continue}var s=t[i].Date,o=t[i].Time;const l=t[i];if(s==r&&o==n)(h=new SingleData).Date=l.Date,h.Time=l.Time,h.Value=l.Value,e[a]=h,++i,++a;else if(s<r||s==r&&o<n)++i;else{var h;(h=new SingleData).Date=r,h.Time=n,e[a]=h,++a}}return e},this.GetFittingFinanceData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date;if(i<t.length)if(r<t[i].Date){++a;continue}if(i+1<t.length&&t[i].Date<r&&t[i+1].Date<=r)++i;else{var n=new SingleData;n.Date=r,i<t.length?(n.Value=t[i].Value,n.FinanceDate=t[i].Date):(n.Value=null,n.FinanceDate=null),e[a]=n,++a}}return e},this.GetMinuteFittingFinanceData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date,n=this.Data[a].Time;if(i+1<t.length&&t[i].Date<r&&t[i+1].Date<=r)++i;else{var s=new SingleData;s.Date=r,s.Time=n,i<t.length?(s.Value=t[i].Value,s.FinanceDate=t[i].Date):(s.Value=null,s.FinanceDate=null),e[a]=s,++a}}return e},this.GetFittingTradeData=function(t,e,a){for(var i=[],r=!1,n=0,s=0;n<this.Data.length;){var o=this.Data[n].Date;if(s<t.length&&t[s].Date>o)(h=new SingleData).Date=o,h.Value=e,i[n]=h,++n;else if(s+1<t.length&&t[s].Date<o&&t[s+1].Date<=o)++s,r=!1;else{var h;if((h=new SingleData).Date=o,h.Value=e,h.FinanceDate=null,s<t.length){var l=t[s];0==this.Period&&!0===a?l.Date==h.Date&&(h.Value=l.Value,h.FinanceDate=l.Date,r=!0):0==r&&(h.Value=l.Value,h.FinanceDate=l.Date,r=!0)}i[n]=h,++n}}return i},this.GetMinuteFittingTradeData=function(t,e){for(var a=[],i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date,s=this.Data[i].Time;if(r+1<t.length&&t[r].Date<n&&t[r+1].Date<=n)++r;else{var o=new SingleData;if(o.Date=n,o.FinanceDate=null,o.Time=s,o.Value=e,r<t.length){var h=t[r];h.Date==o.Date&&(o.Value=h.Value,o.FinanceDate=h.Date)}a[i]=o,++i}}return a},this.GetFittingMarketValueData=function(t){for(var e=[],a=0,i=0;a<this.Data.length;){var r=this.Data[a].Date,n=this.Data[a].Close;if(i+1<t.length&&t[i].Date<r&&t[i+1].Date<=r)++i;else{var s=new SingleData;s.Date=r,s.Value=t[i].Value*n,s.FinanceDate=t[i].Date,e[a]=s,++a}}return e},this.GetFittingMonthData=function(t){for(var e=new Array,a=null,i=0,r=0;i<this.Data.length;){var n=this.Data[i].Date;if(r>=t.length)e[i]=null,++i;else{var s=t[r].Date;if(s==n)(o=new SingleData).Date=t[r].Date,o.Value=t[r].Value,o.Text=t[r].Text,e[i]=o,++r,++i;else if(null!=a&&a<s&&n>s){var o;(o=new SingleData).Date=n,o.OverlayDate=t[r].Date,o.Value=t[r].Value,o.Text=t[r].Text,e[i]=o,++r,++i}else s<n?++r:(e[i]=new SingleData,e[i].Date=n,++i);a=n}}return e},this.GetValue=function(){var t=[];for(var e in this.Data)if(this.Data[e]&&null!=this.Data[e].Value){var a=this.Data[e].Value;isNaN(a)?a instanceof Array?t[e]=a:t[e]=null:t[e]=a}else t[e]=null;return t},this.GetObject=function(){var t=[];for(var e in this.Data)if(this.Data[e]&&this.Data[e].Value){var a=this.Data[e].Value;t[e]=a}else t[e]=null;return t},this.GetPeriodSingleData=function(t){var e=new Array,a=0,i=2,r=null;for(var n in this.Data){var s=!1,o=this.Data[n];if(null!=o&&null!=o.Date){switch(t){case 1:(h=ChartData.GetFirday(o.Date))!=a&&(s=!0,a=h);break;case 21:var h;(h=ChartData.GetFirday(o.Date))!=a&&(++i>=2&&(s=!0,i=0),a=h);break;case 2:parseInt(o.Date/100)!=parseInt(a/100)&&(s=!0,a=o.Date);break;case 3:parseInt(o.Date/1e4)!=parseInt(a/1e4)&&(s=!0,a=o.Date);break;case 9:var l=ChartData.GetQuarter(o.Date);l=10*parseInt(o.Date/1e4)+l;var C=ChartData.GetQuarter(a);l!=(C=10*parseInt(a/1e4)+C)&&(s=!0,a=o.Date)}if(s)(r=new SingleData).Date=o.Date,r.Value=o.Value,e.push(r);else{if(null==r)continue;if(null==o.Value||isNaN(o.Value))continue;(null==r.Value||isNaN(r.Value))&&(r.Value=o.Value)}}}return e},this.GetMinuteAvPrice=function(){var t=new Array;for(var e in this.Data)t[e]=this.Data[e].AvPrice;return t},this.MergeMinuteData=function(t){for(var e=this.Data[0],a=0,i=null,r=0;r<t.length;++r){if((C=t[r]).Date>e.Date){a=r,i=C;break}if(C.Date==e.Date&&C.Time>=e.Time){a=r,i=C;break}}if(null==i)return!1;var n=null,s=!1;for(r=this.Data.length-1;r>=0;--r){var o=this.Data[r].Date,h=this.Data[r].Time;if(i.Date>o||i.Date==o&&i.Time>=h){n=r,i.Date==o&&i.Time==h&&(s=!0);break}}if(null==n)return!1;var l=n;r=a;if(1==s){var C=t[r];l-1>0&&!C.YClose&&(C.YClose=this.Data[l-1].Close);var u=HistoryData.Copy(C);this.Data[l]=u,++l,++r}else++l;for(;r<t.length;){C=t[r];if(l>=this.Data.length-1){l-1>0&&!C.YClose&&(C.YClose=this.Data[l-1].YClose);u=HistoryData.Copy(C);this.Data[l]=u,++l,++r}else{var D=this.Data[l];D.Date==C.Date&&D.Time==C.Time?(HistoryData.CopyTo(D,C),++l,++r):++l}}return!0},this.ConverPeriod=function(t,e,a){for(var i=[],r=null,n=ChartData.IsMinutePeriod(e,!0),s=ChartData.IsMinutePeriod(a,!0),o=n&&s,h=n&&!s,l=!n&&!s,C=0,u=0;C<this.Data.length;++C){for(var D=this.Data[C];u<t.length;++u){var d=t[u];if(o){if(d.Date>D.Date||d.Date==D.Date&&d.Time>=D.Time){r=d;break}}else if((h||l)&&d.Date>=D.Date){r=d;break}}var c=null;r?((c=HistoryData.Copy(r)).PDate=r.Date,c.PTime=r.Time):c=new HistoryData,c.Date=D.Date,(o||h)&&(c.Time=D.Time),i.push(c)}return JSConsole.Chart.Log("[ChartData::ConverPeriod] result",i),i},this.GetRef=function(t){let e=[];for(var a=0;a<this.Data.length;++a){e[a]=null;var i=this.Data[a];if(a-t<0){(r=new HistoryData).Date=i.Date,r.Time=i.Time,e[a]=r}else{var r,n=this.Data[a-t];(r=HistoryData.Copy(n)).Date=i.Date,r.Time=i.Time,e[a]=r}}return e},this.FitKLineIndex=function(t,e,a,i){for(var r=this.Data.length,n=t.length,s=[ChartData.IsMinutePeriod(a,!0),ChartData.IsMinutePeriod(i,!0)],o=[ChartData.IsDayPeriod(a,!0),ChartData.IsDayPeriod(i,!0)],h=ChartData.GetKLineDataTime(this.Data[0]),l=[],C=n,u=0;u<n;++u){var D=ChartData.GetKLineDataTime(t[u]);if(o[0]&&o[1]||s[0]&&o[1]){if(D.Date>=h.Date){C=u;break}}else if(s[0]&&s[1]){if(D.Date>h.Date){C=u;break}if(D.Date==h.Date&&D.Time>=h.Time){C=u;break}}}u=0;for(var d=C;u<r;){D=ChartData.GetKLineDataTime(this.Data[u]);if(d>=n){var c={Date:D.Date,Time:D.Time,Index:-1};l[u]=c,++u}else{var m=ChartData.GetKLineDataTime(t[d]);if(o[0]&&o[1]||s[0]&&o[1])if(m.Date==D.Date){c={Date:D.Date,Time:D.Time,Index:d,Data2:m.Date,Time2:m.Time};l[u]=c,++u}else if(d+1<n){var f=ChartData.GetKLineDataTime(t[d+1]);if(m.Date<=D.Date&&f.Date>D.Date){c={Date:D.Date,Time:D.Time,Index:d,Data2:m.Date,Time2:m.Time};l[u]=c,++u}else if(f.Date<=D.Date)++d;else{c={Date:D.Date,Time:D.Time,Index:-1};l[u]=c,++u}}else++d;else if(s[0]&&s[1])if(m.Date==D.Date&&m.Time==D.Time){c={Date:D.Date,Time:D.Time,Index:d,Data2:m.Date,Time2:m.Time};l[u]=c,++u}else if(d+1<n){f=ChartData.GetKLineDataTime(t[d+1]);if(m.Date<D.Date&&f.Date>D.Date||m.Date==D.Date&&m.Time<D.Time&&f.Date==D.Date&&f.Time>D.Time||m.Date==D.Date&&m.Time<D.Time&&f.Date>D.Date||m.Date<D.Date&&f.Date==D.Date&&f.Time>D.Time){c={Date:D.Date,Time:D.Time,Index:d,Data2:m.Date,Time2:m.Time};l[u]=c,++u}else if(f.Date<D.Date||f.Date==D.Date&&f.Time<=D.Time)++d;else{c={Date:D.Date,Time:D.Time,Index:-1};l[u]=c,++u}}else++d}}var v=[];for(var u in e){D=e[u];if(Array.isArray(D.Data)){var S=[];v[u]={Data:S,Name:D.Name};for(d=0;d<l.length;++d){var T=l[d];S[d]=null,T&&T.Index>=0&&T.Index<D.Data.length&&(S[d]=D.Data[T.Index])}}else v[u]={Data:D.Data,Name:D.Name}}return v},this.FindDataIndexByDateTime=function(t){var e=0;for(var a in t)t[a].Index=-1;for(var a in this.Data){var i=this.Data[a];for(var r in t){var n=t[r];if(!(n.Index>=0)){if(IFrameSplitOperator.IsNumber(n.Time)){if(n.Date==i.Date&&n.Time==i.Time){n.Index=parseInt(a),++e;break}}else if(n.Date==i.Date){n.Index=parseInt(a),++e;break}if(e>=t.length)break}}}},this.CloneData=function(t){var e=[];if("HistoryData"==t)for(var a in this.Data){var i=this.Data[a],r=HistoryData.Copy(i);e.push(r)}return e},this.GetAPIDataIndex=function(t,e){var a=[];if(t&&e){for(var i=this.Data.length,r=t.length,n=ChartData.GetKLineDataTime(this.Data[0]),s=r,o=(s=r,0);o<r;++o){var h=t[o],l=e[o];if(h>n.Date||h==n.Date&&l>=n.Time){s=o;break}}o=0;for(var C=s;o<i;){var u=this.Data[o];if(C>=r){var D={KDate:u.Date,KTime:u.Time,KIndex:o,Index:-1};a[o]=D,++o}else{h=t[C],l=e[C];if(h==u.Date&&l==u.Time){D={KDate:u.Date,KTime:u.Time,KIndex:o,Index:C,Data:h,Time:l};a[o]=D,++o}else if(C+1<r){var d=t[C+1],c=e[C+1];if(h<u.Date&&d>u.Date||h==u.Date&&l<u.Time&&d==u.Date&&c>u.Time||h==u.Date&&l<u.Time&&d>u.Date||h<u.Date&&d==u.Date&&c>u.Time){D={KDate:u.Date,KTime:u.Time,KIndex:o,Index:C,Data:h,Time:l};a[o]=D,++o}else if(d<u.Date||d==u.Date&&c<=u.Time)++C;else{D={KDate:u.Date,KTime:u.Time,KIndex:o,Index:-1};a[o]=D,++o}}else++C}}}else if(t){for(i=this.Data.length,r=t.length,n=ChartData.GetKLineDataTime(this.Data[0]),s=r,o=0;o<r;++o){if((u=t[o])>=n.Date){s=o;break}}for(o=0,C=s;o<i;){u=this.Data[o];if(C>=r){D={KDate:u.Date,KIndex:o,Index:-1};a[o]=D,++o}else{var m=t[C];if(m==u.Date){D={KDate:u.Date,KIndex:o,Index:C,Data:m};a[o]=D,++o}else if(C+1<r){var f=t[C+1];if(m<=u.Date&&f>u.Date){D={KDate:u.Date,KIndex:o,Index:C,Data:m};a[o]=D,++o}else if(f<=u.Date)++C;else{D={KDate:u.Date,KIndex:o,Index:-1};a[o]=D,++o}}else++C}}}return a},this.FixKData=function(t,e){return ChartData.IsDayPeriod(e,!0)?this.FixKData_Day(t):ChartData.IsMinutePeriod(e,!0)?this.FixKData_Minute(t):null},this.FixKData_Day=function(t){for(var e=[],a=t.length,i=0,r=0;i<this.Data.length;){var n=this.Data[i];if(r<a)if((s=t[r]).Date>n.Date){++i;continue}if(r+1<a){var s=t[r],o=t[r+1];if(s.Date<n.Date&&o.Date<=n.Date){++r;continue}}var h=new HistoryData;h.Date=n.Date;s=t[r<a?r:a-1];h.Close=s.Close,h.High=s.High,h.Low=s.Low,h.Open=s.Open,h.YClose=s.YClose,h.Amount=s.Amount,h.Vol=s.Vol,h.ExDate=s.Date,e[i]=h,++i}return e},this.FixKData_Minute=function(t){for(var e=[],a=t.length,i=0,r=0;i<this.Data.length;){var n=this.Data[i],s=ChartData.DateTimeToNumber(n);if(r<a){var o=t[r];if((l=ChartData.DateTimeToNumber(o))>s){++i;continue}}if(r+1<a){o=t[r];var h=t[r+1],l=ChartData.DateTimeToNumber(o),C=ChartData.DateTimeToNumber(h);if(l<s&&C<=s){++r;continue}}var u=new HistoryData;u.Date=n.Date,u.Time=n.Time;o=t[r<a?r:a-1];u.Close=o.Close,u.High=o.High,u.Low=o.Low,u.Open=o.Open,u.YClose=o.YClose,u.Amount=o.Amount,u.Vol=o.Vol,u.ExDate=o.Date,u.ExTime=o.Time,e[i]=u,++i}return e}}ChartData.DateTimeToNumber=function(t){return 1e4*t.Date+t.Time},ChartData.GetKLineDataTime=function(t){var e={Date:t.Date,Time:0};return IFrameSplitOperator.IsNumber(t.Time)&&(e.Time=t.Time),e},ChartData.GetFirday=function(t){var e=new Date(parseInt(t/1e4),t/100%100-1,t%100),a=e.getDay();if(5==a)return t;var i=e.getTime();a<5?i+=864e5*(5-a):i-=864e5*(a-5);e.setTime(i);var r=1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate();e.getDay();return r},ChartData.GetSunday=function(t){var e=new Date(parseInt(t/1e4),t/100%100-1,t%100),a=e.getDay();if(0==a)return t;var i=e.getTime();a>0&&(i+=864e5*(7-a));e.setTime(i);var r=1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate();e.getDay();return r},ChartData.GetQuarter=function(t){var e=parseInt(t%1e4/100);return 1==e||2==e||3==e?1:4==e||5==e||6==e?2:7==e||8==e||9==e?3:10==e||11==e||12==e?4:0};var CUSTOM_DAY_PERIOD_START=4e4,CUSTOM_DAY_PERIOD_END=49999;ChartData.IsDayPeriod=function(t,e){return 1==t||2==t||3==t||9==t||21==t||(t>CUSTOM_DAY_PERIOD_START&&t<=CUSTOM_DAY_PERIOD_END||0==t&&1==e)};var CUSTOM_MINUTE_PERIOD_START=2e4,CUSTOM_MINUTE_PERIOD_END=29999;ChartData.IsMinutePeriod=function(t,e){return 5==t||6==t||7==t||8==t||11==t||12==t||(t>CUSTOM_MINUTE_PERIOD_START&&t<=CUSTOM_MINUTE_PERIOD_END||(4==t&&1==e||0==t))};var CUSTOM_SECOND_PERIOD_START=3e4,CUSTOM_SECOND_PERIOD_END=32e3;function TooltipData(){this.ChartPaint,this.Data,this.Type=0}function Rect(t,e,a,i){this.X=t,this.Y=e,this.Width=a,this.Height=i}function IChartPainting(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="IChartPainting",this.Data=new ChartData,this.NotSupportMessage=null,this.MessageFont=g_JSChartResource.Index.NotSupport.Font,this.MessageColor=g_JSChartResource.Index.NotSupport.TextColor,this.IsDrawFirst=!1,this.IsShow=!0,this.Draw=function(){},this.DrawNotSupportmessage=function(){this.Canvas.font=this.MessageFont,this.Canvas.fillStyle=this.MessageColor;var t=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()/2,e=this.ChartBorder.GetTopEx()+this.ChartBorder.GetHeightEx()/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.NotSupportMessage,t,e)},this.GetTooltipData=function(t,e,a){return!1},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null};if(!this.Data||!this.Data.Data)return e;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];null==r||isNaN(r)||(null==e.Max&&(e.Max=r),null==e.Min&&(e.Min=r),e.Max<r&&(e.Max=r),e.Min>r&&(e.Min=r))}return e},this.GetDynamicFont=function(t,e,a,i,r,n){var s=GetDevicePixelRatio();if((a*=s)==(i*=s))return`${a.toFixed(0)}px ${n}`;var o=t+e;return r&&(0==r.Type?r.Value>0&&(o=t*r.Value):1==r.Type?r.Value>0&&(o=(t+e)*r.Value):2==r.Type&&IFrameSplitOperator.IsNumber(r.Value)&&(o=t+e+2*r.Value*s)),o<i?o=i:o>a&&(o=a),`${o.toFixed(0)}px ${n}`},this.GetLockRect=function(){return this.ChartFrame.GetLockRect()},this.SetFillStyle=function(t,e,a,i,r){if(Array.isArray(t)){let o=this.Canvas.createLinearGradient(e,a,i,r);var n=1/t.length;for(var s in t)o.addColorStop(s*n,t[s]);this.Canvas.fillStyle=o}else this.Canvas.fillStyle=t},this.GetDynamicIconSize=function(t,e,a,i,r){var n=GetDevicePixelRatio();if((a*=n)==(i*=n))return a;var s=t+e-2*n;return r&&(0==r.Type?r.Value>0&&(s=t*r.Value):1==r.Type?r.Value>0&&(s=(t+e)*r.Value):2==r.Type&&IFrameSplitOperator.IsNumber(r.Value)&&(s=t+e+2*r.Value*n)),s<i?s=i:s>a&&(s=a),s}}ChartData.IsSecondPeriod=function(t){return t>CUSTOM_SECOND_PERIOD_START&&t<=CUSTOM_SECOND_PERIOD_END},ChartData.IsTickPeriod=function(t){return 10==t},ChartData.GetPeriodName=function(t){var e=new Map([[0,"日线"],[1,"周线"],[2,"月线"],[3,"年线"],[9,"季线"],[21,"双周"],[4,"1分"],[5,"5分"],[6,"15分"],[7,"30分"],[8,"60分"],[11,"2小时"],[12,"4小时"],[10,"分笔"]]);return e.has(t)?e.get(t):""};var ZOOM_SEED=[[48,10],[44,10],[40,9],[36,9],[32,8],[28,8],[24,7],[20,7],[18,6],[16,6],[14,5],[12,5],[8,4],[6,4],[4,4],[3,3],[3,1],[2,1],[1,1],[1,0]];function ChartKLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartKLine",this.Symbol,this.DrawType=0,this.CloseLineColor=g_JSChartResource.CloseLineColor,this.CloseLineAreaColor=g_JSChartResource.CloseLineAreaColor,this.UpColor=g_JSChartResource.UpBarColor,this.DownColor=g_JSChartResource.DownBarColor,this.UnchagneColor=g_JSChartResource.UnchagneBarColor,this.ColorData,this.TradeData,this.TradeIcon=g_JSChartResource.KLine.TradeIcon,this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.IsShowMaxMinPrice=!0,this.IsShowKTooltip=!0,this.TextFont=g_JSChartResource.KLine.MaxMin.Font,this.TextColor=g_JSChartResource.KLine.MaxMin.Color,this.InfoData,this.InfoPosition=0,this.PtMax,this.PtMin,this.TickSymbol="╳",this.TickFontName="arial",this.Period,this.ShowRange={},this.ReloadResource=function(t){this.TextFont=g_JSChartResource.KLine.MaxMin.Font,this.TextColor=g_JSChartResource.KLine.MaxMin.Color,this.CloseLineColor=g_JSChartResource.CloseLineColor,this.CloseLineAreaColor=g_JSChartResource.CloseLineAreaColor,this.UpColor=g_JSChartResource.UpBarColor,this.DownColor=g_JSChartResource.DownBarColor,this.UnchagneColor=g_JSChartResource.UnchagneBarColor},this.DrawAKLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());for(var n=this.ChartFrame.XPointCount,s=(this.UpColor,this.DownColor,this.UnchagneColor,{X:null,Y:null,Value:null,Align:"left"}),o={X:null,Y:null,Value:null,Align:"left"},h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<n;++h,++l,i+=e+a){var C=this.Data.Data[h];if(null!=C.Open&&null!=C.High&&null!=C.Low&&null!=C.Close){var u=i,D=i+e;if(D>r)break;var d=u+(D-u)/2,c=this.ChartFrame.GetYFromData(C.Low),m=this.ChartFrame.GetYFromData(C.High),f=this.ChartFrame.GetYFromData(C.Open),v=this.ChartFrame.GetYFromData(C.Close);if((null==s.Value||s.Value<C.High)&&(s.X=d,s.Y=m,s.Value=C.High,s.Align=l<n/2?"left":"right"),(null==o.Value||o.Value>C.Low)&&(o.X=d,o.Y=c,o.Value=C.Low,o.Align=l<n/2?"left":"right"),C.Open<C.Close?this.Canvas.strokeStyle=this.UpColor:C.Open>C.Close?this.Canvas.strokeStyle=this.DownColor:this.Canvas.strokeStyle=this.UnchagneColor,this.ColorData&&(h<this.ColorData.length&&this.ColorData[h]>0?this.UpColor:this.DownColor),this.Canvas.beginPath(),t?(this.Canvas.moveTo(m,ToFixedPoint(d)),this.Canvas.lineTo(c,ToFixedPoint(d))):(this.Canvas.moveTo(ToFixedPoint(d),m),this.Canvas.lineTo(ToFixedPoint(d),c)),this.Canvas.stroke(),e>=4&&(this.Canvas.beginPath(),t?(this.Canvas.moveTo(ToFixedPoint(f),u),this.Canvas.lineTo(ToFixedPoint(f),d)):(this.Canvas.moveTo(u,ToFixedPoint(f)),this.Canvas.lineTo(d,ToFixedPoint(f))),this.Canvas.stroke(),this.Canvas.beginPath(),t?(this.Canvas.moveTo(ToFixedPoint(v),D),this.Canvas.lineTo(ToFixedPoint(v),d)):(this.Canvas.moveTo(D,ToFixedPoint(v)),this.Canvas.lineTo(d,ToFixedPoint(v))),this.Canvas.stroke()),0==this.Data.DataType){var S={Xleft:u,XRight:D,YMax:m,XCenter:d,YMin:c,DayData:C,Index:l};this.DrawInfo(S)}}}this.PtMax=s,this.PtMin=o},this.DrawCloseArea=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount,s=!0,o=null;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor;for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<n;++h,++l,i+=e+a){var C=this.Data.Data[h];if(null!=C.Open&&null!=C.High&&null!=C.Low&&null!=C.Close){var u=i,D=i+e;if(D>r)break;var d=u+(D-u)/2,c=this.ChartFrame.GetYFromData(C.Close);s?(t?(this.Canvas.moveTo(c,d),o={X:c,Y:d}):(this.Canvas.moveTo(d,c),o={X:d,Y:c}),s=!1):t?this.Canvas.lineTo(c,d):this.Canvas.lineTo(d,c)}}if(!s){if(this.Canvas.stroke(),t?(this.Canvas.lineTo(this.ChartBorder.GetLeft(),d),this.Canvas.lineTo(this.ChartBorder.GetLeft(),o.Y)):(this.Canvas.lineTo(d,this.ChartBorder.GetBottom()),this.Canvas.lineTo(o.X,this.ChartBorder.GetBottom())),this.Canvas.closePath(),Array.isArray(this.CloseLineAreaColor))if(t){let t=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());t.addColorStop(0,this.CloseLineAreaColor[0]),t.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=t}else{let t=this.Canvas.createLinearGradient(o.X,this.ChartBorder.GetTopEx(),o.X,this.ChartBorder.GetBottom());t.addColorStop(0,this.CloseLineAreaColor[0]),t.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=t}else this.Canvas.fillStyle=this.CloseLineAreaColor;this.Canvas.fill()}},this.DrawCloseLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount,s=!0;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<n;++o,++h,i+=e+a){var l=this.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){var C=i,u=i+e;if(u>r)break;var D=C+(u-C)/2,d=this.ChartFrame.GetYFromData(l.Close);s?(t?this.Canvas.moveTo(d,D):this.Canvas.moveTo(D,d),s=!1):t?this.Canvas.lineTo(d,D):this.Canvas.lineTo(D,d)}}0==s&&this.Canvas.stroke()},this.DrawKBar=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2,r=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;t&&(i=this.ChartBorder.GetTop()+a/2+2,r=this.ChartBorder.GetBottom());var s={X:null,Y:null,Value:null,Align:"left"},o={X:null,Y:null,Value:null,Align:"left"},h=this.UpColor,l=this.DownColor,C=this.UnchagneColor;debug&&console.log("=============",this.Data.DataOffset,this.ChartFrame.ZoomIndex,this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth),window.chartdata[this.Data.Period]||(window.chartdata[this.Data.Period]={}),window.chartdata[this.Data.Period].DataOffset=this.Data.DataOffset,this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=n;for(var u=this.Data.DataOffset,D=0;u<this.Data.Data.length&&D<n;++u,++D,i+=e+a,++this.ShowRange.DataCount){var d=this.Data.Data[u];if(this.ShowRange.End=u,null!=d.Open&&null!=d.High&&null!=d.Low&&null!=d.Close){var c=i,m=i+e;if(m>r)break;var f=c+(m-c)/2,v=this.ChartFrame.GetYFromData(d.Low),S=this.ChartFrame.GetYFromData(d.High),T=this.ChartFrame.GetYFromData(d.Open),I=this.ChartFrame.GetYFromData(d.Close),F=S;if((null==s.Value||s.Value<d.High)&&(s.X=f,s.Y=S,s.Value=d.High,s.Align=D<n/2?"left":"right"),(null==o.Value||o.Value>d.Low)&&(o.X=f,o.Y=v,o.Value=d.Low,o.Align=D<n/2?"left":"right"),this.ColorData&&(h=l=C=u<this.ColorData.length&&this.ColorData[u]>0?this.UpColor:this.DownColor),d.Open<d.Close?e>=4?(this.Canvas.strokeStyle=h,d.High>d.Close?(this.Canvas.beginPath(),t?(this.Canvas.moveTo(ToFixedPoint(F),ToFixedPoint(f)),this.Canvas.lineTo(ToFixedPoint(3==this.DrawType?Math.max(I,T):I),ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),ToFixedPoint(F)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(3==this.DrawType?Math.min(I,T):I))),this.Canvas.stroke(),F=I):F=I,this.Canvas.fillStyle=h,t?Math.abs(T-F)<1?this.Canvas.fillRect(ToFixedRect(F),ToFixedRect(c),1,ToFixedRect(e)):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(F),ToFixedPoint(c),ToFixedRect(T-F),ToFixedRect(e)),this.Canvas.stroke()):this.Canvas.fillRect(ToFixedRect(F),ToFixedRect(c),ToFixedRect(T-F),ToFixedRect(e)):Math.abs(T-F)<1?this.Canvas.fillRect(ToFixedRect(c),ToFixedRect(F),ToFixedRect(e),1):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(c),ToFixedPoint(F),ToFixedRect(e),ToFixedRect(T-F)),this.Canvas.stroke()):this.Canvas.fillRect(ToFixedRect(c),ToFixedRect(Math.min(F,T)),ToFixedRect(e),ToFixedRect(Math.abs(T-F))),d.Open>d.Low&&(this.Canvas.beginPath(),t?(this.Canvas.moveTo(ToFixedPoint(3==this.DrawType?Math.min(I,T):F),ToFixedPoint(f)),this.Canvas.lineTo(ToFixedPoint(v),ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),ToFixedPoint(3==this.DrawType?Math.max(I,T):F)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(v))),this.Canvas.stroke())):(this.Canvas.beginPath(),t?(this.Canvas.moveTo(S,ToFixedPoint(f)),this.Canvas.lineTo(v,ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),S),this.Canvas.lineTo(ToFixedPoint(f),v)),this.Canvas.strokeStyle=h,this.Canvas.stroke()):d.Open>d.Close?e>=4?(this.Canvas.strokeStyle=l,d.High>d.Close?(this.Canvas.beginPath(),t?(this.Canvas.moveTo(ToFixedPoint(F),ToFixedPoint(f)),this.Canvas.lineTo(ToFixedPoint(T),ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),ToFixedPoint(F)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(T))),this.Canvas.stroke(),F=T):F=T,this.Canvas.fillStyle=l,t?Math.abs(I-F)<1?this.Canvas.fillRect(ToFixedRect(F),ToFixedRect(c),1,ToFixedRect(e)):this.Canvas.fillRect(ToFixedRect(F),ToFixedRect(c),ToFixedRect(I-F),ToFixedRect(e)):Math.abs(I-F)<1?this.Canvas.fillRect(ToFixedRect(c),ToFixedRect(F),ToFixedRect(e),1):this.Canvas.fillRect(ToFixedRect(c),ToFixedRect(Math.min(F,I)),ToFixedRect(e),ToFixedRect(Math.abs(I-F))),d.Open>d.Low&&(this.Canvas.beginPath(),t?(this.Canvas.moveTo(ToFixedPoint(F),ToFixedPoint(f)),this.Canvas.lineTo(ToFixedPoint(v),ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),ToFixedPoint(F)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(v))),this.Canvas.stroke())):(this.Canvas.beginPath(),t?(this.Canvas.moveTo(S,ToFixedPoint(f)),this.Canvas.lineTo(v,ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),S),this.Canvas.lineTo(ToFixedPoint(f),v)),this.Canvas.strokeStyle=l,this.Canvas.stroke()):e>=4?(this.Canvas.strokeStyle=C,this.Canvas.beginPath(),d.High>d.Close?(t?(this.Canvas.moveTo(F,ToFixedPoint(f)),this.Canvas.lineTo(T,ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),F),this.Canvas.lineTo(ToFixedPoint(f),T)),F=T):F=T,t?(this.Canvas.moveTo(ToFixedPoint(F),ToFixedPoint(c)),this.Canvas.lineTo(ToFixedPoint(F),ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(c),ToFixedPoint(F)),this.Canvas.lineTo(ToFixedPoint(m),ToFixedPoint(F))),d.Open>d.Low&&(t?(this.Canvas.moveTo(ToFixedPoint(F),ToFixedPoint(f)),this.Canvas.lineTo(ToFixedPoint(v),ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),ToFixedPoint(F)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(v)))),this.Canvas.stroke()):(this.Canvas.beginPath(),t?(this.Canvas.moveTo(S,ToFixedPoint(f)),this.Canvas.lineTo(v,ToFixedPoint(f))):(this.Canvas.moveTo(ToFixedPoint(f),S),this.Canvas.lineTo(ToFixedPoint(f),v)),this.Canvas.strokeStyle=C,this.Canvas.stroke()),this.IsShowKTooltip&&!t){var g=Math.min(T,I),p=Math.max(T,I);Math.abs(T-I)<5&&(g=Math.min(S,g-5),p=Math.max(v,p+5));var x=new Rect(c,g,e,p-g);this.TooltipRect.push([u,x])}if(0==this.Data.DataType){var P={Xleft:c,XRight:m,XCenter:f,YMax:S,YMin:v,DayData:d,Index:D};this.DrawInfo(P)}}}this.PtMax=s,this.PtMin=o},this.DrawTrade=function(){if(this.TradeData){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2,r=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;t&&(i=this.ChartBorder.GetTop()+a/2+2,r=this.ChartBorder.GetBottom());var s=this.TradeData.Sell,o=this.TradeData.Buy,h=e;h>10&&(h=10);for(var l=this.Data.DataOffset,C=0;l<this.Data.Data.length&&C<n;++l,++C,i+=e+a){var u=this.Data.Data[l];if(null!=u.Open&&null!=u.High&&null!=u.Low&&null!=u.Close){var D=!1,d=!1;if(s&&l<s.length&&(d=s[l]>0),o&&l<o.length&&(D=o[l]>0),d||D){var c=i,m=i+e;if(m>r)break;var f=c+(m-c)/2,v=this.ChartFrame.GetYFromData(u.Low),S=this.ChartFrame.GetYFromData(u.High);this.ChartFrame.GetYFromData(u.Open),this.ChartFrame.GetYFromData(u.Close);D&&(this.Canvas.fillStyle=this.UpColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),t?(this.Canvas.moveTo(v-1,f),this.Canvas.lineTo(v-h-1,f-h/2),this.Canvas.lineTo(v-h-1,f+h/2)):(this.Canvas.moveTo(f,v+1),this.Canvas.lineTo(f-h/2,v+h+1),this.Canvas.lineTo(f+h/2,v+h+1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke()),d&&(this.Canvas.fillStyle=this.DownColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),t?(this.Canvas.moveTo(S+1,f),this.Canvas.lineTo(S+h+1,f-h/2),this.Canvas.lineTo(S+h+1,f+h/2)):(this.Canvas.moveTo(f,S-1),this.Canvas.lineTo(f-h/2,S-h-1),this.Canvas.lineTo(f+h/2,S-h-1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke())}}}}},this.DrawTick=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2;t&&(i=this.ChartBorder.GetTop()+a/2+2);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount,s=parseInt(e);s<=1?s=2:s>=18&&(s=18);this.Canvas.beginPath(),this.Canvas.font=s*GetDevicePixelRatio()+"px "+this.TickFontName;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<n;++o,++h,i+=e+a){var l=this.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){var C=i,u=i+e;if(u>r)break;var D=C+(u-C)/2,d=this.ChartFrame.GetYFromData(l.Close);0===l.Flag?this.Canvas.fillStyle=this.UpColor:1==l.Flag?this.Canvas.fillStyle=this.DownColor:this.Canvas.fillStyle=this.UnchagneColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",t?this.Canvas.fillText(this.TickSymbol,d,D):this.Canvas.fillText(this.TickSymbol,D,d)}}},this.Draw=function(){this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.PtMax={X:null,Y:null,Value:null,Align:"left"},this.PtMin={X:null,Y:null,Value:null,Align:"left"},this.ChartFrame.ChartKLine={Max:null,Min:null},this.IsShow&&(ChartData.IsTickPeriod(this.Period)?this.DrawTick():1!=this.DrawType?(2==this.DrawType?this.DrawAKLine():4==this.DrawType?this.DrawCloseArea():this.DrawKBar(),this.TradeIcon?this.DrawTradeIcon():this.DrawTrade(),this.IsShowMaxMinPrice&&(!0===this.ChartFrame.IsHScreen?this.HScreenDrawMaxMinPrice(this.PtMax,this.PtMin):this.DrawMaxMinPrice(this.PtMax,this.PtMin))):this.DrawCloseLine())},this.DrawMaxMinPrice=function(t,e){if(null!=t.X&&null!=t.Y&&null!=t.Value&&null!=e.X&&null!=e.Y&&null!=e.Value){var a=GetfloatPrecision(this.Symbol);this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor;var i=t;1==this.ChartFrame.CoordinateType?(t.Y<e.Y&&(i=e),this.Canvas.textBaseline="top"):(t.Y>e.Y&&(i=e),this.Canvas.textBaseline="bottom"),this.Canvas.textAlign=i.Align;var r=(i.Align,i.X),n=i.Value.toFixed(a);"left"==i.Align?n="←"+n:n+="→",this.Canvas.fillText(n,r,i.Y),this.ChartFrame.ChartKLine.Max={X:r,Y:i.Y,Text:{BaseLine:"bottom"}};var s=e;1==this.ChartFrame.CoordinateType?(e.Y>t.Y&&(s=t),this.Canvas.textBaseline="bottom"):(t.Y>e.Y&&(i=e),this.Canvas.textBaseline="top"),this.Canvas.textAlign=s.Align;r=(s.Align,s.X),n=e.Value.toFixed(a);"left"==s.Align?n="←"+n:n+="→",this.Canvas.fillText(n,r,s.Y),this.ChartFrame.ChartKLine.Min={X:r,Y:s.Y,Text:{BaseLine:"top"}}}},this.HScreenDrawMaxMinPrice=function(t,e){if(null!=t.X&&null!=t.Y&&null!=t.Value&&null!=e.X&&null!=e.Y&&null!=e.Value){var a=GetfloatPrecision(this.Symbol),i=t.Y,r=t.X;this.Canvas.save(),this.Canvas.translate(i,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=t.Align,this.Canvas.textBaseline="bottom";var n=t.Value.toFixed(a);"left"==t.Align?n="←"+n:n+="→",this.Canvas.fillText(n,0,0),this.Canvas.restore();i=e.Y,r=e.X;this.Canvas.save(),this.Canvas.translate(i,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=e.Align,this.Canvas.textBaseline="top";n=e.Value.toFixed(a);"left"==e.Align?n="←"+n:n+="→",this.Canvas.fillText(n,0,0),this.Canvas.restore()}},this.DrawInfo=function(t){if(this.InfoData&&!(this.InfoData.length<=0)){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetBottom(),n=this.InfoData.get(t.DayData.Date.toString());if(n&&!(n.Data.length<=0)){var s=GetDevicePixelRatio(),o=a+i,h=18*s,l=!0;o<=15&&(l=!1),o<h&&(o=h);var C,u="",D=new Map,d=t.YMax+1*s,c=0;for(var m in n.Data){var f=n.Data[m],v=D.get(f.InfoType);if(v)v.Data.push(f);else{var S=JSKLineInfoMap.GetIconFont(f.InfoType);if(this.Canvas.fillStyle=S.Color,this.Canvas.font=o+"px "+S.Family,e){this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillText(S.HScreenText,d,t.XCenter,o);var T=new Rect(t.XCenter-o/2,d-o,o,o),I={Data:new Array(f),Rect:T,Type:f.InfoType,TextRect:{X:d,Y:t.XCenter}};D.set(f.InfoType,I),d+=o}else if(this.Canvas.textBaseline="bottom",this.Canvas.textAlign="center",1===this.InfoPosition){var F=r+c;this.Canvas.fillText(S.Text,t.XCenter,F,o);T=new Rect(t.XCenter-o/2,F-o,o,o),I={Data:new Array(f),Rect:T,Type:f.InfoType,TextRect:{X:t.XCenter,Y:F}};D.set(f.InfoType,I),c-=o}else{this.Canvas.fillText(S.Text,t.XCenter,d,o);T=new Rect(t.XCenter-o/2,d-o,o,o),I={Data:new Array(f),Rect:T,Type:f.InfoType,TextRect:{X:t.XCenter,Y:d}};D.set(f.InfoType,I),d-=o}}}for(var t of(g_JSChartResource.KLine.NumIcon&&(C=e?g_JSChartResource.KLine.NumIcon.HScreenText:g_JSChartResource.KLine.NumIcon.Text),D)){var g=t[1];if(g.Data.length>=2&&C&&l){var p=g.Data.length;p>=C.length&&(p=0),this.Canvas.fillStyle=g_JSChartResource.KLine.NumIcon.Color;u=C[p];this.Canvas.fillText(u,g.TextRect.X,g.TextRect.Y,o)}e||this.InfoTooltipRect.push(g)}}}},this.DrawTradeIcon=function(){if(this.TradeData){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+2,r=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;t&&(i=this.ChartBorder.GetTop()+a/2+2,r=this.ChartBorder.GetBottom());var s=this.TradeData.Sell,o=this.TradeData.Buy,h=e+a,l=GetDevicePixelRatio(),C=24*l,u=12*l;h<u?h=u:h>C&&(h=C),this.Canvas.font=h+"px "+this.TradeIcon.Family;for(var D=this.Data.DataOffset,d=0;D<this.Data.Data.length&&d<n;++D,++d,i+=e+a){var c=this.Data.Data[D];if(null!=c.Open&&null!=c.High&&null!=c.Low&&null!=c.Close){var m=!1,f=!1;if(s&&D<s.length&&(f=s[D]>0),o&&D<o.length&&(m=o[D]>0),f||m){var v=i,S=i+e;if(S>r)break;var T=v+(S-v)/2,I=this.ChartFrame.GetYFromData(c.Low),F=this.ChartFrame.GetYFromData(c.High);this.ChartFrame.GetYFromData(c.Open),this.ChartFrame.GetYFromData(c.Close);if(m)if(this.Canvas.fillStyle=this.TradeIcon.Buy.Color,t)this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Buy.HScreenText,I,T);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.Canvas.fillText(this.TradeIcon.Buy.Text,T,I);var g=new Rect(T-h/2,I,h,h),p={Data:{Type:1,KData:c,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:g,TextRect:{X:T,Y:I}};this.TradeIconTooltipRect.push(p)}if(f)if(this.Canvas.fillStyle=this.TradeIcon.Sell.Color,t)this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Sell.HScreenText,F,T);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.TradeIcon.Sell.Text,T,F);g=new Rect(T-h/2,F-h,h,h),p={Data:{Type:2,KData:c,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:g,TextRect:{X:T,Y:F}};this.TradeIconTooltipRect.push(p)}}}}}},this.GetTooltipData=function(t,e,a){for(var i in this.TradeIconTooltipRect){if((n=this.TradeIconTooltipRect[i]).Rect){var r=n.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(r.X,r.Y,r.Width,r.Height),this.Canvas.isPointInPath(t,e))return JSConsole.Chart.Log("[ChartKLine::GetTooltipData] trade icon ",n),a.Data=n,a.ChartPaint=this,a.Type=2,!0}}for(var i in this.InfoTooltipRect){var n;if((n=this.InfoTooltipRect[i]).Rect){r=n.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(r.X,r.Y,r.Width,r.Height),this.Canvas.isPointInPath(t,e))return a.Data=n,a.ChartPaint=this,a.Type=1,!0}}for(var i in this.TooltipRect){r=this.TooltipRect[i][1];if(this.Canvas.beginPath(),this.Canvas.rect(r.X,r.Y,r.Width,r.Height),this.Canvas.isPointInPath(t,e)){var s=this.TooltipRect[i][0];return a.Data=this.Data.Data[s],a.ChartPaint=this,a.Type=0,!0}}return!1},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Max:null,Min:null};if(1==this.DrawType||4==this.DrawType)for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];IFrameSplitOperator.IsNumber(r.Close)&&(null==e.Max&&(e.Max=r.Close),null==e.Min&&(e.Min=r.Close),e.Max<r.Close&&(e.Max=r.Close),e.Min>r.Close&&(e.Min=r.Close))}else for(a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){null!=(r=this.Data.Data[a]).Open&&null!=r.High&&null!=r.Low&&null!=r.Close&&(null==e.Max&&(e.Max=r.High),null==e.Min&&(e.Min=r.Low),e.Max<r.High&&(e.Max=r.High),e.Min>r.Low&&(e.Min=r.Low))}return e},this.GetAllPrice=function(){for(var t=this.ChartFrame.XPointCount,e=new Set,a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r.Open&&null!=r.High&&null!=r.Low&&null!=r.Close){var n=r.Close;e.add(n)}}var s=[];for(var o of e)s.push(o);return s.sort(function(t,e){return t-e}),s}}function ChartColorKline(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartColorKline",this.Symbol,this.Color="rgb(0,255,44)",this.DrawType=0,this.KLineColor,this.Draw=function(){this.IsShow&&this.KLineColor&&this.DrawBar()},this.DrawUpBarItem=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=e,s=n+(e+a-n)/2,o=this.ChartFrame.GetYFromData(t.Low),h=this.ChartFrame.GetYFromData(t.High),l=this.ChartFrame.GetYFromData(t.Open),C=this.ChartFrame.GetYFromData(t.Close),u=h;a>=4?(t.High>t.Close?(this.Canvas.beginPath(),r?(this.Canvas.moveTo(ToFixedPoint(u),ToFixedPoint(s)),this.Canvas.lineTo(ToFixedPoint(3==this.DrawType?Math.max(C,l):C),ToFixedPoint(s))):(this.Canvas.moveTo(ToFixedPoint(s),ToFixedPoint(u)),this.Canvas.lineTo(ToFixedPoint(s),ToFixedPoint(3==this.DrawType?Math.min(C,l):C))),this.Canvas.stroke(),u=C):u=C,r?Math.abs(l-u)<1?this.Canvas.fillRect(ToFixedRect(u),ToFixedRect(n),1,ToFixedRect(a)):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(u),ToFixedPoint(n),ToFixedRect(l-u),ToFixedRect(a)),this.Canvas.stroke()):this.Canvas.fillRect(ToFixedRect(u),ToFixedRect(n),ToFixedRect(l-u),ToFixedRect(a)):Math.abs(l-u)<1?this.Canvas.fillRect(ToFixedRect(n),ToFixedRect(u),ToFixedRect(a),1):3==this.DrawType?(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(n),ToFixedPoint(u),ToFixedRect(a),ToFixedRect(l-u)),this.Canvas.stroke()):this.Canvas.fillRect(ToFixedRect(n),ToFixedRect(Math.min(u,l)),ToFixedRect(a),ToFixedRect(Math.abs(l-u))),t.Open>t.Low&&(this.Canvas.beginPath(),r?(this.Canvas.moveTo(ToFixedPoint(3==this.DrawType?Math.min(C,l):u),ToFixedPoint(s)),this.Canvas.lineTo(ToFixedPoint(o),ToFixedPoint(s))):(this.Canvas.moveTo(ToFixedPoint(s),ToFixedPoint(3==this.DrawType?Math.max(C,l):u)),this.Canvas.lineTo(ToFixedPoint(s),ToFixedPoint(o))),this.Canvas.stroke())):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(h,ToFixedPoint(s)),this.Canvas.lineTo(o,ToFixedPoint(s))):(this.Canvas.moveTo(ToFixedPoint(s),h),this.Canvas.lineTo(ToFixedPoint(s),o)),this.Canvas.stroke())},this.DrawDownBarItem=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=e,s=n+(e+a-n)/2,o=this.ChartFrame.GetYFromData(t.Low),h=this.ChartFrame.GetYFromData(t.High),l=this.ChartFrame.GetYFromData(t.Open),C=this.ChartFrame.GetYFromData(t.Close),u=h;a>=4?(t.High>t.Close?(this.Canvas.beginPath(),r?(this.Canvas.moveTo(ToFixedPoint(u),ToFixedPoint(s)),this.Canvas.lineTo(ToFixedPoint(l),ToFixedPoint(s))):(this.Canvas.moveTo(ToFixedPoint(s),ToFixedPoint(u)),this.Canvas.lineTo(ToFixedPoint(s),ToFixedPoint(l))),this.Canvas.stroke(),u=l):u=l,r?Math.abs(C-u)<1?this.Canvas.fillRect(ToFixedRect(u),ToFixedRect(n),1,ToFixedRect(a)):this.Canvas.fillRect(ToFixedRect(u),ToFixedRect(n),ToFixedRect(C-u),ToFixedRect(a)):Math.abs(C-u)<1?this.Canvas.fillRect(ToFixedRect(n),ToFixedRect(u),ToFixedRect(a),1):this.Canvas.fillRect(ToFixedRect(n),ToFixedRect(Math.min(u,C)),ToFixedRect(a),ToFixedRect(Math.abs(C-u))),t.Open>t.Low&&(this.Canvas.beginPath(),r?(this.Canvas.moveTo(ToFixedPoint(u),ToFixedPoint(s)),this.Canvas.lineTo(ToFixedPoint(o),ToFixedPoint(s))):(this.Canvas.moveTo(ToFixedPoint(s),ToFixedPoint(u)),this.Canvas.lineTo(ToFixedPoint(s),ToFixedPoint(o))),this.Canvas.stroke())):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(h,ToFixedPoint(s)),this.Canvas.lineTo(o,ToFixedPoint(s))):(this.Canvas.moveTo(ToFixedPoint(s),h),this.Canvas.lineTo(ToFixedPoint(s),o)),this.Canvas.stroke())},this.DrawUnChangeBarItem=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=e,s=e+a,o=n+(s-n)/2,h=this.ChartFrame.GetYFromData(t.Low),l=this.ChartFrame.GetYFromData(t.High),C=this.ChartFrame.GetYFromData(t.Open),u=(this.ChartFrame.GetYFromData(t.Close),l);a>=4?(this.Canvas.beginPath(),t.High>t.Close?(r?(this.Canvas.moveTo(u,ToFixedPoint(o)),this.Canvas.lineTo(C,ToFixedPoint(o))):(this.Canvas.moveTo(ToFixedPoint(o),u),this.Canvas.lineTo(ToFixedPoint(o),C)),u=C):u=C,r?(this.Canvas.moveTo(ToFixedPoint(u),ToFixedPoint(n)),this.Canvas.lineTo(ToFixedPoint(u),ToFixedPoint(s))):(this.Canvas.moveTo(ToFixedPoint(n),ToFixedPoint(u)),this.Canvas.lineTo(ToFixedPoint(s),ToFixedPoint(u))),t.Open>t.Low&&(r?(this.Canvas.moveTo(ToFixedPoint(u),ToFixedPoint(o)),this.Canvas.lineTo(ToFixedPoint(h),ToFixedPoint(o))):(this.Canvas.moveTo(ToFixedPoint(o),ToFixedPoint(u)),this.Canvas.lineTo(ToFixedPoint(o),ToFixedPoint(h)))),this.Canvas.stroke()):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(l,ToFixedPoint(o)),this.Canvas.lineTo(h,ToFixedPoint(o))):(this.Canvas.moveTo(ToFixedPoint(o),l),this.Canvas.lineTo(ToFixedPoint(o),h)),this.Canvas.stroke())},this.DrawBar=function(){var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+e/2+2,i=this.ChartBorder.GetRight(),r=this.ChartFrame.XPointCount;this.IsHScreen&&(a=this.ChartBorder.GetTop()+e/2+2,i=this.ChartBorder.GetBottom());for(var n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<r;++n,++s,a+=t+e){var o=this.Data.Data[n];if(null!=o.Open&&null!=o.High&&null!=o.Low&&null!=o.Close&&this.KLineColor.has(n)){var h=this.KLineColor.get(n);if(a+t>i)break;h.Color?(this.Canvas.strokeStyle=h.Color,this.Canvas.fillStyle=h.Color):(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color),o.Open<o.Close?this.DrawUpBarItem(o,a,t,h):o.Open>o.Close?this.DrawDownBarItem(o,a,t,h):this.DrawUnChangeBarItem(o,a,t,h)}}},this.GetMaxMin=function(){return{Max:null,Min:null}}}var OVERLAY_STATUS_ID={STATUS_NONE_ID:0,STATUS_REQUESTDATA_ID:1,STATUS_RECVDATA_ID:2,STATUS_FINISHED_ID:3};function ChartOverlayKLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartOverlayKLine",this.Color="rgb(65,105,225)",this.MainData,this.SourceData,this.Title,this.DrawType=0,this.CustomDrawType=null,this.Status=OVERLAY_STATUS_ID.STATUS_NONE_ID,this.IsDelete=!1,this.SetOption=function(t){t&&IFrameSplitOperator.IsNumber(t.DrawType)&&(this.CustomDrawType=t.DrawType)},this.DrawKBar=function(t){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetLeft()+i/2+2;e&&(r=this.ChartBorder.GetTop()+i/2+2);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=this.DrawType;null!=this.CustomDrawType&&(o=this.CustomDrawType);for(var h=!0,l=null,C=this.Data.DataOffset,u=0;C<this.Data.Data.length&&u<s;++C,++u,r+=a+i){var D=this.Data.Data[C];if(D&&null!=D.Open&&null!=D.High&&null!=D.Low&&null!=D.Close){null==l&&(l=D.Open),h&&(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color,this.Canvas.beginPath(),h=!1);var d=r,c=r+a;if(c>n)break;var m=d+(c-d)/2,f=this.ChartFrame.GetYFromData(D.Low/l*t),v=this.ChartFrame.GetYFromData(D.High/l*t),S=this.ChartFrame.GetYFromData(D.Open/l*t),T=this.ChartFrame.GetYFromData(D.Close/l*t),I=v;D.Open<D.Close?a>=4?(D.High>D.Close?(e?(this.Canvas.moveTo(ToFixedPoint(I),ToFixedPoint(m)),this.Canvas.lineTo(ToFixedPoint(3==this.DrawType?Math.max(T,S):T),ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),ToFixedPoint(I)),this.Canvas.lineTo(ToFixedPoint(m),ToFixedPoint(3==this.DrawType?Math.min(T,S):T))),I=T):I=T,e?Math.abs(S-I)<1?this.Canvas.fillRect(ToFixedRect(I),ToFixedRect(d),1,ToFixedRect(a)):3==o?this.Canvas.rect(ToFixedPoint(I),ToFixedPoint(d),ToFixedRect(S-I),ToFixedRect(a)):this.Canvas.fillRect(ToFixedRect(I),ToFixedRect(d),ToFixedRect(S-I),ToFixedRect(a)):Math.abs(S-I)<1?this.Canvas.fillRect(ToFixedRect(d),ToFixedRect(I),ToFixedRect(a),1):3==o?this.Canvas.rect(ToFixedPoint(d),ToFixedPoint(I),ToFixedRect(a),ToFixedRect(S-I)):this.Canvas.fillRect(ToFixedRect(d),ToFixedRect(I),ToFixedRect(a),ToFixedRect(S-I)),D.Open>D.Low&&(e?(this.Canvas.moveTo(ToFixedPoint(3==this.DrawType?Math.min(T,S):I),ToFixedPoint(m)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),ToFixedPoint(3==this.DrawType?Math.max(T,S):I)),this.Canvas.lineTo(ToFixedPoint(m),ToFixedPoint(f))))):e?(this.Canvas.moveTo(v,ToFixedPoint(m)),this.Canvas.lineTo(f,ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),v),this.Canvas.lineTo(ToFixedPoint(m),f)):D.Open>D.Close?a>=4?(D.High>D.Close?(e?(this.Canvas.moveTo(ToFixedPoint(I),ToFixedPoint(m)),this.Canvas.lineTo(ToFixedPoint(S),ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),ToFixedPoint(I)),this.Canvas.lineTo(ToFixedPoint(m),ToFixedPoint(S))),I=S):I=S,e?Math.abs(T-I)<1?this.Canvas.fillRect(ToFixedRect(I),ToFixedRect(d),1,ToFixedRect(a)):this.Canvas.fillRect(ToFixedRect(I),ToFixedRect(d),ToFixedRect(T-I),ToFixedRect(a)):Math.abs(T-I)<1?this.Canvas.fillRect(ToFixedRect(d),ToFixedRect(I),ToFixedRect(a),1):this.Canvas.fillRect(ToFixedRect(d),ToFixedRect(I),ToFixedRect(a),ToFixedRect(T-I)),D.Open>D.Low&&(e?(this.Canvas.moveTo(ToFixedPoint(I),ToFixedPoint(m)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),ToFixedPoint(I)),this.Canvas.lineTo(ToFixedPoint(m),ToFixedPoint(f))))):e?(this.Canvas.moveTo(v,ToFixedPoint(m)),this.Canvas.lineTo(f,ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),v),this.Canvas.lineTo(ToFixedPoint(m),f)):a>=4?(D.High>D.Close?(e?(this.Canvas.moveTo(I,ToFixedPoint(m)),this.Canvas.lineTo(S,ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),I),this.Canvas.lineTo(ToFixedPoint(m),S)),I=S):I=S,e?(this.Canvas.moveTo(ToFixedPoint(I),ToFixedPoint(d)),this.Canvas.lineTo(ToFixedPoint(I),ToFixedPoint(c))):(this.Canvas.moveTo(ToFixedPoint(d),ToFixedPoint(I)),this.Canvas.lineTo(ToFixedPoint(c),ToFixedPoint(I))),D.Open>D.Low&&(e?(this.Canvas.moveTo(ToFixedPoint(I),ToFixedPoint(m)),this.Canvas.lineTo(ToFixedPoint(f),ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),ToFixedPoint(I)),this.Canvas.lineTo(ToFixedPoint(m),ToFixedPoint(f))))):e?(this.Canvas.moveTo(v,ToFixedPoint(m)),this.Canvas.lineTo(f,ToFixedPoint(m))):(this.Canvas.moveTo(ToFixedPoint(m),v),this.Canvas.lineTo(ToFixedPoint(m),f));var F=Math.min(f,v,S,T),g=new Rect(d,F,a,Math.max(f,v,S,T)-F);this.TooltipRect.push([C,g])}}0==h&&this.Canvas.stroke()},this.DrawAKLine=function(t){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetLeft()+i/2+2;e&&(r=this.ChartBorder.GetTop()+i/2+2);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=null;this.Canvas.strokeStyle=this.Color;for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<s;++h,++l,r+=a+i){var C=this.Data.Data[h];if(null!=C.Open&&null!=C.High&&null!=C.Low&&null!=C.Close){null==o&&(o=C.Open);var u=r,D=r+a;if(D>n)break;var d=u+(D-u)/2,c=this.ChartFrame.GetYFromData(C.Low/o*t),m=this.ChartFrame.GetYFromData(C.High/o*t),f=this.ChartFrame.GetYFromData(C.Open/o*t),v=this.ChartFrame.GetYFromData(C.Close/o*t);this.Canvas.beginPath(),e?(this.Canvas.moveTo(m,ToFixedPoint(d)),this.Canvas.lineTo(c,ToFixedPoint(d))):(this.Canvas.moveTo(ToFixedPoint(d),m),this.Canvas.lineTo(ToFixedPoint(d),c)),this.Canvas.stroke(),a>=4&&(this.Canvas.beginPath(),e?(this.Canvas.moveTo(ToFixedPoint(f),u),this.Canvas.lineTo(ToFixedPoint(f),d)):(this.Canvas.moveTo(u,ToFixedPoint(f)),this.Canvas.lineTo(d,ToFixedPoint(f))),this.Canvas.stroke(),this.Canvas.beginPath(),e?(this.Canvas.moveTo(ToFixedPoint(v),D),this.Canvas.lineTo(ToFixedPoint(v),d)):(this.Canvas.moveTo(D,ToFixedPoint(v)),this.Canvas.lineTo(d,ToFixedPoint(v))),this.Canvas.stroke())}}},this.DrawCloseLine=function(t){var e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetLeft()+i/2+2;e&&(r=this.ChartBorder.GetTop()+i/2+2);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=null,h=!0;this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath();for(var l=this.Data.DataOffset,C=0;l<this.Data.Data.length&&C<s;++l,++C,r+=a+i){var u=this.Data.Data[l];if(null!=u.Open&&null!=u.High&&null!=u.Low&&null!=u.Close){null==o&&(o=u.Open);var D=r,d=r+a;if(d>n)break;var c=D+(d-D)/2,m=this.ChartFrame.GetYFromData(u.Close/o*t);h?(e?this.Canvas.moveTo(m,c):this.Canvas.moveTo(c,m),h=!1):e?this.Canvas.lineTo(m,c):this.Canvas.lineTo(c,m)}}0==h&&this.Canvas.stroke()},this.Draw=function(){if(this.TooltipRect=[],this.InfoTooltipRect=[],this.MainData&&this.Data){for(var t=this.ChartFrame.XPointCount,e=null,a=this.Data.DataOffset,i=0;a<this.MainData.Data.length&&i<t;++a,++i){var r=this.MainData.Data[a];if(null!=r.Open&&null!=r.High&&null!=r.Low&&null!=r.Close){e=r.Open;break}}if(null!=e){var n=this.DrawType;null!=this.CustomDrawType&&(n=this.CustomDrawType),1==n?this.DrawCloseLine(e):2==n?this.DrawAKLine(e):this.DrawKBar(e)}}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Max:null,Min:null};if(!this.MainData||!this.Data)return e;for(var a=null,i=this.Data.DataOffset,r=0;i<this.MainData.Data.length&&r<t;++i,++r){if(null!=(h=this.MainData.Data[i]).Open&&null!=h.High&&null!=h.Low&&null!=h.Close){a=h.Close;break}}if(null==a)return e;var n,s,o=null;for(i=this.Data.DataOffset,r=0;i<this.Data.Data.length&&r<t;++i,++r){var h;(h=this.Data.Data[i])&&null!=h.Open&&null!=h.High&&null!=h.Low&&null!=h.Close&&(null==o&&(o=h.Open),n=h.High/o*a,s=h.Low/o*a,null==e.Max&&(e.Max=n),null==e.Min&&(e.Min=s),e.Max<n&&(e.Max=n),e.Min>s&&(e.Min=s))}return e},this.GetTooltipData=function(t,e,a){for(var i in this.TooltipRect){var r=this.TooltipRect[i][1];if(this.Canvas.beginPath(),this.Canvas.rect(r.X,r.Y,r.Width,r.Height),this.Canvas.isPointInPath(t,e)){var n=this.TooltipRect[i][0];return a.Data=this.Data.Data[n],a.ChartPaint=this,!0}}return!1}}function ChartMinuteVolumBar(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteVolumBar",this.UpColor=g_JSChartResource.UpBarColor,this.DownColor=g_JSChartResource.DownBarColor,this.YClose,this.Draw=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartBorder.GetRight();t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount,i=this.ChartFrame.GetYFromData(0),r=this.YClose,n=this.Data;this.Canvas.canvas.JSChartContainer.Frame.Data&&(n.DataOffset=this.Canvas.canvas.JSChartContainer.Frame.Data.DataOffset,debug&&console.log("ChartMinuteVolumeBar",n.DataOffset,this));for(var s=n.DataOffset,o=0;s<n.Data.length&&o<a;++s,++o){var h=n.Data[s],l=null;if(h){var C=null;if(h.Before?(l=h.Before.Vol,C=h.Before.Close):(l=h.Vol,C=h.Close),l){var u=this.ChartFrame.GetYFromData(l),D=this.ChartFrame.GetXFromIndex(o);if(D>e)break;this.Canvas.strokeStyle=C>=r?this.UpColor:this.DownColor,this.Canvas.beginPath(),t?(this.Canvas.moveTo(u,ToFixedPoint(D)),this.Canvas.lineTo(i,ToFixedPoint(D))):(this.Canvas.moveTo(ToFixedPoint(D),u),this.Canvas.lineTo(ToFixedPoint(D),i)),this.Canvas.stroke(),C&&(r=C)}}}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:0,Max:null};window.chartdata["00"]&&(this.Data.DataOffset=window.chartdata["00"].DataOffset),debug&&console.log("GetMaxMin",this.Data.DataOffset,this);for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];r&&r.Vol&&(null==e.Max&&(e.Max=r.Vol),e.Max<r.Vol&&(e.Max=r.Vol))}return e}}function ChartErrorMessage(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartErrorMessage",this.Draw=function(){this.IsShow&&this.NotSupportMessage&&this.DrawNotSupportmessage()}}function ChartLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.Draw=function(){if(this.IsShow)if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data)switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.DrawLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio()),this.IsDotLine&&this.Canvas.setLineDash(g_JSChartResource.DOTLINE.LineDash);for(var i=!0,r=0,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s),l=this.GetYFromData(o);if(h>e)break;i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(l,h):this.Canvas.moveTo(h,l),i=!1):t?this.Canvas.lineTo(l,h):this.Canvas.lineTo(h,l),++r}}r>0&&this.Canvas.stroke(),this.Canvas.restore()},this.DrawStraightLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount,i=this.GetLockRect();i&&(e=t?i.Top:i.Left),this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(g_JSChartResource.DOTLINE.LineDash);for(var r=!0,n=0,s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<a;++s,++o){var h=this.Data.Data[s];if(null!=h){var l=this.ChartFrame.GetXFromIndex(o),C=this.GetYFromData(h);if(l>e)break;r?(this.Canvas.beginPath(),t?this.Canvas.moveTo(C,l):this.Canvas.moveTo(l,C),r=!1):t?this.Canvas.lineTo(C,l):this.Canvas.lineTo(l,C),++n}else n>0&&this.Canvas.stroke(),r=!0,n=0}n>0&&this.Canvas.stroke(),this.Canvas.restore()},this.GetYFromData=function(t){return this.ChartFrame.GetYFromData(t)}}function ChartSubLine(){this.newMethod=ChartLine,this.newMethod(),delete this.newMethod,this.ClassName="ChartSubLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.SubFrame={Max:null,Min:null},this.Draw=function(){if(this.IsShow&&this.Data&&this.Data.Data)switch(this.CalculateDataMaxMin(),this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetYFromData=function(t){if(!0===this.ChartFrame.IsHScreen){if(t<=this.SubFrame.Min)return this.ChartBorder.GetLeftEx();if(t>=this.SubFrame.Max)return this.ChartBorder.GetRightEx();var e=this.ChartBorder.GetWidthEx()*(t-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetLeftEx()+e}if(t<=this.SubFrame.Min)return this.ChartBorder.GetBottomEx();if(t>=this.SubFrame.Max)return this.ChartBorder.GetTopEx();var a=this.ChartBorder.GetHeightEx()*(t-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetBottomEx()-a},this.CalculateDataMaxMin=function(){this.SubFrame={Max:null,Min:null};var t=!0===this.ChartFrame.IsHScreen,e=this.ChartBorder.GetRight();t&&(e=this.ChartBorder.GetBottom());for(var a=this.ChartFrame.XPointCount,i=this.Data.DataOffset,r=0;i<this.Data.Data.length&&r<a;++i,++r){var n=this.Data.Data[i];if(null!=n){if(this.ChartFrame.GetXFromIndex(r)>e)break;(null==this.SubFrame.Min||this.SubFrame.Min>n)&&(this.SubFrame.Min=n),(null==this.SubFrame.Max||this.SubFrame.Max<n)&&(this.SubFrame.Max=n)}}},this.GetMaxMin=function(){return{Min:null,Max:null}}}function ChartOverlayLine(){this.newMethod=ChartLine,this.newMethod(),delete this.newMethod,this.MainData=new ChartData,this.Draw=function(){if(this.Data&&this.Data.Data&&this.MainData&&this.MainData.Data)switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetFirstVaildIndex=function(){for(var t=this.Data.DataOffset,e=0;t<this.MainData.Data.length&&t<this.Data.Data.length;++t,++e){var a=this.MainData.Data[t],i=this.Data.Data[t];if(IFrameSplitOperator.IsNumber(a)&&IFrameSplitOperator.IsNumber(i))return{Index:e,DataOffset:t,OverlayValue:i,MainValue:a}}return null},this.DrawStraightLine=function(){var t=this.GetFirstVaildIndex();if(t){var e=!0===this.ChartFrame.IsHScreen,a=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());e&&(a=this.ChartBorder.GetBottom());var i=this.ChartFrame.XPointCount,r=this.GetLockRect();r&&(a=e?r.Top:r.Left),this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash([3,5]);for(var n=!0,s=0,o=0,h=t.DataOffset,l=t.Index;h<this.Data.Data.length&&l<i;++h,++l){var C=this.Data.Data[h];if(null!=C){var u=this.ChartFrame.GetXFromIndex(l),D=C-t.OverlayValue;o=0!=t.OverlayValue?1+D/Math.abs(t.OverlayValue):1+D;var d=t.MainValue*o,c=this.GetYFromData(d);if(u>a)break;n?(this.Canvas.beginPath(),e?this.Canvas.moveTo(c,u):this.Canvas.moveTo(u,c),n=!1):e?this.Canvas.lineTo(c,u):this.Canvas.lineTo(u,c),++s}else s>0&&this.Canvas.stroke(),n=!0,s=0}s>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.GetFirstVaildIndex();if(!a)return e;for(var i=a.DataOffset,r=a.Index;i<this.Data.Data.length&&r<t;++i,++r){var n=this.Data.Data[i];if(IFrameSplitOperator.IsNumber(n)){var s=n-a.OverlayValue;0!=a.OverlayValue?rate=1+s/Math.abs(a.OverlayValue):rate=1+s;var o=a.MainValue*rate;null==e.Max&&(e.Max=o),null==e.Min&&(e.Min=o),e.Max<o&&(e.Max=o),e.Min>o&&(e.Min=o)}}return e}}function ChartPartLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartPartLine",this.LineWidth,this.Draw=function(){this.IsShow&&(this.NotSupportMessage?this.DrawNotSupportmessage():this.Data&&this.Data.Data&&this.DrawLine())},this.DrawLine=function(){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio());for(var i,r=0,n={X:null,Y:null},s=!1,o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<a;++o,++h){var l=this.Data.Data[o];if(null!=l&&null!=l.Value){var C=l.Value,u=l.RGB,D=this.ChartFrame.GetXFromIndex(h),d=this.ChartFrame.GetYFromData(C);if(D>e)break;u!=i||1==s?(i&&r>0&&this.Canvas.stroke(),r=0,i=u,this.Canvas.strokeStyle=u,this.Canvas.beginPath(),null!=n.X&&null!=n.Y?(t?this.Canvas.moveTo(n.Y,n.X):this.Canvas.moveTo(n.X,n.Y),t?this.Canvas.lineTo(d,D):this.Canvas.lineTo(D,d),++r):t?this.Canvas.moveTo(d,D):this.Canvas.moveTo(D,d)):(t?this.Canvas.lineTo(d,D):this.Canvas.lineTo(D,d),++r),n.X=D,n.Y=d,s=!1}else n.X=null,n.Y=null,s=!0}r>0&&this.Canvas.stroke(),this.Canvas.restore()},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];r&&r.Value&&((null==e.Max||e.Max<r.Value)&&(e.Max=r.Value),(null==e.Min||e.Min>r.Value)&&(e.Min=r.Value))}return e}}function ChartSlopeLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartSlopeLine",this.Color="rgb(255,193,37)",this.IsDotLine=!1,this.LineWidth,this.Option,this.Draw=function(){if(this.IsShow)if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(g_JSChartResource.DOTLINE.LineDash);var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetTopEx(),a=this.ChartBorder.GetRight(),i=this.ChartBorder.GetBottom(),r=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;this.Canvas.beginPath(),this.Canvas.rect(t,e,a-t,i-e),this.Canvas.clip();for(var s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<n;++s,++o){var h=this.Data.Data[s];if(IFrameSplitOperator.IsNumber(h)){var l=this.Option[s];if(l){var C=this.ChartFrame.GetXFromIndex(o),u=this.ChartFrame.GetYFromData(h),D=l.Length*g_JSChartResource.DRAWSL.PixelWidth;if(C>r)break;var d=Math.sqrt(D*D/(1+l.Slope*l.Slope)),c=d*l.Slope;this.Canvas.beginPath(),2==l.Direct?(this.Canvas.moveTo(C-d,u+c),this.Canvas.lineTo(C+d,u-c)):1==l.Direct?(this.Canvas.moveTo(C,u),this.Canvas.lineTo(C-d,u+c)):(this.Canvas.moveTo(C,u),this.Canvas.lineTo(C+d,u-c)),this.Canvas.stroke()}}}this.Canvas.restore()}}}function ChartPointDot(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartPointDot",this.Color="rgb(255,193,37)",this.Radius=1,this.Draw=function(){if(this.IsShow)if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());!0===t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.Canvas.fillStyle=this.Color;for(var i=this.Data.DataOffset,r=0;i<this.Data.Data.length&&r<a;++i,++r){var n=this.Data.Data[i];if(null!=n){var s=this.ChartFrame.GetXFromIndex(r),o=this.ChartFrame.GetYFromData(n);if(s>e)break;this.Canvas.beginPath(),t?this.Canvas.arc(o,s,this.Radius,0,2*Math.PI,!0):this.Canvas.arc(s,o,this.Radius,0,2*Math.PI,!0),this.Canvas.closePath(),this.Canvas.fill()}}this.Canvas.restore()}}}function ChartStick(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.Color="rgb(255,193,37)",this.LineWidth,this.ClassName="ChartStick",this.DrawLine=function(){if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());!0===t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio());for(var i=!0,r=0,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s),l=this.ChartFrame.GetYFromData(o);if(h>e)break;i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(l,h):this.Canvas.moveTo(h,l),i=!1):t?this.Canvas.lineTo(l,h):this.Canvas.lineTo(h,l),++r}}r>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.DrawStick=function(){if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartBorder.GetRight();t&&(e=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetBottom(),r=this.ChartBorder.GetLeft();this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineWidth&&(this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio());for(var n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s),l=this.ChartFrame.GetYFromData(o);if(h>e)break;if(this.Canvas.beginPath(),t)this.Canvas.moveTo(r,h),this.Canvas.lineTo(l,h),this.Canvas.stroke();else{var C=parseInt(h.toString())+.5;this.Canvas.moveTo(C,l),this.Canvas.lineTo(C,i)}this.Canvas.stroke()}}this.Canvas.restore()}},this.Draw=function(){this.IsShow&&(this.NotSupportMessage?this.DrawNotSupportmessage():this.Data&&this.Data.Data&&this.DrawStick())}}function ChartLineStick(){this.newMethod=ChartStick,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineStick",this.Draw=function(){this.IsShow&&(this.NotSupportMessage?this.DrawNotSupportmessage():(this.DrawStick(),this.DrawLine()))}}function ChartVolStick(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.UpColor=g_JSChartResource.UpBarColor,this.DownColor=g_JSChartResource.DownBarColor,this.HistoryData,this.KLineDrawType=0,this.ClassName="ChartVolStick",this.Draw=function(){if(!0!==this.ChartFrame.IsHScreen){var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+e/2+2,i=this.ChartBorder.GetRight(),r=this.ChartFrame.XPointCount,n=this.GetLockRect();n&&(i=n.Left);var s=this.ChartFrame.GetYFromData(0);if(t>=4){s=ToFixedRect(s);for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){var l=this.Data.Data[o],C=this.HistoryData.Data[o];if(null!=l&&null!=C){var u=a;if(a+t>i)break;var D=this.ChartFrame.GetYFromData(l),d=!1;C.Close>=C.Open?(this.Canvas.fillStyle=this.UpColor,d=!0):this.Canvas.fillStyle=this.DownColor;var c=ToFixedRect(s-D);D=s-c,!d||1!=this.KLineDrawType&&2!=this.KLineDrawType&&3!=this.KLineDrawType?this.Canvas.fillRect(ToFixedRect(u),D,ToFixedRect(t),c):(this.Canvas.strokeStyle=this.UpColor,this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(u),ToFixedPoint(D),ToFixedRect(t),c),this.Canvas.stroke())}}}else for(o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){l=this.Data.Data[o],C=this.HistoryData.Data[o];if(null!=l&&null!=C){D=this.ChartFrame.GetYFromData(l);if((m=this.ChartFrame.GetXFromIndex(h))>i)break;C.Close>=C.Open?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;var m=this.ChartFrame.GetXFromIndex(h);this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(m),D),this.Canvas.lineTo(ToFixedPoint(m),s),this.Canvas.stroke()}}}else this.HScreenDraw()},this.HScreenDraw=function(){var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetTop()+e/2+2,i=this.ChartBorder.GetBottom(),r=this.ChartFrame.XPointCount,n=this.GetLockRect();n&&(i=n.Top);var s=this.ChartFrame.GetYFromData(0);if(t>=4){s=ToFixedRect(s);for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){var l=this.Data.Data[o],C=this.HistoryData.Data[o];if(null!=l&&null!=C){var u=a;if(a+t>i)break;var D=this.ChartFrame.GetYFromData(l),d=!1;C.Close>=C.Open?(d=!0,this.Canvas.fillStyle=this.UpColor):this.Canvas.fillStyle=this.DownColor;var c=ToFixedRect(D-s);!d||1!=this.KLineDrawType&&2!=this.KLineDrawType&&3!=this.KLineDrawType?this.Canvas.fillRect(s,ToFixedRect(u),c,ToFixedRect(t)):(this.Canvas.strokeStyle=this.UpColor,this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(s),ToFixedPoint(u),c,ToFixedRect(t)),this.Canvas.stroke())}}}else for(o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h,a+=t+e){l=this.Data.Data[o],C=this.HistoryData.Data[o];if(null!=l&&null!=C){D=this.ChartFrame.GetYFromData(l);if((m=this.ChartFrame.GetXFromIndex(h))>i)break;C.Close>C.Open?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;var m=this.ChartFrame.GetXFromIndex(h);this.Canvas.beginPath(),this.Canvas.moveTo(D,ToFixedPoint(m)),this.Canvas.lineTo(s,ToFixedPoint(m)),this.Canvas.stroke()}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:0,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];null==e.Max&&(e.Max=r),e.Max<r&&(e.Max=r)}return e}}function ChartLineMultiData(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineMultiData",this.Color="rgb(255,193,37)",this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=(this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight());t&&(e=this.ChartBorder.GetBottom());for(var a=this.ChartFrame.XPointCount,i=!0,r=0,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(null!=o){var h=this.ChartFrame.GetXFromIndex(s);if(h>e)break;for(var l in o){var C=o[l].Value,u=this.ChartFrame.GetYFromData(C);i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(u,h):this.Canvas.moveTo(h,u),i=!1):t?this.Canvas.lineTo(u,h):this.Canvas.lineTo(h,u),++r}}}r>0&&this.Canvas.stroke()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null};if(!this.Data||!this.Data.Data)return e;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r)for(var n in r){var s=r[n].Value;null==e.Max&&(e.Max=s),null==e.Min&&(e.Min=s),e.Max<s&&(e.Max=s),e.Min>s&&(e.Min=s)}}return e}}function ChartStickLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartStickLine",this.Color="rgb(255,193,37)",this.BarType=0,this.LineDotted=[3,3],this.Width=0,this.SetEmptyBar=function(){return(1==this.BarType||-1==this.BarType)&&(this.Canvas.lineWidth=GetDevicePixelRatio(),this.Canvas.strokeStyle=this.Color,-1==this.BarType&&this.Canvas.setLineDash(this.LineDotted),!0)},this.IsEmptyBar=function(){return 1==this.BarType||-1==this.BarType},this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetRight();this.ChartFrame.ZoomIndex;t&&(i=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount,n=this.ChartBorder.GetLeft()+a/2+2;t&&(n=this.ChartBorder.GetTop()+a/2+2),this.Canvas.save();var s=!1,o=!1;if(0==this.Width)this.SetEmptyBar();else if(3==this.Width||50==this.Width)e>=4?(o=!0,this.SetEmptyBar(),this.Canvas.fillStyle=this.Color,this.Canvas.strokeStyle=this.Color):(this.Canvas.lineWidth=GetDevicePixelRatio(),this.Canvas.strokeStyle=this.Color);else if(101==this.Width){var h=e+a+1*GetDevicePixelRatio();this.Canvas.lineWidth=h,this.Canvas.strokeStyle=this.Color}else if(this.Width<=3){var l=2*GetDevicePixelRatio();(C=e*(this.Width/3))<l&&(C=l),this.SetEmptyBar(),this.Canvas.fillStyle=this.Color,s=!0}else{var C=this.Width*GetDevicePixelRatio()+e;this.SetEmptyBar(),this.Canvas.fillStyle=this.Color,s=!0}for(var u=this.Data.DataOffset,D=0;u<this.Data.Data.length&&D<r;++u,++D,n+=e+a){var d=this.Data.Data[u];if(null!=d){var c=d.Value,m=d.Value2;null==m&&(m=0);var f=this.ChartFrame.GetXFromIndex(D),v=this.ChartFrame.GetYFromData(c),S=this.ChartFrame.GetYFromData(m);if(f>i)break;if(s)if(t){var T=f-C/2,I=C;this.IsEmptyBar()?(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(Math.min(v,S)),ToFixedPoint(T),ToFixedRect(Math.abs(v-S)),ToFixedRect(I)),this.Canvas.stroke()):this.Canvas.fillRect(ToFixedRect(Math.min(v,S)),ToFixedRect(T),ToFixedRect(Math.abs(v-S)),ToFixedRect(I))}else{(T=f-C/2)+(I=C)>i&&(I=i-T),this.IsEmptyBar()?(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(T),ToFixedPoint(Math.min(v,S)),ToFixedRect(I),ToFixedRect(Math.abs(v-S))),this.Canvas.stroke()):this.Canvas.fillRect(ToFixedRect(T),ToFixedRect(Math.min(v,S)),ToFixedRect(I),ToFixedRect(Math.abs(v-S)))}else if(o)this.IsEmptyBar()?t?(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(Math.min(v,S)),ToFixedPoint(n),ToFixedRect(Math.abs(v-S)),ToFixedRect(e)),this.Canvas.stroke()):(this.Canvas.beginPath(),this.Canvas.rect(ToFixedPoint(n),ToFixedPoint(Math.min(v,S)),ToFixedRect(e),ToFixedRect(Math.abs(v-S))),this.Canvas.stroke()):t?this.Canvas.fillRect(ToFixedRect(Math.min(v,S)),ToFixedRect(n),ToFixedRect(Math.abs(v-S)),ToFixedRect(e)):this.Canvas.fillRect(ToFixedRect(n),ToFixedRect(Math.min(v,S)),ToFixedRect(e),ToFixedRect(Math.abs(v-S)));else if(t)this.Canvas.beginPath(),this.Canvas.moveTo(v,ToFixedPoint(f)),this.Canvas.lineTo(S,ToFixedPoint(f)),this.Canvas.stroke();else{var F=parseInt(f.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(F,v),this.Canvas.lineTo(F,S),this.Canvas.stroke()}}}this.Canvas.restore()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={Min:null,Max:null};if(!this.Data||!this.Data.Data)return e;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r){var n=r.Value2;if(null==n&&(n=0),null!=r&&!isNaN(r.Value)&&!isNaN(n)){var s=Math.max(r.Value,n),o=Math.min(r.Value,n);null==e.Max&&(e.Max=s),null==e.Min&&(e.Min=o),e.Max<s&&(e.Max=s),e.Min>o&&(e.Min=o)}}}return e}}function ChartText(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartText",this.TextFont="14px 微软雅黑",this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var t=this.ChartBorder.GetRight();this.ChartFrame.XPointCount;for(var e in this.Data.Data){var a=this.Data.Data[e];if(null!=a){var i=a.Value;if("Left"==a.Position){var r=this.ChartFrame.GetXFromIndex(0),n=this.ChartFrame.GetYFromData(i);if(r>t)continue;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a.Color,this.Canvas.font=this.TextFont,this.Canvas.fillText(a.Message,r,n)}}}}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var t={Min:null,Max:null};if(!this.Data||!this.Data.Data)return t;for(var e in this.Data.Data){var a=this.Data.Data[e];if(null!=a&&!isNaN(a.Value)){var i=a.Value;null==t.Max&&(t.Max=i),null==t.Min&&(t.Min=i),t.Max<i&&(t.Max=i),t.Min>i&&(t.Min=i)}}return t}}function ChartSingleText(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartSingleText",this.Color="rgb(255,193,37)",this.TextFont="14px 微软雅黑",this.Text,this.TextAlign="left",this.Direction=0,this.YOffset=0,this.Position,this.IconFont,this.IconSize={Max:g_JSChartResource.DRAWICON.Icon.MaxSize,Min:g_JSChartResource.DRAWICON.Icon.MinSize,Zoom:{Type:g_JSChartResource.DRAWICON.Icon.Zoom.Type,Value:g_JSChartResource.DRAWICON.Icon.Zoom.Value}},this.TextSize={Max:g_JSChartResource.DRAWICON.Text.MaxSize,Min:g_JSChartResource.DRAWICON.Text.MinSize,Zoom:{Type:g_JSChartResource.DRAWICON.Text.Zoom.Type,Value:g_JSChartResource.DRAWICON.Text.Zoom.Value},FontName:g_JSChartResource.DRAWICON.Text.FontName},this.ReloadResource=function(t){"DRAWTEXT"==this.Name&&(this.TextSize={Max:g_JSChartResource.DRAWTEXT.MaxSize,Min:g_JSChartResource.DRAWTEXT.MinSize,Zoom:{Type:g_JSChartResource.DRAWTEXT.Zoom.Type,Value:g_JSChartResource.DRAWTEXT.Zoom.Value},FontName:g_JSChartResource.DRAWTEXT.FontName})},this.SuperGetMaxMin=this.GetMaxMin,this.GetMaxMin=function(){return"DRAWTEXT_FIX"==this.Name||"DRAWNUMBER_FIX"==this.Name?{Min:null,Max:null}:this.SuperGetMaxMin()},this.Draw=function(){if(this.IsShow)if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Position)this.DrawPosition();else if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetRight(),r=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetBottomEx();t&&(i=this.ChartBorder.GetBottom(),r=this.ChartBorder.GetRightEx(),n=this.ChartBorder.GetLeftEx());var s=this.ChartFrame.XPointCount,o=Array.isArray(this.Text),h=GetDevicePixelRatio();if(1==this.Direction?this.Canvas.textBaseline="bottom":2==this.Direction?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",this.IconFont){this.Color=this.IconFont.Color,this.Text=this.IconFont.Text;var l=this.GetDynamicIconSize(e,a,this.IconSize.Max,this.IconSize.Min,this.IconSize.Zoom);this.Canvas.font=l+"px "+this.IconFont.Family}else this.TextFont=this.GetDynamicFont(e,a,this.TextSize.Max,this.TextSize.Min,this.TextSize.Zoom,this.TextSize.FontName),this.Canvas.font=this.TextFont;for(var C=this.Data.DataOffset,u=0;C<this.Data.Data.length&&u<s;++C,++u){var D=this.Data.Data[C];if(null!=D){var d=this.ChartFrame.GetXFromIndex(u),c=this.ChartFrame.GetYFromData(D);if(d>i)break;if(this.Canvas.textAlign=this.TextAlign,this.Canvas.fillStyle=this.Color,this.YOffset>0&&this.Direction>0){var m=c;this.Canvas.save(),this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?(1==this.Direction?(c=r-this.YOffset*h,m+=5*h):(c=n+this.YOffset*h,m-=5*h),this.Canvas.moveTo(ToFixedPoint(m),ToFixedPoint(d)),this.Canvas.lineTo(ToFixedPoint(c),ToFixedPoint(d))):(1==this.Direction?(c=r+this.YOffset*h,m+=5*h):(c=n-this.YOffset*h,m-=5*h),this.Canvas.moveTo(ToFixedPoint(d),ToFixedPoint(m)),this.Canvas.lineTo(ToFixedPoint(d),ToFixedPoint(c))),this.Canvas.stroke(),this.Canvas.restore()}if(o){var f=this.Text[C];if(!f)continue;"DRAWNUMBER"==this.Name&&(1==this.Direction?c-=4*h:2==this.Direction&&(c+=4*h)),this.DrawText(f,d,c,t)}else this.DrawText(this.Text,d,c,t)}}}},this.DrawPosition=function(){if(this.Text){var t=!0===this.ChartFrame.IsHScreen;if(t)var e=this.ChartBorder.GetRightEx()-this.ChartBorder.GetWidthEx()*this.Position.Y,a=this.ChartBorder.GetTop()+this.ChartBorder.GetHeight()*this.Position.X;else a=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*this.Position.X,e=this.ChartBorder.GetTopEx()+this.ChartBorder.GetHeightEx()*this.Position.Y;if(this.Canvas.fillStyle=this.Color,0==this.Position.Type?this.Canvas.textAlign="left":1==this.Position.Type?this.Canvas.textAlign="right":this.Canvas.textAlign="center",1==this.Direction?this.Canvas.textBaseline="bottom":2==this.Direction?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",Array.isArray(this.Text)){if(!this.Data||!this.Data.Data)return;for(var i=this.ChartFrame.XPointCount,r=this.Data.DataOffset,n=0;r<this.Data.Data.length&&n<i;++r,++n){var s=this.Text[r];if(s){this.DrawText(s,a,e,t);break}}}else this.DrawText(this.Text,a,e,t)}},this.DrawText=function(t,e,a,i){i?(this.Canvas.save(),this.Canvas.translate(a,e),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(t,0,0),this.Canvas.restore()):this.Canvas.fillText(t,e,a)}}function ChartStraightLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartStraightLine",this.Color="rgb(255,193,37)",this.Draw=function(){if(this.Data&&this.Data.Data&&1==this.Data.Data.length){this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight();var t=this.ChartFrame.XPointCount,e=this.Data.Data[0],a=this.ChartFrame.GetYFromData(e),i=this.ChartFrame.GetXFromIndex(0),r=this.ChartFrame.GetXFromIndex(t-1),n=parseInt(a.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(i,n),this.Canvas.lineTo(r,n),this.Canvas.strokeStyle=this.Color,this.Canvas.stroke()}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var t={Min:null,Max:null};return this.Data&&this.Data.Data?1!=this.Data.Data.length?t:(t.Min=this.Data.Data[0],t.Max=this.Data.Data[0],t):t}}function ChartStraightArea(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartStraightArea",this.Color="rgb(255,193,37)",this.Font="11px 微软雅黑",this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data)if(!0!==this.ChartFrame.IsHScreen){this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),this.ChartBorder.GetBottom();var t=this.ChartBorder.GetLeft(),e=this.ChartFrame.XPointCount,a=this.ChartFrame.GetXFromIndex(e-1);for(var i in this.Data.Data){let e=this.Data.Data[i];if(null==e||isNaN(e.Value)||isNaN(e.Value2))continue;if(null==e.Color)continue;let s=Math.max(e.Value,e.Value2),o=Math.min(e.Value,e.Value2);var r=this.ChartFrame.GetYFromData(s),n=this.ChartFrame.GetYFromData(o);if(this.Canvas.fillStyle=e.Color,this.Canvas.fillRect(ToFixedRect(t),ToFixedRect(r),ToFixedRect(a-t),ToFixedRect(n-r)),e.Title&&e.TitleColor){this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=e.TitleColor,this.Canvas.font=this.Font;let t=r+(n-r)/2;this.Canvas.fillText(e.Title,a,t)}}}else this.HScreenDraw()},this.HScreenDraw=function(){var t=this.ChartBorder.GetBottom(),e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetHeight();for(var i in this.Data.Data){let h=this.Data.Data[i];if(null==h||isNaN(h.Value)||isNaN(h.Value2))continue;if(null==h.Color)continue;let l=Math.max(h.Value,h.Value2),C=Math.min(h.Value,h.Value2);var r=this.ChartFrame.GetYFromData(l),n=this.ChartFrame.GetYFromData(C);if(this.Canvas.fillStyle=h.Color,this.Canvas.fillRect(ToFixedRect(n),ToFixedRect(e),ToFixedRect(r-n),ToFixedRect(a)),h.Title&&h.TitleColor){var s=r+(n-r)/2,o=t;this.Canvas.save(),this.Canvas.translate(s,o),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=h.TitleColor,this.Canvas.font=this.Font,this.Canvas.fillText(h.Title,0,-2),this.Canvas.restore()}}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var t={Min:null,Max:null};if(!this.Data||!this.Data.Data)return t;for(let e in this.Data.Data){let a=this.Data.Data[e];if(null==a||isNaN(a.Value)||isNaN(a.Value2))continue;let i=Math.max(a.Value,a.Value2),r=Math.min(a.Value,a.Value2);null==t.Max&&(t.Max=i),null==t.Min&&(t.Min=r),t.Max<i&&(t.Max=i),t.Min>r&&(t.Min=r)}return t}}function ChartMinutePriceLine(){this.newMethod=ChartLine,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinutePriceLine",this.YClose,this.IsDrawArea=!0,this.AreaColor="rgba(0,191,255,0.1)",this.SourceData,this.IsShowLead=!1,this.LeadData,this.UpColor=g_JSChartResource.UpBarColor,this.DownColor=g_JSChartResource.DownBarColor,this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.IsShow){var t=!0===this.ChartFrame.IsHScreen;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight();!0===t&&this.ChartBorder.GetBottom();var e=this.ChartFrame.XPointCount,a=this.ChartFrame.MinuteCount,i=this.ChartBorder.GetBottomEx(),r=this.ChartBorder.GetLeftEx(),n=this.Data,s=!1;if(this.SourceData&&(n=this.SourceData,s=!0),this.IsShowLead&&this.DrawLead(),n){var o=!0,h={},l={},C=0;if(n.Period="00",n.Data.length>0){debug&&console.log(n.DataOffset,window.chartdata[n.Period].DataOffset);var u=Math.max(0,n.Data.length-a),D=u-(window.chartdata[n.Period]?window.chartdata[n.Period].DataOffset:u);!window.chartdata[n.Period]&&(window.chartdata[n.Period]={}),0==n.DataOffset&&(n.DataOffset=D<0||D>3?window.chartdata[n.Period].DataOffset:u),this.Canvas.canvas.JSChartContainer.Frame.Data.DataOffset=window.chartdata[n.Period].DataOffset=n.DataOffset}debug&&console.log("ChartMinutePriceLine",n.Data.length,a,n.DataOffset,this);for(var d=n.DataOffset,c=0;d<n.Data.length&&c<e;++d,++c){var m=null;if(s){var f=n.Data[d];m=f.Before?f.Before.Close:f.Close}else m=n.Data[d];if(null!=m){var v=this.ChartFrame.GetXFromIndex(c),S=this.ChartFrame.GetYFromData(m);o?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(S,v):this.Canvas.moveTo(v,S),o=!1,h={X:v,Y:S}):t?this.Canvas.lineTo(S,v):this.Canvas.lineTo(v,S),l.X=v,l.Y=S,l.Price=m,++C>=a&&(o=!0,this.Canvas.stroke(),this.IsDrawArea&&(t?(this.Canvas.lineTo(r,v),this.Canvas.lineTo(r,h.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),i,this.ChartBorder.GetLeftEx(),i)):(this.Canvas.lineTo(v,i),this.Canvas.lineTo(h.X,i),this.SetFillStyle(this.AreaColor,r,this.ChartBorder.GetTopEx(),r,i)),this.Canvas.fill()),C=0)}}if(C>0&&(this.Canvas.stroke(),this.IsDrawArea&&(t?(this.Canvas.lineTo(r,v),this.Canvas.lineTo(r,h.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),i,this.ChartBorder.GetLeftEx(),i)):(this.Canvas.lineTo(v,i),this.Canvas.lineTo(h.X,i),this.SetFillStyle(this.AreaColor,r,this.ChartBorder.GetTopEx(),r,i)),this.Canvas.fill())),this.HQChart){var T=this.HQChart.GetEventCallback(JSCHART_EVENT_ID.ON_DRAW_MINUTE_LAST_POINT);if(T){n={LastPoint:{X:l.X,Y:l.Y},Price:l.Price};T.Callback(T,n,this)}}}}},this.DrawLead=function(){if(this.LeadData){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.XPointCount,a=this.ChartFrame.MinuteCount,i=(this.ChartBorder.GetBottomEx(),this.ChartBorder.GetTopEx());if(!0===t&&(i=this.ChartBorder.GetRightEx()),!(e>a)){for(var r=[],n=null,s=null,o=this.ChartFrame.GetYFromData(this.YClose),h=(o-i)/3,l=this.LeadData,C=l.DataOffset,u=0;C<l.Data.length&&u<e;++C,++u){var D=l.Data[C];if(IFrameSplitOperator.IsNumber(D)&&0!=D){var d=this.ChartFrame.GetXFromIndex(u);(null==n||n<D)&&(n=D),(null==s||s>D)&&(s=D),r.push({X:d,Value:D})}}if(!(r.length<=0)){var c=Math.max(Math.abs(n),Math.abs(s));for(var C in r){var m=r[C];m.Value>0?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;var f=o-m.Value*h/c;d=ToFixedPoint(m.X);this.Canvas.beginPath(),!0===t?(this.Canvas.moveTo(o,d),this.Canvas.lineTo(f,d)):(this.Canvas.moveTo(d,o),this.Canvas.lineTo(d,f)),this.Canvas.stroke()}}}}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={};if(null==this.YClose)return e;if(!this.IsShow)return e;e.Min=this.YClose,e.Max=this.YClose;var a=this.Data,i=!1;this.SourceData&&(a=this.SourceData,i=!0);for(var r=a.DataOffset,n=0;r<a.Data.length&&n<t;++r,++n){var s=null;if(i){var o=a.Data[r];s=o.Before?o.Before.Close:o.Close}else s=a.Data[r];null!=s&&(null==e.Max&&(e.Max=s),null==e.Min&&(e.Min=s),e.Max<s&&(e.Max=s),e.Min>s&&(e.Min=s))}if(e.Max==this.YClose&&e.Min==this.YClose)return e.Max=this.YClose+.1*this.YClose,e.Min=this.YClose-.1*this.YClose,e;var h=Math.max(Math.abs(this.YClose-e.Max),Math.abs(this.YClose-e.Min));return e.Max=this.YClose+h,e.Min=this.YClose-h,e}}function ChartOverlayMinutePriceLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.Color="rgb(65,105,225)",this.MainData,this.MainYClose,this.SourceData,this.BeforeDataCount=0,this.IsBeforeData=!1,this.ClassName="ChartOverlayMinutePriceLine",this.Title,this.Symbol,this.YClose,this.Status=OVERLAY_STATUS_ID.STATUS_NONE_ID,this.Draw=function(){if(this.Data)if(this.NotSupportMessage)this.DrawNotSupportmessage();else{var t=!0===this.ChartFrame.IsHScreen;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight();!0===t&&this.ChartBorder.GetBottom();var e=this.ChartFrame.XPointCount,a=this.ChartFrame.MinuteCount,i=!0,r=0,n=0;this.IsBeforeData&&(n=1);for(var s=this.Data.DataOffset+n,o=0;s<this.Data.Data.length&&o<e;++s,++o){var h=this.Data.Data[s].Close;if(null!=h){var l=h/this.YClose*this.MainYClose,C=this.ChartFrame.GetXFromIndex(o+this.BeforeDataCount),u=this.ChartFrame.GetYFromData(l);i?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),t?this.Canvas.moveTo(u,C):this.Canvas.moveTo(C,u),i=!1):t?this.Canvas.lineTo(u,C):this.Canvas.lineTo(C,u),++r>=a&&(i=!0,this.Canvas.stroke(),r=0)}}r>0&&this.Canvas.stroke()}},this.GetMaxMin=function(){var t=this.ChartFrame.XPointCount,e={};if(null==this.YClose)return e;e.Min=this.MainYClose,e.Max=this.MainYClose;for(var a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){if(null!=(r=this.Data.Data[a].Close)){var r=r/this.YClose*this.MainYClose;null==e.Max&&(e.Max=r),null==e.Min&&(e.Min=r),e.Max<r&&(e.Max=r),e.Min>r&&(e.Min=r)}}if(e.Max==this.MainYClose&&e.Min==this.MainYClose)return e.Max=this.MainYClose+.1*this.MainYClose,e.Min=this.MainYClose-.1*this.MainYClose,e;var n=Math.max(Math.abs(this.MainYClose-e.Max),Math.abs(this.MainYClose-e.Min));return e.Max=this.MainYClose+n,e.Min=this.MainYClose-n,e}}function ChartMinuteInfo(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteInfo",this.Data=new Map,this.SourceData,this.ChartMinutePrice,this.YClose,this.HQChartBorder,this.TextColor=g_JSChartResource.MinuteInfo.TextColor,this.Font=g_JSChartResource.MinuteInfo.Font,this.PointColor=g_JSChartResource.MinuteInfo.PointColor,this.LineColor=g_JSChartResource.MinuteInfo.LineColor,this.TextBGColor=g_JSChartResource.MinuteInfo.TextBGColor,this.PixelTatio=GetDevicePixelRatio(),this.TextHeight=20,this.TextRectCache=[],this.InfoDrawCache=[],this.FrameBottom,this.FrameTop,this.FrameLeft,this.FrameRight,this.YOffset=5,this.IsHScreen=!1,this.IsDrawFull=!1,this.TooltipRect=[],this.SetOption=function(t){t.TextColor&&(this.TextColor=t.TextColor),t.TextBGColor&&(this.TextBGColor=t.TextBGColor),t.Font&&(this.Font=t.Font),t.PointColor&&(this.PointColor=t.PointColor),t.LineColor&&(this.LineColor=t.LineColor),t.TextHeight>0&&(this.TextHeight=t.TextHeight),1==t.IsDrawFull&&(this.IsDrawFull=!0)},this.Draw=function(){if(this.TooltipRect=[],this.ChartMinutePrice&&this.Data&&!(this.Data.size<=0)){this.TextRectCache=[],this.InfoDrawCache=[],this.PixelTatio=GetDevicePixelRatio(),this.YOffset=5*this.PixelTatio,this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount;this.ChartFrame.MinuteCount;this.FrameBottom=this.ChartBorder.GetBottom(),this.IsDrawFull&&this.HQChartBorder&&(this.FrameBottom=this.HQChartBorder.GetBottom()),this.FrameTop=this.ChartBorder.GetTop(),this.FrameLeft=this.ChartBorder.GetLeft(),this.FrameRight=this.ChartBorder.GetRight(),this.IsHScreen&&(this.FrameRight=this.ChartBorder.GetBottom(),this.FrameLeft=this.ChartBorder.GetTop(),this.FrameBottom=this.ChartBorder.GetLeft(),this.FrameTop=this.ChartBorder.GetRight()),this.YClose=this.ChartMinutePrice.YClose;var e=this.ChartMinutePrice.Data,a=!1;this.ChartMinutePrice.SourceData&&(e=this.ChartMinutePrice.SourceData,a=!0);for(var i=e.DataOffset,r=0;i<e.Data.length&&r<t;++i,++r){var n=this.SourceData.Data[i];if((!a||!n.Before)&&n){var s=n.DateTime;this.Data.has(s)&&(this.IsHScreen?this.CalcuateInfoHScreenPosition(this.Data.get(s),r,n):this.CalcuateInfoPosition(this.Data.get(s),r,n))}}for(var i in this.InfoDrawCache){n=this.InfoDrawCache[i];this.DrawInfoLines(n)}for(var i in this.InfoDrawCache){n=this.InfoDrawCache[i];if(this.DrawInfoText(n),!this.IsHScreen){var o=n.Border,h={Data:{Item:n},Rect:new Rect(o.X,o.Y,o.Width,o.Height)};this.TooltipRect.push(h)}}this.TextRectCache=[],this.InfoDrawCache=[]}},this.CalcuateInfoPosition=function(t,e,a){if(t&&t.Data&&!(t.Data.length<=0)){var i=t.Data[0];this.Canvas.font=this.Font;var r,n=this.Canvas.measureText(i.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(e);r=IFrameSplitOperator.IsNumber(i.Price)?this.ChartFrame.GetYFromData(i.Price):this.ChartFrame.GetYFromData(a.Close);var h=(o=ToFixedPoint(o))<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,l=[2,4,6,8,3,5,7],C=s+l[e%l.length]*this.PixelTatio,u={Y:[{Value:r+(s+this.YOffset),Offset:C},{Value:r-(2*s+this.YOffset),Offset:-C}]};a.Close<this.YClose&&(u.Y=u.Y.reverse());var D={X:o,Y:null,Width:n,Height:s};h||(D.X-=D.Width),this.FixTextRect(D,u);var d={Border:D,Start:{X:o,Y:r},IsLeft:h,Title:i.Title,Date:i.Date,Time:i.Time};i.Content&&(d.Content=i.Content),i.Link&&(d.Link=i.Link),i.Color&&(d.Color=i.Color),i.BGColor&&(d.BGColor=i.BGColor),this.InfoDrawCache.push(d),this.TextRectCache.push(D)}},this.CalcuateInfoHScreenPosition=function(t,e,a){if(t&&t.Data&&!(t.Data.length<=0)){var i=t.Data[0];this.Canvas.font=this.Font;var r,n=this.Canvas.measureText(i.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(e);r=IFrameSplitOperator.IsNumber(i.Price)?this.ChartFrame.GetYFromData(i.Price):this.ChartFrame.GetYFromData(a.Close);var h=(o=ToFixedPoint(o))<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,l=[2,4,6,8,3,5,7],C=s+l[e%l.length]*this.PixelTatio,u={X:[{Value:r+(s+this.YOffset),Offset:C},{Value:r-(2*s+this.YOffset),Offset:-C}]};a.Close>this.YClose&&(u.X=u.X.reverse());var D={X:null,Y:o,Width:s,Height:n};h||(D.Y-=D.Height),this.FixHScreenTextRect(D,u);var d={Border:D,Start:{X:r,Y:o},IsLeft:h,Title:i.Title};this.InfoDrawCache.push(d),this.TextRectCache.push(D)}},this.DrawInfoLines=function(t){var e=t.Border,a=t.IsLeft;this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(t.Start.X),t.Start.Y),a?this.Canvas.lineTo(ToFixedPoint(t.Start.X),e.Y):this.IsHScreen?this.Canvas.lineTo(e.X,e.Y+e.Height):this.Canvas.lineTo(ToFixedPoint(t.Start.X),e.Y),this.Canvas.stroke(),this.Canvas.fillStyle=this.PointColor,this.Canvas.beginPath(),this.Canvas.arc(t.Start.X,t.Start.Y,5,0,2*Math.PI),this.Canvas.closePath(),this.Canvas.fill()},this.DrawInfoText=function(t){var e=t.Border,a=e.X,i=e.Y;t.BGColor?this.Canvas.fillStyle=t.BGColor:this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(a,i,e.Width,e.Height),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.rect(a,i,e.Width,e.Height),this.Canvas.stroke(),this.IsHScreen&&(this.Canvas.save(),this.Canvas.translate(e.X,e.Y),this.Canvas.rotate(90*Math.PI/180),a=0,i=0),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",t.Color?this.Canvas.fillStyle=t.Color:this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.IsHScreen?this.Canvas.fillText(t.Title,a+2*this.PixelTatio,i-e.Width/2):this.Canvas.fillText(t.Title,a+2*this.PixelTatio,i+e.Height/2),this.IsHScreen&&this.Canvas.restore()},this.FixTextRect=function(t,e){for(var a in e.Y){var i,r=e.Y[a];t.Y=r.Value;for(var n=0;n<10;++n){var s=!1;for(var o in this.TextRectCache){var h=this.TextRectCache[o];if(this.IsOverlap(h,t)){s=!0;break}}if(0==s)return;if(i=t.Y,(i+=r.Offset)+t.Height>this.FrameBottom||i<this.FrameTop)break;t.Y=i}}},this.FixHScreenTextRect=function(t,e){for(var a in e.X){var i,r=e.X[a];t.X=r.Value;for(var n=0;n<10;++n){var s=!1;for(var o in this.TextRectCache){var h=this.TextRectCache[o];if(this.IsOverlap(h,t)){s=!0;break}}if(0==s)return;if(i=t.X,(i+=r.Offset)+t.Width<this.FrameBottom||i>this.FrameTop)break;t.X=i}}},this.IsOverlap=function(t,e){return t.X+t.Width>e.X&&e.X+e.Width>t.X&&t.Y+t.Height>e.Y&&e.Y+e.Height>t.Y},this.GetMaxMin=function(){return{Min:null,Max:null}},this.GetTooltipData=function(t,e,a){for(var i in this.TooltipRect){var r=this.TooltipRect[i];if(r.Rect){var n=r.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.X,n.Y,n.Width,n.Height),this.Canvas.isPointInPath(t,e))return a.Data=r,a.ChartPaint=this,a.Type=3,!0}}return!1}}function ChartMACD(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartMACD",this.UpColor=g_JSChartResource.UpBarColor,this.DownColor=g_JSChartResource.DownBarColor,this.LineWidth=1,this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else if(!0!==this.ChartFrame.IsHScreen){var t=this.ChartFrame.DataWidth,e=(this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight()),a=this.ChartFrame.XPointCount,i=this.GetLockRect();i&&(e=i.Left);var r=this.ChartFrame.GetYFromData(0),n=this.LineWidth*GetDevicePixelRatio();50==this.LineWidth?n=t:n>t&&(n=t);var s=this.Canvas.lineWidth;this.Canvas.lineWidth=n;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<a;++o,++h){var l=this.Data.Data[o];if(null!=l){var C=this.ChartFrame.GetXFromIndex(h),u=this.ChartFrame.GetYFromData(l);if(C>e)break;var D=parseInt(C.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(D,r),this.Canvas.lineTo(D,u),this.Canvas.strokeStyle=l>=0?this.UpColor:this.DownColor,this.Canvas.stroke(),this.Canvas.closePath()}}this.Canvas.lineWidth=s}else this.HScreenDraw()},this.HScreenDraw=function(){var t=this.ChartFrame.DataWidth,e=(this.ChartFrame.DistanceWidth,this.ChartBorder.GetBottom()),a=this.ChartFrame.XPointCount,i=this.GetLockRect();i&&(e=i.Top);var r=this.ChartFrame.GetYFromData(0),n=this.LineWidth*GetDevicePixelRatio();50==this.LineWidth?n=t:n>t&&(n=t);var s=this.Canvas.lineWidth;this.Canvas.lineWidth=n;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<a;++o,++h){var l=this.Data.Data[o];if(null!=l){var C=this.ChartFrame.GetXFromIndex(h),u=this.ChartFrame.GetYFromData(l);if(C>e)break;this.Canvas.beginPath(),this.Canvas.moveTo(r,ToFixedPoint(C)),this.Canvas.lineTo(u,ToFixedPoint(C)),this.Canvas.strokeStyle=l>=0?this.UpColor:this.DownColor,this.Canvas.stroke(),this.Canvas.closePath()}}this.Canvas.lineWidth=s}}function ChartBar(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartBar",this.UpBarColor=g_JSChartResource.UpBarColor,this.DownBarColor=g_JSChartResource.DownBarColor,this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else{var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetRight(),i=this.ChartFrame.XPointCount,r=this.ChartBorder.GetLeft()+e/2+2,n=this.ChartFrame.GetYFromData(0);if(t>=4){n=ToFixedRect(n);for(var s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<i;++s,++o,r+=t+e){if(null!=(D=this.Data.Data[s])&&0!=D){var h=r;if(r+t>a)break;var l=this.ChartFrame.GetXFromIndex(o),C=this.ChartFrame.GetYFromData(D);this.Canvas.fillStyle=D>0?this.UpBarColor:this.DownBarColor;var u=ToFixedRect(Math.abs(n-C));C=n-C>0?n-u:n+u,this.Canvas.fillRect(ToFixedRect(h),C,ToFixedRect(t),u)}}}else for(s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<i;++s,++o,r+=t+e){var D;if(null!=(D=this.Data.Data[s])&&0!=D){h=r;if(r+t>a)break;l=this.ChartFrame.GetXFromIndex(o),C=this.ChartFrame.GetYFromData(D);this.Canvas.strokeStyle=D>0?this.UpBarColor:this.DownBarColor,this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(l),C),this.Canvas.lineTo(ToFixedPoint(l),n),this.Canvas.stroke()}}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:0,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];null==e.Max&&(e.Max=r),e.Max<r&&(e.Max=r)}return e}}function ChartBand(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartBand",this.FirstColor=g_JSChartResource.Index.LineColor[0],this.SecondColor=g_JSChartResource.Index.LineColor[1],this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else for(var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+2,r=0,n=0,s=0,o=[],h=[],l=this.Data.DataOffset,C=0;l<this.Data.Data.length&&C<a;++l,++C,i+=t+e){for(o=[],h=[];l<this.Data.Data.length&&C<a;++l,++C,i+=t+e){var u=this.Data.Data[l];if(null==u||null==u.Value||null==u.Value2)break;r=this.ChartFrame.GetXFromIndex(C),n=this.ChartFrame.GetYFromData(u.Value),s=this.ChartFrame.GetYFromData(u.Value2),o.push({x:r,y:n}),h.push({x:r,y:s})}o.length>1&&h.length>1&&this.DrawBand(o,h)}},this.DrawBand=function(t,e){this.Canvas.save(),this.Canvas.beginPath();for(var a=0;a<t.length;++a)0==a?this.Canvas.moveTo(t[a].x,t[a].y):this.Canvas.lineTo(t[a].x,t[a].y);for(a=e.length-1;a>=0;--a)this.Canvas.lineTo(e[a].x,e[a].y);this.Canvas.closePath(),this.Canvas.clip(),this.Canvas.moveTo(t[0].x,this.ChartBorder.GetBottom());for(a=0;a<t.length;++a)this.Canvas.lineTo(t[a].x,t[a].y);this.Canvas.lineTo(t[t.length-1].x,this.ChartBorder.GetBottom()),this.Canvas.closePath(),this.Canvas.fillStyle=this.FirstColor,this.Canvas.fill(),this.Canvas.beginPath(),this.Canvas.moveTo(e[0].x,this.ChartBorder.GetBottom());for(a=0;a<e.length;++a)this.Canvas.lineTo(e[a].x,e[a].y);this.Canvas.lineTo(e[e.length-1].x,this.ChartBorder.GetBottom()),this.Canvas.closePath(),this.Canvas.fillStyle=this.SecondColor,this.Canvas.fill(),this.Canvas.restore()},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r&&null!=r.Value&&null!=r.Value2){var n=r.Value>r.Value2?r.Value:r.Value2,s=r.Value<r.Value2?r.Value:r.Value2;null==e.Max?e.Max=n:e.Max<n&&(e.Max=n),null==e.Min?e.Min=s:e.Min>s&&(e.Min=s)}}return e}}function ChartLineArea(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartLineArea",this.Color="rgb(56,67,99)",this.IsHScreen=!1,this.Draw=function(){if(this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){for(var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+g_JSChartResource.FrameLeftMargin,r=0,n=0,s=0,o=[],h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<a;++h,++l,i+=t+e){var C=this.Data.Data[h];o[h]=null,null!=C&&null!=C.Value&&null!=C.Value2&&(r=this.ChartFrame.GetXFromIndex(l),n=this.ChartFrame.GetYFromData(C.Value),s=this.ChartFrame.GetYFromData(C.Value2),this.IsHScreen?o[h]={Line:{X:n,Y:r},Line2:{X:s,Y:r}}:o[h]={Line:{X:r,Y:n},Line2:{X:r,Y:s}})}this.Canvas.fillStyle=this.Color;var u=!0,D=0,d=[];for(var h in o){var c=o[h];if(c)u?(this.Canvas.beginPath(),this.Canvas.moveTo(c.Line.X,c.Line.Y),u=!1):this.Canvas.lineTo(c.Line.X,c.Line.Y),d.push(c),++D;else{if(D>0){for(l=d.length-1;l>=0;--l){var m=d[l];this.Canvas.lineTo(m.Line2.X,m.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}u=!0,D=0,d=[]}}if(D>0){for(l=d.length-1;l>=0;--l){m=d[l];this.Canvas.lineTo(m.Line2.X,m.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(r&&null!=r.Value&&null!=r.Value2){var n=r.Value>r.Value2?r.Value:r.Value2,s=r.Value<r.Value2?r.Value:r.Value2;null==e.Max?e.Max=n:e.Max<n&&(e.Max=n),null==e.Min?e.Min=s:e.Min>s&&(e.Min=s)}}return e}}function ChartFillRGN(){this.newMethod=ChartLineArea,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.IsHScreen=!1,this.ClassName="ChartFillRGN",this.DrawRGB=function(t){var e=!0,a=0,i=[],r=null;for(var n in t){var s=t[n];if(!s||r&&s.Color!=r){if(a>0){for(var o=i.length-1;o>=0;--o){var h=i[o];this.Canvas.lineTo(h.Line2.X,h.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=r,this.Canvas.fill()}e=!0,a=0,i=[],r=null}s&&(e?(this.Canvas.beginPath(),this.Canvas.moveTo(s.Line.X,s.Line.Y),e=!1,r=s.Color):this.Canvas.lineTo(s.Line.X,s.Line.Y),i.push(s),++a)}if(a>0){for(o=i.length-1;o>=0;--o){h=i[o];this.Canvas.lineTo(h.Line2.X,h.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=r,this.Canvas.fill()}},this.Draw=function(){if(this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){for(var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+g_JSChartResource.FrameLeftMargin,r=0,n=0,s=0,o=[],h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<a;++h,++l,i+=t+e){var C=this.Data.Data[h];o[h]=null,null!=C&&null!=C.Value&&null!=C.Value2&&C.Color&&(r=this.ChartFrame.GetXFromIndex(l),n=this.ChartFrame.GetYFromData(C.Value),s=this.ChartFrame.GetYFromData(C.Value2),this.IsHScreen?o[h]={Line:{X:n,Y:r},Line2:{X:s,Y:r},Color:C.Color}:o[h]={Line:{X:r,Y:n},Line2:{X:r,Y:s},Color:C.Color})}this.DrawRGB(o)}}}function ChartFLOATRGN(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!1,this.ClassName="ChartFLOATRGN",this.Color="rgb(56,67,99)",this.IsHScreen=!1,this.Draw=function(){if(this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data){for(var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+g_JSChartResource.FrameLeftMargin,r=0,n=0,s=0,o=[],h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<a;++h,++l,i+=t+e){var C=this.Data.Data[h];o[h]=null,C&&IFrameSplitOperator.IsNumber(C.Value)&&IFrameSplitOperator.IsNumber(C.Value2)&&C.Color&&(r=this.ChartFrame.GetXFromIndex(l),n=this.ChartFrame.GetYFromData(C.Value),this.IsHScreen?o[h]={Line:{X:n,Y:r},Line2:{X:n+C.Value2*GetDevicePixelRatio(),Y:r},Color:C.Color}:o[h]={Line:{X:r,Y:n},Line2:{X:r,Y:n-C.Value2*GetDevicePixelRatio()},Color:C.Color})}var u=null;for(var h in o){C=o[h];if(u&&C)if(this.IsHScreen){var D=C.Line.Y-u.Line.Y;r=u.Line.Y+D/2,n=u.Line.X+(C.Line.X-u.Line.X)/2,s=u.Line2.X+(C.Line2.X-u.Line2.X)/2,u.RightLine={X:n,Y:r},u.RightLine2={X:s,Y:r},C.LeftLine={X:n,Y:r},C.LeftLine2={X:s,Y:r}}else{D=C.Line.X-u.Line.X;r=u.Line.X+D/2,n=u.Line.Y+(C.Line.Y-u.Line.Y)/2,s=u.Line2.Y+(C.Line2.Y-u.Line2.Y)/2,u.RightLine={X:r,Y:n},u.RightLine2={X:r,Y:s},C.LeftLine={X:r,Y:n},C.LeftLine2={X:r,Y:s}}u=C}this.DrawRGB(o)}},this.DrawRGB=function(t){var e=!0,a=0,i=[],r=null;if(this.IsHScreen)var n=this.ChartBorder.GetLeftEx(),s=this.ChartBorder.GetRightEx(),o=this.ChartBorder.GetTop(),h=this.ChartBorder.GetBottom();else n=this.ChartBorder.GetLeft(),s=this.ChartBorder.GetRight(),o=this.ChartBorder.GetTopEx(),h=this.ChartBorder.GetBottomEx();for(var l in this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(n,o,s-n,h-o),this.Canvas.clip(),t){var C=t[l];if(!C||r&&C.Color!=r){if(a>0){var u=i[i.length-1],D=i[0];u.RightLine&&(this.Canvas.lineTo(u.RightLine.X,u.RightLine.Y),this.Canvas.lineTo(u.RightLine2.X,u.RightLine2.Y));for(var d=i.length-1;d>=0;--d){var c=i[d];this.Canvas.lineTo(c.Line2.X,c.Line2.Y)}D.LeftLine2&&this.Canvas.lineTo(D.LeftLine2.X,D.LeftLine2.Y),this.Canvas.closePath(),this.Canvas.fillStyle=r,this.Canvas.fill()}e=!0,a=0,i=[],r=null}C&&(e?(this.Canvas.beginPath(),C.LeftLine?(this.Canvas.moveTo(C.LeftLine.X,C.LeftLine.Y),this.Canvas.lineTo(C.Line.X,C.Line.Y)):this.Canvas.moveTo(C.Line.X,C.Line.Y),e=!1,r=C.Color):this.Canvas.lineTo(C.Line.X,C.Line.Y),i.push(C),++a)}if(a>0){u=i[i.length-1],D=i[0];u.RightLine&&(this.Canvas.lineTo(u.RightLine.X,u.RightLine.Y),this.Canvas.lineTo(u.RightLine2.X,u.RightLine2.Y));for(d=i.length-1;d>=0;--d){c=i[d];this.Canvas.lineTo(c.Line2.X,c.Line2.Y)}D.LeftLine2&&this.Canvas.lineTo(D.LeftLine2.X,D.LeftLine2.Y),this.Canvas.closePath(),this.Canvas.fillStyle=r,this.Canvas.fill()}this.Canvas.restore()},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(r&&IFrameSplitOperator.IsNumber(r.Value)){var n=r.Value;null==e.Max?e.Max=n:e.Max<n&&(e.Max=n),null==e.Min?e.Min=n:e.Min>n&&(e.Min=n)}}return e}}function ChartFillBGRGN(){this.newMethod=ChartFillRGN,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.IsHScreen=!1,this.ClassName="ChartFillBGRGN",this.DrawVerticalRGN=function(){for(var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+g_JSChartResource.FrameLeftMargin,r=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetBottomEx(),s=[],o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<a;++o,++h,i+=t+e){var l=this.Data.Data[o];s[o]=null,l&&l.Color&&(x=this.ChartFrame.GetXFromIndex(h),this.IsHScreen?s[o]={Line:{X:r,Y:x},Line2:{X:n,Y:x},Color:l.Color}:s[o]={Line:{X:x,Y:r},Line2:{X:x,Y:n},Color:l.Color})}this.DrawRGB(s)},this.Draw=function(){if(this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.NotSupportMessage)this.DrawNotSupportmessage();else if(this.Data&&this.Data.Data)if("FILLVERTICALRGN"!=this.Name){var t=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount,i=this.ChartBorder.GetLeft()+e/2+g_JSChartResource.FrameLeftMargin,r=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetBottomEx(),s=0,o=0,h=r;"FILLBOTTOMRGN"==this.Name&&(h=n);for(var l=[],C=this.Data.DataOffset,u=0;C<this.Data.Data.length&&u<a;++C,++u,i+=t+e){var D=this.Data.Data[C];l[C]=null,null!=D&&null!=D.Value&&D.Color&&(s=this.ChartFrame.GetXFromIndex(u),o=this.ChartFrame.GetYFromData(D.Value),this.IsHScreen?l[C]={Line:{X:o,Y:s},Line2:{X:h,Y:s},Color:D.Color}:l[C]={Line:{X:s,Y:o},Line2:{X:s,Y:h},Color:D.Color})}this.DrawRGB(l)}else this.DrawVerticalRGN()},this.DrawRGB=function(t){var e=this.ChartFrame.DataWidth,a=(this.ChartFrame.DistanceWidth+e)/2,i=!0,r=0,n=[],s=null;for(var o in t){var h=t[o];if(!h||s&&h.Color!=s){if(r>0){for(var l=n.length-1;l>=0;--l){var C=n[l];this.Canvas.lineTo(C.Line2.X+a,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-a,C.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=s,this.Canvas.fill()}i=!0,r=0,n=[],s=null}h&&(i?(this.Canvas.beginPath(),this.Canvas.moveTo(h.Line.X-a,h.Line.Y),this.Canvas.lineTo(h.Line.X+a,h.Line.Y),i=!1,s=h.Color):(this.Canvas.lineTo(h.Line.X-a,h.Line.Y),this.Canvas.lineTo(h.Line.X+a,h.Line.Y)),n.push(h),++r)}if(r>0){for(l=n.length-1;l>=0;--l){C=n[l];this.Canvas.lineTo(C.Line2.X+a,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-a,C.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=s,this.Canvas.fill()}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){if((r=this.Data.Data[a])&&null!=r.Value){var r=r.Value;null==e.Max?e.Max=r:e.Max<r&&(e.Max=r),null==e.Min?e.Min=r:e.Min>r&&(e.Min=r)}}return e}}function ChartChannel(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartChannel",this.IsHScreen=!1,this.PointCount=0,this.DataWidth=0,this.DistanceWidth=0,this.ChartRight=0,this.LineColor="RGB(255,0,0)",this.LineDotted=[3,3],this.AreaColor="RGB(255,222,173)",this.LineWidth=1,this.CalculateData=function(){for(var t=[],e=[],a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<this.PointCount;++a,++i){var r=this.Data.Data[a];if(r&&IFrameSplitOperator.IsNumber(r.Value)&&IFrameSplitOperator.IsNumber(r.Value2)){var n=this.ChartFrame.GetXFromIndex(i);if(n>this.ChartRight)break;var s=this.ChartFrame.GetYFromData(r.Value),o=this.ChartFrame.GetYFromData(r.Value2);e.push({X:n,Y:s,Y2:o})}else e.length>0&&(t.push(e),e=[])}return e.length>0&&t.push(e),t},this.DrawArea=function(t){if(!(t.length<=0)){this.Canvas.beginPath();var e=t[0];this.IsHScreen?this.Canvas.moveTo(e.Y,e.X):this.Canvas.moveTo(e.X,e.Y);for(var a=1;a<t.length;++a){var i=t[a];this.IsHScreen?this.Canvas.lineTo(i.Y,i.X):this.Canvas.lineTo(i.X,i.Y),0}for(a=t.length-1;a>=0;--a){i=t[a];this.IsHScreen?this.Canvas.lineTo(i.Y2,i.X):this.Canvas.lineTo(i.X,i.Y2),0}this.Canvas.closePath(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.fill()}},this.DrawLine=function(t){this.Canvas.strokeStyle=this.LineColor;for(var e=0;e<2;++e){for(var a=!0,i=0,r=0;r<t.length;++r){var n=t[r];a?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(0===e?n.Y:n.Y2,n.X):this.Canvas.moveTo(n.X,0===e?n.Y:n.Y2),a=!1):this.IsHScreen?this.Canvas.lineTo(0===e?n.Y:n.Y2,n.X):this.Canvas.lineTo(n.X,0===e?n.Y:n.Y2),++i}i>0&&this.Canvas.stroke()}},this.Draw=function(){if(this.NotSupportMessage)this.DrawNotSupportmessage();else{this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.PointCount=this.ChartFrame.XPointCount,this.DataWidth=this.ChartFrame.DataWidth,this.DistanceWidth=this.ChartFrame.DistanceWidth,this.IsHScreen?this.ChartRight=this.ChartBorder.GetBottom():this.ChartRight=this.ChartBorder.GetRight();var t=this.CalculateData();if(t&&!(t.length<=0)){this.Canvas.save(),this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio(),this.Canvas.setLineDash(this.LineDotted);for(var e=0;e<t.length;++e){var a=t[e];this.DrawArea(a),this.DrawLine(a)}this.Canvas.restore()}}},this.GetMaxMin=function(){for(var t=this.ChartFrame.XPointCount,e={Min:null,Max:null},a=this.Data.DataOffset,i=0;a<this.Data.Data.length&&i<t;++a,++i){var r=this.Data.Data[a];if(null!=r&&null!=r.Value&&null!=r.Value2){var n=r.Value>r.Value2?r.Value:r.Value2,s=r.Value<r.Value2?r.Value:r.Value2;null==e.Max?e.Max=n:e.Max<n&&(e.Max=n),null==e.Min?e.Min=s:e.Min>s&&(e.Min=s)}}return e}}function ChartBackground(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartBackground",this.Color=null,this.ColorAngle=0,this.IsDrawFirst=!0,this.Draw=function(){if(this.IsShow&&this.Color&&!(this.Color.length<=0)){if(this.IsHScreen=!0===this.ChartFrame.IsHScreen,2==this.Color.length){if(this.IsHScreen)if(0==this.ColorAngle)var t={X:this.ChartBorder.GetRight(),Y:this.ChartBorder.GetTopEx()},e={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()};else t={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},e={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetBottomEx()};else if(0==this.ColorAngle)t={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},e={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetBottomEx()};else t={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},e={X:this.ChartBorder.GetRight(),Y:this.ChartBorder.GetTopEx()};let a=this.Canvas.createLinearGradient(t.X,t.Y,e.X,e.Y);a.addColorStop(0,this.Color[0]),a.addColorStop(1,this.Color[1]),this.Canvas.fillStyle=a}else{if(1!=this.Color.length)return;this.Canvas.fillStyle=this.Color[0]}if("DRAWGBK2"!=this.Name&&"KLINE_BG"!=this.Name){if(this.IsHScreen)var a=this.ChartBorder.GetLeftEx(),i=this.ChartBorder.GetTop(),r=this.ChartBorder.GetWidthEx(),n=this.ChartBorder.GetHeight();else a=this.ChartBorder.GetLeft(),i=this.ChartBorder.GetTopEx(),r=this.ChartBorder.GetWidth(),n=this.ChartBorder.GetHeightEx();this.Canvas.fillRect(a,i,r,n)}else this.DrawRegion()}},this.DrawRegion=function(){var t=this.ChartFrame.XPointCount,e=this.ChartBorder.GetLeft()+i/2+g_JSChartResource.FrameLeftMargin,a=this.ChartFrame.DataWidth,i=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetBottomEx();this.IsHScreen&&(r=this.ChartBorder.GetRightEx(),n=this.ChartBorder.GetLeftEx());for(var s=[],o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<t;++o,++h,e+=a+i){var l=this.Data.Data[o];if(s[o]=null,IFrameSplitOperator.IsNumber(l)&&!(l<=0)){var C=this.ChartFrame.GetXFromIndex(h);this.ChartFrame.GetYFromData(l.Value);this.IsHScreen?s[o]={Line:{X:n,Y:C},Line2:{X:r,Y:C}}:s[o]={Line:{X:C,Y:r},Line2:{X:C,Y:n}}}}this.DrawBG(s)},this.DrawBG=function(t){var e=this.ChartFrame.DataWidth,a=(this.ChartFrame.DistanceWidth+e)/2,i=!0,r=0,n=[],s=null;for(var o in t){var h=t[o];if(!h||s&&h.Color!=s){if(r>0){for(var l=n.length-1;l>=0;--l){var C=n[l];this.IsHScreen?(this.Canvas.lineTo(C.Line2.X,C.Line2.Y+a),this.Canvas.lineTo(C.Line2.X,C.Line2.Y-a)):(this.Canvas.lineTo(C.Line2.X+a,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-a,C.Line2.Y))}this.Canvas.closePath(),this.Canvas.fill()}i=!0,r=0,n=[],s=null}h&&(i?(this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(h.Line.X,h.Line.Y-a),this.Canvas.lineTo(h.Line.X,h.Line.Y+a)):(this.Canvas.moveTo(h.Line.X-a,h.Line.Y),this.Canvas.lineTo(h.Line.X+a,h.Line.Y)),i=!1,s=h.Color):this.IsHScreen?(this.Canvas.lineTo(h.Line.X,h.Line.Y-a),this.Canvas.lineTo(h.Line.X,h.Line.Y+a)):(this.Canvas.lineTo(h.Line.X-a,h.Line.Y),this.Canvas.lineTo(h.Line.X+a,h.Line.Y)),n.push(h),++r)}if(r>0){for(l=n.length-1;l>=0;--l){C=n[l];this.IsHScreen?(this.Canvas.lineTo(C.Line2.X,C.Line2.Y+a),this.Canvas.lineTo(C.Line2.X,C.Line2.Y-a)):(this.Canvas.lineTo(C.Line2.X+a,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-a,C.Line2.Y))}this.Canvas.closePath(),this.Canvas.fill()}},this.GetMaxMin=function(){return{Min:null,Max:null}}}function ChartRectangle(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartRectangle",this.Color=[],this.Rect,this.BorderColor=g_JSChartResource.FrameBorderPen,this.Draw=function(){if(this.IsShow&&this.Color&&this.Rect&&!(this.Color.length<=0)){this.Canvas.strokeStyle=this.BorderColor;var t=!1;if(2==this.Color.length)this.Canvas.fillStyle=this.Color[0],t=!0;else{if(1!=this.Color.length)return;this.Color[0]&&(this.Canvas.fillStyle=this.Color[0],t=!0)}var e=this.ChartBorder.GetWidth(),a=this.ChartBorder.GetHeightEx(),i=this.Rect.Left/1e3*e,r=this.Rect.Top/1e3*a,n=this.Rect.Right/1e3*e,s=this.Rect.Bottom/1e3*a;i=this.ChartBorder.GetLeft()+i,r=this.ChartBorder.GetTopEx()+r,n=this.ChartBorder.GetLeft()+n,s=this.ChartBorder.GetTopEx()+s;var o=Math.abs(i-n),h=Math.abs(r-s);t&&this.Canvas.fillRect(i,r,o,h),this.Canvas.rect(ToFixedPoint(i),ToFixedPoint(r),ToFixedRect(o),ToFixedRect(h)),this.Canvas.stroke()}}}function ChartTextLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartTextLine",this.Text,this.Line,this.Price,this.Draw=function(){if(this.IsShow&&this.Text&&this.Line&&IFrameSplitOperator.IsNumber(this.Price)){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottomEx(),i=this.ChartBorder.GetTopEx(),r=this.ChartFrame.GetYFromData(this.Price),n=0;if(this.Text.Title){var s=t+2*GetDevicePixelRatio(),o=r;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var h=8*GetDevicePixelRatio();r-h<i?(this.Canvas.textBaseline="top",o=i):r+h>a&&(this.Canvas.textBaseline="bottom",o=a),this.Canvas.fillStyle=this.Text.Color,this.Canvas.font=this.Text.Font,this.Canvas.fillText(this.Text.Title,s,o),n=this.Canvas.measureText(this.Text.Title).width+4*GetDevicePixelRatio()}if(this.Line.Type>0){2==this.Line.Type&&(this.Canvas.save(),this.Canvas.setLineDash([3,5]));s=t+n;this.Canvas.strokeStyle=this.Line.Color,this.Canvas.beginPath(),this.Canvas.moveTo(s,ToFixedPoint(r)),this.Canvas.lineTo(e,ToFixedPoint(r)),this.Canvas.stroke(),2==this.Line.Type&&this.Canvas.restore()}}},this.GetMaxMin=function(){var t={Min:null,Max:null};return IFrameSplitOperator.IsNumber(this.Price)&&(t.Min=this.Price,t.Max=this.Price),t}}function ChartMultiBar(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiBar",this.Bars=[],this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=this.ChartFrame.DataWidth,i=GetDevicePixelRatio(),r=[];for(var n in this.Bars){var s={Point:[],Color:(d=this.Bars[n]).Color,Width:a,Type:0};for(var o in d.Type>0&&(s.Type=d.Type),d.Width>0?(s.Width=d.Width*i,s.Width>a&&(s.Width=a)):s.Width<4&&(s.Width=1*i),d.Point){var h=d.Point[o];if(IFrameSplitOperator.IsNumber(h.Index)){var l=h.Index-e;if(l>=0&&l<t){var C=this.ChartFrame.GetXFromIndex(l),u=this.ChartFrame.GetYFromData(h.Value),D=this.ChartFrame.GetYFromData(h.Value2);s.Point.push({X:C,Y:u,Y2:D})}}}s.Point.length>0&&r.push(s)}for(var n in r){var d;(d=r[n]).Width>=4?1==d.Type?this.DrawHollowBar(d):this.DrawFillBar(d):this.DrawLineBar(d)}}},this.DrawLineBar=function(t){this.Canvas.strokeStyle=t.Color;var e=this.Canvas.lineWidth;for(var a in this.Canvas.lineWidth=t.Width,t.Point){var i=t.Point[a];this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(ToFixedPoint(i.Y),ToFixedPoint(i.X)),this.Canvas.lineTo(ToFixedPoint(i.Y2),ToFixedPoint(i.X))):(this.Canvas.moveTo(ToFixedPoint(i.X),ToFixedPoint(i.Y)),this.Canvas.lineTo(ToFixedPoint(i.X),ToFixedPoint(i.Y2))),this.Canvas.stroke()}this.Canvas.lineWidth=e},this.DrawFillBar=function(t){for(var e in this.Canvas.fillStyle=t.Color,t.Point){var a=t.Point[e],i=a.X-t.Width/2,r=Math.min(a.Y,a.Y2),n=t.Width,s=Math.abs(a.Y-a.Y2);this.IsHScreen?this.Canvas.fillRect(ToFixedRect(r),ToFixedRect(i),ToFixedRect(s),ToFixedRect(n)):this.Canvas.fillRect(ToFixedRect(i),ToFixedRect(r),ToFixedRect(n),ToFixedRect(s))}},this.DrawHollowBar=function(t){this.Canvas.strokeStyle=t.Color;for(var e in t.Point){var a=t.Point[e],i=a.X-t.Width/2,r=Math.min(a.Y,a.Y2),n=t.Width,s=Math.abs(a.Y-a.Y2);this.Canvas.beginPath(),this.IsHScreen?this.Canvas.rect(ToFixedPoint(r),ToFixedPoint(i),ToFixedRect(s),ToFixedRect(n)):this.Canvas.rect(ToFixedPoint(i),ToFixedPoint(r),ToFixedRect(n),ToFixedRect(s)),this.Canvas.stroke()}this.Canvas.lineWidth=1},this.GetMaxMin=function(){var t={Min:null,Max:null},e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Bars){var n=this.Bars[r];for(var s in n.Point){var o=n.Point[s];if(o.Index>=a&&o.Index<i){var h=Math.min(o.Value,o.Value2),l=Math.max(o.Value,o.Value2);null==t.Max?t.Max=l:t.Max<l&&(t.Max=l),null==t.Min?t.Min=h:t.Min>h&&(t.Min=h)}}}return t}}function ChartMultiLine(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiLine",this.Lines=[],this.LineDash,this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=[];for(var i in this.Lines){var r=this.Lines[i],n={Point:[],Color:r.Color};for(var s in r.BGColor&&(n.BGColor=r.BGColor),r.Point){var o=r.Point[s];if(IFrameSplitOperator.IsNumber(o.Index)){var h=o.Index-e;if(h>=0&&h<t){var l=this.ChartFrame.GetXFromIndex(h),C=this.ChartFrame.GetYFromData(o.Value);n.Point.push({X:l,Y:C,End:!1})}else n.Point.length>0&&(n.Point[n.Point.length-1].End=!0)}}n.Point.length>=2&&a.push(n)}for(var i in this.Canvas.save(),this.LineDash&&this.Canvas.setLineDash(this.LineDash),a){var u=a[i];this.DrawLine(u)}this.Canvas.restore()}},this.DrawLine=function(t){if(t.BGColor){for(var e in this.Canvas.fillStyle=t.BGColor,t.Point){var a=t.Point[e];0==e?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(a.Y,a.X):this.Canvas.moveTo(a.X,a.Y)):this.IsHScreen?this.Canvas.lineTo(a.Y,a.X):this.Canvas.lineTo(a.X,a.Y)}this.Canvas.closePath(),this.Canvas.fill()}this.Canvas.strokeStyle=t.Color;var i=0;for(var e in t.Point){a=t.Point[e];0==i?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(a.Y,a.X):this.Canvas.moveTo(a.X,a.Y),++i):(this.IsHScreen?this.Canvas.lineTo(a.Y,a.X):this.Canvas.lineTo(a.X,a.Y),++i),1==a.End&&(i>0&&this.Canvas.stroke(),i=0)}i>0&&this.Canvas.stroke()},this.GetMaxMin=function(){var t={Min:null,Max:null},e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Lines){var n=this.Lines[r];for(var s in n.Point){var o=n.Point[s];o.Index>=a&&o.Index<i&&(null==t.Max?t.Max=o.Value:t.Max<o.Value&&(t.Max=o.Value),null==t.Min?t.Min=o.Value:t.Min>o.Value&&(t.Min=o.Value))}}return t}}function ChartMultiText(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiText",this.Texts=[],this.Font=g_JSChartResource.DefaultTextFont,this.Color=g_JSChartResource.DefaultTextColor,this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)&&this.Texts){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=this.ChartBorder.GetLeft(),i=this.ChartBorder.GetRight();for(var r in this.IsHScreen&&(a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom()),this.Texts){var n=this.Texts[r];if(n.Text&&IFrameSplitOperator.IsNumber(n.Index)){var s=n.Index-e;if(s>=0&&s<t){var o=this.ChartFrame.GetXFromIndex(s),h=this.ChartFrame.GetYFromData(n.Value);n.Color?this.Canvas.fillStyle=n.Color:this.Canvas.fillStyle=this.Color,n.Font?this.Canvas.font=n.Font:this.Canvas.font=this.Font;var l=this.Canvas.measureText(n.Text).width;if(this.Canvas.textAlign="center",o+l/2>=i?(this.Canvas.textAlign="right",o=i):o-l/2<a&&(this.Canvas.textAlign="left",o=a),1==n.Baseline?this.Canvas.textBaseline="top":2==n.Baseline?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(h,o),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(n.Text,0,0),this.Canvas.restore()):this.Canvas.fillText(n.Text,o,h),n.Line){var C=this.Data.Data[n.Index],u="H"==n.Line.KData?C.High:C.Low,D=this.ChartFrame.GetYFromData(u),d=h;Array.isArray(n.Line.Offset)&&2==n.Line.Offset.length&&(d>D?(d-=n.Line.Offset[1],D+=n.Line.Offset[0]):d<D&&(d+=n.Line.Offset[1],D-=n.Line.Offset[0])),this.Canvas.save(),n.Line.Dash&&this.Canvas.setLineDash(n.Line.Dash),n.Line.Width>0&&(this.Canvas.lineWidth=n.Line.Width),this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(o),d),this.Canvas.lineTo(ToFixedPoint(o),D),this.Canvas.stroke(),this.Canvas.restore()}}}}}},this.GetMaxMin=function(){var t={Min:null,Max:null};if(!this.Texts)return t;var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Texts){var n=this.Texts[r];n.Index>=a&&n.Index<i&&(null==t.Max?t.Max=n.Value:t.Max<n.Value&&(t.Max=n.Value),null==t.Min?t.Min=n.Value:t.Min>n.Value&&(t.Min=n.Value))}return t}}function ChartMultiSVGIcon(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiSVGIcon",this.Icon,this.IconSize={Max:g_JSChartResource.DRAWICON.Icon.MaxSize,Min:g_JSChartResource.DRAWICON.Icon.MinSize,Zoom:{Type:g_JSChartResource.DRAWICON.Icon.Zoom.Type,Value:g_JSChartResource.DRAWICON.Icon.Zoom.Value}},this.Family,this.Color=g_JSChartResource.DefaultTextColor,this.IsHScreen=!1,this.Draw=function(){if(this.IsShow&&this.Data&&!(this.Data.length<=0)&&this.Family&&this.Icon){this.IsHScreen=!0===this.ChartFrame.IsHScreen;var t=this.ChartFrame.XPointCount,e=this.Data.DataOffset,a=this.ChartBorder.GetLeft(),i=this.ChartBorder.GetRight();this.DataWidth=this.ChartFrame.DataWidth,this.DistanceWidth=this.ChartFrame.DistanceWidth,this.IsHScreen&&(a=this.ChartBorder.GetTop(),i=this.ChartBorder.GetBottom());var r=this.GetDynamicIconSize(this.DataWidth,this.DistanceWidth,this.IconSize.Max,this.IconSize.Min,this.IconSize.Zoom);for(var n in this.Canvas.font=r+"px "+this.Family,this.Icon){var s=this.Icon[n];if(IFrameSplitOperator.IsNumber(s.Index)){var o=s.Index-e;if(o>=0&&o<t){var h=this.ChartFrame.GetXFromIndex(o),l=this.ChartFrame.GetYFromData(s.Value);s.Color?this.Canvas.fillStyle=s.Color:this.Canvas.fillStyle=this.Color;var C=this.Canvas.measureText(s.Text).width;this.Canvas.textAlign="center",h+C/2>=i?(this.Canvas.textAlign="right",h+=this.DataWidth/2):h-C/2<a&&(this.Canvas.textAlign="left",h-=this.DataWidth/2),1==s.Baseline?this.Canvas.textBaseline="top":2==s.Baseline?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(l,h),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(s.Symbol,0,0),this.Canvas.restore()):this.Canvas.fillText(s.Symbol,h,l)}}}}},this.GetMaxMin=function(){var t={Min:null,Max:null},e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,i=a+e;for(var r in this.Icon){var n=this.Icon[r];n.Index>=a&&n.Index<i&&(null==t.Max?t.Max=n.Value:t.Max<n.Value&&(t.Max=n.Value),null==t.Min?t.Min=n.Value:t.Min>n.Value&&(t.Min=n.Value))}return t}}function ChartLock(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="ChartLock",this.WidthDiv=.2,this.LockCount=20,this.BGColor=g_JSChartResource.LockBGColor,this.TextColor=g_JSChartResource.LockTextColor,this.Font=g_JSChartResource.DefaultTextFont,this.Title="🔒开通权限",this.LockRect=null,this.LockID,this.Callback,this.IndexName,this.MinWidth=null,this.Draw=function(t){if(this.LockRect=null,this.NotSupportMessage)this.DrawNotSupportmessage();else if(!0!==this.ChartFrame.IsHScreen){var e=this.ChartBorder.GetRight(),a=0;if(null!=this.ChartFrame.Data){var i=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth;e=this.ChartBorder.GetLeft()+r/2+2;for(var n=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount,o=this.ChartFrame.Data.DataOffset,h=0;o<this.ChartFrame.Data.Data.length&&h<s;++o,++h,e+=i+r){var l=this.ChartFrame.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){if(e+i>n)break}}a=(i+r)*this.LockCount}0==a&&(a=(e-this.ChartBorder.GetLeft())*this.WidthDiv);var C=e-a;C<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft());var u=this.ChartBorder.GetBottom()-this.ChartBorder.GetTop(),D=this.ChartBorder.GetRight()-C;if(this.MinWidth>10&&D<this.MinWidth&&(D=this.MinWidth,(C=this.ChartBorder.GetRight()-D)<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft())),t){this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(C,this.ChartBorder.GetTop(),D,u);var d=C+D/2,c=this.ChartBorder.GetTop()+u/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,d,c)}this.LockRect={Left:C,Top:this.ChartBorder.GetTop(),Width:D,Heigh:u}}else this.HScreenDraw(t)},this.HScreenDraw=function(t){var e=this.ChartBorder.GetBottom(),a=0;if(null!=this.ChartFrame.Data){var i=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth;e=this.ChartBorder.GetTop()+r/2+2;for(var n=this.ChartBorder.GetBottom(),s=this.ChartFrame.XPointCount,o=this.ChartFrame.Data.DataOffset,h=0;o<this.ChartFrame.Data.Data.length&&h<s;++o,++h,e+=i+r){var l=this.ChartFrame.Data.Data[o];if(null!=l.Open&&null!=l.High&&null!=l.Low&&null!=l.Close){if(e+i>n)break}}a=(i+r)*this.LockCount}0==a&&(a=(e-this.ChartBorder.GetTop())*this.WidthDiv);var C=e-a;C<this.ChartBorder.GetTop()&&(C=this.ChartBorder.GetTop());var u=this.ChartBorder.GetRight()-this.ChartBorder.GetLeft(),D=this.ChartBorder.GetBottom()-C;this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(this.ChartBorder.GetLeft(),C,u,D);var d=this.ChartBorder.GetLeft()+u/2,c=C+D/2;this.Canvas.save(),this.Canvas.translate(d,c),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,0,0),this.Canvas.restore(),this.LockRect={Left:this.ChartBorder.GetLeft(),Top:C,Width:u,Heigh:D}},this.GetTooltipData=function(t,e,a){return null!=this.LockRect&&(this.Canvas.beginPath(),this.Canvas.rect(this.LockRect.Left,this.LockRect.Top,this.LockRect.Width,this.LockRect.Heigh),!!this.Canvas.isPointInPath(t,e)&&(a.Data={ID:this.LockID,Callback:this.Callback,IndexName:this.IndexName},a.ChartPaint=this,!0))}}function ChartBuySell(){this.newMethod=ChartSingleText,this.newMethod(),delete this.newMethod,this.ClassName="ChartBuySell",this.TextFont=g_JSChartResource.KLineTrain.Font,this.LastDataIcon=g_JSChartResource.KLineTrain.LastDataIcon,this.BuyIcon=g_JSChartResource.KLineTrain.BuyIcon,this.SellIcon=g_JSChartResource.KLineTrain.SellIcon,this.BuySellData=new Map,this.IconFont=g_JSChartResource.KLineTrain.IconFont,this.AddTradeItem=function(t){this.BuySellData.has(t.Key)?this.BuySellData.get(t.Key).Data.push(t):this.BuySellData.set(t.Key,{Data:[t]})},this.ClearTradeData=function(){this.BuySellData=new Map},this.Draw=function(){if(this.Data&&this.Data.Data){var t=!0===this.ChartFrame.IsHScreen,e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,i=this.ChartBorder.GetRight();!0===t&&(i=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount;if(this.IconFont){var n=e+a,s=18*GetDevicePixelRatio();n<s&&(n=s),this.Canvas.font=n+"px "+this.IconFont.Family}else this.Canvas.font=this.TextFont;for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<r;++o,++h){var l=this.Data.Data[o];if(null!=l){if((C=this.ChartFrame.GetXFromIndex(h))>i)break;if(o==this.Data.Data.length-1){var C=this.ChartFrame.GetXFromIndex(h),u=this.ChartFrame.GetYFromData(l.High);this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Last.Color,this.DrawText(this.IconFont.Last.Text,C,u,t)):(this.Canvas.fillStyle=this.LastDataIcon.Color,this.Canvas.font=this.TextFont,this.DrawText(this.LastDataIcon.Text,C,u,t))}var D=o;if(this.BuySellData.has(D)){var d=this.BuySellData.get(D),c=(u=this.ChartFrame.GetYFromData(l.High),this.ChartFrame.GetYFromData(l.Low)),m=[!1,!1];for(var f in d.Data){if(1==m[0]&&1==m[1])break;var v=d.Data[f];0==v.Op&&0==m[0]?(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Buy.Color,this.DrawText(this.IconFont.Buy.Text,C,c,t)):(this.Canvas.fillStyle=this.BuyIcon.Color,this.DrawText(this.BuyIcon.Text,C,c,t)),m[0]=!0):1==v.Op&&0==m[1]&&(this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Sell.Color,this.DrawText(this.IconFont.Sell.Text,C,u,t)):(this.Canvas.fillStyle=this.SellIcon.Color,this.DrawText(this.SellIcon.Text,C,u,t)),m[1]=!0)}}}}}}}function ChartPie(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.Radius=100,this.Distance=30,this.txtLine=20,this.paddingX=20/3,this.Draw=function(){if(!(this.Data&&this.Data.Data&&this.Data.Data.length>0))return this.DrawEmptyData();this.ChartBorder.GetLeft(),this.ChartBorder.GetRight(),this.ChartBorder.GetTop(),this.ChartBorder.GetBottom();let t=this.ChartBorder.GetWidth(),e=this.ChartBorder.GetHeight();if(isNaN(this.Radius)){let a=this.Radius.replace("%","");a/=100,t>=e&&(this.Radius=a*e),t<e&&(this.Radius=a*t)}this.Canvas.save(),this.Canvas.translate(t/2,e/2);let a=0;for(var i in this.Data.Data)a+=this.Data.Data[i].Value;let r=0,n=0;for(var i in this.Data.Data){let t=this.Data.Data[i],e=(t.Value/a).toFixed(2);this.Canvas.beginPath(),this.Canvas.moveTo(0,0),n+=2*e*Math.PI,this.Canvas.strokeStyle="white",this.Canvas.fillStyle=t.Color,this.Canvas.arc(0,0,this.Radius,r,n),this.Canvas.fill(),this.Canvas.closePath(),this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.strokeStyle=t.Color,this.Canvas.moveTo(0,0);let s=(this.Radius+this.Distance)*Math.cos(n-(n-r)/2),o=(this.Radius+this.Distance)*Math.sin(n-(n-r)/2);this.Canvas.lineTo(s,o);let h=this.txtLine,l=this.paddingX;if(this.Canvas.textAlign="left",n-(n-r)/2<1.5*Math.PI&&n-(n-r)/2>.5*Math.PI&&(h=-this.txtLine,l=-this.paddingX,this.Canvas.textAlign="right"),this.Canvas.lineTo(s+h,o),this.Canvas.stroke(),t.Text)this.Canvas.fillText(t.Text,s+h+l,o);else{let e=`${t.Name}:${t.Value}`;this.Canvas.fillText(e,s+h+l,o)}r+=2*e*Math.PI}this.Canvas.restore()},this.DrawEmptyData=function(){JSConsole.Chart.Log("[ChartPie::DrawEmptyData]")}}function ChartRadar(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.BorderPoint=[],this.DataPoint=[],this.CenterPoint={},this.StartAngle=0,this.Color="rgb(198,198,198)",this.AreaColor="rgba(242,154,118,0.4)",this.AreaLineColor="rgb(242,154,118)",this.TitleFont=24*GetDevicePixelRatio()+"px 微软雅黑",this.TitleColor="rgb(102,102,102)",this.BGColor=["rgb(255,255,255)","rgb(224,224,224)"],this.DrawBorder=function(){if(this.BorderPoint.length<=0)return;this.Canvas.font=this.TitleFont,this.Canvas.strokeStyle=this.Color;const t=[1,.8,.6,.4,.2];for(let n in t){var e=t[n],a=!0;for(var i in this.BorderPoint){(r=this.BorderPoint[i]).X=this.CenterPoint.X+r.Radius*Math.cos(r.Angle*Math.PI/180)*e,r.Y=this.CenterPoint.Y+r.Radius*Math.sin(r.Angle*Math.PI/180)*e,a?(this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),a=!1):this.Canvas.lineTo(r.X,r.Y)}this.Canvas.closePath(),this.Canvas.stroke(),this.Canvas.fillStyle=this.BGColor[n%2==0?0:1],this.Canvas.fill()}for(var i in this.Canvas.beginPath(),this.BorderPoint){var r;(r=this.BorderPoint[i]).X=this.CenterPoint.X+r.Radius*Math.cos(r.Angle*Math.PI/180),r.Y=this.CenterPoint.Y+r.Radius*Math.sin(r.Angle*Math.PI/180),this.Canvas.moveTo(this.CenterPoint.X,this.CenterPoint.Y),this.Canvas.lineTo(r.X,r.Y),this.DrawText(r)}this.Canvas.stroke()},this.DrawArea=function(){if(this.DataPoint&&!(this.DataPoint.length<=0)){this.Canvas.fillStyle=this.AreaColor,this.Canvas.strokeStyle=this.AreaLineColor,this.Canvas.beginPath();var t=!0;for(var e in this.DataPoint){var a=this.DataPoint[e];t?(this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),t=!1):this.Canvas.lineTo(a.X,a.Y)}this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke()}},this.DrawText=function(t){if(t.Text){this.Canvas.fillStyle=this.TitleColor;var e=t.X,a=t.Y;t.Angle>0&&t.Angle<45?(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",e+=2):t.Angle>=0&&t.Angle<90?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",e+=2):t.Angle>=90&&t.Angle<135?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",e-=2):t.Angle>=135&&t.Angle<180?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",e-=2):t.Angle>=180&&t.Angle<225?(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",e-=2):t.Angle>=225&&t.Angle<=270?(this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom"):t.Angle>270&&t.Angle<315?(this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",e+=2):(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",e+=2),this.Canvas.fillText(t.Text,e,a)}},this.Draw=function(){this.BorderPoint=[],this.DataPoint=[],this.CenterPoint={},this.Data&&this.Data.Data&&this.Data.Data.length>0?this.CalculatePoints(this.Data.Data):this.CalculatePoints(null),this.DrawBorder(),this.DrawArea()},this.CalculatePoints=function(t){let e=this.ChartBorder.GetLeft(),a=(this.ChartBorder.GetRight(),this.ChartBorder.GetTop()),i=(this.ChartBorder.GetBottom(),this.ChartBorder.GetWidth()),r=this.ChartBorder.GetHeight(),n={X:e+i/2,Y:a+r/2},s=Math.min(i/2,r/2)-2,o=Math.max(5,t?t.length:0),h=360/o;for(var l=0;l<o;++l){let e={Index:l,Radius:s,Angle:l*h+this.StartAngle},a=e.Angle;if(t&&l<t.length){var C=t[l];let i={Index:l,Text:C.Text};if(e.Text=C.Name,C.Value){var u=C.Value;u>=1&&(u=1);var D=s*u;i.X=n.X+D*Math.cos(a*Math.PI/180),i.Y=n.Y+D*Math.sin(a*Math.PI/180)}else i.X=n.X,i.Y=n.Y;this.DataPoint.push(i)}this.BorderPoint.push(e)}this.CenterPoint=n},this.DrawEmptyData=function(){JSConsole.Chart.Log("[ChartPie::DrawEmptyData]")}}function ChartChinaMap(){this.newMethod=IChartPainting,this.newMethod(),delete this.newMethod,this.ImageData=null,this.Left,this.Top,this.Width,this.Height,this.ImageWidth,this.ImageHeight,this.DefaultColor=[217,222,239],this.Color=[{Name:"海南",Color:"rgb(217,222,223)"},{Name:"内蒙古",Color:"rgb(217,222,225)"},{Name:"新疆",Color:"rgb(217,222,226)"},{Name:"青海",Color:"rgb(217,222,227)"},{Name:"西藏",Color:"rgb(217,222,228)"},{Name:"云南",Color:"rgb(217,222,229)"},{Name:"黑龙江",Color:"rgb(217,222,230)"},{Name:"吉林",Color:"rgb(217,222,231)"},{Name:"辽宁",Color:"rgb(217,222,232)"},{Name:"河北",Color:"rgb(217,222,233)"},{Name:"山东",Color:"rgb(217,222,234)"},{Name:"江苏",Color:"rgb(217,222,235)"},{Name:"浙江",Color:"rgb(217,222,236)"},{Name:"福建",Color:"rgb(217,222,237)"},{Name:"广东",Color:"rgb(217,222,238)"},{Name:"广西",Color:"rgb(217,222,239)"},{Name:"贵州",Color:"rgb(217,222,240)"},{Name:"湖南",Color:"rgb(217,222,241)"},{Name:"江西",Color:"rgb(217,222,242)"},{Name:"安徽",Color:"rgb(217,222,243)"},{Name:"湖北",Color:"rgb(217,222,244)"},{Name:"重庆",Color:"rgb(217,222,245)"},{Name:"四川",Color:"rgb(217,222,246)"},{Name:"甘肃",Color:"rgb(217,222,247)"},{Name:"陕西",Color:"rgb(217,222,248)"},{Name:"山西",Color:"rgb(217,222,249)"},{Name:"河南",Color:"rgb(217,222,250)"}],this.Draw=function(){let t=this.ChartBorder.GetLeft()+1,e=(this.ChartBorder.GetRight(),this.ChartBorder.GetTop()+1),a=(this.ChartBorder.GetBottom(),this.ChartBorder.GetWidth()-2),i=this.ChartBorder.GetHeight()-2,r=CHINA_MAP_IMAGE.width,n=CHINA_MAP_IMAGE.height,s=r,o=n;if(i<o||a<s)this.ImageData=null;else if(this.Left==t&&this.Top==e&&this.Width==a&&this.Height==i&&this.ImageWidth==r&&this.ImageHeight==n||(this.ImageData=null,this.ImageWidth=r,this.ImageHeight=n,this.Left=t,this.Top=e,this.Width=a,this.Height=i,JSConsole.Chart.Log(r,n)),null==this.ImageData){this.Canvas.drawImage(CHINA_MAP_IMAGE,0,0,r,n,t,e,s,o),this.ImageData=this.Canvas.getImageData(t,e,s,o);let a=new Set,i=new Map,C=new Map;if(this.Data.length>0)for(var h in this.Data){let t=this.Data[h];C.set(t.Name,t.Color)}for(var h in JSConsole.Chart.Log(this.Data),this.Color){let t=this.Color[h];C.has(t.Name)?i.set(t.Color,C.get(t.Name)):a.add(t.Color)}var l;for(let t=0;t<this.ImageData.data.length;t+=4)if(l="rgb("+this.ImageData.data[t]+","+this.ImageData.data[t+1]+","+this.ImageData.data[t+2]+")",a.has(l))this.ImageData.data[t]=this.DefaultColor[0],this.ImageData.data[t+1]=this.DefaultColor[1],this.ImageData.data[t+2]=this.DefaultColor[2];else if(i.has(l)){let e=i.get(l);this.ImageData.data[t]=e[0],this.ImageData.data[t+1]=e[1],this.ImageData.data[t+2]=e[2]}this.Canvas.clearRect(t,e,s,o),this.Canvas.putImageData(this.ImageData,t,e,0,0,s,o)}else this.Canvas.putImageData(this.ImageData,t,e,0,0,s,o)}}function IExtendChartPainting(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.Data,this.IsDynamic=!1,this.IsAnimation=!1,this.ClassName="IExtendChartPainting",this.SizeChange=!0,this.IsEraseBG=!1,this.DrawAfterTitle=!1,this.IsCallbackDraw=!1,this.Left=5,this.Right=5,this.Top=5,this.Bottom=5,this.Draw=function(){},this.SetOption=function(t){}}function KLineTooltipPaint(){this.newMethod=IExtendChartPainting,this.newMethod(),delete this.newMethod,this.IsDynamic=!0,this.IsEraseBG=!0,this.DrawAfterTitle=!0,this.ClassName="KLineTooltipPaint",this.BorderColor=g_JSChartResource.TooltipPaint.BorderColor,this.BGColor=g_JSChartResource.TooltipPaint.BGColor,this.TitleColor=g_JSChartResource.TooltipPaint.TitleColor,this.Left=1*GetDevicePixelRatio(),this.Top=5*GetDevicePixelRatio(),this.Width=50,this.Height=100,this.LineHeight=15*GetDevicePixelRatio(),this.Font=[g_JSChartResource.TooltipPaint.TitleFont],this.HQChart,this.KLineTitlePaint,this.IsHScreen=!1,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.GetLeft=function(){return this.IsHScreen?this.ChartBorder.GetRightEx()-this.Height-this.Top:this.ChartBorder.GetLeft()+this.Left},this.GetTop=function(){return this.IsHScreen?this.ChartBorder.GetTop():this.ChartBorder.GetTopEx()+this.Top},this.IsEnableDraw=function(){if(!this.HQChart||!this.HQChart.TitlePaint||!this.HQChart.TitlePaint[0])return!1;if(this.HQChart.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID){if(0==this.HQChart.TouchStatus.CorssCursorShow)return!1}else if(!this.HQChart.IsOnTouch)return!1;return!this.HQChart.CurrentChartDrawPicture},this.Draw=function(){if(this.IsEnableDraw()){this.KLineTitlePaint=this.HQChart.TitlePaint[0];var t=this.KLineTitlePaint.GetCurrentKLineData();if(t){var e,a=8;this.HQChart.Symbol&&(e=this.HQChart.Symbol.toUpperCase()),"MinuteTooltipPaint"===this.ClassName?(a=7,MARKET_SUFFIX_NAME.IsFutures(e)&&++a):(IFrameSplitOperator.IsNumber(t.Time)&&++a,MARKET_SUFFIX_NAME.IsSHSZStockA(this.HQChart.Symbol)&&t.FlowCapital>0&&++a,MARKET_SUFFIX_NAME.IsFutures(e)&&IFrameSplitOperator.IsNumber(t.Position)&&++a),this.IsHScreen=!0===this.ChartFrame.IsHScreen,this.Canvas.font=this.Font[0];var i=GetfloatPrecision(this.HQChart.Symbol),r=" 擎: 9999.99亿 ";if(i>=5&&(r=` 擎: ${99.99.toFixed(i)} `),this.Width=this.Canvas.measureText(r).width,this.Height=this.LineHeight*a+2*GetDevicePixelRatio()*2,t&&t.High>0){r=` 擎: ${t.High.toFixed(i)} `;var n=this.Canvas.measureText(r).width;n>this.Width&&(this.Width=n)}this.DrawBG(),this.DrawTooltipData(t),this.DrawBorder()}}},this.DrawTooltipData=function(t){this.HQChart.Symbol&&(u=this.HQChart.Symbol.toUpperCase());var e=GetfloatPrecision(this.HQChart.Symbol),a=this.GetLeft()+2*GetDevicePixelRatio(),i=this.GetTop()+3*GetDevicePixelRatio();if(this.IsHScreen){this.Canvas.save();var r=this.GetLeft()+this.Height,n=this.GetTop();this.Canvas.translate(r,n),this.Canvas.rotate(90*Math.PI/180),a=2*GetDevicePixelRatio(),i=3*GetDevicePixelRatio()}this.Canvas.textBaseline="top",this.Canvas.textAlign="left",this.Canvas.font=this.Font[0];var s=this.Canvas.measureText("擎: ").width,o=IFrameSplitOperator.FormatDateString(t.Date);this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(o,a,i);var h=this.HQChart.Period;ChartData.IsMinutePeriod(h,!0)&&t.Time?(i+=this.LineHeight,o=IFrameSplitOperator.FormatTimeString(t.Time),this.Canvas.fillText(o,a,i)):ChartData.IsSecondPeriod(h)&&t.Time&&(i+=this.LineHeight,o=IFrameSplitOperator.FormatTimeString(t.Time,"HH:MM:SS"),this.Canvas.fillText(o,a,i)),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=g_JSChartLocalization.GetText("Tooltip-Open",this.LanguageID),this.Canvas.fillText(o,a,i);var l=this.KLineTitlePaint.GetColor(t.Open,t.YClose);o=t.Open.toFixed(e),this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=g_JSChartLocalization.GetText("Tooltip-High",this.LanguageID),this.Canvas.fillText(o,a,i);l=this.KLineTitlePaint.GetColor(t.High,t.YClose),o=t.High.toFixed(e);this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=g_JSChartLocalization.GetText("Tooltip-Low",this.LanguageID),this.Canvas.fillText(o,a,i);l=this.KLineTitlePaint.GetColor(t.Low,t.YClose),o=t.Low.toFixed(e);this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=g_JSChartLocalization.GetText("Tooltip-Close",this.LanguageID),this.Canvas.fillText(o,a,i);l=this.KLineTitlePaint.GetColor(t.Close,t.YClose),o=t.Close.toFixed(e);if(this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,o=g_JSChartLocalization.GetText("Tooltip-Increase",this.LanguageID),this.Canvas.fillText(o,a,i),t.YFClose>0&&MARKET_SUFFIX_NAME.IsChinaFutures(u)){var C=(t.Close-t.YFClose)/t.YFClose*100;l=this.KLineTitlePaint.GetColor(C,0),o=C.toFixed(2)+"%"}else if(t.YClose>0)C=(t.Close-t.YClose)/t.YClose*100,l=this.KLineTitlePaint.GetColor(C,0),o=C.toFixed(2)+"%";else o="--.--",l=this.KLineTitlePaint.GetColor(0,0);this.Canvas.fillStyle=l,this.Canvas.fillText(o,a+s,i),this.Canvas.fillStyle=this.TitleColor,i+=this.LineHeight,o=g_JSChartLocalization.GetText("Tooltip-Vol",this.LanguageID),this.Canvas.fillText(o,a,i);o=IFrameSplitOperator.FromatIntegerString(t.Vol,2,this.LanguageID);if(this.Canvas.fillText(o,a+s,i),IFrameSplitOperator.IsNumber(t.Amount)){i+=this.LineHeight,o=g_JSChartLocalization.GetText("Tooltip-Amount",this.LanguageID),this.Canvas.fillText(o,a,i);o=IFrameSplitOperator.FormatValueString(t.Amount,2,this.LanguageID);this.Canvas.fillText(o,a+s,i)}if(MARKET_SUFFIX_NAME.IsSHSZStockA(this.HQChart.Symbol)&&t.FlowCapital>0){i+=this.LineHeight,o=g_JSChartLocalization.GetText("Tooltip-Exchange",this.LanguageID),this.Canvas.fillText(o,a,i);o=(C=t.Vol/t.FlowCapital*100).toFixed(2)+"%";this.Canvas.fillText(o,a+s,i)}var u=this.HQChart.Symbol.toUpperCase();if(MARKET_SUFFIX_NAME.IsFutures(u)&&IFrameSplitOperator.IsNumber(t.Position)){this.Canvas.fillStyle=this.TitleColor,i+=this.LineHeight,o=g_JSChartLocalization.GetText("Tooltip-Position",this.LanguageID),this.Canvas.fillText(o,a,i);o=IFrameSplitOperator.FromatIntegerString(t.Position,2,this.LanguageID);this.Canvas.fillText(o,a+s,i)}this.IsHScreen&&this.Canvas.restore()},this.DrawBorder=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.GetLeft(),a=this.GetTop();this.Canvas.strokeStyle=this.BorderColor,t?this.Canvas.strokeRect(ToFixedPoint(e),ToFixedPoint(a),this.Height,this.Width):this.Canvas.strokeRect(ToFixedPoint(e),ToFixedPoint(a),this.Width,this.Height)},this.DrawBG=function(){var t=!0===this.ChartFrame.IsHScreen,e=this.GetLeft(),a=this.GetTop();this.Canvas.fillStyle=this.BGColor,t?this.Canvas.fillRect(e,a,this.Height,this.Width):this.Canvas.fillRect(e,a,this.Width,this.Height)},this.SetOption=function(t){t.LineHeight>0&&(this.LineHeight=t.LineHeight*GetDevicePixelRatio()),t.BGColor&&(this.BGColor=t.BGColor),t.LanguageID>0&&(this.LanguageID=t.LanguageID)}}function MinuteTooltipPaint(){this.newMethod=KLineTooltipPaint,this.newMethod(),delete this.newMethod,this.ClassName="MinuteTooltipPaint",this.Left=1*GetDevicePixelRatio(),this.Top=1*GetDevicePixelRatio(),this.YClose,this.GetTop=function(){return this.IsHScreen?this.ChartBorder.GetTop():this.ChartBorder.GetTop()+this.Top},this.DrawTooltipData=function(t){if(this.HQChart.Symbol){var e=GetfloatPrecision(this.HQChart.Symbol),a=this.GetLeft()+2*GetDevicePixelRatio(),i=this.GetTop()+3*GetDevicePixelRatio();this.YClose=this.KLineTitlePaint.YClose;var r=this.HQChart.Symbol.toUpperCase();if(this.IsHScreen){this.Canvas.save();var n=this.GetLeft()+this.Height,s=this.GetTop();this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180),a=2*GetDevicePixelRatio(),i=3*GetDevicePixelRatio()}this.Canvas.textBaseline="top",this.Canvas.textAlign="left",this.Canvas.font=this.Font[0];var o=this.Canvas.measureText("擎: ").width,h=t.DateTime.split(" ");if(h&&2==h.length){var l=IFrameSplitOperator.FormatDateString(h[0]);this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(l,a,i),i+=this.LineHeight,l=IFrameSplitOperator.FormatTimeString(h[1]),this.Canvas.fillText(l,a,i)}var C=t.Close,u=(t.Increase,t.Vol),D=t.Amount;t.Before&&(C=t.Before.Close,t.Before.Increase,u=t.Before.Vol,D=t.Before.Amount),i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,l=g_JSChartLocalization.GetText("Tooltip-Price",this.LanguageID),this.Canvas.fillText(l,a,i);var d=this.KLineTitlePaint.GetColor(C,this.YClose);l=C.toFixed(e);this.Canvas.fillStyle=d,this.Canvas.fillText(l,a+o,i);var c=!0;if(t.Before?c=!1:MARKET_SUFFIX_NAME.IsForeignExchange(r)?c=!1:MARKET_SUFFIX_NAME.IsET(r)&&!MARKET_SUFFIX_NAME.IsETShowAvPrice(r)&&(c=!1),c&&IFrameSplitOperator.IsNumber(t.AvPrice)){i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,l=g_JSChartLocalization.GetText("Tooltip-AvPrice",this.LanguageID),this.Canvas.fillText(l,a,i);d=this.KLineTitlePaint.GetColor(t.AvPrice,this.YClose),l=t.AvPrice.toFixed(e);this.Canvas.fillStyle=d,this.Canvas.fillText(l,a+o,i)}i+=this.LineHeight,this.Canvas.fillStyle=this.TitleColor,l=g_JSChartLocalization.GetText("Tooltip-Increase",this.LanguageID),this.Canvas.fillText(l,a,i);var m=(C-this.YClose)/this.YClose*100;d=this.KLineTitlePaint.GetColor(m,0),l=m.toFixed(2)+"%";if(this.Canvas.fillStyle=d,this.Canvas.fillText(l,a+o,i),IFrameSplitOperator.IsNumber(u)){this.Canvas.fillStyle=this.TitleColor,i+=this.LineHeight,l=g_JSChartLocalization.GetText("Tooltip-Vol",this.LanguageID),this.Canvas.fillText(l,a,i);l=IFrameSplitOperator.FromatIntegerString(u,2,this.LanguageID);this.Canvas.fillText(l,a+o,i)}if(IFrameSplitOperator.IsNumber(D)){i+=this.LineHeight,l=g_JSChartLocalization.GetText("Tooltip-Amount",this.LanguageID),this.Canvas.fillText(l,a,i);l=IFrameSplitOperator.FormatValueString(D,2,this.LanguageID);this.Canvas.fillText(l,a+o,i)}if(IFrameSplitOperator.IsNumber(t.Position)){i+=this.LineHeight,l=g_JSChartLocalization.GetText("Tooltip-Position",this.LanguageID),this.Canvas.fillText(l,a,i);l=IFrameSplitOperator.FormatValueString(t.Position,2,this.LanguageID);this.Canvas.fillText(l,a+o,i)}this.IsHScreen&&this.Canvas.restore()}}}function StockInfoExtendChartPaint(){this.newMethod=IExtendChartPainting,this.newMethod(),delete this.newMethod,this.Left=80,this.Right=1,this.Top=1,this.Bottom=1,this.BorderColor=g_JSChartResource.FrameBorderPen,this.Symbol,this.Name,this.TitleFont=["14px 微软雅黑"],this.Draw=function(){var t=this.ChartBorder.GetRight()+this.Left,e=this.ChartBorder.GetChartWidth()-this.Right,a=this.Top+18,i=t+(e-t)/2;this.Symbol&&this.Name&&(this.Canvas.font=this.TitleFont[0],this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.Symbol,i-2,a),this.Canvas.textAlign="left",this.Canvas.fillText(this.Name,i+2,a)),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.moveTo(t,a),this.Canvas.lineTo(e,a),this.Canvas.stroke(),a+=30,this.DrawBorder()},this.DrawBorder=function(){var t=this.ChartBorder.GetRight()+this.Left,e=this.ChartBorder.GetChartWidth()-this.Right,a=this.Top,i=this.ChartBorder.GetChartHeight()-this.Bottom;this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(t,a,e-t,i-a)}}function StockChip(){this.newMethod=IExtendChartPainting,this.newMethod(),delete this.newMethod,this.Name="筹码分布",this.ClassName="StockChip",this.HQChart,this.PenBorder=g_JSChartResource.FrameBorderPen,this.ColorProfit="rgb(255,0,0)",this.ColorNoProfit="rgb(90,141,248)",this.ColorAveragePrice="rgb(0,139,0)",this.ColorBG="rgb(190,190,190)",this.PixelRatio=GetDevicePixelRatio(),this.ShowType=0,this.IsDynamic=!0,this.ClientRect={},this.Font=g_JSChartResource.TitleFont,this.InfoColor="rgb(0,0,0)",this.DayInfoColor="rgb(255,255,255)",this.LineHeight=16,this.Left=50*this.PixelRatio,this.IsShowX=!1,this.ShowXCount=3,this.Width=150*this.PixelRatio,this.CalculateType=0,this.PriceZoom=100,this.ButtonID=Guid(),this.DAY_COLOR=[["rgb(255,0,0)","rgb(255,128,128)","rgb(255,0,128)","rgb(255,100,0)","rgb(192,128,0)","rgb(255,192,0)"],["rgb(120,80,225)","rgb(160,160,225)","rgb(80,80,255)","rgb(120,120,255)","rgb(32,64,192)","rgb(0,64,128)"]],this.SetOption=function(t){t&&(t.ShowType>0&&(this.ShowType=t.ShowType),t.IsShowX&&(this.IsShowX=t.IsShowX),t.ShowXCount>0&&(this.ShowXCount=t.ShowXCount),t.Width>100&&(this.Width=t.Width*GetDevicePixelRatio()),t.CalculateType>0&&(this.CalculateType=t.CalculateType),IFrameSplitOperator.IsNumber(t.PriceZoom)&&(this.PriceZoom=t.PriceZoom))},this.Draw=function(){this.PixelRatio=GetDevicePixelRatio();var t=ToFixedPoint(this.ChartBorder.GetRight()+this.Left),e=ToFixedPoint(this.ChartBorder.GetTop()),a=ToFixedPoint(t+this.Width-1*this.PixelRatio)-t,i=ToFixedPoint(this.ChartBorder.GetBottom())-e;this.ClientRect={Left:t,Top:e,Width:a,Height:i},this.CalculateChip()?(this.DrawFrame(),this.DrawAllChip(),1!=this.ShowType&&2!=this.ShowType||this.DrawDayChip(),this.CalculateCast(),this.DrawChipInfo()):JSConsole.Chart.Log("[StockChip::Draw] no data"),this.DrawBorder(),1==this.SizeChange&&this.DrawButton(),this.SizeChange=!1},this.DrawChipInfo=function(){var t=this.ClientRect.Top+this.ClientRect.Height-1,e=this.ClientRect.Left+2,a=this.ClientRect.Left+this.ClientRect.Width;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";var i=this.LineHeight*GetDevicePixelRatio(),r="70%成本价"+this.Data.Cast[1].MinPrice.toFixed(2)+"-"+this.Data.Cast[1].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[1].Rate.toFixed(2)+"%";this.Canvas.fillText(r,e,t),t-=i,r="90%成本价"+this.Data.Cast[0].MinPrice.toFixed(2)+"-"+this.Data.Cast[0].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[0].Rate.toFixed(2)+"%",this.Canvas.fillText(r,e,t),t-=i,r="平均成本："+this.Data.ChipInfo.AveragePrice.toFixed(2)+"元",this.Canvas.fillText(r,e,t),t-=i,r=+this.Data.YPrice.toFixed(2)+"处获利盘："+this.Data.ChipInfo.YProfitRate.toFixed(2)+"%",this.Canvas.fillText(r,e,t),t-=i,r="获利比例：",this.Canvas.fillText(r,e,t);var n=e+(o=this.Canvas.measureText(r).width+2),s=a-5-n;if(this.Canvas.strokeStyle=this.ColorNoProfit,this.Canvas.strokeRect(n,t-i,s,i),this.Canvas.strokeStyle=this.ColorProfit,this.Canvas.strokeRect(n,t-i,s*(this.Data.ChipInfo.ProfitRate/100),i),r=this.Data.ChipInfo.ProfitRate.toFixed(2)+"%",this.Canvas.textAlign="center",this.Canvas.fillText(r,n+s/2,t),t-=i,this.Canvas.textAlign="left",r="成本分布,日期："+IFrameSplitOperator.FormatDateString(this.Data.SelectData.Date),this.Data.SelectData.Time&&(r+=" "+IFrameSplitOperator.FormatTimeString(this.Data.SelectData.Time)),this.Canvas.fillText(r,e,t),t-=i,1==this.ShowType||2==this.ShowType){a=this.ClientRect.Left+this.ClientRect.Width-1;this.Canvas.textAlign="right";var o=50;for(var h in this.Data.DayChip.sort(function(t,e){return e.Day-t.Day}),this.Data.DayChip){var l=this.Data.DayChip[h],C=0;this.Data.ChipInfo&&this.Data.ChipInfo.Vol>0&&(C=l.Vol/this.Data.ChipInfo.Vol*100),r=l.Day+"周期"+(1==this.ShowType?"前":"内")+"成本"+C.toFixed(2)+"%",0==h&&(o=this.Canvas.measureText(r).width+8),this.Canvas.fillStyle=l.Color,this.Canvas.fillRect(a-o,t-i,o,i),this.Canvas.fillStyle=this.DayInfoColor,this.Canvas.fillText(r,a,t),t-=i}}},this.DrawDayChip=function(){var t=this.HQChart.Frame.SubFrame[0].Frame;for(var e in this.Data.DayChip){var a=[],i=this.Data.DayChip[e].Chip;if(i){for(var r=0,n=0;n<i.length;++n){var s=i[n];if(s){r+=s;var o=(n+this.Data.MinPrice)/100,h=t.GetYFromData(o),l=s/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;a.push({X:l,Y:h})}}this.Data.DayChip[e].Vol=r,this.DrawArea(a,this.Data.DayChip[e].Color)}}},this.Clear=function(){var t=document.getElementById(this.ButtonID);t&&this.ChartBorder.UIElement.parentNode.removeChild(t)},this.DrawButton=function(){var t=document.getElementById(this.ButtonID);t||((t=document.createElement("div")).className="klineframe-button",t.id=this.ButtonID,this.ChartBorder.UIElement.parentNode.appendChild(t));var e=this.PixelRatio,a=(this.ClientRect.Left,this.ClientRect.Left+this.ClientRect.Width),i=this.ChartBorder.GetChartWidth(),r=this.ChartBorder.GetTitleHeight(),n=this.ChartBorder.GetTop()/e;const s=[{Class:"chip_default icon iconfont icon-chip_default",ID:"chip_default",Color:["#808080","#FF0000"],Title:"默认筹码分布图"},{Class:"chip_long icon iconfont icon-chip_date",ID:"chip_long",Color:["#808080","#FF8000"],Title:"远期筹码分布图"},{Class:"chip_recent icon iconfont icon-chip_date",ID:"chip_recent",Color:["#808080","#0000CC"],Title:"近期筹码分布图"}];var o="";for(var h in s){var l=s[h],C="<span class=\'{iconclass}\' id=\'{iconid}\' title=\'{icontitle}\' style=\'cursor:pointer;display:inline-block;color:{iconcolor};font-size:{iconsize}px\'></span>";C=(C=(C=(C=(C=C.replace("{iconclass}",l.Class)).replace("{iconid}",l.ID)).replace("{iconcolor}",l.Color[h==this.ShowType?1:0])).replace("{iconsize}",r)).replace("{icontitle}",l.Title),o.length>0&&(o+="&nbsp;&nbsp;"),o+=C}t.style.right=Math.floor((i-a+2)/e)+"px",t.style.top=n+"px",t.style.height=r+"px",t.innerHTML=o;var u=this;for(var h in s){l=s[h];$("#"+this.ButtonID+" ."+l.ID).click({IconID:l.ID,ShowType:h},function(t){t.data.IconID;var e=t.data.ShowType;for(var a in u.ShowType=e,u.HQChart&&u.HQChart.Draw(),s){var i=s[a];$("#"+u.ButtonID+" ."+i.ID)[0].style.color=i.Color[a==e?1:0]}})}},this.DrawAllChip=function(){for(var t=this.HQChart.Frame.SubFrame[0].Frame,e=this.Data.SelectData.Close,a=[],i=[],r=0,n=0,s=0,o=0,h=this.Data.YPrice,l=t.HorizontalMax,C=t.HorizontalMin,u=1,D=0;D<this.Data.AllChip.length;++D){if(d=this.Data.AllChip[D])r+=d,n+=(c=(D+this.Data.MinPrice)/this.PriceZoom)*d,c<h&&(o+=d),c<e&&(s+=d),c<=l&&c>=C&&u<d&&(u=d)}this.Data.MaxVol=u;for(D=0;D<this.Data.AllChip.length;++D){var d,c;if(d=this.Data.AllChip[D])if(!((c=(D+this.Data.MinPrice)/this.PriceZoom)>l||c<C)){var m=t.GetYFromData(c),f=d/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;c<e?a.push({X:f,Y:m}):i.push({X:f,Y:m})}}if(this.Data.ChipInfo={Vol:r,AveragePrice:n/r,ProfitVol:s,ProfitRate:r>0?s/r*100:0,YProfitRate:r>0?o/r*100:0},0==this.ShowType){this.DrawLines(a,this.ColorProfit),this.DrawLines(i,this.ColorNoProfit);var v=this.Data.ChipInfo.AveragePrice;v>0&&v<=l&&v>=C&&(v=v.toFixed(2),this.DrawAveragePriceLine(a,i,t.GetYFromData(v),this.ColorAveragePrice))}else this.DrawLines(a,this.ColorBG),this.DrawLines(i,this.ColorBG)},this.CalculateCast=function(){if(this.Data.ChipInfo&&this.Data.ChipInfo.Vol){for(var t=[{Start:.05,End:.95,MaxPrice:0,MinPrice:0,Rate:0},{Start:.15,End:.85,MaxPrice:0,MinPrice:0,Rate:0}],e=(this.Data.ChipInfo.AveragePrice,this.Data.ChipInfo.ProfitVol),a=0,i=0,r=0;i<this.Data.AllChip.length&&4!=r;++i){var n=this.Data.AllChip[i];if(!(n<=0)){var s=(i+this.Data.MinPrice)/this.PriceZoom,o=(a+=n)/e;for(var h in t){var l=t[h];l.MinPrice<=0&&o>l.Start&&(l.MinPrice=s,++r),l.MaxPrice<=0&&o>l.End&&(l.MaxPrice=s,++r)}}}for(var i in t){var C=t[i],u=C.MaxPrice+C.MinPrice;u&&(C.Rate=Math.abs(C.MaxPrice-C.MinPrice)/u*100)}this.Data.Cast=t}},this.DrawArea=function(t,e){if(!(t.length<=0)){for(var a in this.Canvas.fillStyle=e,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,t[0].Y),t){var i=t[a];this.Canvas.lineTo(i.X,i.Y)}this.Canvas.lineTo(this.ClientRect.Left,t[t.length-1].Y),this.Canvas.fill()}},this.DrawLines=function(t,e){if(!(t.length<=0)){for(var a in this.Canvas.strokeStyle=e,this.Canvas.beginPath(),t){var i=t[a];this.Canvas.moveTo(this.ClientRect.Left,i.Y),this.Canvas.lineTo(i.X,i.Y)}this.Canvas.stroke()}},this.DrawAveragePriceLine=function(t,e,a,i){for(var r in t){if((n=t[r]).Y==a)return this.Canvas.strokeStyle=i,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,n.Y),this.Canvas.lineTo(n.X,n.Y),void this.Canvas.stroke()}for(var r in e){var n;if((n=e[r]).Y==a)return this.Canvas.strokeStyle=i,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,n.Y),this.Canvas.lineTo(n.X,n.Y),void this.Canvas.stroke()}},this.DrawBorder=function(){this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(this.ClientRect.Left,this.ClientRect.Top,this.ClientRect.Width,this.ClientRect.Height)},this.EvenlyDistribute=function(t,e){var a=e.Low,i=e.High,r=e.MaxPrice,n=e.MinPrice,s=1;if(i-a!=0){for(var o=e.Vol/(i-a),h=a;h<=i&&h<=r;++h){var l=h-n;t[l]+=o,s<t[l]&&(s=t[l])}e.MaxVol=s}},this.TriangleDistribute=function(t,e){for(var a=e.Low,i=e.High,r=(e.MaxPrice,e.MinPrice),n=1,s=3.1415926535,o=(i-a)/2+a,h=0,l=[],C=a+1,u=1;C<=o;++C,++u){h+=D=Math.tan(45*s/180)*u,l.push({Index:C-r,Value:D})}for(C=i-1,u=1;C>o;--C,++u){var D;h+=D=Math.tan(45*s/180)*u,l.push({Index:C-r,Value:D})}if(h>0){for(C=0;C<l.length;++C){var d=l[C];t[d.Index]+=d.Value*e.Vol/h,n<t[d.Index]&&(n=t[d.Index])}e.MaxVol=n}},this.CalculateDistribute=function(t,e){1==this.CalculateType?this.TriangleDistribute(t,e):this.EvenlyDistribute(t,e)},this.CalculateChip=function(){if(!this.HQChart)return!1;if(!this.HQChart.FlowCapitalReady)return!1;var t=this.HQChart.Symbol;if(!t)return!1;if(MARKET_SUFFIX_NAME.IsSHSZIndex(t))return!1;var e=this.HQChart.ChartPaint[0].Data,a=e.DataOffset+parseInt(this.HQChart.CursorIndex);a>=e.Data.length&&(a=e.Data.length-1);var i=e.Data[a],r=i.Close,n=this.HQChart.LastPoint.Y;n&&(r=this.HQChart.Frame.SubFrame[0].Frame.GetYData(n));for(var s,o,h=[],l=1,C=a;C>=0;--C){var u=1;(S=e.Data[C]).FlowCapital>0&&(u=S.Vol/S.FlowCapital);var D={Vol:C==a?S.Vol*u:S.Vol*l,High:S.High,Low:S.Low};h.push(D),l*=1-1*u,(!s||s<S.High)&&(s=S.High),(!o||o>S.Low)&&(o=S.Low)}if(!s||!o)return!0;var d=this.PriceZoom,c=(s=parseInt(s*d))-(o=parseInt(o*d)),m=new Array;for(C=0;C<=c;++C)m.push(0);var f,v=[];if(2==this.ShowType){v=[{Day:100,Color:this.DAY_COLOR[1][5]},{Day:60,Color:this.DAY_COLOR[1][4]},{Day:30,Color:this.DAY_COLOR[1][3]},{Day:20,Color:this.DAY_COLOR[1][2]},{Day:10,Color:this.DAY_COLOR[1][1]},{Day:5,Color:this.DAY_COLOR[1][0]}];for(var C in h){var S=h[C],T=parseInt(S.High*d),I=parseInt(S.Low*d),F=S.Vol;if(T-I>0&&(F=S.Vol/(T-I)),!(F<=1e-9)){for(var g=0;g<v.length;++g)if(C==v[g].Day){v[g].Chip=m.slice(0);break}f={Low:I,High:T,Vol:S.Vol,MaxPrice:s,MinPrice:o},this.CalculateDistribute(m,f)}}}else if(1==this.ShowType)for(v=[{Day:5,Color:this.DAY_COLOR[0][0]},{Day:10,Color:this.DAY_COLOR[0][1]},{Day:20,Color:this.DAY_COLOR[0][2]},{Day:30,Color:this.DAY_COLOR[0][3]},{Day:60,Color:this.DAY_COLOR[0][4]},{Day:100,Color:this.DAY_COLOR[0][5]}],C=h.length-1;C>=0;--C){S=h[C],T=parseInt(S.High*d),I=parseInt(S.Low*d),F=S.Vol;if(T-I>0&&(F=S.Vol/(T-I)),!(F<=1e-9)){for(g=0;g<v.length;++g)if(C==v[g].Day){v[g].Chip=m.slice(0);break}f={Low:I,High:T,Vol:S.Vol,MaxPrice:s,MinPrice:o},this.CalculateDistribute(m,f)}}else for(var C in h){S=h[C],T=parseInt(S.High*d),I=parseInt(S.Low*d),F=S.Vol;T-I>0&&(F=S.Vol/(T-I)),F<=1e-9||(f={Low:I,High:T,Vol:S.Vol,MaxPrice:s,MinPrice:o},this.CalculateDistribute(m,f))}return this.Data={AllChip:m,MaxVol:f.MaxVol,MaxPrice:s,MinPrice:o,SelectData:i,DayChip:v,YPrice:r},!0},this.DrawFrame=function(){if(0!=this.IsShowX&&!(this.Data.MaxVol<=0)){var t=1!==this.HQChart.Frame.SubFrame.length,e=ToFixedPoint(this.HQChart.Frame.SubFrame[0].Frame.ChartBorder.GetBottomEx()+1);t||(e=this.ClientRect.Top+this.ClientRect.Height);var a=this.ClientRect.Left,i=a+this.ClientRect.Width;this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),t&&(this.Canvas.moveTo(a,e),this.Canvas.lineTo(i,e));var r=this.ShowXCount,n=this.Data.MaxVol,s=Math.floor(n/r);this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.Canvas.fillStyle=this.InfoColor;GetDevicePixelRatio();for(var o=1;o<=r;++o){var h=s*o,l=h/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;if(l=ToFixedPoint(l),o==r){this.Canvas.textAlign="right";var C=IFrameSplitOperator.FormatValueString(n,1);this.Canvas.fillText(C,l,e+2)}else{this.Canvas.moveTo(l,this.ClientRect.Top),this.Canvas.lineTo(l,e),this.Canvas.textAlign="center";C=IFrameSplitOperator.FormatValueString(h,1);var u=this.Canvas.measureText(C).width;this.Canvas.fillText(C,Math.floor(l-.25*u),e+2)}}this.Canvas.stroke()}}}function DrawToolsButton(){this.newMethod=IExtendChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="DrawToolsButton",this.HQChart,this.ID=Guid(),this.ToolsDiv,this.Color="#696969",this.Top=5*GetDevicePixelRatio(),this.Width=45*GetDevicePixelRatio(),this.SetOption=function(t){var e=GetDevicePixelRatio();t&&t.Width>10&&(this.Width=t.Width*e)},this.Clear=function(){this.ToolsDiv&&this.ChartBorder.UIElement.parentNode.removeChild(this.ToolsDiv)},this.Draw=function(){if(0==this.SizeChange)return;const t=[[{HTML:{Title:"线段",IClass:"iconfont icon-draw_line",ID:"icon-segment"},Name:"线段"},{HTML:{Title:"射线",IClass:"iconfont icon-draw_rays",ID:"icon-beam"},Name:"射线"},{HTML:{Title:"趋势线",IClass:"iconfont icon-draw_trendline",ID:"icon-trendline"},Name:"趋势线"},{HTML:{Title:"水平线",IClass:"iconfont icon-draw_hline",ID:"icon-hline"},Name:"水平线"},{HTML:{Title:"平行线",IClass:"iconfont icon-draw_parallel_lines",ID:"icon-parallellines"},Name:"平行线"},{HTML:{Title:"平行通道",IClass:"iconfont icon-draw_parallelchannel",ID:"icon-parallelchannel"},Name:"平行通道"},{HTML:{Title:"价格通道线",IClass:"iconfont icon-draw_pricechannel",ID:"icon-pricechannel"},Name:"价格通道线"},{HTML:{Title:"M头W底",IClass:"iconfont icon-draw_wavemw",ID:"icon-wavemw"},Name:"M头W底"}],[{HTML:{Title:"圆弧",IClass:"iconfont icon-draw_arc",ID:"icon-arc"},Name:"圆弧线"},{HTML:{Title:"矩形",IClass:"iconfont icon-rectangle",ID:"icon-rect"},Name:"矩形"},{HTML:{Title:"平行四边形",IClass:"iconfont icon-draw_quadrangle",ID:"icon-quad"},Name:"平行四边形"},{HTML:{Title:"三角形",IClass:"iconfont icon-draw_triangle",ID:"icon-triangle"},Name:"三角形"},{HTML:{Title:"圆",IClass:"iconfont icon-draw_circle",ID:"icon-circle"},Name:"圆"},{HTML:{Title:"对称角度",IClass:"iconfont icon-draw_symangle",ID:"icon-symangle"},Name:"对称角度"}],[{HTML:{Title:"文本",IClass:"iconfont icon-draw_text",ID:"icon-text"},Name:"文本"},{HTML:{Title:"向上箭头",IClass:"iconfont icon-arrow_up",ID:"icon-arrowup"},Name:"icon-arrow_up"},{HTML:{Title:"向下箭头",IClass:"iconfont icon-arrow_down",ID:"icon-arrowdown"},Name:"icon-arrow_down"},{HTML:{Title:"向左箭头",IClass:"iconfont icon-arrow_left",ID:"icon-arrowleft"},Name:"icon-arrow_left"},{HTML:{Title:"向右箭头",IClass:"iconfont icon-arrow_right",ID:"icon-arrowright"},Name:"icon-arrow_right"}],[{HTML:{Title:"江恩角度线",IClass:"iconfont icon-draw_gannfan",ID:"icon-gannfan"},Name:"江恩角度线"},{HTML:{Title:"斐波那契周期线",IClass:"iconfont icon-draw_fibonacci",ID:"icon-fibonacci"},Name:"斐波那契周期线"},{HTML:{Title:"阻速线",IClass:"iconfont icon-draw_resline",ID:"icon-resline"},Name:"阻速线"},{HTML:{Title:"黄金分割",IClass:"iconfont icon-draw_goldensection",ID:"icon-goldensection"},Name:"黄金分割"},{HTML:{Title:"百分比线",IClass:"iconfont icon-draw_percentage",ID:"icon-percentage"},Name:"百分比线"},{HTML:{Title:"波段线",IClass:"iconfont icon-draw_waveband",ID:"icon-waveband"},Name:"波段线"}],[{HTML:{Title:"全部删除",IClass:"iconfont icon-recycle_bin",ID:"icon-delete"},Name:"全部删除"}]];var e=this.HQChart;if(!this.ToolsDiv){var a=document.createElement("div");a.className="drawtools",a.id=this.ID;var i="",r="",n=new Array;t.forEach(function(t,e){n.push(t[0])});for(var s=0;s<t.length;s++){for(var o=n[s],h=t[s],l="",C="",u=0;u<h.length;u++){var D=h[u],d=D.Name;d.indexOf("up")>-1?d="向上箭头":d.indexOf("down")>-1?d="向下箭头":d.indexOf("left")>-1?d="向左箭头":d.indexOf("right")>-1&&(d="向右箭头"),l+=\'<p class="menuTwoItem \'+D.HTML.ID+\'">\'+d+\'<i class="\'+D.HTML.IClass+\'" title="\'+D.HTML.Title+\'"></i></p>\'}s!==t.length-1?(r=\'<div class="menuTwo">\'+l+"</div>",C=\'<i class="contentArrow iconfont icon-menu_arraw_left"></i>\'):(r="",C=""),i+=\'<div class="icon-image first-\'+o.HTML.ID+\'"><i class="\'+o.HTML.IClass+\'" title="\'+o.HTML.Title+\'"></i>\'+r+C+"</div>"}for(var s in this.ChartBorder.UIElement.parentNode.appendChild(a),a.innerHTML=i,this.ToolsDiv=a,t){var c=t[s][0];if($("#"+this.ID+" .first-"+c.HTML.ID).hover(function(){$(".drawtools").find(".contentArrow").hide(),$(this).find(".contentArrow").removeClass("trans").show()}),$("#"+this.ID+" .first-"+c.HTML.ID+" .contentArrow").click(function(t){t.stopPropagation(),$(".drawtools").find(".menuTwo").hide(),$(this).siblings(".menuTwo").show()}),$("#"+this.ID+" .first-"+c.HTML.ID+" .trans").click(function(){event.stopPropagation(),$(this).siblings(".menuTwo").hide()}),"全部删除"==c.Name)$("#"+this.ID+" .first-icon-delete").click(function(){$(".drawtools").find(".menuTwo").hide(),$(this).siblings().removeClass("active"),$(this).addClass("active"),e.ClearChartDrawPicture(),$(".subTolls").css("display","none")});else for(var u in $("#"+this.ID+" .first-"+n[s].HTML.ID).click({CurrentIndex:s},function(t){$(".drawtools").find(".menuTwo").hide(),$(this).siblings().removeClass("active"),$(this).addClass("active"),e.CreateChartDrawPicture(n[t.data.CurrentIndex].Name)}),t[s]){var m=t[s][u];let a=m.HTML.IClass;$("#"+this.ID+" ."+m.HTML.ID).hover(function(t){t.stopPropagation(),$(this).closest(".icon-image").find(".contentArrow").addClass("trans")}),$("#"+this.ID+" ."+m.HTML.ID).click({DrawName:m.Name,CurrentIndex:s,CurrentData:m},function(t){t.stopPropagation(),$(this).closest(".icon-image").find(".contentArrow").hide(),$(this).siblings().removeClass("current"),$(this).addClass("current"),$(this).closest(".icon-image").children("i").eq(0).removeClass().addClass(a,"active").attr("title",t.data.CurrentData.HTML.Title),n.splice(t.data.CurrentIndex,1,t.data.CurrentData),$(this).parent().hide(),e.CreateChartDrawPicture(t.data.DrawName)})}}}var f=this.ID;$(document).click(function(t){$("#"+f).is(t.target)||0!==$("#"+f).has(t.target).length||($("#"+f+" .menuTwo").hide(),$("#"+f+" .contentArrow").hide())});GetScrollPosition();var v=GetDevicePixelRatio(),S=ToFixedPoint(this.ChartBorder.GetRight()+this.Left),T=this.ChartBorder.GetTop();this.ToolsDiv.style.left=S/v+"px",this.ToolsDiv.style.top=T/v+"px",this.ToolsDiv.style.width=(this.Width-5)/v+"px",this.ToolsDiv.style.height="auto",this.ToolsDiv.style.position="absolute",this.ToolsDiv.style.display="block",this.SizeChange}}function DepthMapPaint(){this.newMethod=IExtendChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="DepthMapPaint",this.LineColor="rgba(0,139,0,0.6)",this.AreaColor=["rgba(0,139,0,0.5)","rgba(0,139,0,0.4)","rgba(0,139,0,0.3)","rgba(0,139,0,0.2)"],this.TextColor="rgba(0,0,0)",this.TextBGColor="rgba(0,139,0)",this.Width=200*GetDevicePixelRatio(),this.FrameID=0,this.ID=Guid(),this.IsDynamic=!1,this.IsCallbackDraw=!0,this.YRange,this.SetOption=function(t){t.FrameID>0&&(this.FrameID=t.FrameID),t.Width>0&&(this.Width=t.Width),IFrameSplitOperator.IsObjectExist(t.ID)&&(this.ID=t.ID),t.IsShowCorssCursor&&(this.IsShowCorssCursor=t.IsShowCorssCursor)},this.Draw=function(){if(this.Data&&this.ChartFrame&&this.ChartFrame.SubFrame&&!(this.ChartFrame.SubFrame.length<=this.FrameID)){var t,e=!0===this.ChartFrame.IsHScreen,a=this.ChartFrame.SubFrame[this.FrameID].Frame.ChartBorder,i=a.GetHeightEx(),r=a.GetRight(),n=a.GetTopEx(),s=a.GetBottomEx();if((t=this.Width)>this.ChartBorder.Right&&(t=this.ChartBorder.Right),e)r=a.GetBottom(),n=a.GetRight(),s=a.GetLeft(),(t=this.Width)>this.ChartBorder.Bottom&&(t=this.ChartBorder.Bottom);var o={Left:r,Top:n,Right:r+t,Bottom:s,Height:i,Width:t};for(var h in this.YRange={Max:null,Min:0},this.Data){var l=this.Data[h];this.CalculateYRange(l,this.YRange)}for(var h in this.Data){(l=this.Data[h]).Height>0&&l.Height<=1?o.Height=i*l.Height:o.Height=i,1==l.Type?(o.Top=n,o.Bottom=n+o.Height,this.DrawUpArea(l,o)):2==l.Type?(o.Bottom=s,o.Top=o.Bottom-o.Height,this.DrawDownArea(l,o)):(o.Top=n,o.Bottom=s,this.DrawDefaultArea(l,o))}}},this.CalculateYRange=function(t,e){for(var a in t.Data){var i=t.Data[a];(null==e.Max||e.Max<i.Y)&&(e.Max=i.Y),(null==e.Min||e.Min>i.Y)&&(e.Min=i.Y)}},this.GetXFromData=function(t,e,a){var i=e.Width*(t-a.Min)/(a.Max-a.Min);return e.Left+i},this.GetYFromData=function(t,e,a,i){if(i){var r=e.Height*(t-a.Min)/(a.Max-a.Min);return e.Bottom-r}r=e.Height*(t-a.Min)/(a.Max-a.Min);return e.Top+r},this.DrawDefaultArea=function(t,e){var a=this.ChartFrame.SubFrame[this.FrameID].Frame,i=t.Range&&t.Range.Y?t.Range.Y:this.YRange,r=[];for(var n in t.Data){var s=t.Data[n],o=this.GetXFromData(s.Y,e,i);if(!(s.X>a.HorizontalMax||s.X<a.HorizontalMin)){var h=a.GetYFromData(s.X);r.push({X:o,Y:h})}}var l=t.LineColor?t.LineColor:this.LineColor,C=t.AreaColor?t.AreaColor:this.AreaColor;r.length>0&&this.DrawLine(r,l,C,e)},this.DrawUpArea=function(t,e){var a=[];for(var i in t.Data){var r=t.Data[i],n=this.GetXFromData(r.Y,e,t.Range.Y),s=this.GetYFromData(r.X,e,t.Range.X,t.IsASC);a.push({X:n,Y:s})}var o=t.LineColor?t.LineColor:this.LineColor,h=t.AreaColor?t.AreaColor:this.AreaColor;a.length>0&&this.DrawLine(a,o,h,e)},this.DrawDownArea=function(t,e){var a=[];for(var i in t.Data){var r=t.Data[i],n=this.GetXFromData(r.Y,e,t.Range.Y),s=this.GetYFromData(r.X,e,t.Range.X,t.IsASC);a.push({X:n,Y:s})}var o=t.LineColor?t.LineColor:this.LineColor,h=t.AreaColor?t.AreaColor:this.AreaColor;a.length>0&&this.DrawLine(a,o,h,e)},this.DrawLine=function(t,e,a,i){var r=!0===this.ChartFrame.IsHScreen,n=!0,s=0;for(var o in this.Canvas.strokeStyle=e,t){var h=t[o];n?(this.Canvas.beginPath(),r?this.Canvas.moveTo(h.Y,h.X):this.Canvas.moveTo(h.X,h.Y),n=!1):r?this.Canvas.lineTo(h.Y,h.X):this.Canvas.lineTo(h.X,h.Y),++s}s>0&&this.Canvas.stroke();var l=t[0],C=t[t.length-1];if(r?(this.Canvas.lineTo(C.Y,i.Left),this.Canvas.lineTo(l.Y,i.Left)):(this.Canvas.lineTo(i.Left,C.Y),this.Canvas.lineTo(i.Left,l.Y)),this.Canvas.closePath(),Array.isArray(a))if(r){let t=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());t.addColorStop(0,a[0]),t.addColorStop(1,a[1]),this.Canvas.fillStyle=t}else{let t=this.Canvas.createLinearGradient(i.Right,i.Top,i.Left,i.Top);var u=1/a.length;for(var o in a)t.addColorStop(o*u,a[o]);this.Canvas.fillStyle=t}else this.Canvas.fillStyle=a;this.Canvas.fill()},this.GetYValueByXValue=function(t,e){var a=[],i=ZOOM_VALUE[e];for(var r in this.Data){var n=this.Data[r];if(0==n.Type&&n.Data&&!(n.Data.length<0)&&0!=n.IsShowCorssCursor){var s=!1;for(var o in n.Data){var h=n.Data[o];if(parseInt(h.X*i)==t){s=!0;var l={X:h.X,Y:h.Y,TextColor:n.TextColor?n.TextColor:this.TextColor,TextBGColor:n.TextBGColor?n.TextBGColor:this.TextBGColor};h.YText&&(l.YText=h.YText),a.push(l);break}}if(!s){var C=n.Data[0],u=n.Data[n.Data.length-1];t>C.X*i&&t<u.X*i&&a.push({X:null,Y:null,TextColor:n.TextColor?n.TextColor:this.TextColor,TextBGColor:n.TextBGColor?n.TextBGColor:this.TextBGColor})}}}return a}}function BackgroundPaint(){this.newMethod=IExtendChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="BackgroundPaint",this.IsDynamic=!1,this.IsCallbackDraw=!0,this.FrameID=0,this.Data,this.ID=Guid(),this.ChartSubFrame,this.ChartBorder,this.KData,this.Period,this.XPointCount=0,this.SetOption=function(t){t.FrameID>0&&(this.FrameID=t.FrameID),IFrameSplitOperator.IsObjectExist(t.ID)&&(this.ID=t.ID)},this.Draw=function(){if(this.Data&&this.HQChart&&this.ChartFrame&&this.ChartFrame.SubFrame&&!(this.ChartFrame.SubFrame.length<=this.FrameID)){var t=this.HQChart.ChartPaint[0];if(t&&t.Data&&(this.ChartSubFrame=this.ChartFrame.SubFrame[this.FrameID].Frame,this.ChartBorder=this.ChartSubFrame.ChartBorder,this.KData=t.Data,this.Period=this.HQChart.Period,this.KData&&!(this.KData.Data.length<=0))){var e=!0===this.ChartSubFrame.IsHScreen;this.XPointCount=this.ChartSubFrame.XPointCount;var a=this.ChartSubFrame.XPointCount,i=this.KData.Data[this.KData.DataOffset],r=this.KData.DataOffset+a-1;r>=this.KData.Data.length&&(r=this.KData.Data.length-1);var n=this.KData.Data[r],s=this.GetShowData(i,n);if(s&&!(s.length<=0)){var o=this.BuildKLineMap(),h=this.ChartBorder.GetBottomEx(),l=this.ChartBorder.GetTopEx(),C=this.ChartBorder.GetHeightEx();for(var u in e&&(l=this.ChartBorder.GetRightEx(),h=this.ChartBorder.GetLeftEx(),C=this.ChartBorder.GetWidthEx()),s){var D=s[u],d=this.GetBGCoordinate(D,o);if(d){if(Array.isArray(D.Color)){var c;c=e?this.Canvas.createLinearGradient(h,d.Left,l,d.Left):this.Canvas.createLinearGradient(d.Left,l,d.Left,h);var m=1/D.Color.length;for(var u in D.Color)c.addColorStop(u*m,D.Color[u]);this.Canvas.fillStyle=c}else this.Canvas.fillStyle=D.Color;e?this.Canvas.fillRect(ToFixedRect(h),ToFixedRect(d.Left),ToFixedRect(C),ToFixedRect(d.Width)):this.Canvas.fillRect(ToFixedRect(d.Left),ToFixedRect(l),ToFixedRect(d.Width),ToFixedRect(C))}}}}}},this.GetShowData=function(t,e){var a=[];for(var i in this.Data){var r=this.Data[i],n={};r.Start.Date>=t.Date&&r.Start.Date<=e.Date&&(n.Start=r.Start),r.End.Date>=t.Date&&r.End.Date<=e.Date&&(n.End=r.End),(n.Start||n.End)&&(n.Color=r.Color,a.push(n))}return a},this.BuildKLineMap=function(){var t=!0===this.ChartSubFrame.IsHScreen,e=this.ChartSubFrame.DataWidth,a=this.ChartSubFrame.DistanceWidth,i=this.ChartBorder.GetLeft()+a/2+g_JSChartResource.FrameLeftMargin;t&&(i=this.ChartBorder.GetTop()+a/2+g_JSChartResource.FrameLeftMargin);var r=this.ChartBorder.GetRight();t&&(r=this.ChartBorder.GetBottom());for(var n={Data:new Map,Start:null,End:null},s=this.KData.DataOffset,o=0;s<this.KData.Data.length&&o<this.XPointCount;++s,++o,i+=e+a){var h=this.KData.Data[s],l=i,C=i+e;if(C>r)break;var u=l+(C-l)/2;0==o&&(n.XLeft=l),n.XRight=C;var D={Index:s,ShowIndex:o,X:u,Right:C,Left:l,Date:h.Date};if(ChartData.IsMinutePeriod(this.Period,!0)){var d=`Date:${h.Date} Time:${h.Time}`;D.Time=h.Time}else d=`Date:${h.Date}`;n.Data.set(d,D),0==o&&(n.Start=D),n.End=D}return n},this.GetBGCoordinate=function(t,e){var a=null,i=null,r=ChartData.IsMinutePeriod(this.Period,!0),n=!1;if(r?t.Start&&t.End&&t.Start.Date==t.End.Date&&t.Start.Time==t.End.Time&&(n=!0):t.Start&&t.End&&t.Start.Date==t.End.Date&&(n=!0),n){if(r)var s=`Date:${t.Start.Date} Time:${t.Start.Time}`;else s=`Date:${t.Start.Date}`;return e.Data.has(s)?{Left:a=(h=e.Data.get(s)).Left,Right:i=h.Right,Width:i-a}:null}if(t.Start){if(r)s=`Date:${t.Start.Date} Time:${t.Start.Time}`;else s=`Date:${t.Start.Date}`;if(e.Data.has(s))a=(h=e.Data.get(s)).Left;else if(r)if(t.Start.Date<e.Start.Date||t.Start.Date==e.Start.Date&&t.Start.Time<=e.Start.Time)a=e.Start.Left;else for(var o of e.Data){if((C=o[1]).Date>t.Start.Date||C.Date==t.Start.Date&&C.Time>t.Start.Time){a=C.Left;break}}else if(t.Start.Date<=e.Start.Date)a=e.Start.Left;else for(var o of e.Data){if((C=o[1]).Date>t.Start.Date){a=C.Left;break}}}else a=e.XLeft;if(t.End){if(r)s=`Date:${t.End.Date} Time:${t.End.Time}`;else s=`Date:${t.End.Date}`;var h;if(e.Data.has(s))i=(h=e.Data.get(s)).Right;else if(r)if(t.End.Date<e.End.Date||t.End.Date==e.End.Date&&t.End.Time>=e.End.Time)i=e.End.Right;else{var l=null;for(var o of e.Data){if((C=o[1]).Date>t.End.Date||C.Date==t.End.Date&&C.Time>t.End.Time){i=l;break}l=C.Right}}else if(t.End.Date<=e.End.Date)i=e.End.Right;else{l=null;for(var o of e.Data){var C;if((C=o[1]).Date>t.End.Date){i=l;break}l=C.Right}}}else i=e.XRight;return null==a||null==i?null:{Left:a,Right:i,Width:i-a}}}function BarrageList(){this.PlayList=[],this.Cache=[],this.MinLineHeight=40*GetDevicePixelRatio(),this.Height,this.Step=1,this.GetPlayList=function(t){for(var e=t.Canves,a=t.Right-t.Left,i=t.IsMoveStep,r=[],n=0,s=0;s<this.PlayList.length;++s){var o=this.PlayList[s],h=this.MinLineHeight;o.Height>this.MinLineHeight&&(h=o.Height);for(var l=!0,C=!1,u=0;u<o.Data.length;++u){var D=o.Data[u],d={X:D.X,Y:n,Text:D.Text,Color:D.Color,Height:h,Font:D.Font,Info:D.Info};r.push(d),i&&(u==o.Data.length-1&&this.Cache.length>0?(l=!1,D.TextWidth||(D.Font&&D.Font.Name?e.font=D.Font.Name:e.font=t.Font,D.TextWidth=e.measureText(d.Text+"擎擎").width),D.X>=D.TextWidth&&(l=!0)):0==u&&(C=!1,D.TextWidth||(D.Font&&D.Font.Name?e.font=D.Font.Name:e.font=t.Font,D.TextWidth=e.measureText(d.Text+"擎擎").width),D.X>a+D.TextWidth&&(C=!0)),D.X+=this.Step)}if(i&&l&&this.Cache.length>0){var c=this.Cache.shift(),m={X:0,Text:c.Text,Color:c.Color,Font:c.Font,Info:c.Info};o.Data.push(m)}if(i&&C&&o.Data.length>0){var f=o.Data.shift();this.OnItemPlayEnd(t.HQChart,f)}n+=h}return r},this.CacluatePlayLine=function(t){this.Height=t;var e=parseInt(t/this.MinLineHeight);if(this.PlayList.length<e)for(var a=e-this.PlayList.length,i=0;i<a;++i)this.PlayList.push({Data:[]});else if(this.PlayList.length>e){var r=this.PlayList.length-e;for(i=0;i<r;++i)for(var n=this.PlayList.pop(),s=0;s<n.Data.length;++s){var o=n.Data[s],h={Text:o.Text,Color:o.Color,Font:o.Font,Info:o.Info};this.Cache.unshift(h)}}JSConsole.Chart.Log(`[BarrageList::CacluatePlayLine] LineCount=${this.PlayList.length} Height=${this.Height}`)},this.AddBarrage=function(t){for(var e in t){var a=t[e];this.Cache.push(a)}},this.OnItemPlayEnd=function(t,e){if(t.mapEvent.has(JSCHART_EVENT_ID.BARRAGE_PLAY_END)){var a=t.mapEvent.get(JSCHART_EVENT_ID.BARRAGE_PLAY_END);a.Callback&&a.Callback(a,e,this)}},this.Count=function(){return this.Cache.length}}function BarragePaint(){this.newMethod=IExtendChartPainting,this.newMethod(),delete this.newMethod,this.ClassName="BarragePaint",this.IsAnimation=!0,this.IsEraseBG=!0,this.HQChart,this.Font=g_JSChartResource.Barrage.Font,this.TextColor=g_JSChartResource.Barrage.Color,this.FontHeight=g_JSChartResource.Barrage.Height,this.BarrageList=new BarrageList,this.IsMoveStep=!1,this.SetOption=function(t){t&&(t.Step>0&&(this.BarrageList.Step=t.Step),t.MinLineHeight&&(this.Barrage.MinLineHeight=t.MinLineHeight))},this.DrawHScreen=function(){var t=this.ChartBorder.GetWidth(),e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom(),i=this.ChartBorder.GetRightEx();this.ChartBorder.GetChartWidth();t!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(t),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var r=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:a,Left:e,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,r){this.Canvas.save(),this.Canvas.translate(this.ChartBorder.GetChartHeight(),0),this.Canvas.rotate(90*Math.PI/180);for(var n=0;n<r.length;++n){var s=r[n];s.Color?this.Canvas.fillStyle=s.Color:this.Canvas.fillStyle=this.TextColor,s.Font?this.Canvas.font=s.Font.Name:this.Canvas.font=this.Font;var o=this.FontHeight;s.Font&&s.Font.Height>0&&(o=s.Font.Height);var h=s.Y+parseInt((s.Height-o)/2);this.Canvas.fillText(s.Text,a-s.X,i+h)}this.Canvas.restore()}},this.Draw=function(){if(this.ChartFrame.IsHScreen)this.DrawHScreen();else{var t=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),a=this.ChartBorder.GetTopEx(),i=this.ChartBorder.GetHeight();i!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(i),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var r=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:e,Left:t,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,r)for(var n=0;n<r.length;++n){var s=r[n];s.Color?this.Canvas.fillStyle=s.Color:this.Canvas.fillStyle=this.TextColor,s.Font?this.Canvas.font=s.Font.Name:this.Canvas.font=this.Font;var o=this.FontHeight;s.Font&&s.Font.Height>0&&(o=s.Font.Height);var h=s.Y+parseInt((s.Height-o)/2);this.Canvas.fillText(s.Text,e-s.X,a+h)}}}}function IFrameSplitOperator(){this.ChartBorder,this.Frame,this.FrameSplitData,this.SplitCount=5,this.StringFormat=0,this.IsShowLeftText=!0,this.IsShowRightText=!0,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.IntegerCoordinateSplit=function(t){var e=this.FrameSplitData.Find(t.Interval);if(!e)return!1;if(t.Interval==e.FixInterval)return!0;var a=parseInt((t.Max/e.FixInterval+.5).toFixed(0))*e.FixInterval,i=parseInt((t.Min/e.FixInterval-.5).toFixed(0))*e.FixInterval;0==t.Min&&(i=0),i<0&&t.Min>0&&(i=0);for(var r=0,n=i;n-a<1e-8;n+=e.FixInterval)++r;return t.Interval=e.FixInterval,t.Max=a,t.Min=i,t.Count=r,!0},this.Filter=function(t,e){if(this.SplitCount<=0||t.length<=0||t.length<=this.SplitCount)return t;var a=parseInt(t.length/this.SplitCount);a<=1&&(a=2);for(var i=[],r=0;r<t.length;r+=a)r+a>=t.length&&r!=t.length-1?i.push(t[t.length-1]):i.push(t[r]);if(2==this.SplitCount&&i.length>2)for(r=1;r<i.length-1;++r){(s=i[r]).Message[0]=null,s.Message[1]=null}if(e){var n=!1;for(r=0;r<i;++r){var s=i[r];if(Math.abs(s.Value)<1e-8){n=!0;break}}if(0==n){var o=new CoordinateInfo;o.Value=0,o.Message[0]=null,o.Message[1]=null,i.push(o)}}return i},this.RemoveZero=function(t){var e=[!0,!0];for(var a in t){var i=(r=t[a]).Message[0];this.IsDecimalZeroEnd(i)||(e[0]=!1);i=r.Message[1];this.IsDecimalZeroEnd(i)||(e[1]=!1)}if(0!=e[0]||0!=e[1])for(var a in t){var r=t[a];if(e[0])null!=(i=r.Message[0])&&("number"==typeof i&&(i=i.toString()),r.Message[0]=i.replace(/[.][0]+/g,""));if(e[1])null!=(i=r.Message[1])&&("number"==typeof i&&(i=i.toString()),r.Message[1]=i.replace(/[.][0]+/g,""))}},this.IsDecimalZeroEnd=function(t){if(null==t)return!0;if("number"==typeof t&&(t=t.toString()),"0"==t)return!0;var e=t.search(/[.]/);if(e<0)return!1;for(var a=e+1;a<t.length;++a){var i=t.charAt(a);if(i>="1"&&i<="9")return!1}return!0}}function FrameSplitKLinePriceY(){this.newMethod=IFrameSplitOperator,this.newMethod(),delete this.newMethod,this.CoordinateType=0,this.Symbol,this.Data,this.FrameSplitData2,this.FloatPrecision=null,this.Period,this.KLineChart,this.Custom=[],this.SplitType=0,this.DefaultYMaxMin,this.Operator=function(){var t={};if(t.Max=this.Frame.HorizontalMax,t.Min=this.Frame.HorizontalMin,t.Count=this.SplitCount,this.DefaultYMaxMin){var e=this.DefaultYMaxMin;IFrameSplitOperator.IsNumber(e.Max)&&(t.Min>e.Max?t.Min=e.Max:t.Max<e.Max&&(t.Max=e.Max)),IFrameSplitOperator.IsNumber(e.Min)&&(t.Max<e.Min?t.Max=e.Min:t.Min>e.Min&&(t.Min=e.Min))}t.Interval=(t.Max-t.Min)/(t.Count-1);var a=GetDevicePixelRatio(),i=this.Frame.ChartBorder.GetChartWidth()<450*a,r=GetfloatPrecision(this.Symbol);i&&MARKET_SUFFIX_NAME.IsSHSZIndex(this.Symbol)&&(r=0),null!=this.FloatPrecision&&(r=this.FloatPrecision),JSConsole.Chart.Log(`[FrameSplitKLinePriceY::Operator] Max=${t.Max} Min=${t.Min} Count=${t.Count} isPhoneModel=${i} defaultfloatPrecision=${r} `),this.Frame.Logarithmic=null;var n=!0;if(ChartData.IsTickPeriod(this.Period))this.SplitTickData(t,r);else switch(this.CoordinateType){case 1:this.SplitPercentage(t,r);break;case 2:this.SplitLogarithmic(t,r)?n=!1:this.SplitDefault(t,r);break;default:1==this.SplitType?(this.SplitFixed(t,r),n=!1):this.SplitDefault(t,r)}this.CustomCoordinate(r),n&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,!1)),this.Frame.HorizontalMax=t.Max,this.Frame.HorizontalMin=t.Min,JSConsole.Chart.Log(`[FrameSplitKLinePriceY::Operator] fixed . Max=${t.Max} Min=${t.Min} Count=${t.Count}`)},this.SplitTickData=function(t,e){var a=this.KLineChart.GetAllPrice();for(var i in this.Frame.HorizontalInfo=[],a){var r=a[i];this.Frame.HorizontalInfo[i]=new CoordinateInfo,this.Frame.HorizontalInfo[i].Value=r,this.IsShowLeftText&&(this.Frame.HorizontalInfo[i].Message[0]=r.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[i].Message[1]=r.toFixed(e))}},this.SplitPercentage=function(t,e){var a=this.GetFirstOpenPrice();t.Max=(t.Max-a)/a,t.Min=(t.Min-a)/a,t.Interval=(t.Max-t.Min)/(t.Count-1),this.IntegerCoordinateSplit2(t),this.Frame.HorizontalInfo=[];for(var i=0,r=t.Min;i<t.Count;++i,r+=t.Interval){var n=(r+1)*a;this.Frame.HorizontalInfo[i]=new CoordinateInfo,this.Frame.HorizontalInfo[i].Value=n,this.IsShowLeftText&&(this.Frame.HorizontalInfo[i].Message[0]=n.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[i].Message[1]=(100*r).toFixed(2)+"%")}t.Min=(1+t.Min)*a,t.Max=(1+t.Max)*a},this.SplitLogarithmic=function(t,e){var a=g_JSChartResource.FromeLogarithmic.MinInterval,i=this.GetFirstOpenPrice();if(!IFrameSplitOperator.IsNumber(i))return!1;for(var r=this.ChartBorder.GetHeightEx(),n=[.01,.02,.04,.08,.1,.2],s=n[n.length-1],o=0;o<n.length;++o){var h=n[o];if(i*h*(r/(t.Max-t.Min))>a){s=h;break}}var l=[],C=i;o=s;do{var u={Start:C};C=i*(1+o),u.End=C,l.push(u),o+=s}while(C<t.Max);var D=C,d=[];C=i,o=s;do{u={End:C};C=i*(1-o),u.Start=C,d.push(u),o+=s}while(C>t.Min);var c=C;t.Max=D,t.Min=c,JSConsole.Chart.Log("[FrameSplitKLinePriceY::SplitLogarithmic] up, down",l,d),this.Frame.HorizontalInfo=[],(u=new CoordinateInfo).Value=i,u.Font=g_JSChartResource.FromeLogarithmic.OpenPriceFont;var m=u.Value.toFixed(e);for(var o in this.IsShowLeftText&&(u.Message[0]=m),this.IsShowRightText&&(u.Message[1]=m),this.Frame.HorizontalInfo.push(u),l){(u=new CoordinateInfo).Value=l[o].End;m=u.Value.toFixed(e);this.IsShowLeftText&&(u.Message[0]=m),this.IsShowRightText&&(u.Message[1]=m),this.Frame.HorizontalInfo.push(u)}for(var o in d){(u=new CoordinateInfo).Value=d[o].End;m=u.Value.toFixed(e);this.IsShowLeftText&&(u.Message[0]=m),this.IsShowRightText&&(u.Message[1]=m),this.Frame.HorizontalInfo.splice(0,0,u)}return this.Frame.Logarithmic={Up:l,Down:d,OpenPrice:i},!0},this.SplitDefault=function(t,e){this.IntegerCoordinateSplit(t),this.Frame.HorizontalInfo=[];for(var a=0,i=t.Min;a<t.Count;++a,i+=t.Interval)this.Frame.HorizontalInfo[a]=new CoordinateInfo,this.Frame.HorizontalInfo[a].Value=i,this.IsShowLeftText&&(this.Frame.HorizontalInfo[a].Message[0]=i.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[a].Message[1]=i.toFixed(e))},this.SplitFixed=function(t,e){this.Frame.HorizontalInfo=[];for(var a=0,i=t.Min;a<t.Count;++a,i+=t.Interval)this.Frame.HorizontalInfo[a]=new CoordinateInfo,this.Frame.HorizontalInfo[a].Value=i,this.IsShowLeftText&&(this.Frame.HorizontalInfo[a].Message[0]=i.toFixed(e)),this.IsShowRightText&&(this.Frame.HorizontalInfo[a].Message[1]=i.toFixed(e))},this.CustomCoordinate=function(t){for(var e in this.Frame.CustomHorizontalInfo=[],this.Custom){var a=this.Custom[e];if(0==a.Type){var i=t;IFrameSplitOperator.IsNumber(a.FloatPrecision)&&a.FloatPrecision>=0&&(i=a.FloatPrecision);var r=this.GetLatestPrice(i,a);r&&this.Frame.CustomHorizontalInfo.push(r)}else 1==a.Type&&this.CustomFixedCoordinate(a)}},this.GetLatestPrice=function(t,e){if(!this.Data||!this.Data.Data)return null;if(this.Data.Data.length<=0)return null;var a=this.Data.Data[this.Data.Data.length-1],i=new CoordinateInfo;return i.Type=0,i.Value=a.Close,i.TextColor=g_JSChartResource.FrameLatestPrice.TextColor,i.LineType=2,"left"==e.Position?i.Message[0]=a.Close.toFixed(t):i.Message[1]=a.Close.toFixed(t),a.Close>a.Open?i.LineColor=g_JSChartResource.FrameLatestPrice.UpBarColor:a.Close<a.Open?i.LineColor=g_JSChartResource.FrameLatestPrice.DownBarColor:i.LineColor=g_JSChartResource.FrameLatestPrice.UnchagneBarColor,IFrameSplitOperator.IsNumber(e.LineType)&&(i.LineType=e.LineType),0==e.IsShowLine&&(i.LineType=-1),i},this.GetFirstOpenPrice=function(){if(!this.Data)return null;for(var t=this.Frame.XPointCount,e=this.Data.DataOffset,a=0;e<this.Data.Data.length&&a<t;++e,++a){var i=this.Data.Data[e];if(null!=i.Open&&null!=i.High&&null!=i.Low&&null!=i.Close)return i.Open}return null},this.CustomFixedCoordinate=function(t){var e=GetfloatPrecision(this.Symbol);for(var a in t.Data){var i,r=t.Data[a],n=new CoordinateInfo;n.Type=1,n.TextColor=r.TextColor,n.LineColor=r.Color,n.LineType=2,IFrameSplitOperator.IsNumber(t.LineType)&&(n.LineType=t.LineType),0==t.IsShowLine&&(n.LineType=-1),n.Value=r.Value,i=r.Text?r.Text:n.Value.toFixed(e),"left"==t.Position?n.Message[0]=i:n.Message[1]=i,this.Frame.CustomHorizontalInfo.push(n)}},this.IntegerCoordinateSplit2=function(t){var e=this.FrameSplitData2.Find(t.Interval);if(!e)return!1;if(t.Interval==e.FixInterval)return!0;var a=parseInt((t.Max/e.FixInterval+.5).toFixed(0))*e.FixInterval,i=parseInt((t.Min/e.FixInterval-.5).toFixed(0))*e.FixInterval;0==t.Min&&(i=0),i<0&&t.Min>0&&(i=0);for(var r=0,n=i;n-a<1e-8;n+=e.FixInterval)++r;return t.Interval=e.FixInterval,t.Max=a,t.Min=i,t.Count=r,!0}}function FrameSplitY(){this.newMethod=IFrameSplitOperator,this.newMethod(),delete this.newMethod,this.SplitCount=3,this.FloatPrecision=2,this.FLOATPRECISION_RANGE=[1,.1,.01,.001,1e-4],this.SplitType=0,this.Custom=[],this.DefaultYMaxMin,this.EnableRemoveZero=!0,this.GetFloatPrecision=function(t,e){if(t>this.FLOATPRECISION_RANGE[0])return e;if(e<0)return 2;for(;e<this.FLOATPRECISION_RANGE.length&&!(t>this.FLOATPRECISION_RANGE[e]);++e);return e},this.Operator=function(){var t={};if(t.Max=this.Frame.HorizontalMax,t.Min=this.Frame.HorizontalMin,this.DefaultYMaxMin){var e=this.DefaultYMaxMin;IFrameSplitOperator.IsNumber(e.Max)&&(t.Min>e.Max?t.Min=e.Max:t.Max<e.Max&&(t.Max=e.Max)),IFrameSplitOperator.IsNumber(e.Min)&&(t.Max<e.Min?t.Max=e.Min:t.Min>e.Min&&(t.Min=e.Min))}if(this.Frame.YSpecificMaxMin?(t.Count=this.Frame.YSpecificMaxMin.Count,t.Interval=(t.Max-t.Min)/(t.Count-1)):1==this.SplitType?(t.Count=this.SplitCount,t.Interval=(t.Max-t.Min)/(t.Count-1)):(t.Count=this.SplitCount,t.Interval=(t.Max-t.Min)/(t.Count-1),this.IntegerCoordinateSplit(t)),this.Frame.HorizontalInfo=[],this.Frame.YSplitScale)for(var a in this.Frame.YSplitScale){var i=this.Frame.YSplitScale[a],r=new CoordinateInfo;if(r.Value=i,(s=Math.abs(i))<1e-10)r.Message[1]=0;else if(s<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])r.Message[1]=i.toExponential(2).toString();else{var n=this.GetFloatPrecision(s,this.FloatPrecision);r.Message[1]=IFrameSplitOperator.FormatValueString(i,n,this.LanguageID)}r.Message[0]=r.Message[1],0==this.IsShowLeftText&&(this.Frame.HorizontalInfo[a].Message[0]=null),0==this.IsShowRightText&&(this.Frame.HorizontalInfo[a].Message[1]=null),this.Frame.HorizontalInfo.push(r)}else for(a=0,i=t.Min;a<t.Count;++a,i+=t.Interval){if(this.Frame.HorizontalInfo[a]=new CoordinateInfo,this.Frame.HorizontalInfo[a].Value=i,1==this.StringFormat){n=this.FloatPrecision;!isNaN(i)&&Math.abs(i)>1e3&&(n=0),this.Frame.HorizontalInfo[a].Message[1]=IFrameSplitOperator.FormatValueString(i,n,this.LanguageID)}else{var s;if((s=Math.abs(i))<1e-10)this.Frame.HorizontalInfo[a].Message[1]=0;else if(s<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])this.Frame.HorizontalInfo[a].Message[1]=i.toExponential(2).toString();else{n=this.GetFloatPrecision(s,this.FloatPrecision);this.Frame.HorizontalInfo[a].Message[1]=IFrameSplitOperator.FormatValueString(i,n,this.LanguageID)}}this.Frame.HorizontalInfo[a].Message[0]=this.Frame.HorizontalInfo[a].Message[1],0==this.IsShowLeftText&&(this.Frame.HorizontalInfo[a].Message[0]=null),0==this.IsShowRightText&&(this.Frame.HorizontalInfo[a].Message[1]=null)}this.CustomCoordinate(),1!=this.SplitType&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,t.Max>0&&t.Min<0)),this.EnableRemoveZero&&this.RemoveZero(this.Frame.HorizontalInfo),this.Frame.HorizontalMax=t.Max,this.Frame.HorizontalMin=t.Min,this.RightFrameSplitY()},this.RightFrameSplitY=function(){if(this.Frame.RightFrame){var t=this.Frame.RightFrame;for(var e in this.Frame.HorizontalInfo){var a=this.Frame.HorizontalInfo[e],i=this.Frame.GetYFromData(a.Value),r=t.GetYData(i);a.Message[1]=IFrameSplitOperator.FormatValueString(r,this.FloatPrecision,this.LanguageID)}}},this.CustomCoordinate=function(){for(var t in this.Frame.CustomHorizontalInfo=[],this.Custom){var e=this.Custom[t];0==e.Type||1==e.Type&&this.CustomFixedCoordinate(e)}},this.CustomFixedCoordinate=function(t){for(var e in t.Data){var a,i=t.Data[e],r=new CoordinateInfo;r.Type=1,r.TextColor=i.TextColor,r.LineColor=i.Color,r.LineType=2,IFrameSplitOperator.IsNumber(t.LineType)&&(r.LineType=t.LineType),0==t.IsShowLine&&(r.LineType=-1),r.Value=i.Value,a=i.Text?i.Text:r.Value.toFixed(2),"left"==t.Position?r.Message[0]=a:r.Message[1]=a,this.Frame.CustomHorizontalInfo.push(r)}}}function FrameSplitKLineX(){this.newMethod=IFrameSplitOperator,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Period,this.Symbol,this.MinTextDistance=50*GetDevicePixelRatio(),this.MinBarDistance=5,this.SplitDateTime=function(){this.Frame.VerticalInfo=[];var t=this.Frame.DistanceWidth+this.Frame.DataWidth,e=this.Frame.Data.DataOffset,a=this.Frame.XPointCount,i=0,r=0;debug&&console.log("Frame",this,this.Frame);for(var n=0,s=e;n<a&&s<this.Frame.Data.Data.length;++n,++s){i+=t,++r;var o=null;if(0==n){var h=IFrameSplitOperator.FormatDateString(this.Frame.Data.Data[s].Date,"MM-DD");o={Value:s-e,Text:h}}else if(i>this.MinTextDistance&&r>=this.MinBarDistance){var l=IFrameSplitOperator.FormatDateString(this.Frame.Data.Data[s].Date,"MM-DD");if(l==h)o={Value:s-e,Text:IFrameSplitOperator.FormatTimeString(this.Frame.Data.Data[s].Time)};else o={Value:s-e,Text:h=l}}if(o){var C=new CoordinateInfo;C.Value=o.Value,this.ShowText&&(C.Message[0]=o.Text),this.Frame.VerticalInfo.push(C),i=0,r=0,0==n&&(i=-this.MinTextDistance/2)}}},this.SplitSecond=function(){this.Frame.VerticalInfo=[];for(var t=this.Frame.DistanceWidth+this.Frame.DataWidth,e=this.Frame.Data.DataOffset,a=this.Frame.XPointCount,i=0,r=0,n=0,s=e;n<a&&s<this.Frame.Data.Data.length;++n,++s){i+=t,++r;var o=null;if(0==n)o={Value:s-e,Text:IFrameSplitOperator.FormatDateString(this.Frame.Data.Data[s].Date,"MM-DD")};else if(i>this.MinTextDistance&&r>=this.MinBarDistance){o={Value:s-e,Text:IFrameSplitOperator.FormatTimeString(this.Frame.Data.Data[s].Time,"HH:MM:SS")}}if(o){var h=new CoordinateInfo;h.Value=o.Value,this.ShowText&&(h.Message[0]=o.Text),this.Frame.VerticalInfo.push(h),i=0,r=0,0==n&&(i=-this.MinTextDistance/2)}}},this.SplitDate=function(){this.Frame.VerticalInfo=[];for(var t=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,a=null,i=null,r=0,n=0,s=t,o=12;n<e&&s<this.Frame.Data.Data.length;++n,++s){var h=parseInt(this.Frame.Data.Data[s].Date/1e4),l=parseInt(this.Frame.Data.Data[s].Date/100)%100;if(i!=l&&++r,o<12||null!=a&&a==h&&null!=i&&i==l)i=l,++o;else{var C,u=new CoordinateInfo;u.Value=s-t,null==a||a!=h?C=h.toString():null!=i&&i==l||(C=l.toString()+"月",C=g_JSChartLocalization.GetText(C,this.LanguageID)),a=h,i=l,this.ShowText&&(u.Message[0]=C),this.Frame.VerticalInfo.push(u),o=0}}0==this.Period&&r<=2&&this.SplitShortDate()},this.SplitShortDate=function(){this.Frame.VerticalInfo=[];for(var t=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,a=!0,i=0,r=t,n=12;i<e&&r<this.Frame.Data.Data.length;++i,++r){var s=parseInt(this.Frame.Data.Data[r].Date/1e4);if(n<12)++n;else{var o,h=new CoordinateInfo;h.Value=r-t,a?(o=s.toString(),a=!1):o=IFrameSplitOperator.FormatDateString(this.Frame.Data.Data[r].Date,"MM-DD"),this.ShowText&&(h.Message[0]=o),this.Frame.VerticalInfo.push(h),n=0}}},this.Operator=function(){null!=this.Frame.Data&&(FrameSplitKLineX.SplitCustom?FrameSplitKLineX.SplitCustom(this):ChartData.IsMinutePeriod(this.Period,!0)?this.SplitDateTime():ChartData.IsSecondPeriod(this.Period)?this.SplitSecond():this.SplitDate())},this.CreateCoordinateInfo=function(){return new CoordinateInfo}}function FrameSplitMinutePriceY(){this.newMethod=IFrameSplitOperator,this.newMethod(),delete this.newMethod,this.High=null,this.Low=null,this.YClose,this.Data,this.AverageData,this.SourceData,this.OverlayChartPaint,this.SplitCount=7,this.Symbol,this.SplitType=0,this.LimitPrice,this.Custom,this.RightTextFormat=0,this.Operator=function(){if(this.Frame.HorizontalInfo=[],this.Frame.CustomHorizontalInfo=[],this.Data){var t=this.Data;if(t.Period="00",!window.chartdata[t.Period]&&(window.chartdata[t.Period]={}),t.Data.length>0){debug&&console.log(t.DataOffset,window.chartdata[t.Period].DataOffset);var e=Math.max(0,t.Data.length-this.Frame.XPointCount),a=e-(null==window.chartdata[t.Period].DataOffset?e:window.chartdata[t.Period].DataOffset);0==t.DataOffset&&(t.DataOffset=a<0||a>3?window.chartdata[t.Period].DataOffset:e)}window.chartdata[t.Period].YClose=this.YClose=_yclose(0==t.DataOffset?0:t.DataOffset+this.Frame.XPointCount-1)||this.YClose,debug&&console.log("FrameSplitMinutePriceY",t.DataOffset,this.Frame.XPointCount,this.YClose,this);var i=this.GetMaxMin();this.Symbol&&MARKET_SUFFIX_NAME.IsUSA(this.Symbol.toUpperCase())?this.USASplit(i):2==this.SplitType?this.USASplit(i):this.DefaultSplit(i),this.CustomCoordinate()}},this.CustomCoordinate=function(){if(this.Custom){var t=GetfloatPrecision(this.Symbol);for(var e in this.Custom){var a=this.Custom[e];if(1==a.Type)this.CustomFixedCoordinate(a);else if(0==a.Type){var i=this.GetLatestPrice(t,a);i&&this.Frame.CustomHorizontalInfo.push(i)}}}},this.GetLatestPrice=function(t,e){if(!this.Data||!this.Data.Data)return null;if(this.Data.Data.length<=0)return null;var a=this.Data.Data[this.Data.Data.length-1];if(!IFrameSplitOperator.IsNumber(a)||!IFrameSplitOperator.IsNumber(this.YClose))return null;var i=new CoordinateInfo;return i.Type=0,i.Value=a,i.TextColor=g_JSChartResource.FrameLatestPrice.TextColor,i.LineType=2,"left"==e.Position?i.Message[0]=a.toFixed(t):i.Message[1]=a.toFixed(t),a>this.YClose?i.LineColor=g_JSChartResource.FrameLatestPrice.UpBarColor:a<this.YClose?i.LineColor=g_JSChartResource.FrameLatestPrice.DownBarColor:i.LineColor=g_JSChartResource.FrameLatestPrice.UnchagneBarColor,IFrameSplitOperator.IsNumber(e.LineType)&&(i.LineType=e.LineType),0==e.IsShowLine&&(i.LineType=-1),i},this.CustomFixedCoordinate=function(t){var e=GetfloatPrecision(this.Symbol);for(var a in t.Data){var i,r=t.Data[a],n=new CoordinateInfo;n.Type=1,n.TextColor=r.TextColor,n.LineColor=r.Color,n.LineType=2,IFrameSplitOperator.IsNumber(t.LineType)&&(n.LineType=t.LineType),0==t.IsShowLine&&(n.LineType=-1),IFrameSplitOperator.IsNumber(r.Increase)?(IFrameSplitOperator.IsNumber(this.YClose)||conintue,n.Value=this.YClose*(1+r.Increase)):n.Value=r.Value,i=r.Text?r.Text:n.Value.toFixed(e),"left"==t.Position?n.Message[0]=i:n.Message[1]=i,this.Frame.CustomHorizontalInfo.push(n)}},this.GetMaxMin=function(){var t=this.YClose,e=this.YClose,a=this.Data,i=!1;this.SourceData&&(a=this.SourceData,i=!0),debug&&console.log(">>>>>>>>>>>>>>>>>>>> GetMaxMin",a.DataOffset,this.Frame.XPointCount);for(var r=0,n=a.DataOffset;r<this.Frame.XPointCount&&n<a.Data.length;n++,r++){var s=null;if(i){var o=a.Data[n];s=o.Before?o.Before.Close:o.Close}else s=a.Data[n];null!=s&&(t<s&&(t=s),e>s&&(e=s))}return{Max:t,Min:e}},this.USASplit=function(t){var e=t.Max,a=t.Min;if(e==a)e+=.1*e,a-=.1*a;else{var i=5*GetDevicePixelRatio()*(e-a)/this.Frame.ChartBorder.GetHeight();e+=i,(a-=i)<0&&(a=t.Min)}var r=this.SplitCount,n=(e-a)/(r-1);const s=[1,.1,.01,.001,1e-4];var o=GetfloatPrecision(this.Symbol);n<s[o]&&(e=a+(n=s[o])*r);for(var h=0;h<r;++h){var l=a+n*h;if(!this.YClose||l!=this.YClose){(D=new CoordinateInfo).Value=l;var C=l.toFixed(o);if(this.IsShowLeftText&&(D.Message[0]=C),this.YClose){var u=100*(l/this.YClose-1);u>0?D.TextColor=g_JSChartResource.UpTextColor:u<0&&(D.TextColor=g_JSChartResource.DownTextColor),this.IsShowRightText&&(1==this.RightTextFormat?D.Message[1]=C:D.Message[1]=IFrameSplitOperator.FormatValueString(u,2)+"%")}this.Frame.HorizontalInfo.push(D)}}if(this.YClose>a&&this.YClose<e){var D;(D=new CoordinateInfo).Value=this.YClose,D.LineType=2,g_JSChartResource.FrameDotSplitPen&&(D.LineColor=g_JSChartResource.FrameDotSplitPen);C=this.YClose.toFixed(o);this.IsShowLeftText&&(D.Message[0]=C),this.IsShowRightText&&(1==this.RightTextFormat?D.Message[1]=C:D.Message[1]="0.00%"),this.Frame.HorizontalInfo.push(D)}this.Frame.HorizontalInfo.sort(function(t,e){return t.Value-e.Value}),this.Frame.HorizontalMax=e,this.Frame.HorizontalMin=a},this.DefaultSplit=function(t){debug&&console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>",t);var e=t.Max,a=t.Min;if(this.YClose==e&&this.YClose==a)e=this.YClose+.1*this.YClose,a=this.YClose-.1*this.YClose;else{var i=Math.max(Math.abs(this.YClose-e),Math.abs(this.YClose-a));e=this.YClose+i,(a=this.YClose-i)<0&&(a=t.Min)}var r=GetDevicePixelRatio(),n=this.Frame.ChartBorder.GetChartWidth()<450*r;JSConsole.Chart.Log("[FrameSplitMinutePriceY]max="+e+" min="+a+" isPhoneModel="+n);var s=this.SplitCount,o=(e-a)/(s-1);const h=[1,.1,.01,.001,1e-4];var l=GetfloatPrecision(this.Symbol);n&&MARKET_SUFFIX_NAME.IsSHSZIndex(this.Symbol)&&(l=0),o<h[l]&&(o=h[l],e=this.YClose+o*(s-1)/2,a=this.YClose-o*(s-1)/2);for(var C=0;C<s;++C){var u=a+o*C,D=new CoordinateInfo;this.Frame.HorizontalInfo[C]=D,D.Value=u;var d=u.toFixed(l);if(this.IsShowLeftText&&(D.Message[0]=d),u==this.YClose&&(D.LineType=2,g_JSChartResource.FrameDotSplitPen&&(D.LineColor=g_JSChartResource.FrameDotSplitPen)),this.YClose){var c=100*(u/this.YClose-1);c>0?D.TextColor=g_JSChartResource.UpTextColor:c<0&&(D.TextColor=g_JSChartResource.DownTextColor),this.IsShowRightText&&(1==this.RightTextFormat?D.Message[1]=d:D.Message[1]=IFrameSplitOperator.FormatValueString(c,2)+"%")}}this.Frame.HorizontalMax=e,this.Frame.HorizontalMin=a}}function FrameSplitMinuteX(){this.newMethod=IFrameSplitOperator,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Symbol=null,this.DayCount=1,this.ShowDateFormate=1,this.IsBeforeData=!1,this.Operator=function(){this.Frame.VerticalInfo=[];this.Frame.XPointCount;var t=this.Frame.ChartBorder.GetWidth();!0===this.Frame.IsHScreen&&(t=this.Frame.ChartBorder.GetHeight()),t/=GetDevicePixelRatio();var e=g_MinuteCoordinateData.GetCoordinateData(this.Symbol,t),a=e.Count;a=t,a=Math.trunc(a/enlargeminutechart),debug&&console.log("width,minuteCount",t,a,this,this.Frame);var i=e.MiddleCount>0?e.MiddleCount:parseInt(a/2),r=e.Data;if(this.Frame.XPointCount=a*this.DayCount,this.Frame.MinuteCount=a,this.Frame.VerticalInfo=[],this.DayCount<=1){if(!this.Frame.Data||!window.chartdata["00"])return;var n=window.chartdata["00"].DataOffset,s=(this.Frame.XPointCount,0);debug&&console.log("FrameSplitMinuteX",n,this);for(var o=0,h=n;o<a&&h<this.Frame.Data.Data.length;++o,++h){var l=null;if(0==o){var C=IFrameSplitOperator.FormatDateString(this.Frame.Data.Data[h].Date,"MM-DD"),u=IFrameSplitOperator.FormatTimeString(this.Frame.Data.Data[h].Time);l=this.Frame.Data.Data[h].Date!=this.Frame.Data.Data[this.Frame.Data.Data.length-1].Date?{Value:r[s][0],Text:C}:{Value:r[s][0],Text:u}}else if(o==d){var D=IFrameSplitOperator.FormatDateString(this.Frame.Data.Data[h].Date,"MM-DD");if(D==C)l={Value:d,Text:u=IFrameSplitOperator.FormatTimeString(this.Frame.Data.Data[h].Time)};else l={Value:d,Text:C=D}}if(l){(m=new CoordinateInfo).Value=l.Value,this.ShowText&&(m.Message[0]=l.Text),this.Frame.VerticalInfo.push(m),++s;try{var d=Math.trunc(r[s][0]/enlargeminutechart)}catch(e){}}}}else{o=this.DayData.length-1;for(var c=0;o>=0;--o,++c){var m;(m=new CoordinateInfo).Value=c*a+i,m.LineType=-1,this.ShowText&&(m.Message[0]=IFrameSplitOperator.FormatDateString(this.DayData[o].Date,0==this.ShowFormate?"YYYY-MM-DD":"MM-DD")),this.Frame.VerticalInfo.push(m),(m=new CoordinateInfo).Value=(c+1)*a,this.Frame.VerticalInfo.push(m)}}}}function FrameSplitXData(){this.newMethod=IFrameSplitOperator,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Operator=function(){if(null!=this.Frame.Data&&null!=this.Frame.XData){this.Frame.VerticalInfo=[];for(var t=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,a=0,i=t;a<e&&i<this.Frame.Data.Data.length;++a,++i){var r=new CoordinateInfo;r.Value=i-t,this.ShowText&&(r.Message[0]=this.Frame.XData[a]),this.Frame.VerticalInfo.push(r),distance=0}}}}function ChartCorssCursor(){this.Frame,this.Canvas,this.HPenColor=g_JSChartResource.CorssCursorHPenColor,this.HPenType=0,this.VPenColor=g_JSChartResource.CorssCursorVPenColor,this.VPenType=0,this.Font=g_JSChartResource.CorssCursorTextFont,this.TextColor=g_JSChartResource.CorssCursorTextColor,this.TextBGColor=g_JSChartResource.CorssCursorBGColor,this.TextHeight=20,this.LastPoint,this.CursorIndex,this.IsOnlyDrawKLine=!1,this.IsOnlyDrawMinute=!1,this.PointX,this.PointY,this.StringFormatX,this.StringFormatY,this.ShowTextMode={Left:1,Right:1,Bottom:1},this.TextFormat={Right:0},this.IsShowCorss=!0,this.IsShow=!0,this.IsShowClose=!1,this.Close=null,this.Status=0,this.ReloadResource=function(t){this.Font=g_JSChartResource.CorssCursorTextFont,this.HPenColor=g_JSChartResource.CorssCursorHPenColor,this.VPenColor=g_JSChartResource.CorssCursorVPenColor,this.TextColor=g_JSChartResource.CorssCursorTextColor,this.TextBGColor=g_JSChartResource.CorssCursorBGColor},this.GetCloseYPoint=function(t){if(!this.StringFormatX.Data)return null;var e=this.StringFormatX.Data;if(!e.Data||e.Data.length<=0)return null;var a=e.DataOffset+t;if(a>=e.Data.length&&(a=e.Data.length-1),a<0)return null;var i=e.Data[a];return i?(this.Close=i.Close,this.Frame.GetYFromData(this.Close)):null},this.GetMinuteCloseYPoint=function(t){if(!IFrameSplitOperator.IsNumber(t))return null;if(t=parseInt(t),!this.StringFormatX.Data)return null;var e=this.StringFormatX.Data;if(!e.Data||e.Data.length<=0)return null;var a=e.DataOffset+t;if(a>=e.Data.length&&(a=e.Data.length-1),a<0)return null;var i=e.Data[a];return IFrameSplitOperator.IsNumber(t)?(this.Close=i,this.Frame.GetYFromData(this.Close)):null},this.Draw=function(){if(debug&&console.log("............ChartCorssCursor",this),this.Status=0,this.LastPoint){this.Close=null;var t,e=this.LastPoint.X,a=this.LastPoint.Y;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),t=this.Canvas.isPointInPath(e,a),this.PointY=null,this.PointY,t)if(!0!==this.Frame.IsHScreen){var i=this.Frame.ChartBorder.GetLeft(),r=this.Frame.ChartBorder.GetRight(),n=this.Frame.ChartBorder.GetTopTitle(),s=this.Frame.ChartBorder.GetBottom(),o=this.Frame.ChartBorder.Right,h=this.Frame.ChartBorder.GetChartWidth();if(this.IsOnlyDrawKLine){if(e=this.Frame.GetXFromIndex(this.CursorIndex),this.IsShowClose)null!=(l=this.GetCloseYPoint(this.CursorIndex))&&(a=l)}else if(this.IsOnlyDrawMinute){var l;null!=(l=this.GetMinuteCloseYPoint(this.CursorIndex))&&(a=l)}if(this.PointY=[[i,a],[r,a]],this.PointX=[[e,n],[e,s]],this.IsShowCorss){var C=GetDevicePixelRatio();if(this.Canvas.save(),this.Canvas.strokeStyle=this.HPenColor,0==this.HPenType&&this.Canvas.setLineDash([3*C,2*C]),this.Canvas.beginPath(),this.Canvas.moveTo(i,ToFixedPoint(a)),this.Canvas.lineTo(r,ToFixedPoint(a)),this.Canvas.stroke(),this.Canvas.restore(),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,0==this.VPenType)this.Canvas.setLineDash([3*C,2*C]);else if(2==this.VPenType){let t=this.Frame.SubFrame[0].Frame.DataWidth;t>2*C&&(this.Canvas.lineWidth=t)}if(this.Canvas.beginPath(),this.Frame.SubFrame.length>0)for(var u in this.Frame.SubFrame){n=(x=this.Frame.SubFrame[u].Frame).ChartBorder.GetTopTitle(),s=x.ChartBorder.GetBottom(),this.Canvas.moveTo(ToFixedPoint(e),n),this.Canvas.lineTo(ToFixedPoint(e),s)}else this.Canvas.moveTo(ToFixedPoint(e),n),this.Canvas.lineTo(ToFixedPoint(e),s);this.Canvas.stroke(),this.Canvas.restore()}this.Frame.GetXData(e);var D={},d=this.Frame.GetYData(a,D);if((this.IsOnlyDrawMinute||this.IsShowClose)&&null!=this.Close&&(d=this.Close),this.StringFormatX.Value=this.CursorIndex,this.StringFormatY.Value=d,this.StringFormatY.RValue=D.RightYValue,this.StringFormatY.FrameID=D.FrameID,(1==this.ShowTextMode.Left&&this.Frame.ChartBorder.Left>=30||2==this.ShowTextMode.Left||1==this.ShowTextMode.Right&&this.Frame.ChartBorder.Right>=30||2==this.ShowTextMode.Right)&&this.StringFormatY.Operator()){var c=this.StringFormatY.Text;this.Canvas.font=this.Font;var m=this.Canvas.measureText(c).width+4;if(this.Frame.ChartBorder.Left>=30&&1==this.ShowTextMode.Left?(this.Canvas.fillStyle=this.TextBGColor,i<m?(this.Canvas.fillRect(2,a-this.TextHeight/2,m,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,4,a,m)):(this.Canvas.fillRect(i-2,a-this.TextHeight/2,-m,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,i-4,a,m))):2==this.ShowTextMode.Left&&(this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(i,a-this.TextHeight/2,m,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,i+2,a,m)),this.StringFormatY.PercentageText&&0==this.TextFormat.Right&&(c=this.StringFormatY.PercentageText+"%",m=this.Canvas.measureText(c).width+4),this.StringFormatY.RText){c=this.StringFormatY.RText;m=this.Canvas.measureText(c).width+4}if(this.Frame.ChartBorder.Right>=30&&1==this.ShowTextMode.Right){var f=!1,v=null;if(D.FrameID>=0)f=(x=this.Frame.SubFrame[D.FrameID]).OverlayIndex.length>0,v=x.Interval;if(this.Canvas.fillStyle=this.TextBGColor,f&&m>v){var S=r+v;S>h&&(S=h),this.Canvas.fillRect(S-2-m,a-this.TextHeight/2,m,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,S-4,a,m)}else o<m?(this.Canvas.fillRect(h-2-m,a-this.TextHeight/2,m,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,h-4,a,m)):(this.Canvas.fillRect(r+2,a-this.TextHeight/2,m,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,r+4,a,m));if(this.StringFormatY.RExtendText&&this.StringFormatY.RExtendText.length>0){var T=0;for(var u in this.StringFormatY.RExtendText){var I="--.--";(M=this.StringFormatY.RExtendText[u]).YText?I=M.YText:IFrameSplitOperator.IsNumber(M.Y)&&(I=M.Y.toFixed(0));var F=this.Canvas.measureText(I).width+4;this.Canvas.fillStyle=M.TextBGColor,o<F?(this.Canvas.fillRect(h-2-F,a+T+this.TextHeight/2,F,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=M.TextColor,this.Canvas.fillText(I,h-4,a+T+this.TextHeight,F)):(this.Canvas.fillRect(r+2,a+T+this.TextHeight/2,F,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=M.TextColor,this.Canvas.fillText(I,r+4,a+T+this.TextHeight,F)),T+=this.TextHeight}}}else if(2==this.ShowTextMode.Right){this.Canvas.fillStyle=this.TextBGColor;var g=r-m;this.Canvas.fillRect(g,a-this.TextHeight/2,m,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,g+2,a,m)}}if(1==this.ShowTextMode.Bottom&&this.StringFormatX.Operator()){debug&&console.log("X label",this.StringFormatX.constructor.name);c=this.StringFormatX.Text;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor;m=this.Canvas.measureText(c).width+4;var p=s+2+this.TextHeight/2;e-m/2<3?(this.Canvas.fillRect(e-1,s+2,m,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,e+1,p,m)):e+m/2>=r?(this.Canvas.fillRect(r-m,s+2,m,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,r-2,p,m)):(this.Canvas.fillRect(e-m/2,s+2,m,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,e,p,m))}if(D.FrameID>=0){var x=this.Frame.SubFrame[D.FrameID],P=r;for(var u in this.Canvas.font=this.Font,x.OverlayIndex){var M;if(!1!==(M=x.OverlayIndex[u]).Frame.IsShow){if((P+=x.Interval)+30>h)break;for(d=M.Frame.GetYData(a),u=2;u>=0;--u){c=IFrameSplitOperator.FormatValueString(d,u);if((m=this.Canvas.measureText(c).width+4)<x.Interval)break}this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(P+2,a-this.TextHeight/2,m,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(c,P+4,a,m)}}}this.Status=1}else this.HScreenDraw()}},this.HScreenDraw=function(){var t=this.LastPoint.X,e=this.LastPoint.Y;this.IsOnlyDrawKLine&&(e=this.Frame.GetXFromIndex(this.CursorIndex));var a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetRightEx(),r=this.Frame.ChartBorder.GetTop(),n=this.Frame.ChartBorder.GetBottom(),s=this.Frame.ChartBorder.Bottom;if(this.PointY=[[a,e],[i,e]],this.PointX=[[t,r],[t,n]],this.IsShowCorss){var o=GetDevicePixelRatio();if(this.Canvas.save(),this.Canvas.strokeStyle=this.HPenColor,0==this.HPenType&&this.Canvas.setLineDash([3*o,2*o]),this.Canvas.beginPath(),this.Canvas.moveTo(ToFixedPoint(t),r),this.Canvas.lineTo(ToFixedPoint(t),n),this.Canvas.stroke(),this.Canvas.restore(),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,0==this.VPenType)this.Canvas.setLineDash([3*o,2*o]);else if(2==this.VPenType){let t=this.Frame.SubFrame[0].Frame.DataWidth;t>2*o&&(this.Canvas.lineWidth=t)}if(this.Canvas.beginPath(),this.Frame.SubFrame.length>0)for(var h in this.Frame.SubFrame){var l=this.Frame.SubFrame[h].Frame;this.Canvas.moveTo(l.ChartBorder.GetLeft(),ToFixedPoint(e)),this.Canvas.lineTo(l.ChartBorder.GetRightTitle(),ToFixedPoint(e))}else this.Canvas.moveTo(a,ToFixedPoint(e)),this.Canvas.lineTo(i,ToFixedPoint(e));this.Canvas.stroke(),this.Canvas.restore()}var C=this.Frame.GetXData(e),u={},D=this.Frame.GetYData(t,u);if(this.StringFormatX.Value=C,this.StringFormatY.Value=D,this.StringFormatY.FrameID=u.FrameID,(1==this.ShowTextMode.Left&&this.Frame.ChartBorder.Top>=30||2==this.ShowTextMode.Left||1==this.ShowTextMode.Right&&this.Frame.ChartBorder.Bottom>=30||2==this.ShowTextMode.Right)&&this.StringFormatY.Operator()){var d=this.StringFormatY.Text;this.Canvas.font=this.Font;var c=this.Canvas.measureText(d).width+4;if(this.Frame.ChartBorder.Top>=30&&1==this.ShowTextMode.Left){var m=t,f=r;this.Canvas.save(),this.Canvas.translate(m,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,r>=c?(this.Canvas.fillRect(0,-this.TextHeight/2,-c,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,-2,0,c)):(this.Canvas.fillRect(c-r,-this.TextHeight/2,-c,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,c-r-2,0,c)),this.Canvas.restore()}else if(2==this.ShowTextMode.Left){m=t,f=r;this.Canvas.save(),this.Canvas.translate(m,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-this.TextHeight/2,c,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,2,0,c),this.Canvas.restore()}if(this.Frame.ChartBorder.Bottom>=30&&1==this.ShowTextMode.Right){m=t,f=n;if(this.Canvas.save(),this.Canvas.translate(m,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,s>c?(this.Canvas.fillRect(0,-this.TextHeight/2,c,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,2,0,c)):(this.Canvas.fillRect(s-c,-this.TextHeight/2,c,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,s-c+2,0,c)),this.StringFormatY.RExtendText&&this.StringFormatY.RExtendText.length>0){var v=0;for(var h in this.StringFormatY.RExtendText){var S=this.StringFormatY.RExtendText[h],T="--.--";S.YText?T=S.YText:IFrameSplitOperator.IsNumber(S.Y)&&(T=S.Y.toFixed(0));var I=this.Canvas.measureText(T).width+4;if(this.Canvas.fillStyle=S.TextBGColor,s>I)this.Canvas.fillRect(0,v+this.TextHeight/2,I,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=S.TextColor,this.Canvas.fillText(T,2,v+this.TextHeight,I);else{var F=s-I;this.Canvas.fillRect(F,v+this.TextHeight/2,I,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=S.TextColor,this.Canvas.fillText(T,F+2,v+this.TextHeight,I)}v+=this.TextHeight}}this.Canvas.restore()}else if(2==this.ShowTextMode.Right){m=t,f=n;this.Canvas.save(),this.Canvas.translate(m,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-this.TextHeight/2,-c,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,-2,0,c),this.Canvas.restore()}}if(1===this.ShowTextMode.Bottom&&this.StringFormatX.Operator()){d=this.StringFormatX.Text;if(this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor,e-(c=this.Canvas.measureText(d).width+4)/2<3){m=a,f=e;this.Canvas.save(),this.Canvas.translate(m,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(0,0,c,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,2,this.TextHeight/2,c),this.Canvas.restore()}else if(e+c/2>=n){m=a,f=e;this.Canvas.save(),this.Canvas.translate(m,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(-c,0,c,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,-2,this.TextHeight/2,c),this.Canvas.restore()}else{m=a,f=e;this.Canvas.save(),this.Canvas.translate(m,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(-c/2,0,c,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(d,0,this.TextHeight/2,c),this.Canvas.restore()}}this.Status=1}}function ChartSplashPaint(){this.Frame,this.Canvas,this.Font=g_JSChartResource.DefaultTextFont,this.TextColor=g_JSChartResource.DefaultTextColor,this.IsEnableSplash=!1,this.SplashTitle="数据加载中",this.HQChart,this.EnableSplash=function(t){if(this.IsEnableSplash=t,this.HQChart){var e=this.HQChart.GetEventCallback(JSCHART_EVENT_ID.ON_ENABLE_SPLASH_DRAW);if(e){var a={Enable:t};e.Callback(e,a,this)}}},this.Draw=function(){if(this.IsEnableSplash)if(!0!==this.Frame.IsHScreen){var t=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,e=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,t,e)}else this.HScreenDraw()},this.HScreenDraw=function(){var t=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,e=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.save(),this.Canvas.translate(t,e),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,0,0),this.Canvas.restore()}}function IChangeStringFormat(){this.Data,this.Value,this.Text,this.Operator=function(){return!1}}IFrameSplitOperator.FormatValueThousandsString=function(t,e){if(null==t||isNaN(t)){if(e>0){for(var a="-.",i=0;i<e;++i)a+="-";return a}return"--"}var r="",n=t.toFixed(e);if(e>0){for(var s=n.split(".")[1],o=n.split(".")[0];o.length>3;)r=","+o.slice(-3)+r,o=o.slice(0,o.length-3);o&&(r=o+r+"."+s)}else{for(;n.length>3;)r=","+n.slice(-3)+r,n=n.slice(0,n.length-3);n&&(r=n+r)}return r},IFrameSplitOperator.FormatValueString=function(t,e,a){if(null==t||isNaN(t)){if(e>0){for(var i="-.",r=0;r<e;++r)i+="-";return i}return"--"}if(t<1e-11&&t>-1e-11)return"0";var n=Math.abs(t);return a===JSCHART_LANGUAGE_ID.LANGUAGE_ENGLISH_ID?n<1e4?t.toFixed(e):n<1e6?(t/1e3).toFixed(e)+"K":n<1e9?(t/1e6).toFixed(e)+"M":n<1e12?(t/1e9).toFixed(e)+"B":(t/1e12).toFixed(e)+"T":n<1e4?t.toFixed(e):n<1e8?(t/1e4).toFixed(e)+"万":n<1e12?(t/1e8).toFixed(e)+"亿":(t/1e12).toFixed(e)+"万亿"},IFrameSplitOperator.FromatIntegerString=function(t,e,a){return t<1e4&&IFrameSplitOperator.IsInteger(t)&&(e=0),IFrameSplitOperator.FormatValueString(t,e,a)},IFrameSplitOperator.NumberToString=function(t){return t<10?"0"+t.toString():t.toString()},IFrameSplitOperator.FormatDateString=function(t,e,a){var i=parseInt(t/1e4),r=parseInt(t/100)%100,n=t%100;switch(e){case"MM-DD":return IFrameSplitOperator.NumberToString(r)+"-"+IFrameSplitOperator.NumberToString(n);case"YYYY/MM/DD":return i.toString()+"/"+IFrameSplitOperator.NumberToString(r)+"/"+IFrameSplitOperator.NumberToString(n);case"YYYY/MM/DD/W":var s=new Date(i,r-1,n),o=g_JSChartLocalization.GetText(WEEK_NAME[s.getDay()],a);return i.toString()+"/"+IFrameSplitOperator.NumberToString(r)+"/"+IFrameSplitOperator.NumberToString(n)+"/"+o.toString();default:return i.toString()+"-"+IFrameSplitOperator.NumberToString(r)+"-"+IFrameSplitOperator.NumberToString(n)}},IFrameSplitOperator.FormatTimeString=function(t,e){if("HH:MM:SS"==e){var a=parseInt(t/1e4),i=parseInt(t%1e4/100),r=t%100;return IFrameSplitOperator.NumberToString(a)+":"+IFrameSplitOperator.NumberToString(i)+":"+IFrameSplitOperator.NumberToString(r)}if("HH:MM"==e){a=parseInt(t/100),i=t%100;return IFrameSplitOperator.NumberToString(a)+":"+IFrameSplitOperator.NumberToString(i)}if(t<1e4){a=parseInt(t/100),i=t%100;return IFrameSplitOperator.NumberToString(a)+":"+IFrameSplitOperator.NumberToString(i)}a=parseInt(t/1e4),i=parseInt(t%1e4/100),r=t%100;return IFrameSplitOperator.NumberToString(a)+":"+IFrameSplitOperator.NumberToString(i)+":"+IFrameSplitOperator.NumberToString(r)},IFrameSplitOperator.FormatReportDateString=function(t){var e,a=parseInt(t/1e4);switch(parseInt(t/100)%100){case 3:e="一季度报";break;case 6:e="半年报";break;case 9:e="三季度报";break;case 12:e="年报"}return a.toString()+e},IFrameSplitOperator.FormatDateTimeString=function(t,e,a){var i=t.split(" ");if(i.length<2)return"";var r="";if(e){var n=parseInt(i[0]),s=parseInt(n/1e4),o=parseInt(n%1e4/100),h=n%100;r+=D=s.toString()+"-"+(o<10?"0"+o.toString():o.toString())+"-"+(h<10?"0"+h.toString():h.toString())}if(a){var l=parseInt(i[1]),C=l%100,u=parseInt(l/100),D=(u<10?"0"+u.toString():u.toString())+":"+(C<10?"0"+C.toString():C.toString());r.length>0&&(r+=" "),r+=D}return r},IFrameSplitOperator.FormatValueColor=function(t,e){return null!=t&&null==e?0==t?"PriceNull":t>0?"PriceUp":"PriceDown":null==t||null==e?"PriceNull":t==e?"PriceNull":t>e?"PriceUp":"PriceDown"},IFrameSplitOperator.IsNumber=function(t){return null!=t&&!isNaN(t)},IFrameSplitOperator.IsPlusNumber=function(t){return null!=t&&(!isNaN(t)&&t>0)},IFrameSplitOperator.IsInteger=function(t){return"number"==typeof t&&t%1==0},IFrameSplitOperator.IsObjectExist=function(t){return void 0!==t&&null!=t},IFrameSplitOperator.IsBool=function(t){return!0===t||!1===t},IFrameSplitOperator.IsString=function(t){return!(!t||"string"!=typeof t)},IFrameSplitOperator.RemoveZero=function(t){for(;t.length>0;){var e=t.length-1,a=t[e];if("0"!=a){if("."==a){t=t.substr(0,e);break}break}t=t.substr(0,e)}return t};var ZOOM_VALUE=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10];function HQPriceStringFormat(){this.newMethod=IChangeStringFormat,this.newMethod(),delete this.newMethod,this.Symbol,this.FrameID,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.YClose,this.PercentageText,this.RValue,this.RText,this.ExtendChartPaint,this.RExtendText=[],this.Operator=function(){if(this.RText=null,this.RExtendText=[],IFrameSplitOperator.IsString(this.RValue)&&(this.RText=this.RValue),!this.Value)return!1;this.PercentageText=null;var t=2;if(0==this.FrameID){t=GetfloatPrecision(this.Symbol);this.Text=this.Value.toFixed(t),this.YClose>0&&(this.PercentageText=(100*(this.Value-this.YClose)/this.YClose).toFixed(2)),this.GetExtendPaintData(t)}else 1==this.FrameID?(this.Text=IFrameSplitOperator.FormatValueString(this.Value,t,this.LanguageID),IFrameSplitOperator.IsNumber(this.RValue)&&(this.RText=IFrameSplitOperator.FormatValueString(this.RValue,t,this.LanguageID))):this.Text=IFrameSplitOperator.FormatValueString(this.Value,t,this.LanguageID);return!0},this.GetExtendPaintData=function(t){var e=parseInt(this.Value*ZOOM_VALUE[t]);for(var a in this.ExtendChartPaint){var i=this.ExtendChartPaint[a];if("DepthMapPaint"==i.ClassName&&i.FrameID==this.FrameID){var r=i.GetYValueByXValue(e,t);for(var n in r)this.RExtendText.push(r[n])}}}}function HQDateStringFormat(){this.newMethod=IChangeStringFormat,this.newMethod(),delete this.newMethod,this.DateFormatType=0,this.LanguageID=0,this.Operator=function(){if(!IFrameSplitOperator.IsNumber(this.Value))return!1;if(!this.Data)return!1;var t=this.Value;if(t=parseInt(t.toFixed(0)),this.Data.DataOffset+t>=this.Data.Data.length)return!1;var e=this.Data.Data[this.Data.DataOffset+t],a="YYYY-MM-DD";if(1==this.DateFormatType?a="YYYY/MM/DD":2==this.DateFormatType&&(a="YYYY/MM/DD/W"),this.Text=IFrameSplitOperator.FormatDateString(e.Date,a,this.LanguageID),ChartData.IsMinutePeriod(this.Data.Period,!0)){var i=IFrameSplitOperator.FormatTimeString(e.Time);this.Text=this.Text+"  "+i}else if(ChartData.IsSecondPeriod(this.Data.Period)){i=IFrameSplitOperator.FormatTimeString(e.Time,"HH:MM:SS");this.Text=this.Text+"  "+i}else if(ChartData.IsTickPeriod(this.Data.Period)){i=IFrameSplitOperator.FormatTimeString(e.Time);this.Text=this.Text+"  "+i}return!0}}function HQMinuteTimeStringFormat(){this.newMethod=IChangeStringFormat,this.newMethod(),delete this.newMethod,this.Frame,this.Symbol,this.IsBeforeData=!1,this.Operator=function(){if(null==this.Value||isNaN(this.Value))return!1;var t=Math.abs(this.Value);t=parseInt(t.toFixed(0));var e=this.Data.DataOffset+t;return!(e<0||e>=window.minutedata.length)&&(this.Text=IFrameSplitOperator.FormatDateTimeString(datetime(window.minutedata[e][0]),!0,!0),!0)}}var WEEK_NAME=["日","一","二","三","四","五","六"];function HistoryDataStringFormat(){this.newMethod=IChangeStringFormat,this.newMethod(),delete this.newMethod,this.Symbol,this.UpColor=g_JSChartResource.UpTextColor,this.DownColor=g_JSChartResource.DownTextColor,this.UnchagneColor=g_JSChartResource.UnchagneTextColor,this.VolColor=g_JSChartResource.Title.VolColor,this.AmountColor=g_JSChartResource.Title.AmountColor,this.TurnoverRateColor=g_JSChartResource.Title.TurnoverRateColor,this.PositionColor=g_JSChartResource.Title.PositionColor,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.LineCount=0,this.LineHeight=g_JSChartResource.PCTooltip.LineHeight,this.Width=157,this.Height=5*this.LineHeight,this.Operator=function(){var t=this.Value.Data;if(!t)return!1;this.Width=157,this.LanguageID==JSCHART_LANGUAGE_ID.LANGUAGE_ENGLISH_ID&&(this.Width=180);var e=new Date(parseInt(t.Date/1e4),t.Date/100%100-1,t.Date%100),a=IFrameSplitOperator.FormatDateString(t.Date),i=g_JSChartLocalization.GetText(WEEK_NAME[e.getDay()],this.LanguageID);ChartData.IsMinutePeriod(this.Value.ChartPaint.Data.Period,!0)?i=IFrameSplitOperator.FormatTimeString(t.Time):ChartData.IsSecondPeriod(this.Value.ChartPaint.Data.Period)&&(i=IFrameSplitOperator.FormatTimeString(t.Time,"HH:MM:SS"));var r=this.Symbol.toUpperCase(),n=GetfloatPrecision(this.Symbol),s=null;t.YClose>0&&(s=(t.Close-t.YClose)/t.YClose*100);var o="<span class=\'tooltip-title\'>"+a+"&nbsp&nbsp"+i+"</span><span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Open",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.GetColor(t.Open,t.YClose)+";\'>"+t.Open.toFixed(n)+"</span><br/><span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-High",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.GetColor(t.High,t.YClose)+";\'>"+t.High.toFixed(n)+"</span><br/><span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Low",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.GetColor(t.Low,t.YClose)+";\'>"+t.Low.toFixed(n)+"</span><br/><span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Close",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.GetColor(t.Close,t.YClose)+";\'>"+t.Close.toFixed(n)+"</span><br/><span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Vol",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.VolColor+";\'>"+IFrameSplitOperator.FormatValueString(t.Vol,2,this.LanguageID)+"</span><br/><span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Amount",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.AmountColor+";\'>"+IFrameSplitOperator.FormatValueString(t.Amount,2,this.LanguageID)+"</span><br/><span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Increase",this.LanguageID)+"</span>"+(null==s?"<span class=\'tooltip-num\' style=\'color:"+this.GetColor(0,0)+";\'>--</span><br/>":"<span class=\'tooltip-num\' style=\'color:"+this.GetColor(s,0)+";\'>"+s.toFixed(2)+"%</span><br/>");if(this.LineCount=8,MARKET_SUFFIX_NAME.IsSHSZStockA(this.Symbol)&&t.FlowCapital>0){var h=t.Vol/t.FlowCapital*100;o+="<span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Exchange",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.TurnoverRateColor+";\'>"+h.toFixed(2)+"%</span><br/>",++this.LineCount}(MARKET_SUFFIX_NAME.IsFutures(r)&&IFrameSplitOperator.IsNumber(t.Position)&&(o+="<span class=\'tooltip-con\'>"+g_JSChartLocalization.GetText("DivTooltip-Position",this.LanguageID)+"</span><span class=\'tooltip-num\' style=\'color:"+this.PositionColor+";\'>"+t.Position+"</span><br/>",++this.LineCount),"Overlay-KLine"==this.Value.ChartPaint.Name)&&(o="<span style=\'color:rgb(0,0,0);font:微软雅黑;font-size:12px;text-align:center;display: block;\'>"+this.Value.ChartPaint.Title+"</span>"+o,++this.LineCount);return this.Text=o,this.Height=this.LineCount*this.LineHeight,!0},this.GetColor=function(t,e){return t>e?this.UpColor:t<e?this.DownColor:this.UnchagneColor}}function KLineInfoDataStringFormat(){this.newMethod=IChangeStringFormat,this.newMethod(),delete this.newMethod,this.UpColor=g_JSChartResource.UpTextColor,this.DownColor=g_JSChartResource.DownTextColor,this.UnchagneColor=g_JSChartResource.UnchagneTextColor,this.Width=500,this.Operator=function(){if(!this.Value)return!1;var t=this.Value.Data.Data,e=this.Value.Data.Type,a="";for(var i in t){var r=t[i],n="";switch(e){case KLINE_INFO_TYPE.BLOCKTRADING:n=this.BlockTradingFormat(r);break;case KLINE_INFO_TYPE.TRADEDETAIL:n=this.TradeDetailFormat(r);break;case KLINE_INFO_TYPE.RESEARCH:n=this.ResearchFormat(r);break;case KLINE_INFO_TYPE.PFORECAST:n=this.PerformanceForecastFormat(r);break;default:n=this.DefaultFormat(r)}a+=n}var s="<div class=\'title-length\'>"+a+"</div>";t.length>8&&(s+="<div class=\'total-list\'>共"+t.length+"条</div>");return this.Text=s,!0},this.DefaultFormat=function(t){return"<span>"+IFrameSplitOperator.FormatDateString(t.Date)+"&nbsp;&nbsp;&nbsp;"+t.Title+"</span>"},this.BlockTradingFormat=function(t){var e=t.ExtendData;return"<span><i class=\'date-tipbox\'>"+IFrameSplitOperator.FormatDateString(t.Date)+"</i>&nbsp;&nbsp;<i class=\'tipBoxTitle\'>成交价:&nbsp;"+e.Price.toFixed(2)+"</i><i class=\'tipBoxTitle\'>收盘价:&nbsp;"+e.ClosePrice.toFixed(2)+"</i><br/><i class=\'rate-discount tipBoxTitle\'>溢折价率:&nbsp;<strong style=\'color:"+this.GetColor(e.Premium.toFixed(2))+"\'>"+e.Premium.toFixed(2)+"%</strong></i><i class=\'tipBoxTitle\'>成交量(万股):&nbsp;"+e.Vol.toFixed(2)+"</i></span>"},this.TradeDetailFormat=function(t){var e=t.ExtendData.Detail,a=IFrameSplitOperator.FormatDateString(t.Date),i=[];for(var r in e)i+="<i>"+e[r].TypeExplain+"</i><br/>";return"<span><i class=\'trade-time\'>"+a+"&nbsp;&nbsp;&nbsp;上榜原因:&nbsp;&nbsp;</i><i class=\'reason-list\'>"+i+"</i><br/><i class=\'trade-detall\'>一周后涨幅:&nbsp;<strong style=\'color:"+this.GetColor(t.ExtendData.FWeek.Week1.toFixed(2))+"\'>"+t.ExtendData.FWeek.Week1.toFixed(2)+"%</strong>&nbsp;&nbsp;&nbsp;四周后涨幅:&nbsp;<strong style=\'color:"+this.GetColor(t.ExtendData.FWeek.Week4.toFixed(2))+";\'>"+t.ExtendData.FWeek.Week4.toFixed(2)+"%</strong></i></span>"},this.ResearchFormat=function(t){var e=t.ExtendData.Level,a="";if(0==e.length)a="<i>一般调研</i>";else{for(var i in e)0==e[i]?a+="<i style=\'color:#00a0e9\'>证券代表&nbsp;&nbsp;&nbsp;</i>":1==e[i]?a+="<i>董秘&nbsp;&nbsp;&nbsp;</i>":2==e[i]?a+="<i style=\'color:#00a0e9\'>总经理&nbsp;&nbsp;&nbsp;</i>":3==e[i]&&(a+="<i style=\'color:#00a0e9\'>董事长&nbsp;&nbsp;&nbsp;</i>");a="接待:&nbsp;&nbsp;&nbsp;"+a}var r="";return t.ExtendData.Type&&"其他"!=t.ExtendData.Type&&(r="&nbsp;&nbsp;&nbsp;<i>"+t.ExtendData.Type+"</i>",0==e.length&&(a="")),"<span>"+IFrameSplitOperator.FormatDateString(t.Date)+"&nbsp;&nbsp;&nbsp;"+r+a+"</span>"},this.PerformanceForecastFormat=function(t){var e,a=t.ExtendData.ReportDate,i=parseInt(a/1e4),r=a%1e4;1231==r?e="年报":331==r?e="一季度报":630==r?e="半年度报":930==r&&(e="三季度报");var n="";return t.ExtendData.FWeek&&(null!=t.ExtendData.FWeek.Week1&&(n+="一周后涨幅:<i class=\'increase\' style=\'color:"+this.GetColor(t.ExtendData.FWeek.Week1.toFixed(2))+"\'>"+t.ExtendData.FWeek.Week1.toFixed(2)+"%</i>"),null!=t.ExtendData.FWeek.Week4&&(n+="&nbsp;四周后涨幅:<i class=\'increase\' style=\'color:"+this.GetColor(t.ExtendData.FWeek.Week4.toFixed(2))+"\'>"+t.ExtendData.FWeek.Week4.toFixed(2)+"%</i>"),n.length>0&&(n="<br/>&nbsp;&nbsp;<i class=\'prorecast-week\'>"+n+"</i>")),"<span>"+IFrameSplitOperator.FormatDateString(t.Date)+"&nbsp;&nbsp;"+i+e+t.Title+"&nbsp;"+n+"</span>"},this.GetColor=function(t){return t>0?this.UpColor:t<0?this.DownColor:this.UnchagneColor}}function KLineTradeDataStringFormat(){this.newMethod=IChangeStringFormat,this.newMethod(),delete this.newMethod,this.Width=100,this.Operator=function(){var t=this.Value.Data;if(!t)return!1;var e,a=t.Data,i=`<span class=\'tooltip-index-name\'>${a.Name}${a.Param}:</span>`;return e=1==a.Type?"<span class=\'tooltip-index-buy\'>买入</span>":"<span class=\'tooltip-index-sell\'>卖出</span>",this.Text=i+e,!0}}function MinuteInfoDataStringFormat(){this.newMethod=IChangeStringFormat,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){var t=this.Value.Data;if(!t)return!1;var e=t.Data.Item,a=`<span class=\'tooltip-minuteinfo-time\'>${IFrameSplitOperator.FormatTimeString(e.Time)} </span>`,i=`<span class=\'tooltip-minuteinfo-content\'>${e.Title}</span>`;return e.Content&&(i=`<span class=\'tooltip-minuteinfo-content\'>${e.Content}</span>`),this.Text=a+i,!0}}function DivTooltipDataForamt(){this.DataMap=new Map([["KLineTradeDataStringFormat",{Create:function(){return new KLineTradeDataStringFormat}}],["MinuteInfoDataStringFormat",{Create:function(){return new MinuteInfoDataStringFormat}}],["HistoryDataStringFormat",{Create:function(){return new HistoryDataStringFormat}}],["KLineInfoDataStringFormat",{Create:function(){return new KLineInfoDataStringFormat}}],["CorssCursor_XStringFormat",{Create:function(){return new HQDateStringFormat}}],["CorssCursor_YStringFormat",{Create:function(){return new HQPriceStringFormat}}]]),this.Create=function(t){return this.DataMap.has(t)?this.DataMap.get(t).Create():null}}var g_DivTooltipDataForamt=new DivTooltipDataForamt;function IChartTitlePainting(){this.Frame,this.Data=new Array,this.Canvas,this.IsDynamic=!1,this.Position=0,this.CursorIndex,this.Font=g_JSChartResource.TitleFont,this.Title,this.TitleColor=g_JSChartResource.DefaultTextColor,this.ClassName="IChartTitlePainting",this.ReloadResource=function(){this.Font=g_JSChartResource.TitleFont,this.TitleColor=g_JSChartResource.DefaultTextColor}}var RIGHT_NAME=["不复权","前复权","后复权"];function DynamicKLineTitlePainting(){this.newMethod=IChartTitlePainting,this.newMethod(),delete this.newMethod,this.ClassName="DynamicKLineTitlePainting",this.IsDynamic=!0,this.IsShow=!0,this.Period,this.UpColor=g_JSChartResource.UpTextColor,this.DownColor=g_JSChartResource.DownTextColor,this.UnchagneColor=g_JSChartResource.UnchagneTextColor,this.VolColor=g_JSChartResource.Title.VolColor,this.AmountColor=g_JSChartResource.Title.AmountColor,this.DateTimeColor=g_JSChartResource.Title.DateTimeColor,this.NameColor=g_JSChartResource.Title.NameColor,this.SettingColor=g_JSChartResource.Title.SettingColor,this.TurnoverRateColor=g_JSChartResource.Title.TurnoverRateColor,this.PositionColor=g_JSChartResource.Title.PositionColor,this.Symbol,this.Name,this.SpaceWidth=2*GetDevicePixelRatio(),this.OverlayChartPaint,this.IsShowName=!0,this.IsShowSettingInfo=!0,this.IsShowDateTime=!0,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.OnDrawEvent,this.ReloadResource=function(){this.Font=g_JSChartResource.TitleFont,this.TitleColor=g_JSChartResource.DefaultTextColor,this.UpColor=g_JSChartResource.UpTextColor,this.DownColor=g_JSChartResource.DownTextColor,this.UnchagneColor=g_JSChartResource.UnchagneTextColor,this.VolColor=g_JSChartResource.Title.VolColor,this.AmountColor=g_JSChartResource.Title.AmountColor,this.DateTimeColor=g_JSChartResource.Title.DateTimeColor,this.NameColor=g_JSChartResource.Title.NameColor,this.SettingColor=g_JSChartResource.Title.SettingColor,this.TurnoverRateColor=g_JSChartResource.Title.TurnoverRateColor,this.PositionColor=g_JSChartResource.Title.PositionColor},this.GetCurrentKLineData=function(){if(null==this.CursorIndex||!this.Data)return null;if(this.Data.length<=0)return null;var t=this.CursorIndex;t=parseInt(t.toFixed(0));var e=this.Data.DataOffset+t;return e>=this.Data.Data.length&&(e=this.Data.Data.length-1),e<0?null:this.Data.Data[e]},this.DrawItem=function(t){var e=!0===this.Frame.IsHScreen,a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetTop()-this.Frame.ChartBorder.Top/2,r=(this.Frame.ChartBorder.GetRight(),GetfloatPrecision(this.Symbol)),n=this.Symbol.toUpperCase();if(e){if(this.Frame.ChartBorder.Right<5)return;a=2,i=this.Frame.ChartBorder.Right/2,this.Frame.ChartBorder.GetHeight();var s=this.Frame.ChartBorder.GetChartWidth(),o=this.Frame.ChartBorder.GetTop();this.Canvas.translate(s,o),this.Canvas.rotate(90*Math.PI/180)}else if(this.Frame.ChartBorder.Top<5*GetDevicePixelRatio())return;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var h={Left:a,Bottom:i,IsHScreen:e};if(!this.IsShowName||this.DrawText(this.Name,this.NameColor,h)){if(this.IsShowSettingInfo){var l="",C="("+(l=this.Data.Period>CUSTOM_MINUTE_PERIOD_START&&this.Data.Period<=CUSTOM_MINUTE_PERIOD_END?this.Data.Period-CUSTOM_MINUTE_PERIOD_START+g_JSChartLocalization.GetText("自定义分钟",this.LanguageID):this.Data.Period>CUSTOM_DAY_PERIOD_START&&this.Data.Period<=CUSTOM_DAY_PERIOD_END?this.Data.Period-CUSTOM_DAY_PERIOD_START+g_JSChartLocalization.GetText("自定义日线",this.LanguageID):this.Data.Period>CUSTOM_SECOND_PERIOD_START&&this.Data.Period<=CUSTOM_SECOND_PERIOD_END?this.Data.Period-CUSTOM_SECOND_PERIOD_START+g_JSChartLocalization.GetText("自定义秒",this.LanguageID):g_JSChartLocalization.GetText(ChartData.GetPeriodName(this.Data.Period),this.LanguageID))+" "+g_JSChartLocalization.GetText(RIGHT_NAME[this.Data.Right],this.LanguageID)+")",u=MARKET_SUFFIX_NAME.IsSHSZStockA(this.Symbol);if(null==t.Time&&u||(C="("+l+")"),!this.DrawText(C,this.SettingColor,h))return}if(this.IsShowDateTime){C=IFrameSplitOperator.FormatDateString(t.Date);if(!this.DrawText(C,this.DateTimeColor,h))return}if(ChartData.IsMinutePeriod(this.Period,!0)&&t.Time){C=IFrameSplitOperator.FormatTimeString(t.Time);if(!this.DrawText(C,this.DateTimeColor,h))return}else if(ChartData.IsSecondPeriod(this.Period)&&t.Time){C=IFrameSplitOperator.FormatTimeString(t.Time,"HH:MM:SS");if(!this.DrawText(C,this.DateTimeColor,h))return}var D=this.GetColor(t.Open,t.YClose);C=g_JSChartLocalization.GetText("KTitle-Open",this.LanguageID)+t.Open.toFixed(r);if(this.DrawText(C,D,h)){D=this.GetColor(t.High,t.YClose),C=g_JSChartLocalization.GetText("KTitle-High",this.LanguageID)+t.High.toFixed(r);if(this.DrawText(C,D,h)){D=this.GetColor(t.Low,t.YClose),C=g_JSChartLocalization.GetText("KTitle-Low",this.LanguageID)+t.Low.toFixed(r);if(this.DrawText(C,D,h)){D=this.GetColor(t.Close,t.YClose),C=g_JSChartLocalization.GetText("KTitle-Close",this.LanguageID)+t.Close.toFixed(r);if(this.DrawText(C,D,h)){if(t.YFClose>0&&MARKET_SUFFIX_NAME.IsChinaFutures(n)){var d=(t.Close-t.YFClose)/t.YFClose*100;D=this.GetColor(d,0),C=g_JSChartLocalization.GetText("KTitle-Increase",this.LanguageID)+d.toFixed(2)+"%";if(!this.DrawText(C,D,h))return}else if(t.YClose>0){d=(t.Close-t.YClose)/t.YClose*100,D=this.GetColor(d,0),C=g_JSChartLocalization.GetText("KTitle-Increase",this.LanguageID)+d.toFixed(2)+"%";if(!this.DrawText(C,D,h))return}C=g_JSChartLocalization.GetText("KTitle-Vol",this.LanguageID)+IFrameSplitOperator.FromatIntegerString(t.Vol,2,this.LanguageID);if(this.DrawText(C,this.VolColor,h)){if(IFrameSplitOperator.IsNumber(t.Amount)){C=g_JSChartLocalization.GetText("KTitle-Amount",this.LanguageID)+IFrameSplitOperator.FormatValueString(t.Amount,2,this.LanguageID);if(!this.DrawText(C,this.AmountColor,h))return}if(MARKET_SUFFIX_NAME.IsSHSZStockA(this.Symbol)&&t.FlowCapital>0){d=t.Vol/t.FlowCapital*100,C=g_JSChartLocalization.GetText("KTitle-Exchange",this.LanguageID)+IFrameSplitOperator.FormatValueString(d,2,this.LanguageID)+"%";if(!this.DrawText(C,this.TurnoverRateColor,h))return}if(MARKET_SUFFIX_NAME.IsFutures(n)&&IFrameSplitOperator.IsNumber(t.Position)){C=g_JSChartLocalization.GetText("KTitle-Position",this.LanguageID)+t.Position;if(!this.DrawText(C,this.PositionColor,h))return}for(var c in this.OverlayChartPaint){if((t=this.OverlayChartPaint[c]).Symbol&&t.Title){var m=t.Title,f=t.Color;C="["+m+"]";if(!this.DrawText(C,f,h))return}}}}}}}}},this.Draw=function(){if(this.IsShow)if(null==this.CursorIndex||!this.Data||this.Data.length<=0)this.OnDrawEventCallback(null);else{this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var t=this.CursorIndex;t=parseInt(t.toFixed(0));var e=this.Data.DataOffset+t;if(e>=this.Data.Data.length&&(e=this.Data.Data.length-1),e<0)this.OnDrawEventCallback(null);else{var a=this.Data.Data[e];this.OnDrawEventCallback(a),this.Canvas.save(),this.DrawItem(a),this.Canvas.restore()}}},this.OnDrawEventCallback=function(t){if(this.OnDrawEvent&&this.OnDrawEvent.Callback){var e={Draw:t,Name:this.ClassName};if(this.Data&&this.Data.Data){var a=Math.abs(this.CursorIndex);a=parseInt(a.toFixed(0));var i=this.Data.DataOffset+a,r=this.Data.Data.length;e.DataIndex=i,e.DataCount=r}this.OnDrawEvent.Callback(this.OnDrawEvent,e,this)}},this.GetColor=function(t,e){return t>e?this.UpColor:t<e?this.DownColor:this.UnchagneColor},this.DrawText=function(t,e,a){if(!t)return!0;var i=!0===this.Frame.IsHScreen,r=this.Frame.ChartBorder.GetRight();i&&(r=this.Frame.ChartBorder.GetHeight()),this.Canvas.fillStyle=e;var n=this.Canvas.measureText(t).width;return!(a.Left+n>r)&&(this.Canvas.fillText(t,a.Left,a.Bottom,n),a.Left+=n+this.SpaceWidth,!0)}}function DynamicMinuteTitlePainting(){this.newMethod=DynamicKLineTitlePainting,this.newMethod(),delete this.newMethod,this.ClassName="DynamicMinuteTitlePainting",this.SpaceWidth=1*GetDevicePixelRatio(),this.YClose,this.IsShowDate=!1,this.IsShowTime=!0,this.IsShowName=!0,this.IsShowAveragePrice=!0,this.OverlayChartPaint,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.LastShowData,this.OnDrawEvent,this.GetCurrentKLineData=function(){if(this.LastShowData)return this.LastShowData;if(null==this.CursorIndex||!this.Data)return null;if(this.Data.Data.length<=0)return null;var t=Math.abs(this.CursorIndex);t=parseInt(t.toFixed(0));var e=this.Data.DataOffset+t;return e>=this.Data.Data.length&&(e=this.Data.Data.length-1),e<0?null:this.Data.Data[e]},this.DrawItem=function(t){var e=!0===this.Frame.IsHScreen,a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetTop()-this.Frame.ChartBorder.Top/2,r=(this.Frame.ChartBorder.GetRight(),GetfloatPrecision(this.Symbol));if(e){if(this.Frame.ChartBorder.Right<5)return;a=2,i=this.Frame.ChartBorder.Right/2,this.Frame.ChartBorder.GetHeight();var n=this.Frame.ChartBorder.GetChartWidth(),s=this.Frame.ChartBorder.GetTop();this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180)}else if(this.Frame.ChartBorder.Top<5)return;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var o={Left:a,Bottom:i,IsHScreen:e};if(!this.IsShowName||this.DrawText(this.Name,this.NameColor,o)){if(this.IsShowDate||this.IsShowTime){var h=IFrameSplitOperator.FormatDateTimeString(t.DateTime,this.IsShowDate,this.IsShowTime);if(!this.DrawText(h,this.DateTimeColor,o))return}var l=t.Close,C=t.Increase,u=t.Vol,D=t.Amount;if(t.Before&&(l=t.Before.Close,C=t.Before.Increase,u=t.Before.Vol,D=t.Before.Amount),window.chartdata["00"]&&window.chartdata["00"].YClose&&(this.YClose=window.chartdata["00"].YClose),l){var d=this.GetColor(l,this.YClose);h=g_JSChartLocalization.GetText("MTitle-Close",this.LanguageID)+l.toFixed(r);if(!this.DrawText(h,d,o))return}if(null!=(C=(l-this.YClose)/this.YClose*100)){d=this.GetColor(C,0),h=g_JSChartLocalization.GetText("MTitle-Increase",this.LanguageID)+C.toFixed(2)+"%";if(!this.DrawText(h,d,o))return}var c=!0,m=this.Symbol.toUpperCase();if(MARKET_SUFFIX_NAME.IsET(m)&&!MARKET_SUFFIX_NAME.IsETShowAvPrice(m)&&(c=!1),t.AvPrice&&c&&this.IsShowAveragePrice){d=this.GetColor(t.AvPrice,this.YClose),h=g_JSChartLocalization.GetText("MTitle-AvPrice",this.LanguageID)+t.AvPrice.toFixed(r);if(!this.DrawText(h,d,o))return}h=g_JSChartLocalization.GetText("MTitle-Vol",this.LanguageID)+IFrameSplitOperator.FromatIntegerString(u,2);if(this.DrawText(h,this.VolColor,o)){if(IFrameSplitOperator.IsNumber(D)){h=g_JSChartLocalization.GetText("MTitle-Amount",this.LanguageID)+IFrameSplitOperator.FormatValueString(D,2);if(!this.DrawText(h,this.AmountColor,o))return}if(IFrameSplitOperator.IsNumber(t.Position)){h=g_JSChartLocalization.GetText("MTitle-Position",this.LanguageID)+IFrameSplitOperator.FromatIntegerString(t.Position,2);if(!this.DrawText(h,this.VolColor,o))return}for(var f in this.OverlayChartPaint){if((t=this.OverlayChartPaint[f]).Symbol&&t.Title){var v=t.Title,S=t.Color;h="["+v+"]";if(!this.DrawText(h,S,o))return}}}}},this.Draw=function(){if(this.Canvas.canvas.JSChartContainer.Frame.Data&&(this.Data.DataOffset=this.Canvas.canvas.JSChartContainer.Frame.Data.DataOffset,this.LastShowData=null,this.IsShow))if(null==this.CursorIndex||!this.Data||!this.Data.Data||this.Data.Data.length<=0)this.OnDrawEventCallback(null);else{this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var t=this.CursorIndex;t=parseInt(t.toFixed(0)),debug&&console.log("DynamicMinuteTitlePainting",this);var e=this.Canvas.canvas.JSChartContainer.IsOnTouch?this.Data.DataOffset+t:this.Data.DataOffset+this.Frame.MinuteCount-1;e>=this.Data.Data.length&&(e=this.Data.Data.length-1);var a=this.Data.Data[e];this.LastShowData=a,this.Canvas.save(),this.OnDrawEventCallback(a),this.DrawItem(a),this.Canvas.restore()}}}var STRING_FORMAT_TYPE={DEFAULT:1,ORIGINAL:2,INTEGER:3,THOUSANDS:21};function DynamicTitleData(t,e,a){this.Data=t,this.Name=e,this.Color=a,this.DataType,this.StringFormat=STRING_FORMAT_TYPE.DEFAULT,this.FloatPrecision=2}function DynamicChartTitlePainting(){this.newMethod=IChartTitlePainting,this.newMethod(),delete this.newMethod,this.ClassName="DynamicChartTitlePainting",this.IsDynamic=!0,this.Data=new Array,this.Explain,this.ColorIndex,this.IsShowColorIndexTitle=!0,this.IsShowUpDownArrow=!0,this.IsShowIndexName=!0,this.TradeIndex,this.IsShowTradeIndexTitle=!0,this.OverlayIndex=new Map,this.LanguageID=JSCHART_LANGUAGE_ID.LANGUAGE_CHINESE_ID,this.TitleRect,this.IsDrawTitleBG=!1,this.BGColor=g_JSChartResource.IndexTitleBGColor,this.OnDrawEvent,this.ParamSpace=2,this.IsKLineFrame=!1,this.OutName=null,this.SetDynamicOutName=function(t,e){this.OutName?this.OutName.clear():this.OutName=new Map;var a=new Map;for(var i in e){var r=e[i];a.set(`{${r.Name}}`,r)}for(var i in t){var n=(r=t[i]).DynamicName.match(/{\w*}/i);if(!n||n.length<=0)this.OutName.set(r.Name,r.DynamicName);else{for(var s=r.DynamicName,o=!0,h=0;h<n.length;++h){var l=n[h];if(!a.has(l)){o=!1;break}var C=a.get(l).Value;s=s.replace(l,C.toString())}o&&this.OutName.set(r.Name,s)}}},this.GetDynamicOutName=function(t){return!this.OutName||this.OutName.size<=0?null:this.OutName.has(t)?this.OutName.get(t):null},this.IsClickTitle=function(t,e){return!!this.TitleRect&&(t>this.TitleRect.Left&&t<this.TitleRect.Left+this.TitleRect.Width&&e>this.TitleRect.Top&&e<this.TitleRect.Top+this.TitleRect.Height)},this.FormatValue=function(t,e){return e.StringFormat==STRING_FORMAT_TYPE.DEFAULT?IFrameSplitOperator.FormatValueString(t,e.FloatPrecision,this.LanguageID):e.StringFormat==STRING_FORMAT_TYPE.THOUSANDS?IFrameSplitOperator.FormatValueThousandsString(t,e.FloatPrecision):e.StringFormat==STRING_FORMAT_TYPE.ORIGINAL?t.toFixed(e.FloatPrecision).toString():e.StringFormat==STRING_FORMAT_TYPE.INTEGER?IFrameSplitOperator.FromatIntegerString(t,e.FloatPrecision,this.LanguageID):void 0},this.FormatMultiReport=function(t,e){var a="";for(var i in t){var r=t[i];let n=r.Quarter,s=r.Year,o=r.Value;switch(a.length>0&&(a+=","),a+=s.toString(),n){case 1:a+="一季报 ";break;case 2:a+="半年报 ";break;case 3:a+="三季报 ";break;case 4:a+="年报 "}a+=this.FormatValue(o,e)}return a},this.Draw=function(){if(this.IsKLineFrame="KLineFrame"==this.Frame.ClassName||"KLineHScreenFrame"==this.Frame.ClassName,this.IsDrawTitleBG=this.Frame.IsDrawTitleBG,this.IsShowUpDownArrow=this.Frame.IsShowTitleArraw,this.IsShowIndexName=this.Frame.IsShowIndexName,this.ParamSpace=this.Frame.IndexParamSpace,this.TitleRect=null,null!=this.CursorIndex&&this.Data&&!(this.Frame.ChartBorder.TitleHeight<5)){if(!0===this.Frame.IsHScreen)return this.Canvas.save(),this.HScreenDraw(),void this.Canvas.restore();var t=this.Frame.ChartBorder.GetLeft()+1,e=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,a=this.Frame.ChartBorder.GetRight();if(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font,this.Title&&this.IsShowIndexName){var i=this.Canvas.measureText(this.Title).width+2;if(this.IsDrawTitleBG){var r=2*GetDevicePixelRatio();this.Canvas.fillStyle=this.BGColor,this.TitleRect={Left:t,Top:this.Frame.ChartBorder.GetTop()+r,Width:i,Height:this.Frame.ChartBorder.TitleHeight-2*r},this.Canvas.fillRect(this.TitleRect.Left,this.TitleRect.Top,this.TitleRect.Width,this.TitleRect.Height)}this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,t,e,i),t+=i}var n=this.Frame.GetLockRect();if(n){var s=Math.abs(this.CursorIndex-.5);if(this.IsKLineFrame&&(s=this.CursorIndex),this.Frame.GetXFromIndex(s.toFixed(0))>=n.Left)return}for(var o in this.Data){var h=this.Data[o];if(h&&h.Data&&h.Data.Data&&!(h.Data.Data.length<=0)){var l=null,C=null;if("StraightLine"==h.DataType)l=h.Data.Data[0],C=this.FormatValue(l,h);else{s=Math.abs(this.CursorIndex-.5);s=parseInt(s.toFixed(0)),this.IsKLineFrame&&(s=this.CursorIndex);var u=h.Data.DataOffset+s;if(u>=h.Data.Data.length&&(u=h.Data.Data.length-1),u<0)continue;if(null==(l=h.Data.Data[u]))continue;if("HistoryData-Vol"==h.DataType)l=l.Vol,C=this.FormatValue(l,h);else if("MultiReport"==h.DataType)C=this.FormatMultiReport(l,h);else{var D=null;if(this.IsShowUpDownArrow){var d=null;u-1>=0&&(d=h.Data.Data[u-1]),IFrameSplitOperator.IsNumber(d)&&(D=d>l?"↓":d<l?"↑":"→")}C=this.FormatValue(l,h),D&&(C+=D)}}this.Canvas.fillStyle=h.Color;var c=C;if(h.Name){var m=this.GetDynamicOutName(h.Name);c=m?m+":"+C:h.Name+":"+C}var f=this.ParamSpace*GetDevicePixelRatio();i=this.Canvas.measureText(c).width+f;this.Canvas.fillText(c,t,e,i),t+=i}}if(this.Explain){this.Canvas.fillStyle=this.TitleColor;c="说明:"+this.Explain;t+(i=this.Canvas.measureText(c).width+2)<a&&(this.Canvas.fillText(c,t,e,i),t+=i)}if(this.ColorIndex&&this.IsShowColorIndexTitle){this.Canvas.fillStyle=g_JSChartResource.Title.ColorIndexColor;var v=this.ColorIndex.Name+this.ColorIndex.Param;i=this.Canvas.measureText(v).width+2;this.Canvas.fillText(v,t,e,i),t+=i}if(this.TradeIndex&&this.IsShowTradeIndexTitle){this.Canvas.fillStyle=g_JSChartResource.Title.TradeIndexColor;v=this.TradeIndex.Name+this.TradeIndex.Param,i=this.Canvas.measureText(v).width+2;this.Canvas.fillText(v,t,e,i),t+=i}this.DrawOverlayIndex(t+10*GetDevicePixelRatio())}},this.DrawOverlayIndex=function(t){var e=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,a=this.Frame.ChartBorder.GetRight();if(!0===this.Frame.IsHScreen&&(e=-this.Frame.ChartBorder.TitleHeight/2,a=this.Frame.ChartBorder.GetHeight()),!(t>a)){var i=5*GetDevicePixelRatio(),r=t;for(o of this.OverlayIndex){t+=i;var n=o[1];if(n.Title){if(this.Canvas.fillStyle=this.TitleColor,r=t,(t+=D=this.Canvas.measureText(n.Title).width+2)>a)break;this.Canvas.fillText(n.Title,r,e,D)}for(var s in n.Data){var o=n.Data[s];if(o&&o.Data&&o.Data.Data&&o.Name&&!(o.Data.Data.length<=0)){var h=null,l=null;if("StraightLine"==o.DataType)h=o.Data.Data[0],l=this.FormatValue(h,o);else{var C=Math.abs(this.CursorIndex-.5);C=parseInt(C.toFixed(0)),this.IsKLineFrame&&(C=this.CursorIndex);var u=o.Data.DataOffset+C;if(u>=o.Data.Data.length&&(u=o.Data.Data.length-1),u<0)continue;if(null==(h=o.Data.Data[u]))continue;"HistoryData-Vol"==o.DataType?(h=h.Vol,l=this.FormatValue(h,o)):l="MultiReport"==o.DataType?this.FormatMultiReport(h,o):this.FormatValue(h,o)}this.Canvas.fillStyle=o.Color;var D,d=o.Name+":"+l;if(r=t,(t+=D=this.Canvas.measureText(d).width+2)>a)break;this.Canvas.fillText(d,r,e,D)}}if(t>a)break}}},this.HScreenDraw=function(){var t=this.Frame.ChartBorder.GetRightTitle(),e=this.Frame.ChartBorder.GetTop();this.Canvas.translate(t,e),this.Canvas.rotate(90*Math.PI/180);var a=1,i=-this.Frame.ChartBorder.TitleHeight/2,r=this.Frame.ChartBorder.GetHeight();if(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font,this.Title&&this.IsShowIndexName){var n=this.Canvas.measureText(this.Title).width+2;if(this.IsDrawTitleBG){var s=2*GetDevicePixelRatio();this.Canvas.fillStyle=this.BGColor,this.TitleRect={Left:this.Frame.ChartBorder.GetRightTitle(),Top:this.Frame.ChartBorder.GetTop(),Width:this.Frame.ChartBorder.TitleHeight,Height:n};let t={Left:a,Top:-this.Frame.ChartBorder.TitleHeight+s,Width:n,Height:this.Frame.ChartBorder.TitleHeight-2*s};this.Canvas.fillRect(t.Left,t.Top,t.Width,t.Height)}this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,a,i,n),a+=n}var o=this.Frame.GetLockRect();if(o){var h=Math.abs(this.CursorIndex-.5);if(this.IsKLineFrame&&(h=this.CursorIndex),this.Frame.GetXFromIndex(h.toFixed(0))>=o.Top)return}for(var l in this.Data){var C=this.Data[l];if(C&&C.Data&&C.Data.Data&&C.Name&&!(C.Data.Data.length<=0)){var u=null,D=null;if("StraightLine"==C.DataType)u=C.Data.Data[0],D=this.FormatValue(u,C);else{h=Math.abs(this.CursorIndex-.5);h=parseInt(h.toFixed(0)),this.IsKLineFrame&&(h=this.CursorIndex);var d=C.Data.DataOffset+h;if(d>=C.Data.Data.length&&(d=C.Data.Data.length-1),d<0)continue;if(null==(u=C.Data.Data[d]))continue;"HistoryData-Vol"==C.DataType?(u=u.Vol,D=this.FormatValue(u,C)):D="MultiReport"==C.DataType?this.FormatMultiReport(u,C):this.FormatValue(u,C)}this.Canvas.fillStyle=C.Color;var c=C.Name+":"+D;n=this.Canvas.measureText(c).width+2;this.Canvas.fillText(c,a,i,n),a+=n}}if(this.Explain){this.Canvas.fillStyle=this.TitleColor;c="说明:"+this.Explain;a+(n=this.Canvas.measureText(c).width+2)<r&&(this.Canvas.fillText(c,a,i,n),a+=n)}this.DrawOverlayIndex(a+5*GetDevicePixelRatio())},this.OnDrawEventCallback=function(t){if(this.OnDrawEvent&&this.OnDrawEvent.Callback){var e={Draw:t,Name:"DynamicChartTitlePainting"};this.OnDrawEvent.Callback(this.OnDrawEvent,e,this)}}}function IChartDrawPicture(){this.Frame,this.Canvas,this.Point=new Array,this.Value=new Array,this.LinePoint=[],this.PointCount=2,this.Status=0,this.PointStatus=0,this.MovePointIndex=null,this.ClassName="IChartDrawPicture",this.FinishedCallback,this.Guid=Guid(),this.Symbol,this.Period,this.IsSelected=!1,this.Option,this.LineColor="#1e90ff",this.LineWidth=2,this.BackupLineWidth=null,this.AreaColor="rgba(25,25,25,0.4)",this.PointColor=g_JSChartResource.DrawPicture.PointColor[0],this.SetLastPoint=null,this.Update=null,this.Draw=function(){},this.SetOption=function(t){t&&(t.LineColor&&(this.LineColor=t.LineColor),t.LineWidth>0&&(this.LineWidth=t.LineWidth),t.AreaColor&&(this.AreaColor=t.AreaColor),t.PointColor&&(this.PointColor=t.PointColor))},this.SetLineWidth=function(){this.BackupLineWidth=null,this.LineWidth>0&&(this.BackupLineWidth=this.Canvas.lineWidth,this.Canvas.lineWidth=this.LineWidth*GetDevicePixelRatio())},this.RestoreLineWidth=function(){null!=this.BackupLineWidth&&(this.Canvas.lineWidth=this.BackupLineWidth)},this.PointToValue=function(){return!!this.Frame&&("MinuteFrame"==this.Frame.ClassName||"MinuteHScreenFrame"==this.Frame.Class?this.PointToValue_Minute():this.PointToValue_KLine())},this.PointToValue_KLine=function(){if(!this.Frame)return!1;var t=this.Frame.Data;if(!t)return!1;if(this.Frame.IsHScreen)for(var e in this.Point){var a=this.Point[e],i={XValue:n=parseInt(this.Frame.GetXData(a.Y))+t.DataOffset,YValue:this.Frame.GetYData(a.X)},r=t.Data[n];i.DateTime={Date:r.Date},IFrameSplitOperator.IsNumber(r.Time)&&(i.DateTime.Time=r.Time),this.Value[e]=i}else for(var e in this.Point){var n;a=this.Point[e];(n=parseInt(this.Frame.GetXData(a.X,!1))+t.DataOffset)<0&&(n=0);i={XValue:n,YValue:this.Frame.GetYData(a.Y,!1)},r=t.Data[n];i.DateTime={Date:r.Date},IFrameSplitOperator.IsNumber(r.Time)&&(i.DateTime.Time=r.Time),this.Value[e]=i}return!0},this.PointToValue_Minute=function(){if(!this.Frame)return!1;var t=this.Frame.Data;if(!t)return!1;if(this.Frame.IsHScreen)for(var e in this.Point){var a=this.Point[e],i={XValue:n=parseInt(this.Frame.GetXData(a.Y)),YValue:this.Frame.GetYData(a.X)},r=t.Data[n];i.DateTime={Date:r.Date,Time:r.Time},this.Value[e]=i}else for(var e in this.Point){var n;a=this.Point[e],i={XValue:n=parseInt(this.Frame.GetXData(a.X)),YValue:this.Frame.GetYData(a.Y)},r=t.Data[n];i.DateTime={Date:r.Date,Time:r.Time},this.Value[e]=i}return!0},this.IsPointIn=function(t,e){return!1},this.ValueToPoint=function(){if(!this.Frame)return!1;var t=this.Frame.Data;if(!t)return!1;var e=this.Frame.IsHScreen;for(var a in this.Point=[],this.Value){var i=this.Value[a],r=new Point;e?(r.Y=this.Frame.GetXFromIndex(i.XValue-t.DataOffset),r.X=this.Frame.GetYFromData(i.YValue)):(r.X=this.Frame.GetXFromIndex(i.XValue-t.DataOffset,!1),r.Y=this.Frame.GetYFromData(i.YValue,!1)),this.Point[a]=r}},this.UpdateXValue=function(){if(!this.Frame)return!1;var t=this.Frame.Data;if(!t)return!1;var e=[];for(var a in this.Value){var i=this.Value[a],r={Date:i.DateTime.Date};IFrameSplitOperator.IsNumber(i.DateTime.Time)&&(r.Time=i.DateTime.Time),e[a]=r}for(var a in t.FindDataIndexByDateTime(e),e){var n=e[a],s=this.Value[a];n.Index>=0&&(s.XValue=n.Index)}},this.Move=function(t,e){if(20!=this.Status)return fasle;if(!this.Frame)return!1;if(!this.Frame.Data)return!1;if(null==this.MovePointIndex)return!1;var a=parseInt(this.MovePointIndex);if(100===a)for(var i in this.Point)this.Point[i].X+=t,this.Point[i].Y+=e;else{if(0!==a&&1!==a&&2!==a&&3!==a&&4!==a&&5!==a)return!1;a<this.Point.length&&(this.Point[a].X+=t,this.Point[a].Y+=e)}},this.ClipFrame=function(){if(this.Frame.IsHScreen)var t=this.Frame.ChartBorder.GetLeftEx(),e=this.Frame.ChartBorder.GetTop(),a=this.Frame.ChartBorder.GetWidthEx(),i=this.Frame.ChartBorder.GetHeight();else t=this.Frame.ChartBorder.GetLeft(),e=this.Frame.ChartBorder.GetTopEx(),a=this.Frame.ChartBorder.GetWidth(),i=this.Frame.ChartBorder.GetHeightEx();this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(t,e,a,i),this.Canvas.clip()},this.CalculateDrawPoint=function(t){if(this.Status<2)return null;if(!this.Point.length||!this.Frame)return null;var e=new Array;if(10==this.Status){var a=this.Frame.Data;if(!a)return null;var i=this.Frame.XPointCount,r=0,n=this.Frame.IsHScreen;for(var s in this.Value){var o=this.Value[s],h=o.XValue-a.DataOffset;(h<0||h>=i)&&++r;var l=new Point;n?(l.Y=this.Frame.GetXFromIndex(o.XValue-a.DataOffset,!1),l.X=this.Frame.GetYFromData(o.YValue,!1)):(l.X=this.Frame.GetXFromIndex(o.XValue-a.DataOffset,!1),l.Y=this.Frame.GetYFromData(o.YValue,!1)),e.push(l)}if(t&&!0===t.IsCheckX&&r==this.Value.length)return null}else e=this.Point;return e},this.IsYValueInFrame=function(t){return!!this.Frame&&!(t>this.Frame.HorizontalMax||t<this.Frame.HorizontalMin)},this.DrawPoint=function(t){if(t&&!(t.length<=0)){this.ClipFrame();var e=GetDevicePixelRatio();for(var a in t){var i=t[a];this.Canvas.beginPath(),this.Canvas.arc(i.X,i.Y,5*e,0,360,!1),this.Canvas.fillStyle=this.PointColor,this.Canvas.fill(),this.Canvas.closePath()}this.Canvas.restore()}},this.CalculateExtendLinePoint=function(t,e){var a={},i=(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetTopEx()),r=this.Frame.ChartBorder.GetBottom(),n=e.X-t.X,s=e.Y-t.Y;if(n>0){var o=n*(l=r-t.Y)/s;(h=new Point).X=t.X+o,h.Y=r,a.End=h;o=n*(l=e.Y-i)/s;(C=new Point).Y=i,C.X=e.X-o,a.Start=C}else{var h,l=r-t.Y;o=Math.abs(n)*l/s;(h=new Point).X=t.X-o,h.Y=r,a.End=h;var C;l=e.Y-i,o=Math.abs(n)*l/s;(C=new Point).Y=i,C.X=e.X+o,a.Start=C}return a},this.IsPointInXYValue=function(t,e){if(!this.Frame)return-1;var a=this.Frame.Data;if(!a)return-1;if(!this.Value)return-1;var i=5;this.Option&&(i+=this.Option.Zoom);var r=this.Frame.IsHScreen;i*=GetDevicePixelRatio();for(var n=0;n<this.Value.length;++n){var s=this.Value[n],o=new Point;if(r?(o.Y=this.Frame.GetXFromIndex(s.XValue-a.DataOffset),o.X=this.Frame.GetYFromData(s.YValue)):(o.X=this.Frame.GetXFromIndex(s.XValue-a.DataOffset),o.Y=this.Frame.GetYFromData(s.YValue)),this.Canvas.beginPath(),this.Canvas.arc(o.X,o.Y,i,0,360),this.Canvas.isPointInPath(t,e))return n}return-1},this.IsPointInLine=function(t,e){if(!this.LinePoint)return-1;var a=5;this.Option&&(a+=this.Option.Zoom);var i=GetDevicePixelRatio();for(var r in a*=i,this.LinePoint){var n=this.LinePoint[r],s=n.Start,o=n.End;if(this.Canvas.beginPath(),s.X==o.X?(this.Canvas.moveTo(s.X-a,s.Y),this.Canvas.lineTo(s.X+a,s.Y),this.Canvas.lineTo(o.X+a,o.Y),this.Canvas.lineTo(o.X-a,o.Y)):(this.Canvas.moveTo(s.X,s.Y+a),this.Canvas.lineTo(s.X,s.Y-a),this.Canvas.lineTo(o.X,o.Y-a),this.Canvas.lineTo(o.X,o.Y+a)),this.Canvas.closePath(),this.Canvas.isPointInPath(t,e))return r}return-1},this.IsPointIn_XYValue_Line=function(t,e){if(10!=this.Status)return-1;var a=this.IsPointInXYValue(t,e);return a>=0?a:(a=this.IsPointInLine(t,e))>=0?100:-1},this.DrawLine=function(t,e,a){a&&this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),a&&this.Canvas.setLineDash([])},this.CreateLineData=function(t,e){var a={Start:new Point,End:new Point};return a.Start.Y=t.Y,a.Start.X=t.X,a.End.Y=e.Y,a.End.X=e.X,a},this.ExportStorageData=function(){var t={ClassName:this.ClassName,Symbol:this.Symbol,Guid:this.Guid,Period:this.Period,Value:[],FrameID:this.Frame.Identify,LineColor:this.LineColor,AreaColor:this.AreaColor,LineWidth:this.LineWidth};for(var e in this.Value){var a=this.Value[e];t.Value.push({XValue:a.XValue,YValue:a.YValue,DateTime:a.DateTime})}return this.Text&&(t.Text=this.Text),this.FontOption&&(t.FontOption=this.FontOption),t}}function ChartDrawPictureLine(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){this.ClipFrame();var e=t[0],a=t[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.stroke(),this.RestoreLineWidth();var i={Start:e,End:a};this.LinePoint.push(i),this.DrawPoint(t),this.Canvas.restore()}}}function ChartDrawPictureHaflLine(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureHaflLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){var e=t[0],a=t[1];this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y),this.Canvas.lineTo(t[1].X,t[1].Y);var i=this.CalculateEndPoint(t);this.Canvas.lineTo(i.X,i.Y),this.Canvas.stroke(),this.RestoreLineWidth();var r={Start:e,End:a};this.LinePoint.push(r),this.DrawPoint(t),this.Canvas.restore()}},this.CalculateEndPoint=function(t){var e=this.Frame.ChartBorder.GetLeft(),a=this.Frame.ChartBorder.GetRight(),i=t[1].X-t[0].X,r=t[1].Y-t[0].Y;if(i>0){var n=(a-t[0].X)*r/i+t[0].Y;return(s=new Point).X=a,s.Y=n,s}var s;n=(t[0].X-e)*r/Math.abs(i)+t[0].Y;return(s=new Point).X=e,s.Y=n,s}}function ChartDrawPictureHorizontalLine(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.Label,this.SetOption=function(t){this.Super_SetOption&&this.Super_SetOption(t),t&&t.Label&&(this.Label=t.Label)},this.ExportStorageData=function(){var t;return this.Super_ExportStorageData&&(t=this.Super_ExportStorageData(),this.Label&&(t.Label=this.Label)),t},this.PointCount=1,this.ClassName="ChartDrawPictureHorizontalLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Font=16*GetDevicePixelRatio()+"px 微软雅黑",this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t&&1==t.length&&this.Frame&&1==this.Value.length){if(!this.IsYValueInFrame(this.Value[0].YValue))return null;var e=this.Frame.IsHScreen,a=this.Frame.ChartBorder.GetLeft(),i=this.Frame.ChartBorder.GetRight();e&&(a=this.Frame.ChartBorder.GetTop(),i=this.Frame.ChartBorder.GetBottom()),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),e?(this.Canvas.moveTo(t[0].X,a),this.Canvas.lineTo(t[0].X,i)):(this.Canvas.moveTo(a,t[0].Y),this.Canvas.lineTo(i,t[0].Y)),this.Canvas.stroke(),this.RestoreLineWidth();var r={Start:new Point,End:new Point};if(e?(r.Start.X=t[0].X,r.Start.Y=a,r.End.X=t[0].X,r.End.Y=i):(r.Start.X=a,r.Start.Y=t[0].Y,r.End.X=i,r.End.Y=t[0].Y),this.LinePoint.push(r),this.DrawPoint(t),this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font,e){this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var n=t[0].X,s=a;this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180);var o=(h=this.Frame.GetYData(t[0].X)).toFixed(2);this.Label&&(0==this.Label.Position?o=this.Label.Text+h.toFixed(2):1==this.Label.Position&&(o=h.toFixed(2)+this.Label.Text)),this.Canvas.fillText(o,0,0)}else{this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var h;o=(h=this.Frame.GetYData(t[0].Y)).toFixed(2);this.Label&&(0==this.Label.Position?o=this.Label.Text+h.toFixed(2):1==this.Label.Position&&(o=h.toFixed(2)+this.Label.Text)),this.Canvas.fillText(o,a,t[0].Y)}this.Canvas.restore()}}}function ChartDrawPictureTrendLine(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTrendLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){var e=t[0],a=t[1],i=this.CalculateExtendLinePoint(e,a);this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(i.Start.X,i.Start.Y),this.Canvas.lineTo(i.End.X,i.End.Y),this.Canvas.stroke(),this.RestoreLineWidth();var r={Start:e,End:a};this.LinePoint.push(r),this.DrawPoint(t),this.Canvas.restore()}}}function ChartDrawPictureRect(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureRect",this.Draw=function(){var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});t&&2==t.length&&(this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.rect(t[0].X,t[0].Y,t[1].X-t[0].X,t[1].Y-t[0].Y),this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.fillRect(t[0].X,t[0].Y,t[1].X-t[0].X,t[1].Y-t[0].Y),this.Canvas.restore(),this.DrawPoint(t))},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;if(!this.Frame.Data)return-1;var a=this.IsPointInXYValue(t,e);if(a>=0)return a;var i=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!i||2!=i.length)return-1;var r=[{X:i[0].X,Y:i[0].Y},{X:i[1].X,Y:i[0].Y}];return this.IsPointInLine(r,t,e)?100:(r=[{X:i[1].X,Y:i[0].Y},{X:i[1].X,Y:i[1].Y}],this.IsPointInLine2(r,t,e)?100:(r=[{X:i[1].X,Y:i[1].Y},{X:i[0].X,Y:i[1].Y}],this.IsPointInLine(r,t,e)?100:(r=[{X:i[0].X,Y:i[1].Y},{X:i[0].X,Y:i[0].Y}],this.IsPointInLine2(r,t,e)?100:-1)))},this.IsPointInLine=function(t,e,a){var i=5;if(this.Option&&(i+=this.Option.Zoom),i*=GetDevicePixelRatio(),this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y+i),this.Canvas.lineTo(t[0].X,t[0].Y-i),this.Canvas.lineTo(t[1].X,t[1].Y-i),this.Canvas.lineTo(t[1].X,t[1].Y+i),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return!0},this.IsPointInLine2=function(t,e,a){var i=5;if(this.Option&&(i+=this.Option.Zoom),i*=GetDevicePixelRatio(),this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X-i,t[0].Y),this.Canvas.lineTo(t[0].X+i,t[0].Y),this.Canvas.lineTo(t[1].X+i,t[1].Y),this.Canvas.lineTo(t[1].X-i,t[1].Y),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return!0}}function ChartDrawPictureArc(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureArc",this.Draw=function(){var t=this.CalculateDrawPoint();if(t&&2==t.length){if(this.ClipFrame(),this.SetLineWidth(),t[0].X<t[1].X&&t[0].Y>t[1].Y){var e=(s=t[1].X-t[0].X)>(o=t[0].Y-t[1].Y)?1/s:1/o,a=t[0].X,i=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(var r=1.5*Math.PI;r<2*Math.PI;r+=e)this.Canvas.lineTo(a+s*Math.cos(r),i+o*Math.sin(r)*-1);for(var n=0;n<=.5*Math.PI;n+=e)this.Canvas.lineTo(a+s*Math.cos(n),i+o*Math.sin(n)*-1)}else if(t[0].X>t[1].X&&t[0].Y>t[1].Y){e=(s=t[0].X-t[1].X)>(o=t[0].Y-t[1].Y)?1/s:1/o,a=t[1].X,i=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(r=0;r<=Math.PI;r+=e)this.Canvas.lineTo(a+s*Math.cos(r),i+o*Math.sin(r)*-1)}else if(t[0].X>t[1].X&&t[0].Y<t[1].Y){e=(s=t[0].X-t[1].X)>(o=t[1].Y-t[0].Y)?1/s:1/o,a=t[0].X,i=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(r=.5*Math.PI;r<=1.5*Math.PI;r+=e)this.Canvas.lineTo(a+s*Math.cos(r),i+o*Math.sin(r)*-1)}else if(t[0].X<t[1].X&&t[0].Y<t[1].Y){var s,o;e=(s=t[1].X-t[0].X)>(o=t[1].Y-t[0].Y)?1/s:1/o,a=t[1].X,i=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(r=Math.PI;r<=2*Math.PI;r+=e)this.Canvas.lineTo(a+s*Math.cos(r),i+o*Math.sin(r)*-1)}this.Canvas.strokeStyle=this.LineColor,this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(t)}},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;if(!this.Frame.Data)return-1;var a=this.IsPointInXYValue(t,e);if(a>=0)return a;var i=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!i||2!=i.length)return-1;var r=[{X:i[0].X,Y:i[0].Y},{X:i[1].X,Y:i[1].Y}];return this.IsPointInArc(r,t,e)?100:-1},this.IsPointInArc=function(t,e,a){if(2!=t.length)return!1;if(t[0].X<t[1].X&&t[0].Y>t[1].Y){var i=(u=t[1].X-t[0].X)>(D=t[0].Y-t[1].Y)?1/u:1/D,r=(d=.8*u)>(c=.8*D)?1/d:1/c,n=t[0].X,s=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(var o=1.5*Math.PI;o<2*Math.PI;o+=i)this.Canvas.lineTo(n+u*Math.cos(o),s+D*Math.sin(o)*-1);for(var h=0;h<=.5*Math.PI;h+=i)this.Canvas.lineTo(n+u*Math.cos(h),s+D*Math.sin(h)*-1);for(var l=.5*Math.PI;l>=0;l-=r)this.Canvas.lineTo(n+d*Math.cos(l),s+c*Math.sin(h)*-1);for(var C=2*Math.PI;C>=1.5*Math.PI;C-=r)this.Canvas.lineTo(n+d*Math.cos(C),s+c*Math.sin(C)*-1);this.Canvas.closePath()}else if(t[0].X>t[1].X&&t[0].Y>t[1].Y){i=(u=t[0].X-t[1].X)>(D=t[0].Y-t[1].Y)?1/u:1/D,r=(d=.8*u)>(c=.8*D)?1/d:1/c,n=t[1].X,s=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(o=0;o<=Math.PI;o+=i)this.Canvas.lineTo(n+u*Math.cos(o),s+D*Math.sin(o)*-1);for(h=Math.PI;h>=0;h-=r)this.Canvas.lineTo(n+d*Math.cos(h),s+c*Math.sin(h)*-1);this.Canvas.closePath()}else if(t[0].X>t[1].X&&t[0].Y<t[1].Y){i=(u=t[0].X-t[1].X)>(D=t[1].Y-t[0].Y)?1/u:1/D,r=(d=.8*u)>(c=.8*D)?1/d:1/c,n=t[0].X,s=t[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(o=.5*Math.PI;o<=1.5*Math.PI;o+=i)this.Canvas.lineTo(n+u*Math.cos(o),s+D*Math.sin(o)*-1);for(h=1.5*Math.PI;h>=.5*Math.PI;h-=r)this.Canvas.lineTo(n+d*Math.cos(h),s+c*Math.sin(h)*-1);this.Canvas.closePath()}else if(t[0].X<t[1].X&&t[0].Y<t[1].Y){var u,D,d,c;i=(u=t[1].X-t[0].X)>(D=t[1].Y-t[0].Y)?1/u:1/D,r=(d=.8*u)>(c=.8*D)?1/d:1/c,n=t[1].X,s=t[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y);for(o=Math.PI;o<=2*Math.PI;o+=i)this.Canvas.lineTo(n+u*Math.cos(o),s+D*Math.sin(o)*-1);for(h=2*Math.PI;h>=Math.PI;h-=r)this.Canvas.lineTo(n+d*Math.cos(h),s+c*Math.sin(h)*-1);this.Canvas.closePath()}return!!this.Canvas.isPointInPath(e,a)}}function ChartDrawPictureWaveMW(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveMW",this.PointCount=5,this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){for(var e in this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(t),this.SetLineWidth(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End)}this.RestoreLineWidth(),this.DrawPoint(t),this.Canvas.restore()}},this.CalculateLines=function(t){if(this.Frame&&!(t.length<2))if(2==this.Status){(r={Start:new Point,End:new Point}).Start.Y=t[0].Y,r.Start.X=t[0].X,r.End.Y=t[1].Y,r.End.X=t[1].X,this.LinePoint.push(r);var e=t[1].X-t[0].X;(r={Start:new Point,End:new Point}).Start.Y=t[1].Y,r.Start.X=t[1].X,r.End.Y=t[0].Y,r.End.X=t[1].X+e,this.LinePoint.push(r);var a=r.End;(i=new Point).X=a.X,i.Y=a.Y,this.Point[2]=i,(r={Start:new Point,End:new Point}).Start.Y=a.Y,r.Start.X=a.X,r.End.Y=t[1].Y,r.End.X=a.X+e,this.LinePoint.push(r);a=r.End;(i=new Point).X=a.X,i.Y=a.Y,this.Point[3]=i,(r={Start:new Point,End:new Point}).Start.Y=a.Y,r.Start.X=a.X,r.End.Y=t[0].Y,r.End.X=a.X+e,this.LinePoint.push(r);var i;a=r.End;(i=new Point).X=a.X,i.Y=a.Y,this.Point[4]=i,this.PointCount=this.Point.length}else if(5==t.length){var r;(r={Start:new Point,End:new Point}).Start.Y=t[0].Y,r.Start.X=t[0].X,r.End.Y=t[1].Y,r.End.X=t[1].X,this.LinePoint.push(r),(r={Start:new Point,End:new Point}).Start.Y=t[1].Y,r.Start.X=t[1].X,r.End.Y=t[2].Y,r.End.X=t[2].X,this.LinePoint.push(r),(r={Start:new Point,End:new Point}).Start.Y=t[2].Y,r.Start.X=t[2].X,r.End.Y=t[3].Y,r.End.X=t[3].X,this.LinePoint.push(r),(r={Start:new Point,End:new Point}).Start.Y=t[3].Y,r.Start.X=t[3].X,r.End.Y=t[4].Y,r.End.X=t[4].X,this.LinePoint.push(r)}}}function ChartDrawPictureParallelLines(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelLines",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3);var e=t.slice(0);for(var a in this.CalculateLines(e),this.ClipFrame(),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End)}this.DrawArea(),this.DrawPoint(e),this.Canvas.restore()}},this.SetLastPoint=function(t){this.LastPoint={X:t.X,Y:t.Y}},this.DrawArea=function(){2==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new Point;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2==t.length){var a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a)}else if(3==t.length){a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a);var i=t[2].X-t[1].X,r=t[2].Y-t[1].Y,n=new Point,s=new Point;n.X=t[0].X+i,n.Y=t[0].Y+r,s.X=t[1].X+i,s.Y=t[1].Y+r,a=this.CalculateExtendLinePoint(n,s),this.LinePoint.push(a)}}}function ChartDrawPicturePriceChannel(){this.newMethod=ChartDrawPictureParallelLines,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePriceChannel",this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new Point;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2==t.length){var a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a)}else if(3==t.length){a=this.CalculateExtendLinePoint(t[0],t[1]);this.LinePoint.push(a);var i=t[2].X-t[1].X,r=t[2].Y-t[1].Y,n=new Point,s=new Point;n.X=t[0].X+i,n.Y=t[0].Y+r,s.X=t[1].X+i,s.Y=t[1].Y+r,a=this.CalculateExtendLinePoint(n,s),this.LinePoint.push(a);n=new Point,s=new Point;n.X=t[0].X-i,n.Y=t[0].Y-r,s.X=t[1].X-i,s.Y=t[1].Y-r,a=this.CalculateExtendLinePoint(n,s),this.LinePoint.push(a)}},this.DrawArea=function(){3==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.lineTo(this.LinePoint[2].Start.X,this.LinePoint[2].Start.Y),this.Canvas.closePath(),this.Canvas.fill())}}function ChartDrawPictureParallelChannel(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelChannel",this.ChannelWidth=50,this.AreaColor="rgba(25,25,25,0.4)",this.LinePoint=[],this.CalculateDrawPoint=function(){if(this.Status<2)return null;if(!this.Point.length||!this.Frame)return null;var t=this.Frame.Data;if(!t)return null;var e=[];if(10==this.Status)for(var a=0;a<2;++a){var i=this.Value[a];(r=new Point).X=this.Frame.GetXFromIndex(i.XValue-t.DataOffset),r.Y=this.Frame.GetYFromData(i.YValue),e.push(r)}else for(a=0;a<this.Point.length;++a){var r;i=this.Point[a];(r=new Point).X=i.X,r.Y=i.Y,e.push(r)}if(e.length>=2){var n={Start:new Point,End:new Point};if(n.Start.X=e[0].X,n.Start.Y=e[0].Y,n.End.X=e[1].X,n.End.Y=e[1].Y,this.LinePoint.push(n),3==e.length||10==this.Status){var s=n.End.X-n.Start.X,o=n.End.Y-n.Start.Y,h=Math.atan(Math.abs(s/o)),l=this.ChannelWidth/Math.sin(h);(n={Start:new Point,End:new Point}).Start.X=e[0].X,n.Start.Y=e[0].Y-l,n.End.X=e[1].X,n.End.Y=e[1].Y-l,this.LinePoint.push(n);var C=new Point;C.X=n.Start.X+(n.End.X-n.Start.X)/2,C.Y=n.Start.Y+(n.End.Y-n.Start.Y)/2,e[3]=C,this.Point[2]=C;var u=parseInt(this.Frame.GetXData(C.X))+t.DataOffset,D=this.Frame.GetYData(C.Y);this.Value[2]={XValue:u,YValue:D},this.PointCount=this.Point.length}}return e},this.DrawLine=function(t,e){this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke()},this.DrawArea=function(t,e,a,i){this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.lineTo(i.X,i.Y),this.Canvas.closePath(),this.Canvas.fill()},this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t){for(var e in this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End)}2==this.LinePoint.length&&this.DrawArea(this.LinePoint[0].Start,this.LinePoint[0].End,this.LinePoint[1].End,this.LinePoint[1].Start),this.Canvas.restore(),this.DrawPoint(t)}},this.Move=function(t,e){if(20!=this.Status)return fasle;if(!this.Frame)return!1;if(!this.Frame.Data)return!1;if(100==this.MovePointIndex)for(var a in this.Point)this.Point[a].X+=t,this.Point[a].Y+=e;else if(0==this.MovePointIndex||1==this.MovePointIndex)this.MovePointIndex<this.Point.length&&(this.Point[this.MovePointIndex].X+=t,this.Point[this.MovePointIndex].Y+=e);else if(2==this.MovePointIndex){this.Point[this.MovePointIndex].X+=t,this.Point[this.MovePointIndex].Y+=e;var i=this.Point[1].X-this.Point[0].X,r=this.Point[1].Y-this.Point[0].Y,n=Math.atan(Math.abs(i/r)),s=this.ChannelWidth/Math.sin(n)-e;this.ChannelWidth=Math.sin(n)*s}},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;var a=this.Frame.Data;if(!a)return-1;for(var i=0;i<this.Value.length;++i){var r=this.Value[i],n=new Point;if(i<2)n.X=this.Frame.GetXFromIndex(r.XValue-a.DataOffset),n.Y=this.Frame.GetYFromData(r.YValue);else{if(i>=this.Point.length)continue;n.X=this.Point[i].X,n.Y=this.Point[i].Y}if(this.Canvas.beginPath(),this.Canvas.arc(n.X,n.Y,5,0,360),this.Canvas.isPointInPath(t,e))return i}for(var i in this.LinePoint){var s=(r=this.LinePoint[i]).Start,o=r.End;if(this.Canvas.beginPath(),this.Canvas.moveTo(s.X,s.Y+5),this.Canvas.lineTo(s.X,s.Y-5),this.Canvas.lineTo(o.X,o.Y-5),this.Canvas.lineTo(o.X,o.Y+5),this.Canvas.closePath(),this.Canvas.isPointInPath(t,e))return 100}return-1}}function ChartDrawPictureText(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureText",this.Text="文本",this.PointCount=1,this.FontOption={Family:"微软雅黑",Size:20,Weight:null,Style:null},this.TextRect=null,this.IsInitialized=!1,this.SettingMenu,this.HQChart,this.SetOption=function(t){t&&(t.LineColor&&(this.LineColor=t.LineColor),t.Text&&(this.Text=t.Text),t.FontOption&&(this.FontOption=t.FontOption))},this.Draw=function(t){this.TextRect=null;var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&1==e.length){this.ClipFrame(),this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.font=this.GetTextFont(),this.Canvas.fillText(this.Text,e[0].X,e[0].Y);var a=this.Canvas.measureText(this.Text).width,i=this.FontOption.Size*GetDevicePixelRatio();this.TextRect={},this.TextRect.Left=e[0].X-a/2,this.TextRect.Top=e[0].Y-i,this.TextRect.Width=a,this.TextRect.Height=i,this.Canvas.restore(),!1===this.IsInitialized&&(this.SetTextOption(),this.IsInitialized=!0)}},this.GetTextFont=function(){const t=16*GetDevicePixelRatio()+"px 微软雅黑";if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return t;var e="";return this.FontOption.Color&&(e+=this.FontOption.Color+" "),this.FontOption.Style&&(e+=this.FontOption.Style+" "),this.FontOption.Weight&&(e+=this.FontOption.Weight+" "),this.FontOption.Size>=0&&(e+=this.FontOption.Size*GetDevicePixelRatio()+"px "),e+=this.FontOption.Family},this.SetTextOption=function(){JSConsole.Chart.Log("[ChartDrawPictureText::SetTextOption]"),this.SettingMenu||(this.SettingMenu=new ChartPictureTextSettingMenu(this.Frame.ChartBorder.UIElement.parentNode)),this.SettingMenu.ChartPicture=this,this.SettingMenu.HQChart=this.HQChart,this.SettingMenu.Position={Left:this.TextRect.Left+this.TextRect.Width,Top:this.TextRect.Top},this.SettingMenu.DoModal()},this.IsPointIn=function(t,e){return this.Frame&&10==this.Status&&this.Frame.Data&&this.TextRect?(this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left,this.TextRect.Top,this.TextRect.Width,this.TextRect.Height),this.Canvas.isPointInPath(t,e)?100:-1):-1}}function ChartDrawPictureIconFont(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureIconFont",this.PointCount=1,this.Text="",this.FontOption={Family:"iconfont",Size:24},this.TextRect=null,this.SettingMenu,this.Angle=0,this.SetOption=function(t){t&&(t.LineColor&&(this.LineColor=t.LineColor),t.FontOption&&t.FontOption.Size>0&&(this.FontOption.Size=t.FontOption.Size),IFrameSplitOperator.IsNumber(t.Angle)&&(this.Angle=t.Angle))},this.Draw=function(){this.TextRect=null;var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&1==t.length){var e=this.GetTextFont();if(e){this.ClipFrame();var a=this.Frame.IsHScreen,i=GetDevicePixelRatio();this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.font=e,a?(this.Canvas.translate(t[0].X,t[0].Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Text,0,0)):0!=this.Angle?(this.Canvas.translate(t[0].X,t[0].Y),this.Canvas.rotate(this.Angle*(Math.PI/180)),this.Canvas.fillText(this.Text,0,0)):this.Canvas.fillText(this.Text,t[0].X,t[0].Y);var r=this.Canvas.measureText(this.Text).width;this.TextRect={},this.TextRect.Left=t[0].X-r/2,this.TextRect.Top=t[0].Y-this.FontOption.Size*i,this.TextRect.Width=r,this.TextRect.Height=this.FontOption.Size*i,this.Canvas.restore()}}},this.GetTextFont=function(){if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return null;var t="";return this.FontOption.Size>=0&&(t+=this.FontOption.Size*GetDevicePixelRatio()+"px "),t+=this.FontOption.Family},this.IsPointIn=function(t,e){if(!this.Frame||10!=this.Status)return-1;if(!this.Frame.Data)return-1;if(!this.TextRect)return-1;var a=0;return this.Option&&this.Option.Zoom>=1&&(a=this.Option.Zoom*GetDevicePixelRatio()),this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left-a,this.TextRect.Top-a,this.TextRect.Width+2*a,this.TextRect.Height+2*a),this.Canvas.isPointInPath(t,e)?100:-1}}function ChartDrawPictureGannFan(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGannFan",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LinePoint=[],this.Font=16*GetDevicePixelRatio()+"px 微软雅黑",this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var e=this.GetQuadrant(t[0],t[1]);if(this.SetLineWidth(),1===e||4===e){for(var a in this.CalculateLines(t[0],t[1],e),this.DrawArea(),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End,i.IsDottedLine)}for(var a in this.LinePoint){(i=this.LinePoint[a]).Text&&i.PtEnd&&this.DrawTitle(i.PtEnd,i.Text)}}else this.DrawLine(t[0],t[1],!1);this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(t)}},this.GetQuadrant=function(t,e){return t.X<e.X&&t.Y>e.Y?1:t.X<e.X&&t.Y>e.Y?2:t.X<e.X&&t.Y<e.Y?4:3},this.DrawLine=function(t,e,a){a&&this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),a&&this.Canvas.setLineDash([])},this.DrawTitle=function(t,e){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Canvas.fillText(e,t.X,t.Y)},this.DrawArea=function(){var t=null,e=null;for(var a in this.LinePoint){var i=this.LinePoint[a];"1:8"==i.Text?t=this.LinePoint[a]:"8:1"==i.Text&&(e=this.LinePoint[a])}t&&e&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.End.X,t.End.Y),this.Canvas.lineTo(t.Start.X,t.Start.Y),this.Canvas.lineTo(e.End.X,e.End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(t,e,a){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();const i=[.5,1/3,.25,.125,2/3],r=["1:2","1:3","1:4","1:8","2:3"],n=["2:1","3:1","4:1","8:1","3:2"];var s=new Point,o=new Point;s.X=t.X,s.Y=t.Y,o.X=e.X,o.Y=e.Y;var h=Math.abs(t.X-e.X),l=Math.abs(t.Y-e.Y);if(1===a){var C={Start:s,End:(D=this.CalculateExtendLinePoint(t,e)).Start,IsDottedLine:!1,PtEnd:o,Text:"1:1"};for(var u in this.LinePoint.push(C),i){if(h>5){(C={Start:s,End:null,IsDottedLine:!1,PtEnd:new Point,Text:r[u]}).PtEnd.Y=e.Y,C.PtEnd.X=t.X+h*i[u];var D=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=D.Start,this.LinePoint.push(C)}if(l>5){(C={Start:s,End:null,IsDottedLine:!1,PtEnd:new Point,Text:n[u]}).PtEnd.Y=t.Y-l*i[u],C.PtEnd.X=e.X;D=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=D.Start,this.LinePoint.push(C)}}}else{if(4!=a)return!1;C={Start:s,End:(D=this.CalculateExtendLinePoint(t,e)).End,IsDottedLine:!1,PtEnd:o,Text:"1:1"};for(var u in this.LinePoint.push(C),i){if(h>5){(C={Start:s,End:null,IsDottedLine:!1,PtEnd:new Point,Text:r[u]}).PtEnd.Y=e.Y,C.PtEnd.X=t.X+h*i[u];D=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=D.End,this.LinePoint.push(C)}if(l>5){(C={Start:s,End:null,IsDottedLine:!1,PtEnd:new Point,Text:n[u]}).PtEnd.Y=t.Y+l*i[u],C.PtEnd.X=e.X;D=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=D.End,this.LinePoint.push(C)}}}return!0}}function ChartDrawPictureResistanceLine(){this.newMethod=ChartDrawPictureGannFan,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureResistanceLine",this.CalculateLines=function(t,e,a){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();const i=[1/3,2/3],r=["3:1","3:2"];var n=new Point,s=new Point;n.X=t.X,n.Y=t.Y,s.X=e.X,s.Y=e.Y;Math.abs(t.X-e.X);var o=Math.abs(t.Y-e.Y);if(1===a){var h={Start:n,End:(C=this.CalculateExtendLinePoint(t,e)).Start,IsDottedLine:!1,PtEnd:s,Text:"1:1"};for(var l in this.LinePoint.push(h),i)if(o>5){(h={Start:n,End:null,IsDottedLine:!1,PtEnd:new Point,Text:r[l]}).PtEnd.Y=t.Y-o*i[l],h.PtEnd.X=e.X;var C=this.CalculateExtendLinePoint(h.Start,h.PtEnd);h.End=C.Start,this.LinePoint.push(h)}}else{if(4!=a)return!1;h={Start:n,End:(C=this.CalculateExtendLinePoint(t,e)).End,IsDottedLine:!1,PtEnd:s,Text:"1:1"};for(var l in this.LinePoint.push(h),i)if(o>5){(h={Start:n,End:null,IsDottedLine:!1,PtEnd:new Point,Text:r[l]}).PtEnd.Y=t.Y+o*i[l],h.PtEnd.X=e.X;C=this.CalculateExtendLinePoint(h.Start,h.PtEnd);h.End=C.End,this.LinePoint.push(h)}}return!0},this.DrawArea=function(){var t=null,e=null;for(var a in this.LinePoint){var i=this.LinePoint[a];"1:1"==i.Text?t=this.LinePoint[a]:"3:1"==i.Text&&(e=this.LinePoint[a])}t&&e&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.End.X,t.End.Y),this.Canvas.lineTo(t.Start.X,t.Start.Y),this.Canvas.lineTo(e.End.X,e.End.Y),this.Canvas.closePath(),this.Canvas.fill())}}function ChartDrawPictureGoldenSection(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGoldenSectionLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Font=14*GetDevicePixelRatio()+"px 微软雅黑",this.GetSectionData=function(){return[0,.236,.382,.5,.618,.8,1,1.236,1.382,1.5,1.618,1.8,2]},this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t&&2==t.length){for(var e in this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.CalculateLines(t[0],t[1]),this.ClipFrame(),this.SetLineWidth(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End,a.IsDottedLine)}for(var e in this.RestoreLineWidth(),this.LinePoint){(a=this.LinePoint[e]).Text&&this.DrawTitle(a.Start,a.Text)}this.DrawPoint(t),this.Canvas.restore()}},this.CalculateHSCreenLines=function(t,e){for(var a=this.GetSectionData(),i=this.Frame.ChartBorder.GetTop(),r=this.Frame.ChartBorder.GetBottom(),n=t.X-e.X,s=0;s<a.length;++s){var o=n*a[s],h={Start:new Point,End:new Point};h.Start.X=t.X-o,h.Start.Y=i,h.End.X=t.X-o,h.End.Y=r;var l="";l=0==s?"Base ":(100*a[s]).toFixed(2)+"% ",l+=this.Frame.GetYData(h.Start.Y).toFixed(2),h.Text=l,this.LinePoint.push(h)}},this.CalculateLines=function(t,e){if(this.Frame.IsHScreen)this.CalculateHSCreenLines(t,e);else for(var a=this.GetSectionData(),i=this.Frame.ChartBorder.GetLeft(),r=this.Frame.ChartBorder.GetRight(),n=t.Y-e.Y,s=0;s<a.length;++s){var o=n*a[s],h={Start:new Point,End:new Point};h.Start.Y=t.Y-o,h.Start.X=i,h.End.Y=t.Y-o,h.End.X=r;var l="";l=0==s?"Base ":(100*a[s]).toFixed(2)+"% ",l+=this.Frame.GetYData(h.Start.Y).toFixed(2),h.Text=l,this.LinePoint.push(h)}},this.DrawLine=function(t,e){this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke()},this.DrawTitle=function(t,e){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(t.X,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,0,0),this.Canvas.restore()):this.Canvas.fillText(e,t.X,t.Y)}}function ChartDrawPicturePercentage(){this.newMethod=ChartDrawPictureGoldenSection,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePercentage",this.GetSectionData=function(){return[0,.25,.333,.5,1]}}function ChartDrawPictureWaveBand(){this.newMethod=ChartDrawPictureGoldenSection,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveBand",this.GetSectionData=function(){return[0,.125,.25,.375,.5,.625,.75,.875,1]}}function ChartDrawPictureTriangle(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTriangle",this.PointCount=3,this.Font=16*GetDevicePixelRatio()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LastPoint,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){var e=t.slice(0);for(var a in this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(e),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End)}this.DrawArea(e),this.DrawPoint(e),this.DrawTitle(e),this.Canvas.restore()}},this.DrawArea=function(t){3==t.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(t[0].X,t[0].Y),this.Canvas.lineTo(t[1].X,t[1].Y),this.Canvas.lineTo(t[2].X,t[2].Y),this.Canvas.lineTo(t[0].X,t[0].Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(t){this.Status},this.SetLastPoint=function(t){this.LastPoint={X:t.X,Y:t.Y}},this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new Point;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2===t.length)(a={Start:new Point,End:new Point}).Start.Y=t[0].Y,a.Start.X=t[0].X,a.End.Y=t[1].Y,a.End.X=t[1].X,this.LinePoint.push(a);else if(3===t.length){var a;(a={Start:new Point,End:new Point}).Start.Y=t[0].Y,a.Start.X=t[0].X,a.End.Y=t[1].Y,a.End.X=t[1].X,this.LinePoint.push(a),(a={Start:new Point,End:new Point}).Start.Y=t[1].Y,a.Start.X=t[1].X,a.End.Y=t[2].Y,a.End.X=t[2].X,this.LinePoint.push(a),(a={Start:new Point,End:new Point}).Start.Y=t[2].Y,a.Start.X=t[2].X,a.End.Y=t[0].Y,a.End.X=t[0].X,this.LinePoint.push(a)}}}function ChartDrawPictureSymmetryAngle(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureSymmetryAngle",this.PointCount=2,this.Font=16*GetDevicePixelRatio()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){for(var e in this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(t),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End)}this.DrawArea(),this.DrawPoint(t),this.DrawTitle(t),this.Canvas.restore()}},this.CalculateLines=function(t){if(2==t.length&&this.Frame){var e={Start:new Point,End:new Point};e.Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[1].X,this.LinePoint.push(e),(e={Start:new Point,End:new Point}).Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[0].X,this.LinePoint.push(e);var a=t[0].X-t[1].X;(e={Start:new Point,End:new Point}).Start.Y=t[0].Y,e.Start.X=t[0].X,e.End.Y=t[1].Y,e.End.X=t[0].X+a,this.LinePoint.push(e)}},this.DrawArea=function(){3==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(t){this.Status}}function ChartDrawPictureCircle(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureCircle",this.PointCount=2,this.CircleData,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t&&2==t.length){this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var e=t[0].X-t[1].X,a=t[0].Y-t[1].Y,i=Math.sqrt(e*e+a*a);this.Canvas.fillStyle=this.AreaColor,this.Canvas.strokeStyle=this.LineColor,this.DrawLine(t[0],t[1]),this.Canvas.beginPath(),this.Canvas.arc(t[0].X,t[0].Y,i,0,2*Math.PI),this.Canvas.stroke(),this.Canvas.fill(),this.CircleData={X:t[0].X,Y:t[0].Y,R:i},this.DrawPoint(t),this.Canvas.restore()}},this.IsPointIn=function(t,e){if(10!=this.Status)return-1;var a=this.IsPointInXYValue(t,e);if(a>=0)return a;if(this.CircleData&&this.CircleData.R>8){var i=this.CircleData.X-t,r=this.CircleData.Y-e,n=Math.sqrt(i*i+r*r);if(n<this.CircleData.R&&n>this.CircleData.R-8)return 100}return-1}}function ChartDrawPictureQuadrangle(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureQuadrangle",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(t){this.AreaColor=IChartDrawPicture.ColorToRGBA(this.LineColor,.3);var e=t.slice(0);for(var a in this.CalculateLines(e),this.ClipFrame(),this.LinePoint){var i=this.LinePoint[a];this.DrawLine(i.Start,i.End)}this.DrawArea(),this.DrawPoint(e),this.Canvas.restore()}},this.SetLastPoint=function(t){this.LastPoint={X:t.X,Y:t.Y}},this.DrawArea=function(){4==this.LinePoint.length&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(t){if(2==this.PointStatus&&this.LastPoint){var e=new Point;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,t[2]=e}if(2==t.length){var a=this.CreateLineData(t[0],t[1]);this.LinePoint.push(a)}else if(3==t.length){a=this.CreateLineData(t[0],t[1]);this.LinePoint.push(a);a=this.CreateLineData(t[1],t[2]);this.LinePoint.push(a);var i=t[2].X-t[1].X,r=t[2].Y-t[1].Y,n=new Point;n.X=t[0].X+i,n.Y=t[0].Y+r;a=this.CreateLineData(t[2],n);this.LinePoint.push(a);a=this.CreateLineData(n,t[0]);this.LinePoint.push(a)}}}function ChartDrawPictureFibonacci(){this.newMethod=IChartDrawPicture,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureFibonacci",this.PointCount=1,this.Font=14*GetDevicePixelRatio()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){this.LinePoint=[];var t=this.CalculateDrawPoint();if(t&&(this.CalculateLines(),!(this.LinePoint.length<=0))){for(var e in this.ClipFrame(),this.SetLineWidth(),this.LinePoint){var a=this.LinePoint[e];this.DrawLine(a.Start,a.End),this.DrawTitle(a.Start,a.Title)}this.RestoreLineWidth(),this.DrawPoint(t),this.Canvas.restore()}},this.DrawTitle=function(t,e){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(t.X,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,2,10),this.Canvas.restore()):this.Canvas.fillText(e,t.X+2,t.Y+10)},this.CalculateHSCreenLines=function(){var t=this.Frame.Data;if(!t)return;var e=null;if(10==this.Status){if(1!=this.Value.length)return;e=this.Value[0].XValue}else{if(1!=this.Point.length)return;e=parseInt(this.Frame.GetXData(this.Point[0].Y))+t.DataOffset}var a=this.Frame.ChartBorder.GetRightEx(),i=this.Frame.ChartBorder.GetLeftEx(),r=this.Frame.XPointCount;const n=[1,2,3,5,8,13,21,34,55,89,144,233];for(var s=0;s<n.length;++s){var o=e+n[s],h=o-t.DataOffset;if(!(h<0||h>=r)){var l=this.Frame.GetXFromIndex(o-t.DataOffset,!1),C={Start:new Point,End:new Point,Title:n[s]};C.Start.X=a,C.Start.Y=l,C.End.X=i,C.End.Y=l,this.LinePoint.push(C)}}},this.CalculateLines=function(){if(this.Status<2)return;if(!this.Frame)return;var t=this.Frame.Data;if(!t)return;if(this.Frame.IsHScreen)return void this.CalculateHSCreenLines();var e=null;if(10==this.Status){if(1!=this.Value.length)return;e=this.Value[0].XValue}else{if(1!=this.Point.length)return;e=parseInt(this.Frame.GetXData(this.Point[0].X))+t.DataOffset}var a=this.Frame.ChartBorder.GetTopEx(),i=this.Frame.ChartBorder.GetBottom(),r=this.Frame.XPointCount;const n=[1,2,3,5,8,13,21,34,55,89,144,233];for(var s=0;s<n.length;++s){var o=e+n[s],h=o-t.DataOffset;if(!(h<0||h>=r)){var l=this.Frame.GetXFromIndex(o-t.DataOffset,!1),C={Start:new Point,End:new Point,Title:n[s]};C.Start.Y=a,C.Start.X=l,C.End.Y=i,C.End.X=l,this.LinePoint.push(C)}}}}function ChartDrawStorage(){this.DrawData=new Map,this.StorageKey,this.Load=function(t){if(t){this.StorageKey=t;var e=localStorage[this.StorageKey];if(JSConsole.Chart.Log(`[ChartDrawStorage::Save] Load to localStorage, key=${this.StorageKey}, cache=${e}`),e&&"string"==typeof e){var a=JSON.parse(e);for(var i in a){var r=a[i],n=new Map;for(var s in r.Value){var o=r.Value[s];n.set(o.Key,o.Value)}this.DrawData.set(r.Key,n)}}}},this.Save=function(){if(this.StorageKey){var t=[];for(var e of this.DrawData){var a=e[0],i=e[1],r={Key:a,Value:[]};for(var n of i)r.Value.push({Key:n[0],Value:n[1]});t.push(r)}JSConsole.Chart.Log(`[ChartDrawStorage::Save] save to localStorage, key=${this.StorageKey}`);var s=JSON.stringify(t);localStorage[this.StorageKey]=s}},this.SaveDrawData=function(t){var e=t.Symbol+"-"+t.Period,a=t.ExportStorageData();if(a){if(this.DrawData.has(e))JSConsole.Chart.Log("[ChartDrawStorage::SaveDrawData] Upate: key, drawPicture, data",e,t,a),this.DrawData.get(e).set(a.Guid,a);else{JSConsole.Chart.Log("[ChartDrawStorage::SaveDrawData] Insert: key, drawPicture, data",e,t,a);var i=new Map;i.set(a.Guid,a),this.DrawData.set(e,i)}JSConsole.Chart.Log("[ChartDrawStorage::SaveDrawData] All draw data： ",this.DrawData),this.Save()}},this.DeleteDrawData=function(t){var e=t.Symbol+"-"+t.Period;if(this.DrawData.has(e)){var a=this.DrawData.get(e);a.has(t.Guid)&&(a.delete(t.Guid),this.Save())}},this.Clear=function(){this.DrawData=new Map,this.Save()},this.GetDrawData=function(t){var e=[],a=t.Symbol+"-"+t.Period;if(!this.DrawData.has(a))return e;var i=this.DrawData.get(a);for(var r of i)e.push(r[1]);return e}}function SplitData(){this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,2e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.002],[.04,.05,.04,.001],[.05,.1,.05,.005],[.1,.2,.1,.01],[.2,.4,.2,.02],[.4,.5,.4,.01],[.5,1,.5,.05],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,20,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,1e4,1e3],[4e4,5e4,1e4,1e3],[5e4,1e5,1e4,1e3],[1e5,2e5,1e5,1e4],[2e5,4e5,1e5,1e4],[4e5,5e5,1e5,1e4],[5e5,1e6,1e5,1e4],[1e6,2e6,1e6,1e5],[2e6,4e6,1e6,1e5],[4e6,5e6,1e6,1e5],[5e6,1e7,1e6,1e5],[1e7,2e7,1e7,1e6],[2e7,4e7,1e7,1e6],[4e7,5e7,1e7,1e6],[5e7,1e8,1e7,1e6],[1e8,2e8,1e8,1e7],[2e8,4e8,1e8,1e7],[4e8,5e8,1e8,1e7],[5e8,1e9,1e8,1e7],[1e9,2e9,1e9,1e8],[2e9,4e9,1e9,1e8],[4e9,5e9,1e9,1e8],[5e9,1e10,1e9,1e8]],this.Find=function(t){for(var e in this.Data){var a=this.Data[e];if(t>a[0]&&t<=a[1]){var i={};return i.FixInterval=a[2],i.Increase=a[3],i}}return null}}function PriceSplitData(){this.newMethod=SplitData,this.newMethod(),delete this.newMethod,this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,1e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.001],[.04,.05,.04,.001],[.05,.1,.05,.001],[.1,.2,.1,.01],[.2,.4,.2,.01],[.4,.5,.2,.01],[.5,.8,.2,.01],[.8,1,.5,.01],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,12,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,2e4,2e3],[4e4,5e4,4e4,1e3],[5e4,1e5,5e4,5e3],[1e5,2e5,1e5,1e4],[2e5,4e5,2e5,2e4],[4e5,5e5,4e5,1e4],[5e5,1e6,5e5,5e4],[1e6,2e6,1e6,1e5],[2e6,4e6,2e6,2e5],[4e6,5e6,4e6,1e5],[5e6,1e7,5e6,5e5],[1e7,2e7,1e7,1e6],[2e7,4e7,2e7,2e6],[4e7,5e7,4e7,1e6],[5e7,1e8,5e7,5e6],[1e8,2e8,1e8,1e7],[2e8,4e8,2e8,2e7],[4e8,5e8,4e8,1e7],[5e8,1e9,5e8,5e7],[1e9,2e9,1e9,1e8],[2e9,4e9,2e9,2e8],[4e9,5e9,4e9,1e8],[5e9,1e10,5e9,5e8]]}function JSChartResource(){this.TooltipBGColor="rgb(255, 255, 255)",this.TooltipAlpha=.92,this.SelectRectBGColor="rgba(1,130,212,0.06)",this.UpBarColor="rgb(238,21,21)",this.DownBarColor="rgb(25,158,0)",this.UnchagneBarColor="rgb(0,0,0)",this.Minute={},this.Minute.VolBarColor="rgb(238,127,9)",this.Minute.PriceColor="rgb(50,171,205)",this.Minute.AreaPriceColor="rgba(50,171,205,0.1)",this.Minute.AvPriceColor="rgb(238,127,9)",this.Minute.BeforeBGColor="rgba(240,240,240,0.7)",this.Minute.PositionColor="rgb(218,165,32)",this.DefaultTextColor="rgb(43,54,69)",this.DefaultTextFont=14*GetDevicePixelRatio()+"px 微软雅黑",this.TitleFont=13*GetDevicePixelRatio()+"px 微软雅黑",this.IndexTitleBGColor="rgb(217,219,220)",this.Title={TradeIndexColor:"rgb(105,105,105)",ColorIndexColor:"rgb(112,128,144)",VolColor:"rgb(43,54,69)",AmountColor:"rgb(43,54,69)",DateTimeColor:"rgb(43,54,69)",SettingColor:"rgb(43,54,69)",NameColor:"rgb(43,54,69)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(43,54,69)"},this.UpTextColor="rgb(238,21,21)",this.DownTextColor="rgb(25,158,0)",this.UnchagneTextColor="rgb(0,0,0)",this.CloseLineColor="rgb(0,191,255)",this.CloseLineAreaColor=["rgba(0,191,255,0.8)","rgba(0,191,255,0.2)"],this.FrameBorderPen="rgb(225,236,242)",this.FrameSplitPen="rgb(225,236,242)",this.FrameDotSplitPen="rgb(105,105,105)",this.FrameYLineDash=null,this.FrameSplitTextColor="rgb(117,125,129)",this.FrameSplitTextFont=14*GetDevicePixelRatio()+"px 微软雅黑",this.FrameTitleBGColor="rgb(246,251,253)",this.Frame={XBottomOffset:1*GetDevicePixelRatio(),YTopOffset:2*GetDevicePixelRatio()},this.FromeLogarithmic={OpenPriceFont:"bold "+14*GetDevicePixelRatio()+"px 微软雅黑",MinInterval:45*GetDevicePixelRatio()},this.FrameLatestPrice={TextColor:"rgb(255,255,255)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(0,0,0)",BGAlpha:.6},this.FrameMargin=4,this.FrameLeftMargin=2,this.FrameRightMargin=2,this.DragSubFrameBorder={TopBorderHeight:6*GetDevicePixelRatio(),MinFrameHeight:50*GetDevicePixelRatio()},this.OverlayFrame={BolderPen:"rgb(190,190,190)",TitleColor:"rgb(105,105,105)",TitleFont:11*GetDevicePixelRatio()+"px arial"},this.CorssCursorBGColor="rgb(43,54,69)",this.CorssCursorTextColor="rgb(255,255,255)",this.CorssCursorTextFont=14*GetDevicePixelRatio()+"px 微软雅黑",this.CorssCursorHPenColor="rgb(130,130,130)",this.CorssCursorVPenColor="rgb(130,130,130)",this.LockBGColor="rgb(220, 220, 220)",this.LockTextColor="rgb(210, 34, 34)",this.Domain="https://opensource.zealink.com",this.CacheDomain="https://opensourcecache.zealink.com",this.PyIndexDomain="https://py.zealink.com",this.KLine={MaxMin:{Font:12*GetDevicePixelRatio()+"px 微软雅黑",Color:"rgb(43,54,69)"},Info:{Investor:{ApiUrl:"https://opensource.zealink.com/API/NewsInteract",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#1c65db"}},Announcement:{ApiUrl:"https://opensource.zealink.com/API/ReportList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f5a521"},IconFont2:{Family:"iconfont",Text:"",HScreenText:"",Color:"#ed7520"}},Pforecast:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#986cad"}},Research:{ApiUrl:"https://opensource.zealink.com/API/InvestorRelationsList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#19b1b7"}},BlockTrading:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f39f7c"}},TradeDetail:{ApiUrl:"https://opensource.zealink.com/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#b22626"}},IconLibrary:{Family:"iconfont",Icon:[{Text:"",HScreenText:"",Color:"#f39f7c"},{Text:"",HScreenText:"",Color:"#19b1b7"},{Text:"",HScreenText:"",Color:"#b22626"},{Text:"",HScreenText:"",Color:"#ed7520"}]}},NumIcon:{Color:"rgb(251,80,80)",Family:"iconfont",Text:["","","","","","","","","","","","","","","","","","","","",""]},TradeIcon:{Family:"iconfont",Buy:{Color:"rgb(255,15,4)",Text:"",HScreenText:""},Sell:{Color:"rgb(64,122,22)",Text:"",HScreenText:""}}},this.Index={},this.Index.LineColor=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],this.OverlaySymbol={Random:0},this.OverlaySymbol.Color=["rgb(38,198,218)","rgb(103,58,183)","rgb(0,191,165)","rgb(130,177,255)"],this.Index.StockHistoryDayApiUrl="https://opensource.zealink.com/API/StockHistoryDay",this.Index.MarketLongShortApiUrl="https://opensource.zealink.com/API/FactorTiming",this.Index.MarketAttentionApiUrl="https://opensource.zealink.com/API/MarketAttention",this.Index.MarketHeatApiUrl="https://opensource.zealink.com/API/MarketHeat",this.Index.CustomIndexHeatApiUrl="https://opensource.zealink.com/API/QuadrantCalculate",this.Index.NotSupport={Font:"14px 微软雅黑",TextColor:"rgb(52,52,52)"},this.DrawPicture={},this.DrawPicture.LineColor=["rgb(30,144,255)"],this.DrawPicture.PointColor=["rgb(105,105,105)"],this.KLineTrain={Font:"bold 14px arial",LastDataIcon:{Color:"rgb(0,0,205)",Text:"⬇"},BuyIcon:{Color:"rgb(0,205,102 )",Text:"B"},SellIcon:{Color:"rgb(255,127,36 )",Text:"S"},IconFont:{Family:"iconfont",Buy:{Text:"",HScreenText:"",Color:"rgb(255,140,0)"},Sell:{Text:"",HScreenText:"",Color:"rgb(6,79,18)"},Last:{Text:"",HScreenText:"",Color:"rgb(55,0,255)"}}},this.TooltipPaint={BGColor:"rgba(250,250,250,0.8)",BorderColor:"rgb(120,120,120)",TitleColor:"rgb(120,120,120)",TitleFont:13*GetDevicePixelRatio()+"px 微软雅黑"},this.PCTooltip={LineHeight:25},this.Barrage={Font:16*GetDevicePixelRatio()+"px 微软雅黑",Height:20,Color:"RGB(109,109,109)"},this.MinuteInfo={TextColor:"rgb(84,143,255)",Font:14*GetDevicePixelRatio()+"px 微软雅黑",PointColor:"rgb(38,113,254)",LineColor:"rgb(120,167,255)",TextBGColor:"rgba(255,255,255,0.8)"},this.DRAWICON={Icon:{MaxSize:24,MinSize:12,Zoom:{Type:1,Value:1}},Text:{MaxSize:50,MinSize:12,Zoom:{Type:1,Value:1},FontName:"Arial"}},this.DRAWTEXT={MaxSize:30,MinSize:20,Zoom:{Type:1,Value:1},FontName:"微软雅黑"},this.DOTLINE={LineDash:[3,5]},this.DRAWSL={PixelWidth:15},this.SetStyle=function(t){if(t.TooltipBGColor&&(this.TooltipBGColor=t.TooltipBGColor),t.TooltipAlpha&&(this.TooltipAlpha=t.TooltipAlpha),t.SelectRectBGColor&&(this.SelectRectBGColor=t.SelectRectBGColor),t.UpBarColor&&(this.UpBarColor=t.UpBarColor),t.DownBarColor&&(this.DownBarColor=t.DownBarColor),t.UnchagneBarColor&&(this.UnchagneBarColor=t.UnchagneBarColor),t.Minute&&(t.Minute.VolBarColor&&(this.Minute.VolBarColor=t.Minute.VolBarColor),t.Minute.PriceColor&&(this.Minute.PriceColor=t.Minute.PriceColor),t.Minute.AvPriceColor&&(this.Minute.AvPriceColor=t.Minute.AvPriceColor),t.Minute.AreaPriceColor&&(this.Minute.AreaPriceColor=t.Minute.AreaPriceColor),t.Minute.PositionColor&&(this.Minute.PositionColor=t.Minute.PositionColor)),t.DefaultTextColor&&(this.DefaultTextColor=t.DefaultTextColor),t.DefaultTextFont&&(this.DefaultTextFont=t.DefaultTextFont),t.TitleFont&&(this.TitleFont=t.TitleFont),t.IndexTitleBGColor&&(this.IndexTitleBGColor=t.IndexTitleBGColor),t.UpTextColor&&(this.UpTextColor=t.UpTextColor),t.DownTextColor&&(this.DownTextColor=t.DownTextColor),t.UnchagneTextColor&&(this.UnchagneTextColor=t.UnchagneTextColor),t.CloseLineColor&&(this.CloseLineColor=t.CloseLineColor),t.CloseLineAreaColor&&(this.CloseLineAreaColor=t.CloseLineAreaColor),t.FrameBorderPen&&(this.FrameBorderPen=t.FrameBorderPen),t.FrameSplitPen&&(this.FrameSplitPen=t.FrameSplitPen),t.FrameDotSplitPen&&(this.FrameDotSplitPen=t.FrameDotSplitPen),t.FrameSplitTextColor&&(this.FrameSplitTextColor=t.FrameSplitTextColor),t.FrameSplitTextFont&&(this.FrameSplitTextFont=t.FrameSplitTextFont),t.FrameTitleBGColor&&(this.FrameTitleBGColor=t.FrameTitleBGColor),t.Frame&&(t.Frame.XBottomOffset&&(this.Frame.XBottomOffset=t.Frame.XBottomOffset),t.Frame.YTopOffset&&(this.Frame.YTopOffset=t.Frame.YTopOffset)),t.FrameLatestPrice&&(t.FrameLatestPrice.TextColor&&(this.FrameLatestPrice.TextColor=t.FrameLatestPrice.TextColor),t.FrameLatestPrice.UpBarColor&&(this.FrameLatestPrice.UpBarColor=t.FrameLatestPrice.UpBarColor),t.FrameLatestPrice.DownBarColor&&(this.FrameLatestPrice.DownBarColor=t.FrameLatestPrice.DownBarColor),t.FrameLatestPrice.UnchagneBarColor&&(this.FrameLatestPrice.UnchagneBarColor=t.FrameLatestPrice.UnchagneBarColor),t.FrameLatestPrice.BGAlpha&&(this.FrameLatestPrice.BGAlpha=t.FrameLatestPrice.BGAlpha)),t.CorssCursorBGColor&&(this.CorssCursorBGColor=t.CorssCursorBGColor),t.CorssCursorTextColor&&(this.CorssCursorTextColor=t.CorssCursorTextColor),t.CorssCursorTextFont&&(this.CorssCursorTextFont=t.CorssCursorTextFont),t.CorssCursorVPenColor&&(this.CorssCursorVPenColor=t.CorssCursorVPenColor),t.CorssCursorHPenColor&&(this.CorssCursorHPenColor=t.CorssCursorHPenColor),t.KLine&&(this.KLine=t.KLine),t.Index&&(t.Index.LineColor&&(this.Index.LineColor=t.Index.LineColor),t.Index.NotSupport&&(this.Index.NotSupport=t.Index.NotSupport)),t.ColorArray&&(this.ColorArray=t.ColorArray),t.DrawPicture&&(this.DrawPicture.LineColor=t.DrawPicture.LineColor,this.DrawPicture.PointColor=t.DrawPicture.PointColor),t.TooltipPaint&&(t.TooltipPaint.BGColor&&(this.TooltipPaint.BGColor=t.TooltipPaint.BGColor),t.TooltipPaint.BorderColor&&(this.TooltipPaint.BorderColor=t.TooltipPaint.BorderColor),t.TooltipPaint.TitleColor&&(this.TooltipPaint.TitleColor=t.TooltipPaint.TitleColor),t.TooltipPaint.TitleFont&&(this.TooltipPaint.TitleFont=t.TooltipPaint.TitleFont)),t.MinuteInfo&&(t.MinuteInfo.TextColor&&(this.MinuteInfo.TextColor=t.MinuteInfo.TextColor),t.MinuteInfo.Font&&(this.MinuteInfo.Font=t.MinuteInfo.Font),t.MinuteInfo.PointColor&&(this.MinuteInfo.PointColor=t.MinuteInfo.PointColor),t.MinuteInfo.LineColor&&(this.MinuteInfo.LineColor=t.MinuteInfo.LineColor),t.MinuteInfo.TextBGColor&&(this.MinuteInfo.TextBGColor=t.MinuteInfo.TextBGColor)),t.Title&&(t.Title.TradeIndexColor&&(this.Title.TradeIndexColor=t.Title.TradeIndexColor),t.Title.ColorIndexColor&&(this.Title.ColorIndexColor=t.Title.ColorIndexColor),t.Title.VolColor&&(this.Title.VolColor=t.Title.VolColor),t.Title.AmountColor&&(this.Title.AmountColor=t.Title.AmountColor),t.Title.DateTimeColor&&(this.Title.DateTimeColor=t.Title.DateTimeColor),t.Title.NameColor&&(this.Title.NameColor=t.Title.NameColor),t.Title.SettingColor&&(this.Title.SettingColor=t.Title.SettingColor),t.Title.TurnoverRateColor&&(this.Title.TurnoverRateColor=t.Title.TurnoverRateColor),t.Title.PositionColor&&(this.Title.PositionColor=t.Title.PositionColor)),t.DRAWICON){if(t.DRAWICON.Icon){var e=t.DRAWICON.Icon;IFrameSplitOperator.IsPlusNumber(e.MaxSize)&&(this.DRAWICON.Icon.MaxSize=e.MaxSize),IFrameSplitOperator.IsPlusNumber(e.MinSize)&&(this.DRAWICON.Icon.MinSize=e.MinSize),e.Zoom&&(this.DRAWICON.Icon.Zoom=e.Zoom)}if(t.DRAWICON.Text){e=t.DRAWICON.Text;IFrameSplitOperator.IsPlusNumber(e.MaxSize)&&(this.DRAWICON.Text.MaxSize=e.MaxSize),IFrameSplitOperator.IsPlusNumber(e.MinSize)&&(this.DRAWICON.Text.MinSize=e.MinSize),e.Zoom&&(this.DRAWICON.Text.Zoom=e.Zoom),e.FontName&&(this.DRAWICON.Text.FontName=e.FontName)}}if(t.DRAWTEXT){e=t.DRAWTEXT;IFrameSplitOperator.IsPlusNumber(e.MaxSize)&&(this.DRAWICON.MaxSize=e.MaxSize),IFrameSplitOperator.IsPlusNumber(e.MinSize)&&(this.DRAWICON.MinSize=e.MinSize),e.Zoom&&(this.DRAWICON.Zoom=e.Zoom),e.FontName&&(this.DRAWICON.FontName=e.FontName)}t.DOTLINE&&(this.DOTLINE=t.DOTLINE),t.DRAWSL&&(this.DOTLINE=t.DRAWSL),t.DragSubFrameBorder&&(this.DragSubFrameBorder=t.DragSubFrameBorder)}}IChartDrawPicture.ColorToRGBA=function(t,e){if(/^(rgb|RGB)/.test(t)){for(var a="#",i=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),r=0;r<i.length;r++){var n=Number(i[r]).toString(16);"0"===n&&(n+=n),a+=n}t=a}return"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+","+e+")"},IChartDrawPicture.ArrayDrawPricture=[{Name:"线段",ClassName:"ChartDrawPictureLine",Create:function(){return new ChartDrawPictureLine}},{Name:"射线",ClassName:"ChartDrawPictureHaflLine",Create:function(){return new ChartDrawPictureHaflLine}},{Name:"水平线",ClassName:"ChartDrawPictureHorizontalLine",Create:function(){return new ChartDrawPictureHorizontalLine}},{Name:"趋势线",ClassName:"ChartDrawPictureTrendLine",Create:function(){return new ChartDrawPictureTrendLine}},{Name:"矩形",ClassName:"ChartDrawPictureRect",Create:function(){return new ChartDrawPictureRect}},{Name:"圆弧线",ClassName:"ChartDrawPictureArc",Create:function(){return new ChartDrawPictureArc}},{Name:"M头W底",ClassName:"ChartDrawPictureWaveMW",Create:function(){return new ChartDrawPictureWaveMW}},{Name:"平行线",ClassName:"ChartDrawPictureParallelLines",Create:function(){return new ChartDrawPictureParallelLines}},{Name:"平行通道",ClassName:"ChartDrawPictureParallelChannel",Create:function(){return new ChartDrawPictureParallelChannel}},{Name:"价格通道线",ClassName:"ChartDrawPicturePriceChannel",Create:function(){return new ChartDrawPicturePriceChannel}},{Name:"文本",ClassName:"ChartDrawPictureText",Create:function(){return new ChartDrawPictureText}},{Name:"江恩角度线",ClassName:"ChartDrawPictureGannFan",Create:function(){return new ChartDrawPictureGannFan}},{Name:"阻速线",ClassName:"ChartDrawPictureResistanceLine",Create:function(){return new ChartDrawPictureResistanceLine}},{Name:"黄金分割",ClassName:"ChartDrawPictureGoldenSection",Create:function(){return new ChartDrawPictureGoldenSection}},{Name:"百分比线",ClassName:"ChartDrawPicturePercentage",Create:function(){return new ChartDrawPicturePercentage}},{Name:"波段线",ClassName:"ChartDrawPictureWaveBand",Create:function(){return new ChartDrawPictureWaveBand}},{Name:"三角形",ClassName:"ChartDrawPictureTriangle",Create:function(){return new ChartDrawPictureTriangle}},{Name:"对称角度",ClassName:"ChartDrawPictureSymmetryAngle",Create:function(){return new ChartDrawPictureSymmetryAngle}},{Name:"圆",ClassName:"ChartDrawPictureCircle",Create:function(){return new ChartDrawPictureCircle}},{Name:"平行四边形",ClassName:"ChartDrawPictureQuadrangle",Create:function(){return new ChartDrawPictureQuadrangle}},{Name:"斐波那契周期线",ClassName:"ChartDrawPictureFibonacci",Create:function(){return new ChartDrawPictureFibonacci}},{ClassName:"ChartDrawPictureIconFont",Create:function(){return new ChartDrawPictureIconFont}}],IChartDrawPicture.MapIonFont=new Map([["icon-arrow_up",{Text:"",Color:"#318757",Family:"iconfont"}],["icon-arrow_down",{Text:"",Color:"#db563e",Family:"iconfont"}],["icon-arrow_right",{Text:"",Color:"#318757",Family:"iconfont"}],["icon-arrow_left",{Text:"",Color:"#318757",Family:"iconfont"}]]),IChartDrawPicture.GetDrawPictureByName=function(t){for(var e in IChartDrawPicture.ArrayDrawPricture){var a=IChartDrawPicture.ArrayDrawPricture[e];if(a.Name==t)return a}return null},IChartDrawPicture.GetDrawPictureByClassName=function(t){for(var e in IChartDrawPicture.ArrayDrawPricture){var a=IChartDrawPicture.ArrayDrawPricture[e];if(a.ClassName==t)return a}return null},IChartDrawPicture.RegisterDrawPicture=function(t){if(!t.Name||!t.ClassName||!t.Create)return!1;var e={Name:t.Name,ClassName:t.ClassName,Create:t.Create};return IChartDrawPicture.ArrayDrawPricture.push(e),JSConsole.Chart.Log("[IChartDrawPicture.RegisterDrawPicture] registered new draw picture class. item=",e),!0},IChartDrawPicture.RegisterIonFont=function(t){if(!t.Name||!t.Text||!t.Family)return!1;var e=IChartDrawPicture.MapIonFont.has(t.Name);return IChartDrawPicture.MapIonFont.set(t.Name,t),JSConsole.Chart.Log("[IChartDrawPicture.RegisterIonFont] registered new icon font, obj=, isOverwirte=",t,e),!0},IChartDrawPicture.CreateChartDrawPicture=function(t){var e=IChartDrawPicture.GetDrawPictureByClassName(t.ClassName);if(!e)return null;var a=e.Create();return t.Period>=0&&(a.Period=t.Period),t.Guid&&(a.Guid=t.Guid),t.Symbol&&(a.Symbol=t.Symbol),t.Value&&(a.Value=t.Value),t.Text&&(a.Text=t.Text),t.LineColor&&(a.LineColor=t.LineColor),t.AreaColor&&(a.AreaColor=t.AreaColor),t.FontOption&&(a.FontOption=t.FontOption),t.Label&&(a.Label=t.Label),t.LineWidth>0&&(a.LineWidth=t.LineWidth),a};var g_JSChartResource=new JSChartResource,JSCHART_LANGUAGE_ID={LANGUAGE_CHINESE_ID:0,LANGUAGE_ENGLISH_ID:1};function JSChartLocalization(){this.TextResource=new Map([["Tooltip-Open",{CN:"开:",EN:"O:"}],["Tooltip-High",{CN:"高:",EN:"H:"}],["Tooltip-Low",{CN:"低:",EN:"L:"}],["Tooltip-Close",{CN:"收:",EN:"C:"}],["Tooltip-Increase",{CN:"幅:",EN:"I:"}],["Tooltip-Vol",{CN:"量:",EN:"V:"}],["Tooltip-Amount",{CN:"额:",EN:"A:"}],["Tooltip-AvPrice",{CN:"均:",EN:"AP:"}],["Tooltip-Price",{CN:"价:",EN:"P:"}],["Tooltip-Exchange",{CN:"换:",EN:"E:"}],["Tooltip-Position",{CN:"持:",EN:"P:"}],["DivTooltip-Open",{CN:"开盘:",EN:"Open:"}],["DivTooltip-High",{CN:"最高:",EN:"High:"}],["DivTooltip-Low",{CN:"最低:",EN:"Low:"}],["DivTooltip-Close",{CN:"收盘:",EN:"Close:"}],["DivTooltip-Increase",{CN:"涨幅:",EN:"Increase:"}],["DivTooltip-Vol",{CN:"数量:",EN:"Volume:"}],["DivTooltip-Amount",{CN:"金额:",EN:"Amount:"}],["DivTooltip-Exchange",{CN:"换手:",EN:"Exchange:"}],["DivTooltip-Position",{CN:"持仓:",EN:"Position:"}],["KTitle-Open",{CN:"开:",EN:"O:"}],["KTitle-High",{CN:"高:",EN:"H:"}],["KTitle-Low",{CN:"低:",EN:"L:"}],["KTitle-Close",{CN:"收:",EN:"C:"}],["KTitle-Increase",{CN:"幅:",EN:"I:"}],["KTitle-Vol",{CN:"量:",EN:"V:"}],["KTitle-Amount",{CN:"额:",EN:"A:"}],["KTitle-Exchange",{CN:"换:",EN:"E:"}],["KTitle-Position",{CN:"持:",EN:"P:"}],["MTitle-Close",{CN:"价:",EN:"C:"}],["MTitle-AvPrice",{CN:"均:",EN:"AC:"}],["MTitle-Increase",{CN:"幅:",EN:"I:"}],["MTitle-Vol",{CN:"量:",EN:"V:"}],["MTitle-Amount",{CN:"额:",EN:"A:"}],["MTitle-Position",{CN:"持:",EN:"P:"}],["日线",{CN:"日线",EN:"1D"}],["周线",{CN:"周线",EN:"1W"}],["双周",{CN:"双周",EN:"2W"}],["月线",{CN:"月线",EN:"1M"}],["年线",{CN:"年线",EN:"1Y"}],["1分",{CN:"1分",EN:"1Min"}],["5分",{CN:"5分",EN:"5Min"}],["15分",{CN:"15分",EN:"15Min"}],["30分",{CN:"30分",EN:"30Min"}],["60分",{CN:"60分",EN:"60Min"}],["季线",{CN:"季线",EN:"1Q"}],["分笔",{CN:"分笔",EN:"Tick"}],["2小时",{CN:"2小时",EN:"2H"}],["4小时",{CN:"4小时",EN:"4H"}],["不复权",{CN:"不复权",EN:"No Right"}],["前复权",{CN:"前复权",EN:"Pro Right"}],["后复权",{CN:"后复权",EN:"Post Right"}],["日",{CN:"日",EN:"Sun."}],["一",{CN:"一",EN:"Mon."}],["二",{CN:"二",EN:"Tues."}],["三",{CN:"三",EN:"Wed."}],["四",{CN:"四",EN:"Thur."}],["五",{CN:"五",EN:"Fri."}],["六",{CN:"六",EN:"Sat."}],["1月",{CN:"1月",EN:"Jan"}],["2月",{CN:"2月",EN:"Feb"}],["3月",{CN:"3月",EN:"Mar"}],["4月",{CN:"4月",EN:"Apr"}],["5月",{CN:"5月",EN:"May"}],["6月",{CN:"6月",EN:"Jun"}],["7月",{CN:"7月",EN:"Jul"}],["8月",{CN:"8月",EN:"Aug"}],["9月",{CN:"9月",EN:"Sept"}],["10月",{CN:"10月",EN:"Oct"}],["11月",{CN:"11月",EN:"Nov"}],["12月",{CN:"12月",EN:"Dec"}],["自定义分钟",{CN:"分",EN:"Min"}],["自定义日线",{CN:"日",EN:"D"}],["自定义秒",{CN:"秒",EN:"S"}]]),this.GetText=function(t,e){var a=this.TextResource.get(t);return a?lang?a[lang]:a.CN:""},this.SetTextResource=function(t,e){this.TextResource.set(t,e)}}var g_JSChartLocalization=new JSChartLocalization;function JSIndexMap(){}function HQIndexFormula(){}function KLineChartContainer(t,e){this.newMethod=JSChartContainer,this.newMethod(t,e),delete this.newMethod,this.ClassName="KLineChartContainer",this.WindowIndex=new Array,this.ColorIndex,this.TradeIndex,this.Symbol,this.Name,this.Period=0,this.IsApiPeriod=!1,this.Right=0,this.SourceData,this.MaxReqeustDataCount=3e3,this.MaxRequestMinuteDayCount=5,this.PageSize=200,this.KLineDrawType=0,this.ScriptErrorCallback,this.FlowCapitalReady=!1,this.EnableFlowCapital={},this.ChartDrawStorage=new ChartDrawStorage,this.ChartDrawStorageCache=null,this.RightSpaceCount=0,this.SourceDataLimit=new Map,this.CustomShow=null,this.OverlayIndexFrameWidth=60,this.ZoomType=0,this.KLineSize=null,this.Page={Day:{Enable:!1,Index:0,Finish:!1},Minute:{Enable:!1,Index:0,Finish:!1}},this.DragDownload={Day:{Enable:!1,IsEnd:!1,Status:0},Minute:{Enable:!1,IsEnd:!1,status:0}},this.IsAutoUpdate=!1,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.KLineApiUrl=g_JSChartResource.Domain+"/API/KLine2",this.MinuteKLineApiUrl=g_JSChartResource.Domain+"/API/KLine3",this.DragMinuteKLineApiUrl=g_JSChartResource.Domain+"/API/KLine4",this.DragKLineApiUrl=g_JSChartResource.Domain+"/API/KLine5",this.RealtimeApiUrl=g_JSChartResource.Domain+"/API/Stock",this.KLineMatchUrl=g_JSChartResource.Domain+"/API/KLineMatch",this.StockHistoryDayApiUrl=g_JSChartResource.Domain+"/API/StockHistoryDay",this.TickApiUrl=g_JSChartResource.Domain+"/API/StockDetail",this.MinuteDialog,this.RightMenu,this.BeforeBindMainData=null,this.AfterBindMainData=null,this.ResetDragDownload=function(){this.DragDownload.Day.Status=0,this.DragDownload.Day.IsEnd=!1,this.DragDownload.Minute.Status=0,this.DragDownload.Minute.IsEnd=!1},this.ResetPage=function(){this.Page.Day.Finish=!1,this.Page.Day.Index=0,this.Page.Minute.Finish=!1,this.Page.Minute.Index=0},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.SandTableOperator=function(t){switch(t.ID){case 1:this.StopAutoUpdate(),t.Data&&this.ManualUpdateKData(t);break;case 2:this.ManualUpdateKData(t);break;case 3:t.IsAutoUpdate&&(this.IsAutoUpdate=t.IsAutoUpdate),this.ChangeSymbol(this.Symbol)}},this.ManualUpdateKData=function(t){var e=t.Data,a=e.length,i=new ChartData;i.Data=e,i.Period=this.Period,i.Right=this.Right,i.Symbol=this.Symbol,this.UpdateMainData(i,a),this.BindInstructionIndexData(i);for(var r=0;r<this.Frame.SubFrame.length;++r)this.BindIndexData(r,i);if(IFrameSplitOperator.IsNumber(t.DataOffset)&&t.DataOffset>=0){var n=null;(n=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data)&&(n.DataOffset=t.DataOffset)}this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendManualKLineUpdateEvent(i)},this.GetKDataInfo=function(){if(!this.ChartPaint[0])return null;var t=this.ChartPaint[0],e={};return t.Data&&t.Data.Data&&(e.Data=t.Data.CloneData("HistoryData")),e.ShowRange=t.ShowRange,e.Period=this.Period,e.RightSpaceCount=this.RightSpaceCount,e},this.ChartOperator=function(t){var e=t.ID;if(e===JSCHART_OPERATOR_ID.OP_SCROLL_LEFT||e===JSCHART_OPERATOR_ID.OP_SCROLL_RIGHT){var a=e===JSCHART_OPERATOR_ID.OP_SCROLL_LEFT,i=1;t.Step>0&&(i=t.Step),this.DataMove(i*this.StepPixel,a)&&(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw())}else if(e===JSCHART_OPERATOR_ID.OP_ZOOM_IN||e===JSCHART_OPERATOR_ID.OP_ZOOM_OUT){var r={};if(r.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),e===JSCHART_OPERATOR_ID.OP_ZOOM_IN){if(!this.Frame.ZoomUp(r))return}else if(!this.Frame.ZoomDown(r))return;this.CursorIndex=r.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else if(e===JSCHART_OPERATOR_ID.OP_GOTO_HOME){if(!(u=this.ChartOperator_Temp_GetHistroyData()))return;var n=this.Frame.SubFrame[0].Frame.XPointCount;n-=this.RightSpaceCount;var s=u.Data.length-n;u.DataOffset=s,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,JSConsole.Chart.Log(`[KLineChartContainer::ChartOperator] OP_GOTO_HOME, dataOffset=${u.DataOffset} CursorIndex=${this.CursorIndex} PageSize=${n}`),this.ChartOperator_Temp_Update()}else if(e===JSCHART_OPERATOR_ID.OP_GOTO_END){if(!(u=this.ChartOperator_Temp_GetHistroyData()))return;u.DataOffset=0,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,JSConsole.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO_END "),this.ChartOperator_Temp_Update()}else if(e==JSCHART_OPERATOR_ID.OP_LEFT_ZOOM_IN||e==JSCHART_OPERATOR_ID.OP_LEFT_ZOOM_OUT){if(!(u=this.ChartOperator_Temp_GetHistroyData()))return;var o=u.Data.length,h=(n=this.Frame.SubFrame[0].Frame.XPointCount,u.DataOffset);if(e==JSCHART_OPERATOR_ID.OP_LEFT_ZOOM_IN){if(IFrameSplitOperator.IsNumber(t.Step)){if(n>=o)return;if((i=t.Step)>h&&(i=h),n+i>o&&(i=o-n),i<=0)return;n+=i,u.DataOffset-=i}}else if(e==JSCHART_OPERATOR_ID.OP_LEFT_ZOOM_OUT){var l=this.GetMaxMinPageSize().Min;if(IFrameSplitOperator.IsNumber(t.Step)){if(n<l)return;if(n-(i=t.Step)<l&&(i=n-l),i<=0)return;n-=i,u.DataOffset-=i}}for(var C in this.Frame.SubFrame){this.Frame.SubFrame[C].Frame.XPointCount=n}u.DataOffset<0&&(u.DataOffset=0),this.ChartOperator_Temp_Update()}else if(e==JSCHART_OPERATOR_ID.OP_RIGHT_ZOOM_IN||e==JSCHART_OPERATOR_ID.OP_RIGHT_ZOOM_OUT){var u;if(!(u=this.ChartOperator_Temp_GetHistroyData()))return;o=u.Data.length,n=this.Frame.SubFrame[0].Frame.XPointCount,h=u.DataOffset;if(e==JSCHART_OPERATOR_ID.OP_RIGHT_ZOOM_IN){if(IFrameSplitOperator.IsNumber(t.Step)){if(n>=o)return;var D=o-(h+n);if(D<=0)return;if((i=t.Step)>D&&(i=D),i<=0)return;n+=i}}else if(e==JSCHART_OPERATOR_ID.OP_RIGHT_ZOOM_OUT){l=this.GetMaxMinPageSize().Min;if(IFrameSplitOperator.IsNumber(t.Step)){if(n<l)return;if((i=t.Step)>n&&(i=n),n-i<l&&(i=n-l),i<=0)return;n-=i}}for(var C in this.Frame.SubFrame){this.Frame.SubFrame[C].Frame.XPointCount=n}u.DataOffset<0&&(u.DataOffset=0),this.ChartOperator_Temp_Update()}},this.ChartOperator_Temp_GetHistroyData=function(){return(this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data)||null},this.ChartOperator_Temp_Update=function(){this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()},this.OnWheel=function(t){JSConsole.Chart.Log("[KLineChartContainer::OnWheel]",t);var e,a=t.clientX-this.UIElement.getBoundingClientRect().left,i=t.clientY-this.UIElement.getBoundingClientRect().top;this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),e=this.Canvas.isPointInPath(a,i);var r=t.wheelDelta;if(IFrameSplitOperator.IsObjectExist(t.wheelDelta)||(r=-.01*t.deltaY),this.SourceData&&this.SourceData.Data)if(e&&r<0)(n={ZoomType:this.ZoomType}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),this.Frame.ZoomDown(n)&&(this.CursorIndex=n.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw());else if(e&&r>0){var n;(n={ZoomType:this.ZoomType}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),this.Frame.ZoomUp(n)&&(JSConsole.Chart.Log("[KLineChartContainer::OnWheel] cursorIndex ",n),this.CursorIndex=n.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw())}t.preventDefault?t.preventDefault():t.returnValue=!1},this.Create=function(t,e){for(var a in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new ChartCorssCursor,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=g_DivTooltipDataForamt.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatX.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY=g_DivTooltipDataForamt.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartSplashPaint=new ChartSplashPaint,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new HQTradeFrame,this.Frame.ChartBorder=new ChartBorder,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var i=new DynamicChartTitlePainting;i.Frame=this.Frame.SubFrame[a].Frame,i.Canvas=this.Canvas,i.LanguageID=this.LanguageID,this.TitlePaint.push(i)}var r=!0,n=!0;e&&(!1===e.KeyDown&&(r=!1,JSConsole.Chart.Log("[KLineChartContainer::Create] not register keydown event.")),!1===e.Wheel&&(n=!1,JSConsole.Chart.Log("[KLineChartContainer::Create] not register wheel event."))),r&&this.UIElement.addEventListener("keydown",t=>{this.OnKeyDown(t)},!0),n&&this.UIElement.addEventListener("wheel",t=>{this.OnWheel(t)},!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new ChartBorder;a.UIElement=this.UIElement;var i=new KLineFrame;if(i.Canvas=this.Canvas,i.ChartBorder=a,i.Identify=e,i.RightSpaceCount=this.RightSpaceCount,this.ModifyIndexDialog&&(i.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(i.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),i.HorizontalMax=20,i.HorizontalMin=10,0==e){i.YSplitOperator=new FrameSplitKLinePriceY,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),i.YSplitOperator.FrameSplitData2=this.FrameSplitData.get("double");var r=GetDevicePixelRatio();a.BottomSpace=12*r,a.TopSpace=12*r}else i.YSplitOperator=new FrameSplitY,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),i.YSplitOperator.LanguageID=this.LanguageID;i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new FrameSplitKLineX,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,i.XSplitOperator.LanguageID=this.LanguageID,e!=t-1&&(i.XSplitOperator.ShowText=!1);for(var n=i.HorizontalMin;n<=i.HorizontalMax;n+=1)i.HorizontalInfo[n]=new CoordinateInfo,i.HorizontalInfo[n].Value=n,0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=n.toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new SubFrameItem;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}},this.CreateSubFrameItem=function(t){var e=new ChartBorder;e.UIElement=this.UIElement;var a=new KLineFrame;a.Canvas=this.Canvas,a.ChartBorder=e,a.Identify=t,this.ModifyIndexDialog&&(a.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(a.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),a.HorizontalMax=20,a.HorizontalMin=10,a.YSplitOperator=new FrameSplitY,a.YSplitOperator.LanguageID=this.LanguageID,a.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),a.YSplitOperator.Frame=a,a.YSplitOperator.ChartBorder=e,a.XSplitOperator=new FrameSplitKLineX,a.XSplitOperator.Frame=a,a.XSplitOperator.ChartBorder=e,a.XSplitOperator.ShowText=!1;var i=this.Frame.SubFrame[0].Frame.XPointCount;a.XPointCount=i,a.Data=this.ChartPaint[0].Data;for(var r=a.HorizontalMin;r<=a.HorizontalMax;r+=1)a.HorizontalInfo[r]=new CoordinateInfo,a.HorizontalInfo[r].Value=r,a.HorizontalInfo[r].Message[1]=r.toString(),a.HorizontalInfo[r].Font="14px 微软雅黑";var n=new SubFrameItem;return n.Frame=a,n.Height=10,n},this.CreateMainKLine=function(){var t=new ChartKLine;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="Main-KLine",t.DrawType=this.KLineDrawType,this.ChartPaint[0]=t,this.TitlePaint[0]=new DynamicKLineTitlePainting,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID},this.BindMainData=function(t,e){(window.chartdata[this.Period]&&window.chartdata[this.Period].XPointCount&&(e=window.chartdata[this.Period].XPointCount),this.ChartPaint[0].Data=t,this.ChartPaint[0].Symbol=this.Symbol,this.KLineSize)&&(null==this.KLineSize.DataWidth?e=this.Frame.SubFrame[0].Frame.XPointCount-this.RightSpaceCount:(e=this.Frame.SetDataWidth(this.KLineSize.DataWidth).XPointCount-this.RightSpaceCount,this.KLineSize.DataWidth=null));for(var a in this.Frame.SubFrame){(i=this.Frame.SubFrame[a].Frame).XPointCount=e+this.RightSpaceCount,i.Data=this.ChartPaint[0].Data,i.XSplitOperator.Symbol=this.Symbol,i.XSplitOperator.Period=this.Period}for(var a in this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data,this.OverlayChartPaint){var i;(i=this.OverlayChartPaint[a]).MainData=this.ChartPaint[0].Data}var r=t.Data.length-e;r<0&&(r=0);var n=r-(window.chartdata[this.Period]?window.chartdata[this.Period].DataOffset:r);this.ChartPaint[0].Data.DataOffset=n<0||n>3?window.chartdata[this.Period].DataOffset:r,debug&&console.log("=========BindMainData",this.ChartPaint[0].Data.DataOffset,e),this.ChartPaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.CursorIndex=e,this.CursorIndex+r>=t.Data.length&&(this.CursorIndex=t.Data.length-1-r),this.CursorIndex<0&&(this.CursorIndex=0),this.CustomShow&&(this.SetCustomShow(this.CustomShow,t),this.CustomShow=null)},this.UpdateMainData=function(t,e){var a=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(a=this.Frame.SubFrame[0].Frame.Data):a=this.Frame.Data,a){var i=0;for(var r in e>0&&t.Data.length>e&&(i=t.Data.length-e,JSConsole.Chart.Log(`[KLineChartContainer::UpdateMainData]  [count=${e}->${t.Data.length}], [newDataCount=${i}]`)),this.ChartPaint[0].Data=t,this.ChartPaint[0].Symbol=this.Symbol,this.ChartPaint[0].Data.DataOffset=a.DataOffset+i,this.Frame.SubFrame){(n=this.Frame.SubFrame[r].Frame).Data=this.ChartPaint[0].Data,0==r&&(n.YSplitOperator.Symbol=this.Symbol,n.YSplitOperator.Data=this.ChartPaint[0].Data,n.YSplitOperator.Period=this.Period)}for(var r in this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data,this.OverlayChartPaint){var n;(n=this.OverlayChartPaint[r]).MainData=this.ChartPaint[0].Data}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol}},this.SetCustomShow=function(t,e){if(t&&t.Date&&!(t.Date<19910101)){for(var a=t.Date,i=null,r=0;r<e.Data.length;++r){if(e.Data[r].Date>=a){i=r;break}}if(null!==i){var n=e.Data.length-i;t.PageSize>0&&(n=t.PageSize);var s=n,o=this.GetMaxMinPageSize();for(var r in n>o.Max?s=o.Max:n<o.Min&&(s=o.Min),this.Frame.SubFrame){this.Frame.SubFrame[r].Frame.XPointCount=s}this.ChartPaint[0].Data.DataOffset=i,this.CursorIndex=0}else JSConsole.Chart.Log(`[KLineChartContainer::SetCustomShow] Can\'t find first date=${a}`)}},this.ShowSelectData=function(t){this.HideSelectRect(),this.SelectRectRightMenu&&this.SelectRectRightMenu.Hide(),JSConsole.Chart.Log("[KLineChartContainer::ShowSelectData] selectData",t);var e=t.Start,a=t.End-t.Start+1;for(var i in JSConsole.Chart.Log(`[KLineChartContainer::ShowSelectData] DataOffset=${e}, ShowCount=${a}`),this.Frame.SubFrame){this.Frame.SubFrame[i].Frame.XPointCount=a}this.ChartPaint[0].Data.DataOffset=e,this.CursorIndex=0,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()},this.CreateWindowIndex=function(t){this.WindowIndex[t].Create(this,t)},this.BindIndexData=function(t,e){if(this.WindowIndex[t]){if("function"!=typeof this.WindowIndex[t].RequestData)return"function"==typeof this.WindowIndex[t].ExecuteScript?(debug&&console.log("xxxxxxxxxxxxxxx BindIndexData",this.ChartPaint.length),void this.WindowIndex[t].ExecuteScript(this,t,e)):void this.WindowIndex[t].BindData(this,t,e);this.WindowIndex[t].RequestData(this,t,e)}},this.BindOverlayIndexData=function(t,e,a){if(t.Script){if("function"!=typeof t.Script.RequestData)return"function"==typeof t.Script.ExecuteScript?(debug&&console.log("xxxxxxxxxxxxxxx BindOverlayIndexData",this.ChartPaint.length),void t.Script.ExecuteScript(this,e,a)):void t.Script.BindData(this,e,a);t.Script.RequestData(this,e,a)}},this.BindInstructionIndexData=function(t){debug&&console.log("xxxxxxxxxxxxxxx BindInstructionIndexData",this.ChartPaint.length),this.ColorIndex&&"function"==typeof this.ColorIndex.ExecuteScript&&this.ColorIndex.ExecuteScript(this,0,t),this.TradeIndex&&"function"==typeof this.TradeIndex.ExecuteScript&&this.TradeIndex.ExecuteScript(this,0,t)},this.GetChartPaint=function(t){var e=new Array;for(var a in this.ChartPaint)if(0!=a){var i=this.ChartPaint[a];i.ChartFrame==this.Frame.SubFrame[t].Frame&&e.push(i)}return e},this.AutoUpdateEvent=function(t,e){var a=t?JSCHART_EVENT_ID.RECV_START_AUTOUPDATE:JSCHART_EVENT_ID.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(a)){var i=this,r=this.mapEvent.get(a),n={Stock:{Symbol:this.Symbol,Name:this.Name,Right:this.Right,Period:this.Period},Explain:e};t&&(n.Callback=function(t){ChartData.IsDayPeriod(i.Period,!0)?i.RecvRealtimeData(t):ChartData.IsMinutePeriod(i.Period,!0)?i.RecvMinuteRealtimeData(t):ChartData.IsSecondPeriod(i.Period)&&i.RecvMinuteRealtimeData(t)}),r.Callback(r,n,this)}},this.SendKLineUpdateEvent=function(t){var e=this.GetEventCallback(JSCHART_EVENT_ID.RECV_KLINE_UPDATE_DATA);if(e&&e.Callback){var a={HistoryData:t,Stock:{Symbol:this.Symbol,Name:this.Name}};return e.Callback(e,a,this),!0}return!1},this.SendManualKLineUpdateEvent=function(t){var e=this.GetEventCallback(JSCHART_EVENT_ID.RECV_KLINE_MANUAL_UPDATE_DATA);if(e&&e.Callback){var a={HistoryData:t,Stock:{Symbol:this.Symbol,Name:this.Name}};return e.Callback(e,a,this),!0}return!1},this.RequestHistoryData=function(){this.ReqeustHistoryMinuteData(window.minutedata?suffix({data:minutedata}):null)},this.RecvHistoryData=function(t){var e=KLineChartContainer.JsonDataToHistoryData(t),a=new ChartData;a.Data=e,a.DataType=0,a.Symbol=t.symbol,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvHistoryData");var i,r=new ChartData;if(r.Data=e,r.Right=this.Right,r.Period=this.Period,r.DataType=0,r.Symbol=t.symbol,r.Right>0&&!this.IsApiPeriod){var n=r.GetRightDate(r.Right);r.Data=n}if(ChartData.IsDayPeriod(r.Period,!1)&&!this.IsApiPeriod){var s=r.GetPeriodData(r.Period);r.Data=s}this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(r,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvHistoryData"),this.Frame.SetSizeChage(!0),this.BindInstructionIndexData(r);for(var o=0;o<this.Frame.SubFrame.length;++o)0==o&&(i=this.Frame.SubFrame[o].Frame),this.BindIndexData(o,r);i&&i.YSplitOperator&&(i.YSplitOperator.Symbol=this.Symbol,i.YSplitOperator.Data=this.ChartPaint[0].Data,i.YSplitOperator.Period=this.Period);var h=this.Page.Day;(0==h.Enable||1==h.Enable&&1==h.Finish)&&(this.ReqeustKLineInfoData(),this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),h.Enable&&(h.Index=1),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdatePointByCursorIndex(2),this.Draw();for(o=0;o<this.Frame.SubFrame.length;++o){var l=this.Frame.SubFrame[o];for(var C in l.OverlayIndex){var u=l.OverlayIndex[C];this.BindOverlayIndexData(u,o,r)}}if(this.mapEvent.has(JSCHART_EVENT_ID.RECV_HISTROY_DATA)){var D=this.mapEvent.get(JSCHART_EVENT_ID.RECV_HISTROY_DATA);t={HistoryData:r,Stock:{Symbol:this.Symbol,Name:this.Name}};D.Callback(D,t,this)}},this.RequestHistoryPageData=function(){var t=this;if(this.NetworkFilter){var e=this.SourceData.Data[0],a={Name:"KLineChartContainer::RequestHistoryPageData",Explain:"日K数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:t.Symbol,index:t.Page.Day.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:e.Date,first:{date:e.Date}}},Page:t.Page.Day,Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(e){t.RecvHistoryPageData(e);var a=t.Page.Day;1==a.Enable&&0==a.Finish?t.RequestHistoryPageData():t.AutoUpdate()}),1==a.PreventDefault)return}setTimeout(function(){var e=t.Page.Day;e.Finish=!0;var a={data:[[20150218,12.54,12.5,12.74,11.95,12.27,117632441,1459671045],[20150219,12.27,12.1,12.23,11.9,12.23,95889423,1157078548],[20150220,12.23,12.17,12.17,11.9,12.05,67763439,815652761]],symbol:t.Symbol,name:t.Name};t.RecvHistoryPageData(a),1==e.Enable&&0==e.Finish?t.RequestHistoryPageData():t.AutoUpdate()},500)},this.RecvHistoryPageData=function(t){var e=KLineChartContainer.JsonDataToHistoryData(t),a=this.GetHistoryDataCount();for(var i in e){var r=e[i];this.SourceData.Data.splice(i,0,r)}var n=new ChartData;if(n.Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=this.SourceData.DataType,n.Right>0&&n.Period<=3){var s=n.GetRightDate(n.Right);n.Data=s}if(ChartData.IsDayPeriod(n.Period,!1)||ChartData.IsMinutePeriod(n.Period,!1)){var o=n.GetPeriodData(n.Period);n.Data=o}this.UpdateMainData(n,a),this.BindInstructionIndexData(n);for(i=0;i<this.Frame.SubFrame.length;++i)this.BindIndexData(i,n);var h=this.Page.Day;++h.Index,1==h.Enable&&1==h.Finish&&(this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.ReqeustHistoryMinuteData=function(t){if(void 0===window.ReqeustHistoryMinuteData_obj&&(window.ReqeustHistoryMinuteData_obj=this,debug&&console.log("ReqeustHistoryMinuteData_obj",this)),t){this.ChartSplashPaint.EnableSplash(!0),this.FlowCapitalReady=!1,this.ResetPage(),this.ResetDragDownload(),console.log("------------------------------------KLineChartContainer::ReqeustHistoryMinuteData----------1分钟K线数据"),this.ChartSplashPaint.EnableSplash(!1),this.RecvMinuteHistoryData(t);var e=this.Page.Minute;1==e.Enable&&0==e.Finish?this.ReqeustHistoryMinutePageData():(this.AutoUpdateEvent(!0,"KLineChartContainer::ReqeustHistoryMinuteData"),this.AutoUpdate())}},this.RecvMinuteHistoryData=function(t){if(1!=this.IsOnTouch){var e=KLineChartContainer.JsonDataToMinuteHistoryData(t),a=this.SourceData;this.SourceData||(a=new ChartData),a.Data=e,a.DataType=1,a.Symbol=t.symbol,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvMinuteHistoryData");var i,r=this.ChartPaint[0].Data;if(this.ChartPaint[0].Data||(r=new ChartData),r.Data=e,r.Right=this.Right,r.Period=this.Period,r.DataType=1,r.Symbol=t.symbol,debug&&console.log("bindData period",this.Period,this),ChartData.IsMinutePeriod(r.Period,!1)&&!this.IsApiPeriod){var n=a.GetPeriodData(r.Period);r.Data=n}this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(r,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvMinuteHistoryData"),this.Frame.SetSizeChage(!0),this.BindInstructionIndexData(r);for(var s=0;s<this.Frame.SubFrame.length;++s)0==s&&(i=this.Frame.SubFrame[s].Frame),this.BindIndexData(s,r);for(var s in i&&i.YSplitOperator&&(i.YSplitOperator.Symbol=this.Symbol,i.YSplitOperator.Data=this.ChartPaint[0].Data,i.YSplitOperator.Period=this.Period),this.OverlayChartPaint){(h=this.OverlayChartPaint[s]).Data=null}var o=this.Page.Minute;(0==o.Enable||1==o.Enable&&1==o.Finish)&&(this.RequestFlowCapitalData(),this.RequestOverlayHistoryMinuteData(),this.CreateChartDrawPictureByStorage()),o.Enable&&++o.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw();for(s=0;s<this.Frame.SubFrame.length;++s){var h=this.Frame.SubFrame[s];for(var l in h.OverlayIndex){var C=h.OverlayIndex[l];this.BindOverlayIndexData(C,s,r)}}if(this.mapEvent.has(JSCHART_EVENT_ID.RECV_HISTROY_DATA)){var u=this.mapEvent.get(JSCHART_EVENT_ID.RECV_HISTROY_DATA);t={HistoryData:r,Stock:{Symbol:this.Symbol,Name:this.Name}};u.Callback(u,t,this)}}},this.ReqeustHistoryMinutePageData=function(){var t=this;if(this.NetworkFilter){var e=this.SourceData.Data[0],a={Name:"KLineChartContainer::RecvHistoryMinutePageData",Explain:"1分钟K线数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:t.Symbol,index:t.Page.Minute.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:e.Date,first:{date:e.Date,time:e.Time}}},Page:t.Page.Minute,Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(e){t.RecvHistoryMinutePageData(e);var a=t.Page.Minute;1==a.Enable&&0==a.Finish?t.ReqeustHistoryMinutePageData():t.AutoUpdate()}),1==a.PreventDefault)return}setTimeout(function(){var e=t.Page.Minute;e.Finish=!0;t.RecvHistoryMinutePageData({data:[[20190906,14.58,14.71,14.71,14.71,14.71,1096425,16128411,925],[20190906,14.71,14.73,14.74,14.71,14.71,2154859,31731820,930],[20190906,14.71,14.71,14.71,14.68,14.69,1427516,20989208,931],[20190906,14.69,14.69,14.71,14.68,14.7,1680503,24694143,932],[20190906,14.7,14.69,14.7,14.65,14.65,1315900,19310964,933],[20190906,14.65,14.66,14.69,14.65,14.68,702955,10313842,934],[20190906,14.68,14.7,14.71,14.67,14.67,1735266,25495875,935],[20190906,14.67,14.68,14.7,14.67,14.67,739e3,10845398,936],[20190906,14.67,14.67,14.68,14.67,14.68,389800,5721266,937],[20190906,14.68,14.68,14.7,14.68,14.69,648477,9527859,938],[20190906,14.69,14.7,14.71,14.69,14.7,1128400,16589794,939],[20190906,14.7,14.7,14.71,14.69,14.71,714858,10509708,940],[20190906,14.71,14.71,14.71,14.69,14.69,401500,5900477,941],[20190906,14.69,14.69,14.71,14.69,14.69,1165684,17131034,942],[20190906,14.69,14.69,14.7,14.67,14.67,498516,7321024,943],[20190906,14.67,14.68,14.68,14.67,14.67,350126,5139012,944],[20190906,14.67,14.67,14.69,14.67,14.69,561600,8246789,945]]}),1==e.Enable&&0==e.Finish?t.ReqeustHistoryMinutePageData():t.AutoUpdate()},500)},this.RecvHistoryMinutePageData=function(t){var e=KLineChartContainer.JsonDataToMinuteHistoryData(t),a=this.GetHistoryDataCount();for(var i in e){var r=e[i];this.SourceData.Data.splice(i,0,r)}var n=new ChartData;if(n.Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=this.SourceData.DataType,n.Right>0&&ChartData.IsDayPeriod(n.Period,!1)){var s=n.GetRightDate(n.Right);n.Data=s}if(ChartData.IsDayPeriod(n.Period,!1)||ChartData.IsMinutePeriod(n.Period,!1)){var o=n.GetPeriodData(n.Period);n.Data=o}this.UpdateMainData(n,a),this.BindInstructionIndexData(n);for(i=0;i<this.Frame.SubFrame.length;++i)this.BindIndexData(i,n);var h=this.Page.Minute;(0==h.Enable||1==h.Enable&&1==h.Finish)&&(this.RequestFlowCapitalData(),this.CreateChartDrawPictureByStorage()),h.Enable&&++h.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.RequestRealtimeData=function(){var t=this,e=[t.Symbol];for(var a in this.OverlayChartPaint){var i=this.OverlayChartPaint[a];i.Symbol&&(i.MainData&&i.Status==OVERLAY_STATUS_ID.STATUS_FINISHED_ID&&e.push(i.Symbol))}if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestRealtimeData",Explain:"当天最新日线数据",Request:{Url:t.RealtimeApiUrl,Data:{symbol:e,field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(e){t.RecvRealtimeData(e),t.AutoUpdate()}),1==r.PreventDefault)return}JSNetwork.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"],symbol:e,start:-1},type:"post",dataType:"json",async:!0,success:function(e){t.RecvRealtimeData(e),t.AutoUpdate()}})},this.RecvRealtimeData=function(t){},this.UpdateOverlayRealtimeData=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol&&(a.MainData&&a.Status==OVERLAY_STATUS_ID.STATUS_FINISHED_ID)){var i=KLineChartContainer.JsonDataToRealtimeData(t,a.Symbol);if(i){var r=a.SourceData,n=r.Data[r.Data.length-1];if(n.Date==i.Date)JSConsole.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] update kline by minute data",i),n.Close=i.Close,n.High=i.High,n.Low=i.Low,n.Vol=i.Vol,n.Amount=i.Amount;else{if(!(a.Date<i.Date))continue;JSConsole.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] insert kline by minute data",i);var s=new HistoryData;s.YClose=i.YClose,s.Open=i.Open,s.Close=i.Close,s.High=i.High,s.Low=i.Low,s.Vol=i.Vol,s.Amount=i.Amount,s.Date=i.Date,r.Data.push(s)}var o=new ChartData;if(o.Data=r.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=0,o.Right>0&&MARKET_SUFFIX_NAME.IsSHSZStockA(t.symbol)&&!this.IsApiPeriod){var h=o.GetRightDate(o.Right);o.Data=h}var l=this.SourceData.GetOverlayData(o.Data,this.IsApiPeriod);if(o.Data=l,ChartData.IsDayPeriod(o.Period,!1)&&!this.IsApiPeriod){var C=o.GetPeriodData(o.Period);o.Data=C}a.Data=o}}}},this.RequestMinuteRealtimeData=function(){var t=this,e=[t.Symbol];for(var a in this.OverlayChartPaint){var i=this.OverlayChartPaint[a];i.Symbol&&(i.MainData&&i.Status==OVERLAY_STATUS_ID.STATUS_FINISHED_ID&&e.push(i.Symbol))}if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestMinuteRealtimeData",Explain:"当天1分钟K线数据",Request:{Url:t.RealtimeApiUrl,Data:{symbol:e,field:["name","symbol","price","yclose","minutecount","minute","date","time"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(e){t.RecvMinuteRealtimeData(e),t.AutoUpdate()}),1==r.PreventDefault)return}JSNetwork.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","price","yclose","minutecount","minute","date","time"],symbol:e,start:-1},type:"post",dataType:"json",async:!0,success:function(e){t.RecvMinuteRealtimeData(e),t.AutoUpdate()}})},this.SetSourceDatatLimit=function(t){for(var e in this.SourceDataLimit=new Map,t){var a=t[e];this.SourceDataLimit.set(a.Period,a.MaxCount),JSConsole.Chart.Log(`[KLineChartContainer::SetSourceDatatLimit] Period=${a.Period}, MaxCount=${a.MaxCount}`)}},this.ReduceSourceData=function(){if(this.SourceDataLimit&&this.SourceDataLimit.has(this.Period)){var t=this.SourceDataLimit.get(this.Period),e=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(e=this.Frame.SubFrame[0].Frame.Data):e=this.Frame.Data,e&&!(t<50)){for(var a=e.DataOffset,i=0;this.SourceData.Data.length>t;)this.SourceData.Data.shift(),--a,++i;i>0&&(a<0&&(a=0),e.DataOffset=a,JSConsole.Chart.Log(`[KLineChartContainer::ReduceSourceData] remove data ${i}, dataOffset=${a}`))}}},this.RecvMinuteRealtimeDataV2=function(t){if(1!=this.IsOnTouch){var e=KLineChartContainer.JsonDataToMinuteHistoryData(t);if(e&&!(e.length<=0)){this.IsApiPeriod&&this.ReduceSourceData();var a=this.GetHistoryDataCount();if(this.SourceData&&this.SourceData.MergeMinuteData(e)){JSConsole.Chart.Log(`[KLineChartContainer::RecvMinuteRealtimeDataV2] update kline by 1 minute data [${a}->${this.SourceData.Data.length}]`);var i=new ChartData;if(i.Data=this.SourceData.Data,i.Period=this.Period,i.Right=this.Right,i.DataType=this.SourceData.DataType,i.Symbol=this.Symbol,i.Right>0&&ChartData.IsDayPeriod(i.Period,!0)&&!this.IsApiPeriod){var r=i.GetRightDate(i.Right);i.Data=r}if((ChartData.IsDayPeriod(i.Period,!1)||ChartData.IsMinutePeriod(i.Period,!1))&&!this.IsApiPeriod){var n=i.GetPeriodData(i.Period);i.Data=n}this.UpdateMainData(i,a),this.BindInstructionIndexData(i);for(var s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,i);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(i)}}}},this.RecvMinuteRealtimeData=function(t){if(1!=this.IsOnTouch)if(2!=t.ver){var e=KLineChartContainer.JsonDataToMinuteRealtimeData(t,this.Symbol);if(e){this.IsApiPeriod&&this.ReduceSourceData();var a=this.GetHistoryDataCount(),i=this.SourceData.Data.length;if(this.SourceData.MergeMinuteData(e)){JSConsole.Chart.Log(`[KLineChartContainer::RecvMinuteRealtimeData] update kline by 1 minute data [${i}->${this.SourceData.Data.length}]`);var r=new ChartData;if(r.Data=this.SourceData.Data,r.Period=this.Period,r.Right=this.Right,r.DataType=this.SourceData.DataType,r.Symbol=this.Symbol,r.Right>0&&ChartData.IsDayPeriod(r.Period,!0)&&!this.IsApiPeriod){var n=r.GetRightDate(r.Right);r.Data=n}if((ChartData.IsDayPeriod(r.Period,!1)||ChartData.IsMinutePeriod(r.Period,!1))&&!this.IsApiPeriod){var s=r.GetPeriodData(r.Period);r.Data=s}this.UpdateMainData(r,a),this.UpdateOverlayMinuteRealtimeData(t),this.BindInstructionIndexData(r);for(var o=0;o<this.Frame.SubFrame.length;++o)this.BindIndexData(o,r);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(r)}}}else this.RecvMinuteRealtimeDataV2(t)},this.UpdateOverlayMinuteRealtimeData=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol&&(a.MainData&&a.Status==OVERLAY_STATUS_ID.STATUS_FINISHED_ID)){var i=KLineChartContainer.JsonDataToMinuteRealtimeData(t,a.Symbol);if(i){var r=a.SourceData;if(!r.MergeMinuteData(i))return;var n=new ChartData;n.Data=r.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=0;var s=this.SourceData.GetOverlayMinuteData(n.Data,this.IsApiPeriod);if(n.Data=s,ChartData.IsMinutePeriod(n.Period,!1)&&!this.IsApiPeriod){var o=n.GetPeriodData(n.Period);n.Data=o}a.Data=n}}}},this.GetHistoryDataCount=function(){var t=null;return this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(t=this.Frame.SubFrame[0].Frame.Data):t=this.Frame.Data,t?t.Data.length:-1},this.GetRequestDataCount=function(){var t={MaxRequestDataCount:this.MaxReqeustDataCount,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount};if(!this.SourceData||!this.SourceData.Data||this.SourceData.Data.length<=0)return t;if(ChartData.IsDayPeriod(this.Period,!0))(a=this.SourceData.Data.length)>t.MaxRequestDataCount&&(t.MaxRequestDataCount=a);else if(ChartData.IsMinutePeriod(this.Period,!0)){var e,a=0;for(var i in this.SourceData.Data){var r=this.SourceData.Data[i];r.Date!=e&&++a,e=r.Date}a>t.MaxRequestMinuteDayCount&&(t.MaxRequestMinuteDayCount=a)}return t},this.RequestTickData=function(){var t=this;t.ChartSplashPaint.EnableSplash(!0),t.Draw();var e=g_JSChartResource.CacheDomain+"/cache/dealday/today/"+t.Symbol+".json";if(this.NetworkFilter){var a={Name:"KLineChartContainer::RequestTickData",Explain:"当天分笔数据",Request:{Url:e,Data:{symbol:t.Symbol},Type:"GET"},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickData(e),t.AutoUpdate()}),1==a.PreventDefault)return}JSNetwork.HttpRequest({url:e,data:{symbol:t.Symbol},type:"get",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickData(e),t.AutoUpdate(1)},error:function(e,a){t.ChartSplashPaint.EnableSplash(!1),t.AutoUpdate()}})},this.RecvTickData=function(t){var e=KLineChartContainer.JsonDataToTickData(t),a=new ChartData;a.Data=e,a.DataType=2,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvTickData");var i,r=new ChartData;r.Data=e,r.Right=this.Right,r.Period=this.Period,r.DataType=2,this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(r,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvTickData"),this.BindInstructionIndexData(r);for(var n=0;n<this.Frame.SubFrame.length;++n)0==n&&(i=this.Frame.SubFrame[n].Frame),this.BindIndexData(n,r);if(i&&i.YSplitOperator&&(i.YSplitOperator.Symbol=this.Symbol,i.YSplitOperator.Data=this.ChartPaint[0].Data,i.YSplitOperator.Period=this.Period,i.YSplitOperator.KLineChart=this.ChartPaint[0]),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex(),this.mapEvent.has(JSCHART_EVENT_ID.RECV_HISTROY_DATA)){var s=this.mapEvent.get(JSCHART_EVENT_ID.RECV_HISTROY_DATA);t={HistoryData:r,Stock:{Symbol:this.Symbol,Name:this.Name}};s.Callback(s,t,this)}},this.RequestTickRealtimeData=function(){var t=this,e=0;if(this.SourceData&&this.SourceData.Data&&(e=this.SourceData.Data.length),this.NetworkFilter){var a={Name:"KLineChartContainer::RequestTickRealtimeData",Explain:"当天最新分笔数据",Request:{Url:t.TickApiUrl,Data:{symbol:t.Symbol,start:e,end:e+1e3},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickData(e),t.AutoUpdate()}),1==a.PreventDefault)return}JSNetwork.HttpRequest({url:t.TickApiUrl,data:{symbol:t.Symbol,start:e-10,end:e+1e3},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickRealtimeData(e),t.AutoUpdate()}})},this.RecvTickRealtimeData=function(t){var e=KLineChartContainer.JsonDataToTickData(t);if(e&&!(e.length<=0)){var a=this.SourceData.Data,i=this.SourceData.Data.length,r=0;a.length>0&&(r=a[a.length-1].Time);var n=0;for(var s in e){var o=e[s];o.Time<=r||(a.push(o),++n)}if(!(n<=0)){var h=new ChartData;h.Data=a,h.Right=this.Right,h.Period=this.Period,h.DataType=2,this.Symbol=t.symbol,this.Name=t.name,this.UpdateMainData(h,i),this.BindInstructionIndexData(h);for(s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,h);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()}}},this.ChangePeriod=function(t,e){if(this.SourceData){var a=!1,i=!1,r=null;if(e&&(e.KLine&&(IFrameSplitOperator.IsNumber(e.KLine.DrawType)&&(a=!0),IFrameSplitOperator.IsNumber(e.KLine.Right)&&(r=e.KLine.Right)),1==e.Reload&&(i=!0)),this.Period!=t||0!=i){a&&this.ChangeKLineDrawType(e.KLine.DrawType,!1);var n=!1;if(t>CUSTOM_DAY_PERIOD_START&&t<=CUSTOM_DAY_PERIOD_END)0!=this.SourceData.DataType&&(n=!0);else if(t>CUSTOM_MINUTE_PERIOD_START&&t<=CUSTOM_MINUTE_PERIOD_END||t>CUSTOM_SECOND_PERIOD_START&&t<=CUSTOM_SECOND_PERIOD_END)1!=this.SourceData.DataType&&(n=!0);else switch(t){case 0:case 1:case 2:case 3:case 9:case 21:0!=this.SourceData.DataType&&(n=!0);break;case 4:case 5:case 6:case 7:case 8:case 11:case 12:1!=this.SourceData.DataType&&(n=!0);break;case 10:2!=this.SourceData.DataType&&(n=!0)}this.Period=t,null!=r&&(this.Right=r),this.ReloadChartDrawPicture(),0!=n||this.IsApiPeriod?ChartData.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetOverlaySymbolStatus(),this.RequestHistoryData()):ChartData.IsMinutePeriod(this.Period,!0)||ChartData.IsSecondPeriod(this.Period)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetOverlaySymbolStatus(),this.ReqeustHistoryMinuteData()):ChartData.IsTickPeriod(this.Period)&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.RequestTickData()):this.Update({UpdateCursorIndexType:2})}else a&&this.ChangeKLineDrawType(e.KLine.DrawType)}},this.ChangeRight=function(t){if(MARKET_SUFFIX_NAME.IsSHSZStockA(this.Symbol)&&!ChartData.IsTickPeriod(this.Period)){var e=this.Symbol.toUpperCase();MARKET_SUFFIX_NAME.IsBIT(e)||t<0||t>2||this.Right!=t&&(this.Right=t,this.IsApiPeriod?ChartData.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ResetOverlaySymbolStatus(),this.RequestHistoryData()):(ChartData.IsMinutePeriod(this.Period,!0)||ChartData.IsSecondPeriod(this.Period))&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ResetOverlaySymbolStatus(),this.ReqeustHistoryMinuteData()):this.Update())}},this.SetFirstShowDate=function(t){if(t&&t.Date){JSConsole.Chart.Log("[KLineChartContainer::SetFirstShowDate] obj=",t);var e=null;if(e=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data){var a=null;if(ChartData.IsDayPeriod(this.Period,!0))for(var i=0;i<e.Data.length;++i){if((s=e.Data[i]).Date>=t.Date){a=i;break}}else if(ChartData.IsMinutePeriod(this.Period,!0)){let r=t.Time;if(IFrameSplitOperator.IsPlusNumber(r))for(i=0;i<e.Data.length;++i){if((s=e.Data[i]).Date>t.Date||s.Date==t.Date&&s.Time>=r){a=i;break}}else for(i=0;i<e.Data.length;++i){if((s=e.Data[i]).Date>=t.Date){a=i;break}}}if(null!==a){var r=e.Data.length-a;t.PageSize>0&&(r=t.PageSize);var n=this.GetMaxMinPageSize();for(var i in n.Max<r?r=n.Max:n.Min>r&&(r=n.Min),this.Frame.SubFrame){var s;(s=this.Frame.SubFrame[i].Frame).XPointCount=r}e.DataOffset=a,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,JSConsole.Chart.Log(`[KLineChartContainer::SetFirstShowDate] dataOffset=${e.DataOffset} CursorIndex=${this.CursorIndex} PageSize=${r}`),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdatePointByCursorIndex(2),this.Draw()}else JSConsole.Chart.Log(`[KLineChartContainer::SetFirstShowDate] an\'t find first date=${t.Date} time=${t.Time}`,t)}}},this.DeleteIndexPaint=function(t){let e=new Array;for(var a in this.OldPaint||(this.OldPaint=[]),this.ChartPaint){let n=this.ChartPaint[a];if(0==a||n.ChartFrame!=this.Frame.SubFrame[t].Frame)e.push(n);else{for(var i=!1,r=0;r<this.OldPaint.length;r++)this.OldPaint[r].Name==n.Name&&(i=!0);i||(this.OldPaint.push(n),debug&&console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>OldPaint",this.OldPaint))}}this.Frame.SubFrame[t].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[t].Frame.IsLocked=!1,this.Frame.SubFrame[t].Frame.YSplitScale=null,this.ChartPaint=e;var n=t+1;this.TitlePaint[n].Data=[],this.TitlePaint[n].Title=null},this.ShowKLine=function(t){this.ChartPaint.length<=0||!this.ChartPaint[0]||(this.ChartPaint[0].IsShow=t)},this.SetInstructionData=function(t,e){if(!(this.ChartPaint.length<=0)&&this.ChartPaint[0]){var a=this.TitlePaint[1];2==t?(this.ChartPaint[0].ColorData=e.Data,a&&(a.ColorIndex={Name:e.Name,Param:e.Param})):1==t&&(this.ChartPaint[0].TradeData={Sell:e.Sell,Buy:e.Buy,Name:e.Name,Param:e.Param},a&&(a.TradeIndex={Name:e.Name,Param:e.Param}))}},this.ChangeInstructionIndex=function(t){let e=(new JSIndexScript).Get(t);e&&(1!=e.InstructionType&&2!=e.InstructionType||(e.ID=t,this.ChangeInstructionScriptIndex(e)))},this.ChangeInstructionScriptIndex=function(t){if(1==t.InstructionType)this.TradeIndex=new ScriptIndex(t.Name,t.Script,t.Args,t);else{if(2!=t.InstructionType)return;this.ColorIndex=new ScriptIndex(t.Name,t.Script,t.Args,t)}var e=this.ChartPaint[0].Data;this.BindInstructionIndexData(e),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.CancelInstructionIndex=function(){if(!(this.ChartPaint.length<=0)&&this.ChartPaint[0]){this.ColorIndex=null,this.TradeIndex=null,this.ChartPaint[0].ColorData=null,this.ChartPaint[0].TradeData=null;var t=this.TitlePaint[1];t&&(t.TradeIndex=null,t.ColorIndex=null),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.SetFrameToolbar=function(t,e){if(e&&this.Frame.SubFrame[t]&&this.Frame.SubFrame[t].Frame){var a=this.Frame.SubFrame[t].Frame,i=!1;IFrameSplitOperator.IsBool(e.Modify)&&(a.ModifyIndex=e.Modify,i=!0),IFrameSplitOperator.IsBool(e.Change)&&(a.ChangeIndex=e.Change,i=!0),IFrameSplitOperator.IsBool(e.Close)&&(a.CloseIndex=e.Close,i=!0),IFrameSplitOperator.IsBool(e.Overlay)&&(a.OverlayIndex=e.Overlay,i=!0),i&&(a.SizeChange=!0,a.ToolbarRect=null,a.DrawToolbar())}},this.ChangeScriptIndex=function(t,e,a){this.DeleteIndexPaint(t),this.WindowIndex[t]=new ScriptIndex(e.Name,e.Script,e.Args,e),a&&a.Window&&this.SetFrameToolbar(t,a.Window);var i=this.ChartPaint[0].Data;this.BindIndexData(t,i),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeAPIIndex=function(t,e){this.DeleteIndexPaint(t);var a=e.API;this.WindowIndex[t]=new APIScriptIndex(a.Name,a.Script,a.Args,e),e&&e.Window&&this.SetFrameToolbar(t,e.Window);var i=this.ChartPaint[0].Data;this.BindIndexData(t,i),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeIndex=function(t,e,a){if(a&&a.API)return this.ChangeAPIIndex(t,a);var i=JSIndexMap.Get(e);if(!i){let i=(new JSIndexScript).Get(e);if(!i)return;i.IsMainIndex?t=0:0==t&&(t=1);let r=i;return a&&(a.FloatPrecision>=0&&(r.FloatPrecision=a.FloatPrecision),a.StringFormat>0&&(r.StringFormat=a.StringFormat),a.Args&&(r.Args=a.Args),a.TitleFont&&(r.TitleFont=a.TitleFont),a.IsShortTitle&&(r.IsShortTitle=a.IsShortTitle)),this.ChangeScriptIndex(t,r,a)}i.IsMainIndex?t>0&&(t=0):0==t&&(t=1);var r=new Array;for(var n in this.ChartPaint){var s=this.ChartPaint[n];0!=n&&s.ChartFrame==this.Frame.SubFrame[t].Frame||r.push(s)}this.Frame.SubFrame[t].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[t].Frame.IsLocked=!1,this.Frame.SubFrame[t].Frame.YSplitScale=null,this.ChartPaint=r;var o=t+1;this.TitlePaint[o].Data=[],this.TitlePaint[o].Title=null,this.WindowIndex[t]=i.Create(),this.CreateWindowIndex(t);var h=this.ChartPaint[0].Data;this.BindIndexData(t,h),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangePyScriptIndex=function(t,e){this.DeleteIndexPaint(t),this.WindowIndex[t]=new PyScriptIndex(e.Name,e.Script,e.Args,e);var a=this.ChartPaint[0].Data;this.BindIndexData(t,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.AddOverlayIndex=function(t){var e=this.CreateOverlayWindowsIndex(t);if(e){var a=this.ChartPaint[0].Data;this.BindOverlayIndexData(e,t.WindowIndex,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateOverlayWindowsIndex=function(t){let e=t.IndexName,a=t.WindowIndex;var i=null,r=null,n=null;if(t.API)i=t.API;else if(t.Script)r={Script:t.Script,ID:t.indexName,Name:t.indexName},t.Name&&(r.Name=t.Name);else{if(!(r=(new JSIndexScript).Get(e))&&!(n=JSIndexMap.Get(e)))return console.warn(`[KLineChartContainer::CreateOverlayIndex] can not find index[${e}]`),null}var s=this.Frame.SubFrame[a];s.Interval=this.OverlayIndexFrameWidth;var o=new OverlayIndexItem;t.Identify&&(o.Identify=t.Identify);var h="KLineChartHScreenContainer"===this.ClassName?new OverlayKLineHScreenFrame:new OverlayKLineFrame;if(h.Canvas=this.Canvas,h.MainFrame=s.Frame,h.ChartBorder=s.Frame.ChartBorder,!0===t.ShowRightText?h.IsShow=!0:!1===t.ShowRightText&&(h.IsShow=!1),h.YSplitOperator=new FrameSplitY,h.YSplitOperator.LanguageID=this.LanguageID,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),h.YSplitOperator.Frame=h,h.YSplitOperator.ChartBorder=h.ChartBorder,h.YSplitOperator.SplitCount=s.Frame.YSplitOperator.SplitCount,o.Frame=h,i){var l=new APIScriptIndex(i.Name,i.Script,i.Args,t,!0);l.OverlayIndex={IsOverlay:!0,Identify:o.Identify,WindowIndex:a,Frame:o},o.Script=l}else if(r){let e=r;t.Args&&(e.Args=t.Args),(C=new OverlayScriptIndex(e.Name,e.Script,e.Args,e)).OverlayIndex={IsOverlay:!0,Identify:o.Identify,WindowIndex:a,Frame:o},o.Script=C}else{var C;(C=n.Create()).OverlayIndex={IsOverlay:!0,Identify:o.Identify,WindowIndex:a,Frame:o},C.Create(this,a),o.Script=C}return s.OverlayIndex.push(o),o},this.DeleteOverlayWindowsIndex=function(t){var e=null;for(var a in this.Frame.SubFrame){var i=this.Frame.SubFrame[a];for(var r in i.OverlayIndex){if(i.OverlayIndex[r].Identify===t){i.OverlayIndex.splice(r,1),e=parseInt(a);break}}}if(null!=e){var n=e+1,s=this.TitlePaint[n];s.OverlayIndex.has(t)&&s.OverlayIndex.delete(t),this.Draw()}else console.warn(`[KLineChartContainer::DeleteOverlayWindowsIndex] can\'t find overlay index. [identify=${t}]`)},this.ChangeKLineDrawType=function(t,e){if(this.KLineDrawType!=t){for(var a in this.KLineDrawType=t,this.ChartPaint){var i=this.ChartPaint[a];0==a?i.DrawType=this.KLineDrawType:"ChartVolStick"==i.ClassName&&(i.KLineDrawType=this.KLineDrawType)}for(var a in this.OverlayChartPaint){(i=this.OverlayChartPaint[a]).DrawType=this.KLineDrawType}0!=e&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.ChangeCoordinateType=function(t){if((this.Frame||this.Frame.SubFrame)&&this.Frame.SubFrame.length){if(IFrameSplitOperator.IsNumber(t)){var e=t;if(2==e)this.Frame.SubFrame[0].Frame.CoordinateType=1;else if(1==e)this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=e;else if(0==e)this.Frame.SubFrame[0].Frame.CoordinateType=0,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0;else{if(3!=e)return;this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=2}}else t.Type>=0&&t.Type<=2&&(this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=t.Type),!0===t.IsReverse?this.Frame.SubFrame[0].Frame.CoordinateType=1:0==t.IsReverse&&(this.Frame.SubFrame[0].Frame.CoordinateType=0);this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ChangeIndexWindowCount=function(t,e){if(!(t<=0)&&this.Frame.SubFrame.length!=t){var a=this.Frame.SubFrame.length;if(a>t){for(var i=a-1;i>=t;--i)this.DeleteIndexPaint(i),this.Frame.SubFrame[i].Frame.ClearToolbar();this.Frame.SubFrame.splice(t,a-t),this.WindowIndex.splice(t,a-t);for(i=0;i<this.Frame.SubFrame.length;++i){var r=this.Frame.SubFrame[i].Frame;i==this.Frame.SubFrame.length-1?r.XSplitOperator.ShowText=!0:r.XSplitOperator.ShowText=!1}}else{for(i=a;i<t;++i){var n=this.CreateSubFrameItem(i);this.Frame.SubFrame[i]=n;var s=new DynamicChartTitlePainting;s.Frame=this.Frame.SubFrame[i].Frame,s.Canvas=this.Canvas,s.LanguageID=this.LanguageID,this.TitlePaint[i+1]=s}var o=[{Index:"RSI"},{Index:"MACD"},{Index:"VOL"},{Index:"UOS"},{Index:"CHO"},{Index:"BRAR"}];e&&e.Windows.length>0&&(o=e.Windows);let u=new JSIndexScript;for(i=a;i<t;++i){var h=(r=o[i%o.length]).Index;let t=u.Get(h);var l=t.Args;r.Args&&(l=r.Args);let e={Name:t.Name,Script:t.Script,Args:l,ID:r.Index,KLineType:t.KLineType,YSpecificMaxMin:t.YSpecificMaxMin,YSplitScale:t.YSplitScale,FloatPrecision:t.FloatPrecision,Condition:t.Condition,OutName:t.OutName};this.WindowIndex[i]=new ScriptIndex(e.Name,e.Script,e.Args,e),null!=r.Modify&&(this.Frame.SubFrame[i].Frame.ModifyIndex=r.Modify),null!=r.Change&&(this.Frame.SubFrame[i].Frame.ChangeIndex=r.Change),null!=r.Close&&(this.Frame.SubFrame[i].Frame.CloseIndex=r.Close),null!=r.Overlay&&(chart.Frame.SubFrame[i].Frame.OverlayIndex=r.Overlay),1==r.IsDrawTitleBG&&(this.Frame.SubFrame[i].Frame.IsDrawTitleBG=r.IsDrawTitleBG),IFrameSplitOperator.IsNumber(r.TitleHeight)?this.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight=r.TitleHeight:r.TitleHeight=this.Frame.SubFrame[i].Frame.ChartBorder.TitleHeight,0==r.IsShowTitleArraw&&(this.Frame.SubFrame[i].Frame.IsShowTitleArraw=!1),0==r.IsShowIndexName&&(this.Frame.SubFrame[i].Frame.IsShowIndexName=!1),r.IndexParamSpace>=0&&(this.Frame.SubFrame[i].Frame.IndexParamSpace=r.IndexParamSpace),0==r.IsShowXLine&&(this.Frame.SubFrame[i].Frame.IsShowXLine=!1),0==r.IsShowYLine&&(this.Frame.SubFrame[i].Frame.IsShowYLine=!1);var C=this.ChartPaint[0].Data;this.BindIndexData(i,C)}for(i=0;i<this.Frame.SubFrame.length;++i){r=this.Frame.SubFrame[i].Frame;i==this.Frame.SubFrame.length-1?r.XSplitOperator.ShowText=!0:r.XSplitOperator.ShowText=!1}this.UpdataDataoffset()}this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}},this.ChangeIndexTemplate=function(t){if(t.Windows){var e=t.Windows.length;if(!(e<=0)){var a=this.Frame.SubFrame.length,i=null,r=null;t.KLine&&(IFrameSplitOperator.IsNumber(t.KLine.Period)&&t.KLine.Period!=this.Period&&(i=t.KLine.Period),IFrameSplitOperator.IsNumber(t.KLine.Right)&&t.KLine.Right!=this.Right&&(r=t.KLine.Right));for(var n=null!=i||null!=r,s=0;s<a;++s){this.DeleteIndexPaint(s);var o=this.Frame.SubFrame[s];o.YSpecificMaxMin=null,o.IsLocked=!1,o.YSplitScale=null}if(a>e){for(s=a-1;s>=e;--s)this.Frame.SubFrame[s].Frame.ClearToolbar();this.Frame.SubFrame.splice(e,a-e),this.WindowIndex.splice(e,a-e)}else for(s=a;s<e;++s){var h=this.CreateSubFrameItem(s);this.Frame.SubFrame[s]=h;var l=new DynamicChartTitlePainting;l.Frame=this.Frame.SubFrame[s].Frame,l.Canvas=this.Canvas,l.LanguageID=this.LanguageID,this.TitlePaint[s+1]=l}var C=new JSIndexScript,u=this.ChartPaint[0].Data;for(s=0;s<e;++s){var D=s,d=t.Windows[s],c=null;t.Frame&&t.Frame.length>s&&(c=t.Frame[s]);var m=D+1;if(this.TitlePaint[m].Data=[],this.TitlePaint[m].Title=null,d.Script)this.WindowIndex[s]=new ScriptIndex(d.Name,d.Script,d.Args,d),n||this.BindIndexData(D,u);else{var f=d.Index,v=JSIndexMap.Get(f);if(v)this.WindowIndex[s]=v.Create(),this.CreateWindowIndex(D),n||this.BindIndexData(D,u);else{var S=C.Get(f);if(S){var T=S.Args;t.Windows[s].Args&&(T=t.Windows[s].Args);let e={Name:S.Name,Script:S.Script,Args:T,ID:f,KLineType:S.KLineType,YSpecificMaxMin:S.YSpecificMaxMin,YSplitScale:S.YSplitScale,FloatPrecision:S.FloatPrecision,Condition:S.Condition,OutName:S.OutName};this.WindowIndex[s]=new ScriptIndex(e.Name,e.Script,e.Args,e),n||this.BindIndexData(D,u)}}}null!=d.Modify&&(this.Frame.SubFrame[s].Frame.ModifyIndex=d.Modify),null!=d.Change&&(this.Frame.SubFrame[s].Frame.ChangeIndex=d.Change),null!=d.Close&&(this.Frame.SubFrame[s].Frame.CloseIndex=d.Close),null!=d.Overlay&&(chart.Frame.SubFrame[s].Frame.OverlayIndex=d.Overlay),1==d.IsDrawTitleBG&&(this.Frame.SubFrame[s].Frame.IsDrawTitleBG=d.IsDrawTitleBG),IFrameSplitOperator.IsNumber(d.TitleHeight)?this.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight=d.TitleHeight:d.TitleHeight=this.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight,0==d.IsShowTitleArraw&&(this.Frame.SubFrame[s].Frame.IsShowTitleArraw=!1),0==d.IsShowIndexName&&(this.Frame.SubFrame[s].Frame.IsShowIndexName=!1),d.IndexParamSpace>=0&&(this.Frame.SubFrame[s].Frame.IndexParamSpace=d.IndexParamSpace),c&&(c.SplitCount&&(this.Frame.SubFrame[s].Frame.YSplitOperator.SplitCount=c.SplitCount),!1!==c.IsShowXLine&&!0!==c.IsShowXLine||(this.Frame.SubFrame[s].Frame.IsShowXLine=c.IsShowXLine),!1!==c.IsShowYLine&&!0!==c.IsShowYLine||(this.Frame.SubFrame[s].Frame.IsShowYLine=c.IsShowYLine),!1!==c.IsShowLeftText&&!0!==c.IsShowLeftText||(this.Frame.SubFrame[s].Frame.IsShowYText[0]=c.IsShowLeftText,this.Frame.SubFrame[s].Frame.YSplitOperator.IsShowLeftText=c.IsShowLeftText),!1!==c.IsShowRightText&&!0!==c.IsShowRightText||(this.Frame.SubFrame[s].Frame.IsShowYText[1]=c.IsShowRightText,this.Frame.SubFrame[s].Frame.YSplitOperator.IsShowRightText=c.IsShowRightText))}for(s=0;s<this.Frame.SubFrame.length;++s){d=this.Frame.SubFrame[s].Frame;s==this.Frame.SubFrame.length-1?d.XSplitOperator.ShowText=!0:d.XSplitOperator.ShowText=!1}n?(this.Frame.SetSizeChage(!0),null!=i?this.ChangePeriod(i,t):null!=r&&this.ChangeRight(r)):(this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw())}}},this.RemoveIndexWindow=function(t){if(JSConsole.Chart.Log("[KLineChartContainer::RemoveIndexWindow] remove id",t),0!=t&&this.Frame.SubFrame&&!(t>=this.Frame.SubFrame.length)){var e=this.Frame.SubFrame[t].Frame;this.DeleteIndexPaint(t),this.Frame.SubFrame[t].Frame.ClearToolbar(),this.Frame.SubFrame.splice(t,1),this.WindowIndex.splice(t,1),this.TitlePaint.splice(t+1,1);for(var a=0;a<this.Frame.SubFrame.length;++a){var i=this.Frame.SubFrame[a].Frame;a==this.Frame.SubFrame.length-1?i.XSplitOperator.ShowText=!0:i.XSplitOperator.ShowText=!1,i.Identify=a}if(this.ChartDrawPicture.length>0){var r=[];for(var a in this.ChartDrawPicture){(i=this.ChartDrawPicture[a]).Frame!=e&&r.push(i)}this.ChartDrawPicture=r}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.GetIndexInfo=function(){var t=[];for(var e in this.WindowIndex){var a=this.WindowIndex[e],i={Name:a.Name};a.ID&&(i.ID=a.ID),t.push(i)}return t},this.CreateExtendChart=function(t,e){var a;switch(t){case"筹码分布":return(a=new StockChip).Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.Left=this.Frame.ChartBorder.Right,a.SetOption(e),this.ExtendChartPaint.push(a),this.Frame.ChartBorder.Right+=a.Width,a;case"画图工具":return(a=new DrawToolsButton).Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.Left=this.Frame.ChartBorder.Right,a.SetOption(e),this.ExtendChartPaint.push(a),this.Frame.ChartBorder.Right+=a.Width,a;case"KLineTooltip":return(a=e.Create&&"function"==typeof e.Create?e.Create():new KLineTooltipPaint).Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,e.LanguageID=this.LanguageID,a.SetOption(e),this.ExtendChartPaint.push(a),a;case"深度图":return(a=new DepthMapPaint).Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(e),this.ExtendChartPaint.push(a),a;case"背景图":return(a=new BackgroundPaint).Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(e),this.ExtendChartPaint.push(a),a;default:return null}},this.OnTouchFinished=function(){if(this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID){if(1==this.TouchStatus.CorssCursorShow&&this.TouchDrawCount>0)return;return this.TouchStatus.CorssCursorShow=!1,void this.DrawDynamicInfo()}if(!0!==this.CorssCursorTouchEnd)for(var t in this.ExtendChartPaint){"KLineTooltipPaint"===this.ExtendChartPaint[t].ClassName&&this.DrawDynamicInfo()}else this.TouchDrawCount>0&&this.DrawDynamicInfo()},this.GetExtendChartByClassName=function(t){for(var e in this.ExtendChartPaint){var a=this.ExtendChartPaint[e];if(a.ClassName==t)return{Index:e,Chart:a}}return null},this.DeleteExtendChart=function(t){t.Index>=this.ExtendChartPaint.length||this.ExtendChartPaint[t.Index]==t.Chart&&("function"==typeof t.Chart.Clear&&t.Chart.Clear(),this.ExtendChartPaint.splice(t.Index,1))},this.LockIndex=function(t){if(t&&t.IndexName)for(var e in this.WindowIndex){let a=this.WindowIndex[e];if(a||conintue,a.Name==t.IndexName){a.SetLock(t),this.Update();break}}},this.TryClickLock=function(t,e){for(var a in this.Frame.SubFrame){var i=this.Frame.SubFrame[a];if(i.Frame.IsLocked&&i.Frame.LockPaint){var r=new TooltipData;if(i.Frame.LockPaint.GetTooltipData(t,e,r))return r.HQChart=this,r.Data.Callback&&r.Data.Callback(r),!0}}return!1},this.TryClickIndexTitle=function(t,e){for(var a in this.TitlePaint){var i=this.TitlePaint[a];if(i.IsClickTitle&&i.IsClickTitle(t,e)){var r={Point:{X:t,Y:e},Title:i.Title,FrameID:i.Frame.Identify};JSConsole.Chart.Log("[KLineChartContainer::TryClickIndexTitle] click title ",r);var n=this.GetEventCallback(JSCHART_EVENT_ID.ON_CLICK_INDEXTITLE);return n&&n.Callback&&n.Callback(n,r,this),!0}}return!1},this.SetSizeChage=function(t){for(var e in this.Frame.SetSizeChage(t),this.ExtendChartPaint){this.ExtendChartPaint[e].SizeChange=t}},this.Update=function(t){if(this.SourceData){if(this.BeforeBindMainData&&this.BeforeBindMainData("Update"),(n=new ChartData).Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=this.SourceData.DataType,n.Symbol=this.Symbol,n.Right>0&&ChartData.IsDayPeriod(n.Period,!0)){var e=n.GetRightDate(n.Right);n.Data=e}if(ChartData.IsDayPeriod(n.Period,!1)||ChartData.IsMinutePeriod(n.Period,!1)){var a=n.GetPeriodData(n.Period);n.Data=a}this.BindMainData(n,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("Update");for(var i=0;i<this.Frame.SubFrame.length;++i)this.BindIndexData(i,n);for(var i in this.OverlayChartPaint){if((s=this.OverlayChartPaint[i]).SourceData)if(ChartData.IsMinutePeriod(this.Period,!0)){(n=new ChartData).Data=s.SourceData.Data,n.Period=this.Period,n.Right=this.Right;var r=this.SourceData.GetOverlayMinuteData(n.Data,this.IsApiPeriod);if(n.Data=r,ChartData.IsMinutePeriod(n.Period,!1)&&!this.IsApiPeriod){a=n.GetPeriodData(n.Period);n.Data=a}s.Data=n}else{var n;if((n=new ChartData).Data=s.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.Right>0&&MARKET_SUFFIX_NAME.IsSHSZStockA(s.Symbol)){e=n.GetRightDate(n.Right);n.Data=e}r=this.SourceData.GetOverlayData(n.Data,this.IsApiPeriod);if(n.Data=r,ChartData.IsDayPeriod(n.Period,!1)&&!this.IsApiPeriod){a=n.GetPeriodData(n.Period);n.Data=a}s.Data=n}}this.ReqeustKLineInfoData(),this.CreateChartDrawPictureByStorage(),this.UpdataDataoffset(),t&&t.UpdateCursorIndexType>0?this.UpdatePointByCursorIndex(t.UpdateCursorIndexType):this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw();for(i=0;i<this.Frame.SubFrame.length;++i){var s=this.Frame.SubFrame[i];for(var o in s.OverlayIndex){var h=s.OverlayIndex[o];this.BindOverlayIndexData(h,i,n)}}}},this.ChangeSymbol=function(t){if(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeSymbol"),this.Symbol=t,t){if(MARKET_SUFFIX_NAME.IsSHSZIndex(t)&&(this.Right=0),this.Frame&&this.Frame.SubFrame)for(var e=0;e<this.Frame.SubFrame.length;++e)this.DeleteIndexPaint(e);this.ReloadChartDrawPicture(),ChartData.IsDayPeriod(this.Period,!0)?this.RequestHistoryData():ChartData.IsMinutePeriod(this.Period,!0)||ChartData.IsSecondPeriod(this.Period)?this.ReqeustHistoryMinuteData():ChartData.IsTickPeriod(this.Period)&&this.RequestTickData()}else this.DrawEmpty()},this.ReqeustKLineInfoData=function(){this.ChartPaint.length>0&&(this.ChartPaint[0].InfoData=new Map);for(var t in this.ChartInfo)this.ChartInfo[t].RequestData(this)},this.SetKLineInfo=function(t,e){for(var a in this.ChartInfo=[],t){var i=JSKLineInfoMap.Get(t[a]);if(i){var r=i.Create();r.MaxReqeustDataCount=this.MaxReqeustDataCount,this.ChartInfo.push(r)}}1==e&&this.ReqeustKLineInfoData()},this.AddKLineInfo=function(t,e){var a=JSKLineInfoMap.GetClassInfo(t);if(a){for(var i in this.ChartInfo){if((r=this.ChartInfo[i]).ClassName==a.ClassName)return}var r,n=JSKLineInfoMap.Get(t);if(n)(r=n.Create()).MaxReqeustDataCount=this.MaxReqeustDataCount,this.ChartInfo.push(r),1==e&&r.RequestData(this)}else console.warn("[KLineChartContainer::AddKLineInfo] can\'t find infoname=",t)},this.DeleteKLineInfo=function(t){var e=JSKLineInfoMap.GetClassInfo(t);if(e)for(var a in this.ChartInfo){if(this.ChartInfo[a].ClassName==e.ClassName){this.ChartInfo.splice(a,1),this.UpdataChartInfo(),this.Draw();break}}else console.warn("[KLineChartContainer::DeleteKLineInfo] can\'t find infoname=",t)},this.ClearKLineInfo=function(){!this.ChartInfo||this.ChartInfo.length<=0||(this.ChartInfo=[],this.ChartPaint[0].InfoData=null,this.Draw())},this.OverlaySymbol=function(t,e){for(var a in this.OverlayChartPaint){if(this.OverlayChartPaint[a].Symbol===t)return console.warn(`[KLineChartContainer::OverlaySymbol] overlay symbol=${t} exist.`),!1}var i=new ChartOverlayKLine;return i.Canvas=this.Canvas,i.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,i.ChartFrame=this.Frame.SubFrame[0].Frame,i.Name="Overlay-KLine",i.DrawType=this.KLineDrawType,i.Symbol=t,e&&e.Color?i.Color=e.Color:i.Color=g_JSChartResource.OverlaySymbol.Color[g_JSChartResource.OverlaySymbol.Random%g_JSChartResource.OverlaySymbol.Color.length],i.SetOption(e),++g_JSChartResource.OverlaySymbol.Random,this.ChartPaint[0]&&this.ChartPaint[0].Data&&this.SourceData&&(i.MainData=this.ChartPaint[0].Data),this.OverlayChartPaint.push(i),ChartData.IsDayPeriod(this.Period,!0)?this.RequestOverlayHistoryData():ChartData.IsMinutePeriod(this.Period,!0)&&this.RequestOverlayHistoryMinuteData(),!0},this.RequestOverlayHistoryData=function(){if(this.OverlayChartPaint.length&&this.SourceData&&this.SourceData.Data){var t=this,e=this.GetRequestDataCount(),a=this.SourceData.Data[0].Date;for(var i in this.OverlayChartPaint){let n=this.OverlayChartPaint[i];if(!n.MainData)continue;if(n.Status!=OVERLAY_STATUS_ID.STATUS_NONE_ID)continue;let s=n.Symbol;if(s){if(n.Status=OVERLAY_STATUS_ID.STATUS_REQUESTDATA_ID,this.NetworkFilter){var r={Name:"KLineChartContainer::RequestOverlayHistoryData",Explain:"叠加股票日K线数据",Request:{Url:t.KLineApiUrl,Data:{symbol:s,count:e.MaxRequestDataCount,first:{date:a},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(e){n.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOverlayHistoryData(e,n)}),1==r.PreventDefault)return}JSNetwork.HttpRequest({url:this.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high"],symbol:s,start:-1,count:e.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(e){n.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOverlayHistoryData(e,n)}})}}}},this.RecvOverlayHistoryData=function(t,e){if(!e.IsDelete){var a=KLineChartContainer.JsonDataToHistoryData(t),i=new ChartData;i.Data=a,i.DataType=0;var r=new ChartData;if(r.Data=a,r.Period=this.Period,r.Right=this.Right,r.DataType=0,r.Right>0&&MARKET_SUFFIX_NAME.IsSHSZStockA(t.symbol)){var n=r.GetRightDate(r.Right);r.Data=n}var s=this.SourceData.GetOverlayData(r.Data,this.IsApiPeriod);if(r.Data=s,ChartData.IsDayPeriod(r.Period,!1)&&!this.IsApiPeriod){var o=r.GetPeriodData(r.Period);r.Data=o}e.Data=r,e.SourceData=i,e.Title=t.name,e.Symbol=t.symbol,e.Status=OVERLAY_STATUS_ID.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.RequestOverlayHistoryMinuteData=function(){if(this.OverlayChartPaint.length&&this.SourceData&&this.SourceData.Data){var t=this,e=this.GetRequestDataCount(),a=this.SourceData.Data[0].Date,i=this.SourceData.Data[0].Time;for(var r in this.OverlayChartPaint){let s=this.OverlayChartPaint[r];if(!s.MainData)continue;if(s.Status!=OVERLAY_STATUS_ID.STATUS_NONE_ID)continue;let o=s.Symbol;if(o){if(s.Status=OVERLAY_STATUS_ID.STATUS_REQUESTDATA_ID,this.NetworkFilter){var n={Name:"KLineChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票分钟K线数据",Request:{Url:t.MinuteKLineApiUrl,Data:{symbol:o,count:e.MaxRequestMinuteDayCount,first:{date:a,time:i},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,function(e){s.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOveralyHistoryMinuteData(e,s)}),1==n.PreventDefault)return}JSNetwork.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","vol","amount"],symbol:o,start:-1,count:e.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(e){s.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOveralyHistoryMinuteData(e,s)}})}}}},this.RecvOveralyHistoryMinuteData=function(t,e){var a=KLineChartContainer.JsonDataToMinuteHistoryData(t);if(a){var i=new ChartData;i.Data=a,i.DataType=1;var r=new ChartData;r.Data=a,r.Period=this.Period,r.Right=this.Right,r.DataType=1;var n=this.SourceData.GetOverlayMinuteData(r.Data,this.IsApiPeriod);if(r.Data=n,ChartData.IsMinutePeriod(r.Period,!1)&&!this.IsApiPeriod){var s=r.GetPeriodData(r.Period);r.Data=s}e.Data=r,e.SourceData=i,e.Title=t.name,e.Symbol=t.symbol,e.Status=OVERLAY_STATUS_ID.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ResetOverlaySymbolStatus=function(){for(var t in this.OverlayChartPaint){this.OverlayChartPaint[t].Status=OVERLAY_STATUS_ID.STATUS_NONE_ID}},this.ClearOverlaySymbol=function(){for(var t in this.OverlayChartPaint){this.OverlayChartPaint[t].IsDelete=!0}this.OverlayChartPaint=[],this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0,this.UpdateFrameMaxMin(),this.Draw()},this.DeleteOverlaySymbol=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol===t)return a.IsDelete=!0,this.OverlayChartPaint.splice(e,1),this.OverlayChartPaint.length<=0&&(this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn(`[KLineChartContainer::DeleteOverlaySymbol] overlay symbol=${t} not exist.`),!1},this.RequestFlowCapitalData=function(){},this.RecvFlowCapitalData=function(t){if(!t.stock||1!=t.stock.length)return;let e=t.stock[0];var a=new Array;for(var i in e.stockday){var r=e.stockday[i];let t=new SingleData;t.Date=r.date;var n=r.capital;n&&(n.a>0&&(t.Value=n.a,a.push(t)))}if(this.IsApiPeriod){var s=this.ChartPaint[0].Data,o=null;if(ChartData.IsMinutePeriod(this.Period,!0)?o=s.GetMinuteFittingFinanceData(a):ChartData.IsDayPeriod(this.Period,!0)&&(o=s.GetFittingFinanceData(a)),o&&s.Data&&o.length==s.Data.length)for(var i in s.Data){r=s.Data[i];o[i]&&IFrameSplitOperator.IsNumber(o[i].Value)&&(r.FlowCapital=o[i].Value)}}else if(ChartData.IsMinutePeriod(this.Period,!0)){o=this.SourceData.GetMinuteFittingFinanceData(a);for(var i in this.SourceData.Data){r=this.SourceData.Data[i];o[i]&&IFrameSplitOperator.IsNumber(o[i].Value)&&(r.FlowCapital=o[i].Value)}var h=this.ChartPaint[0].Data;if((C=new ChartData).Data=this.SourceData.Data,ChartData.IsMinutePeriod(h.Period,!1)){var l=C.GetPeriodData(h.Period);C.Data=l}h.Data=C.Data}else{o=this.SourceData.GetFittingFinanceData(a);for(var i in this.SourceData.Data){r=this.SourceData.Data[i];o[i]&&IFrameSplitOperator.IsNumber(o[i].Value)&&(r.FlowCapital=o[i].Value)}var C;h=this.ChartPaint[0].Data;if((C=new ChartData).Data=this.SourceData.Data,h.Right>0){var u=C.GetRightDate(h.Right);C.Data=u}if(ChartData.IsDayPeriod(h.Period,!1)){l=C.GetPeriodData(h.Period);C.Data=l}h.Data=C.Data}this.FlowCapitalReady=!0;var D=!1;for(var i in this.ExtendChartPaint){if("StockChip"==(r=this.ExtendChartPaint[i]).ClassName){D=!0;break}}D&&this.Draw()},this.CreateChartDrawPicture=function(t,e,a){var i=null,r=IChartDrawPicture.GetDrawPictureByName(t);if(r&&"ChartDrawPictureText"==(i=r.Create()).ClassName&&(i.HQChart=this),!i&&IChartDrawPicture.MapIonFont.has(t)){var n=IChartDrawPicture.MapIonFont.get(t);(i=new ChartDrawPictureIconFont).FontOption.Family=n.Family,i.Text=n.Text,n.Color&&(i.LineColor=n.Color)}if(!i)return!1;i.Canvas=this.Canvas,i.Status=0,i.Symbol=this.Symbol,i.Period=this.Period,i.Option=this.ChartDrawOption,a&&(i.FinishedCallback=a),e&&i.SetOption(e);var s=this;return i.Update=function(){s.DrawDynamicInfo()},this.CurrentChartDrawPicture=i,!0},this.MoveChartDrawPicture=function(t,e,a){var i=this.CurrentChartDrawPicture;if(!i)return!1;var r=GetDevicePixelRatio();a&&(r=1);var n=t*r,s=e*r;return i.Move(n,s),!0},this.UpdateChartDrawXValue=function(){for(var t in this.ChartDrawPicture){this.ChartDrawPicture[t].UpdateXValue()}},this.OnRightMenu=function(t,e,a){var i=GetDevicePixelRatio();if(this.RightMenu){var r=this.Frame.PtInFrame(t*i,e*i);a.data={Chart:this,FrameID:r},this.RightMenu.DoModal(a)}var n=this.GetEventCallback(JSCHART_EVENT_ID.ON_CONTEXT_MENU);if(n){var s={X:t,Y:e,Event:a,FrameID:r=this.Frame.PtInFrame(t*i,e*i)};n.Callback(n,s,this)}},this.ReloadChartDrawPicture=function(){this.ChartDrawPicture=[],this.ChartDrawStorageCache,this.ChartDrawStorage&&(this.ChartDrawStorageCache=this.ChartDrawStorage.GetDrawData({Symbol:this.Symbol,Period:this.Period}))},this.CreateChartDrawPictureByStorage=function(){if(this.ChartDrawStorageCache&&!(this.ChartDrawStorageCache.length<=0)){for(var t in this.ChartDrawStorageCache){var e=this.ChartDrawStorageCache[t];if(!(e.FrameID<0||!this.Frame.SubFrame||this.Frame.SubFrame.length<e.FrameID)){var a=IChartDrawPicture.CreateChartDrawPicture(e);a&&(a.Canvas=this.Canvas,a.Status=10,a.Frame=this.Frame.SubFrame[e.FrameID].Frame,a.UpdateXValue(),a.ValueToPoint(),"ChartDrawPictureText"===a.ClassName&&(a.IsInitialized=!0),this.ChartDrawPicture.push(a))}}this.ChartDrawStorageCache=null}},this.RequestKLineMatch=function(t,e){var a=this,i=e.Scope,r=e.WaitDialog;JSConsole.Chart.Log("[KLineChartContainer::RequestKLineMatch",t,i);for(var n=new Array,s=new Array,o=t.Start;o<t.End&&o<t.Data.Data.length;++o){var h=t.Data.Data[o];n.push(h.Date),s.push(h.Close)}var l={Stock:t.Stock,Index:{Start:t.Start,End:t.End},Date:{Start:n[0],End:n[n.length-1]},Minsimilar:i.Minsimilar,Plate:i.Plate,DayRegion:300};$.ajax({url:this.KLineMatchUrl,data:{userid:"guest",plate:i.Plate,period:this.Period,right:this.Right,dayregion:l.DayRegion,minsimilar:i.Minsimilar,sampledate:n,samplevalue:s},type:"post",dataType:"json",async:!0,success:function(t){r&&r.Close(),a.RecvKLineMatchData(t,l)},error:function(t,e,a){console.warn("[KLineChartContainer::RequestKLineMatch] failed",t,e,a),r&&r.Close()}})},this.RecvKLineMatchData=function(t,e){JSConsole.Chart.Log("[KLineChartContainer::RecvKLineMatchData] recv",t,e);var a=[];for(var i in t.match){if((o=t.match[i]).symbol!=e.Stock.Symbol)for(var r in o.data){var n=o.data[r],s={Symbol:o.symbol,Name:o.name,Similar:n.similar,Start:n.start,End:n.end};a.push(s)}}if(a.sort(function(t,e){return e.Similar-t.Similar}),JSConsole.Chart.Log("[KLineChartContainer::RecvKLineMatchData] filterData",a),this.mapEvent.has(JSCHART_EVENT_ID.RECV_KLINE_MATCH)){var o;t={Sample:e,Match:a,Source:t};(o=this.mapEvent.get(JSCHART_EVENT_ID.RECV_KLINE_MATCH)).Callback(o,t,this)}else{var h={data:{Chart:this,MatchData:a,Sample:e,Source:t}};new KLineMatchDialog(this.Frame.ChartBorder.UIElement.parentNode).DoModal(h)}},this.UpdataChartInfo=function(){var t=null;if(0==this.Period)for(var e in t=new Map,this.ChartInfo){var a=this.ChartInfo[e].Data;for(var i in a){var r=a[i];t.has(r.Date.toString())?t.get(r.Date.toString()).Data.push(r):t.set(r.Date.toString(),{Data:new Array(r)})}}else if(ChartData.IsDayPeriod(this.Period,!1)){t=new Map;var n=this.ChartPaint[0].Data;if(n&&n.Data&&n.Data.length>0){var s=n.Data[0],o=[];for(var e in this.ChartInfo){var h=this.ChartInfo[e];for(var i in h.Data){(r=h.Data[i]).Date>=s.Date&&o.push(r)}}o.sort(function(t,e){return t.Date-e.Date});for(e=0;e<n.Data.length;){var l=n.Data[e];if(o.length<=0)break;h=o[0];l.Date<h.Date?++e:(t.has(l.Date.toString())?t.get(l.Date.toString()).Data.push(h):t.set(l.Date.toString(),{Data:new Array(h)}),o.shift())}}}this.ChartPaint[0].InfoData=t},this.UpdateWindowIndex=function(t){var e=new ChartData;if(e.Data=this.SourceData.Data,e.Period=this.Period,e.Right=this.Right,this.IsApiPeriod);else{if(e.Right>0){var a=e.GetRightDate(e.Right);e.Data=a}if(ChartData.IsDayPeriod(e.Period,!1)||ChartData.IsMinutePeriod(e.Period,!1)){var i=e.GetPeriodData(e.Period);e.Data=i}}if("function"==typeof this.WindowIndex[t].ExecuteScript){debug&&console.log("xxxxxxxxxxxxxxx UpdateWindowIndex",this.ChartPaint.length);var r=this.ChartPaint[0].Data;this.WindowIndex[t].ExecuteScript(this,t,r)}else this.WindowIndex[t].BindData(this,t,e);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeWindowIndexParam=function(t){this.WindowIndex[t].Index[0].Param+=1,this.WindowIndex[t].Index[1].Param+=1,this.UpdateWindowIndex(t)},this.OnDoubleClick=function(t,e,a){var i=null;if(this.mapEvent.has(JSCHART_EVENT_ID.DBCLICK_KLINE)&&(i=this.mapEvent.get(JSCHART_EVENT_ID.DBCLICK_KLINE)),this.MinuteDialog||i){var r=new TooltipData;for(var n in this.ChartPaint){if(this.ChartPaint[n].GetTooltipData(t,e,r))break}if(r.Data){if(i){var s={Tooltip:r,Stock:{Symbol:this.Symbol,Name:this.Name}};i.Callback(i,s,this)}this.MinuteDialog&&(a.data={Chart:this,Tooltip:r},this.MinuteDialog.DoModal(a))}}},this.CancelAutoUpdate=function(){"number"==typeof this.AutoUpdateTimer&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(t){if(this.CancelAutoUpdate(),this.IsAutoUpdate&&this.Symbol){var e=this,a=MARKET_SUFFIX_NAME.GetMarketStatus(this.Symbol);if(0!=a&&3!=a){var i=this.AutoUpdateFrequency;1==a?this.AutoUpdateTimer=setTimeout(function(){e.AutoUpdate()},i):2==a&&(this.AutoUpdateTimer=setTimeout(function(){ChartData.IsDayPeriod(e.Period,!0)?e.RequestRealtimeData():ChartData.IsMinutePeriod(e.Period,!0)||ChartData.IsSecondPeriod(e.Period)?e.RequestMinuteRealtimeData():ChartData.IsTickPeriod(e.Period)&&e.RequestTickRealtimeData()},i))}}},this.GetMaxMinPageSize=function(){let t={},e=this.Frame.ChartBorder.GetWidth(),a=ZOOM_SEED[ZOOM_SEED.length-1][0]+ZOOM_SEED[ZOOM_SEED.length-1][1];return t.Max=parseInt(e/a)-2,a=ZOOM_SEED[0][0]+ZOOM_SEED[0][1],t.Min=parseInt(e/a)-2,JSConsole.Chart.Log(`[KLineChartContainer::GetMaxMinPageSize] Max=${t.Max} Min=${t.Min}`),t},this.GetChartStatus=function(){var t=this.Frame.SubFrame[0].Frame;if(!t)return null;var e=t.Data;if(!e)return null;var a={KLine:{},Zoom:{}};return a.KLine.Count=e.Data.length,a.KLine.Offset=e.DataOffset,a.KLine.PageSize=t.XPointCount,a.Zoom.Index=t.ZoomIndex,a.Zoom.Max=ZOOM_SEED.length,a},this.DragDownloadData=function(){var t=null;if(!(t=this.Frame.Data?this.Frame.SubFrame[0].Frame.Data:this.Frame.Data))return!1;if(!(t.DataOffset>0))if(ChartData.IsMinutePeriod(this.Period,!0)){if(JSConsole.Chart.Log(`[KLineChartContainer.DragDownloadData] Minute:[Enable=${this.DragDownload.Minute.Enable}, IsEnd=${this.DragDownload.Minute.IsEnd}, Status=${this.DragDownload.Minute.Status}]`),!this.DragDownload.Minute.Enable)return;if(this.DragDownload.Minute.IsEnd)return;if(0!=this.DragDownload.Minute.Status)return;this.RequestDragMinuteData()}else if(ChartData.IsDayPeriod(this.Period,!0)){if(JSConsole.Chart.Log(`[KLineChartContainer.DragDownloadData] Day:[Enable=${this.DragDownload.Minute.Enable}, IsEnd=${this.DragDownload.Minute.IsEnd}, Status=${this.DragDownload.Minute.Status}]`),!this.DragDownload.Day.Enable)return;if(this.DragDownload.Day.IsEnd)return;if(0!=this.DragDownload.Day.Status)return;this.RequestDragDayData()}},this.RequestDragMinuteData=function(){var t=this;this.AutoUpdateEvent(!1,"KLineChartContainer::RequestDragMinuteData"),this.CancelAutoUpdate();var e=this.DragDownload.Minute;e.Status=1;var a=this.SourceData.Data[0],i={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,enddate:a.Date,endtime:a.Time,count:t.MaxRequestMinuteDayCount,first:{date:a.Date,time:a.Time}};if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestDragMinuteData",Explain:"拖拽1分钟K线数据下载",Request:{Url:this.DragMinuteKLineApiUrl,Type:"POST",Data:i},DragDownload:e,Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(a){t.RecvDragMinuteData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragMinuteData"),t.AutoUpdate()}),1==r.PreventDefault)return}JSNetwork.HttpRequest({url:this.DragMinuteKLineApiUrl,data:i,type:"post",dataType:"json",async:!0,success:function(a){t.RecvDragMinuteData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragMinuteData"),t.AutoUpdate()}})},this.RecvDragMinuteData=function(t){var e=KLineChartContainer.JsonDataToMinuteHistoryData(t);if(!e||e.length<=0)this.DragDownload.Minute.IsEnd=!0;else{for(var a=this.GetHistoryDataCount(),i=this.SourceData.Data[0],r=null,n=e.length-1;n>=0;--n){var s=e[n];if(i.Date>s.Date||i.Date==s.Date&&i.Time>s.Time){r=n;break}if(i.Date==s.Date&&i.Time==s.Time){i.YClose=s.YClose,r=n-1;break}}if(!(null==r&&r<0)){for(n=0;n<e.length&&n<=r;++n){s=e[n];this.SourceData.Data.splice(n,0,s)}var o=new ChartData;if(o.Data=this.SourceData.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=this.SourceData.DataType,o.Symbol=this.Symbol,!this.IsApiPeriod&&(ChartData.IsDayPeriod(o.Period,!1)||ChartData.IsMinutePeriod(o.Period,!1))){var h=o.GetPeriodData(o.Period);o.Data=h}this.UpdateMainData(o,a),this.BindInstructionIndexData(o);for(n=0;n<this.Frame.SubFrame.length;++n)this.BindIndexData(n,o);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw()}}},this.RequestDragDayData=function(){var t=this;this.AutoUpdateEvent(!1,"KLineChartContainer::RequestDragDayData"),this.CancelAutoUpdate();var e=this.DragDownload.Day;e.Status=1;var a=this.SourceData.Data[0],i={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,enddate:a.Date,count:t.MaxReqeustDataCount,first:{date:a.Date}};if(this.NetworkFilter){var r={Name:"KLineChartContainer::RequestDragDayData",Explain:"拖拽日K数据下载",Request:{Url:this.DragKLineApiUrl,Type:"POST",Data:i},DragDownload:e,Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(a){t.RecvDragDayData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragDayData"),t.AutoUpdate()}),1==r.PreventDefault)return}JSNetwork.HttpRequest({url:this.DragKLineApiUrl,data:i,type:"post",dataType:"json",async:!0,success:function(a){t.RecvDragDayData(a),e.Status=0,t.AutoUpdateEvent(!0,"KLineChartContainer::RequestDragDayData"),t.AutoUpdate()}})},this.RecvDragDayData=function(t){var e=KLineChartContainer.JsonDataToHistoryData(t);if(!e||e.length<=0)this.DragDownload.Day.IsEnd=!0;else{for(var a=this.GetHistoryDataCount(),i=this.SourceData.Data[0],r=null,n=e.length-1;n>=0;--n){var s=e[n];if(i.Date>s.Date){r=n;break}if(i.Date==s.Date){i.YClose=s.YClose,r=n-1;break}}if(!(null==r&&r<0)){for(n=0;n<e.length&&n<=r;++n){s=e[n];this.SourceData.Data.splice(n,0,s)}var o=new ChartData;if(o.Data=this.SourceData.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=this.SourceData.DataType,o.Symbol=this.Symbol,!this.IsApiPeriod&&(ChartData.IsDayPeriod(o.Period,!1)||ChartData.IsMinutePeriod(o.Period,!1))){var h=o.GetPeriodData(o.Period);o.Data=h}this.UpdateMainData(o,a),this.BindInstructionIndexData(o);for(n=0;n<this.Frame.SubFrame.length;++n)this.BindIndexData(n,o);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw()}}},this.SetCustomVerical=function(t,e){if(this.Frame&&!(t>=this.Frame.SubFrame.length)){var a=this.Frame.SubFrame[t];a.Frame&&(a.Frame.CustomVerticalInfo=e)}},this.OnSize=function(){if(this.Frame&&this.Frame.OnSize){var t=this.Frame.OnSize();this.Frame.SetSizeChage(!0),t.Changed&&(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin()),this.Draw()}}}function MinuteChartContainer(t){this.newMethod=JSChartContainer,this.newMethod(t),delete this.newMethod,this.ClassName="MinuteChartContainer",this.WindowIndex=new Array,this.Symbol,this.Name,this.SourceData,this.IsAutoUpdate=!0,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.TradeDate=0,this.DayCount=1,this.DayData,this.LimitPrice,this.IsShowBeforeData=!1,this.BeforeData=null,this.IsBeforeData=!1,this.IsShowLead=!0,this.ChartDrawStorage=new ChartDrawStorage,this.ChartDrawStorageCache=null,this.MinuteApiUrl=g_JSChartResource.Domain+"/API/Stock",this.HistoryMinuteApiUrl=g_JSChartResource.Domain+"/API/StockMinuteData",this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.OnTouchStart=function(t){this.IsTouchMove=!1,this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer();var e=this.IsSingleTouch(t);if((0==this.EnableScrollUpDown||!e||this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow)&&t.cancelable&&t.preventDefault(),this.IsPhoneDragging(t)){if(this.TryClickLock||this.TryClickIndexTitle){var a=this.GetToucheData(t,this.IsForceLandscape),i=(o=this.PointAbsoluteToRelative(a[0].clientX,a[0].clientY,!0)).X,r=o.Y;if(this.TryClickLock&&this.TryClickLock(i,r))return;if(this.TryClickIndexTitle&&this.TryClickIndexTitle(i,r))return}var n=!0;this.ChartDrawOption.IsLockScreen?n=!1:this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&(n=!1):this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID?n=!1:e||(n=!1);var s={Click:{},LastMove:{}};a=this.GetToucheData(t,this.IsForceLandscape);s.Click.X=a[0].clientX,s.Click.Y=a[0].clientY,s.LastMove.X=a[0].clientX,s.LastMove.Y=a[0].clientY,this.MouseDrag=s,this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null;if(this.CurrentChartDrawPicture)return 2==this.CurrentChartDrawPicture.Status?this.SetChartDrawPictureThirdPoint(s.Click.X,s.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(s.Click.X,s.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),void(t.cancelable&&t.preventDefault());var o,h={X:(o=this.PointAbsoluteToRelative(a[0].clientX,a[0].clientY,!0)).X,Y:o.Y};GetDevicePixelRatio();if(this.GetChartDrawPictureByPoint(h)){h.ChartDrawPicture.Status=20,h.ChartDrawPicture.ValueToPoint(),h.ChartDrawPicture.MovePointIndex=h.PointIndex,h.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=h.ChartDrawPicture,this.SelectChartDrawPicture=h.ChartDrawPicture;let e=this.GetEventCallback(JSCHART_EVENT_ID.ON_CLICK_DRAWPICTURE);if(e&&e.Callback){let t={DrawPicture:h.ChartDrawPicture};e.Callback(e,t,this)}return void(t.cancelable&&t.preventDefault())}if(n){var l=this;this.DragTimer=setTimeout(function(){if(s.Click.X==s.LastMove.X&&s.Click.Y==s.LastMove.Y){l.MouseDrag;l.MouseDrag=null,l.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&(l.TouchStatus.CorssCursorShow=!0),l.MoveCorssCursor(s.Click,t)}},l.PressTime)}this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID||(this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(s.Click,t)):this.IsClickShowCorssCursor&&this.MoveCorssCursor(s.Click,t))}else if(this.IsPhonePinching(t)){var C={Start:{},Last:{}};a=this.GetToucheData(t,this.IsForceLandscape);C.Start={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},C.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},this.PhonePinch=C,this.SelectChartDrawPicture=null}},this.OnTouchMove=function(e){this.IsTouchMove=!0;var a=this.GetToucheData(e,this.IsForceLandscape);if(this.IsPhoneDragging(e)){var i=this.MouseDrag;if(null==i)this.IsForceLandscape&&(y=t.getBoundingClientRect().width-a[0].clientY),this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:a[0].clientX,Y:a[0].clientY},e);else{var r=this.GetMoveAngle(i.LastMove,{X:a[0].clientX,Y:a[0].clientY}),n=Math.abs(i.LastMove.X-a[0].clientX),s=Math.abs(i.LastMove.Y-a[0].clientY);n=parseInt(n);var o=this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow;if(this.CurrentChartDrawPicture){var h=this.CurrentChartDrawPicture;if(1==h.Status||2==h.Status){if(n<5&&s<5)return;this.SetChartDrawPictureSecondPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo()}else if(3==h.Status)this.SetChartDrawPictureThirdPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo();else if(20==h.Status){if(n<5&&s<5)return;this.MoveChartDrawPicture(a[0].clientX-i.LastMove.X,a[0].clientY-i.LastMove.Y,!0)&&this.DrawDynamicInfo()}i.LastMove.X=a[0].clientX,i.LastMove.Y=a[0].clientY}else if(o){this.MouseDrag;this.MouseDrag=null,this.MoveCorssCursor(i.Click,e)}else if(1==this.DragMode||0==o){if((s>0&&n<=3||r<=this.TouchMoveMinAngle)&&1==this.EnableScrollUpDown)return void this.StopDragTimer();if(n<5||r<=this.TouchMoveMinAngle)return void this.PreventTouchEvent(e);var l=!0;i.LastMove.X<a[0].clientX&&(l=!1),this.DataMove(n,l)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):this.DragDownloadData&&this.DragDownloadData(),i.LastMove.X=a[0].clientX,i.LastMove.Y=a[0].clientY}}}else if(this.IsPhonePinching(e)){if(this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID)return;this.PreventTouchEvent(e);var C=this.PhonePinch;if(!C)return;var u=Math.abs(a[0].pageY-a[1].pageY)-Math.abs(C.Last.Y-C.Last.Y2),D=Math.abs(a[0].pageX-a[1].pageX)-Math.abs(C.Last.X-C.Last.X2),d=this.ZoomStepPixel;if(Math.abs(u)<d&&Math.abs(D)<d)return;var c=u;if(Math.abs(u)<d&&(c=D),c>0){if((m={}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(m))return;this.CursorIndex=m.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}else{var m;if((m={}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(m))return;this.CursorIndex=m.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}C.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY}}this.PreventTouchEvent(e)},this.OnTouchEnd=function(t){JSConsole.Chart.Log("[KLineChartContainer:OnTouchEnd]",t);var e=!0;if(this.CurrentChartDrawPicture){var a=this.CurrentChartDrawPicture;2==a.Status||1==a.Status||3==a.Status?(a.PointStatus=a.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():e=!1):20==a.Status&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}this.IsOnTouch=!1,!0===e&&(this.CurrentChartDrawPicture=null),this.StopDragTimer(),this.OnTouchFinished(),this.TouchDrawCount=0},this.OnKeyDown=function(t){switch(t.keyCode?t.keyCode:t.which){case 37:if(this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex<=.99999){if(!this.DataMoveLeft())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo();break;case 39:var e=0;if(e=this.Frame.XPointCount?this.Frame.XPointCount:this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex+1>=e){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else{var a=null;if(!(a=this.Frame.Data?this.Frame.Data:this.Frame.SubFrame[0].Frame.Data))break;if(this.CursorIndex+a.DataOffset+1>=a.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo()}break;default:return}t.preventDefault?t.preventDefault():t.returnValue=!1},this.OnRightMenu=function(t,e,a){if(this.RightMenu){var i=this.Frame.PtInFrame(t,e);a.data={Chart:this,FrameID:i},this.RightMenu.DoModal(a)}var r=this.GetEventCallback(JSCHART_EVENT_ID.ON_CONTEXT_MENU);if(r){var n={X:t,Y:e,Event:a,FrameID:i=this.Frame.PtInFrame(t,e)};r.Callback(r,n,this)}},this.OnWheel=function(t){JSConsole.Chart.Log("[MinuteChartContainer::OnWheel]",t)},this.UpdatePointByCursorIndex=function(){this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);var t=this.CursorIndex;t=parseInt(t.toFixed(0));var e=this.Frame.SourceData;if(!(e.DataOffset+t>=e.Data.length)){var a=e.Data[e.DataOffset+t],i=null;i=a.Before?a.Before.Close:a.Close,this.LastPoint.Y=this.Frame.GetYFromData(i)}},this.Create=function(t,e){for(var a in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new ChartCorssCursor,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=new HQMinuteTimeStringFormat,this.ChartCorssCursor.StringFormatY=new HQPriceStringFormat,this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartSplashPaint=new ChartSplashPaint,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new HQTradeFrame,this.Frame.ChartBorder=new ChartBorder,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var i=new DynamicChartTitlePainting;i.Frame=this.Frame.SubFrame[a].Frame,i.Canvas=this.Canvas,i.LanguageID=this.LanguageID,this.TitlePaint.push(i)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame;var r=!0,n=!0;e&&(!1===e.KeyDown&&(r=!1,JSConsole.Chart.Log("[MinuteChartContainer::Create] not register keydown event.")),!1===e.Wheel&&(n=!1,JSConsole.Chart.Log("[MinuteChartContainer::Create] not register wheel event."))),r&&this.UIElement.addEventListener("keydown",t=>{this.OnKeyDown(t)},!0),n&&this.UIElement.addEventListener("wheel",t=>{this.OnWheel(t)},!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new ChartBorder;a.UIElement=this.UIElement;var i=new MinuteFrame;i.Canvas=this.Canvas,i.ChartBorder=a,i.Identify=e,e<2&&(i.ChartBorder.TitleHeight=0),i.XPointCount=243,e>=2&&(this.ModifyIndexDialog&&(i.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(i.ChangeIndexEvent=this.ChangeIndexDialog.DoModal));var r=[9,8,7,6,5,4,3,2,1];for(var n in i.HorizontalMax=r[0],i.HorizontalMin=r[r.length-1],0==e?(i.YSplitOperator=new FrameSplitMinutePriceY,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price")):(i.YSplitOperator=new FrameSplitY,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double")),i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new FrameSplitMinuteX,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,e!=t-1&&(i.XSplitOperator.ShowText=!1),i.XSplitOperator.Operator(),r)i.HorizontalInfo[n]=new CoordinateInfo,i.HorizontalInfo[n].Value=r[n],0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=r[n].toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new SubFrameItem;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}},this.CreateSubFrameItem=function(t){var e=new ChartBorder;e.UIElement=this.UIElement;var a=new MinuteFrame;a.Canvas=this.Canvas,a.ChartBorder=e,a.Identify=t,a.XPointCount=243,t>=2&&(this.ModifyIndexDialog&&(a.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(a.ChangeIndexEvent=this.ChangeIndexDialog.DoModal));var i=[9,8,7,6,5,4,3,2,1];a.HorizontalMax=i[0],a.HorizontalMin=i[i.length-1],a.YSplitOperator=new FrameSplitY,a.YSplitOperator.LanguageID=this.LanguageID,a.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),a.YSplitOperator.Frame=a,a.YSplitOperator.ChartBorder=e,a.XSplitOperator=new FrameSplitMinuteX,a.XSplitOperator.Frame=a,a.XSplitOperator.ChartBorder=e,a.XSplitOperator.ShowText=!1;var r=this.Frame.SubFrame[0].Frame.XPointCount;for(var n in a.XPointCount=r,a.Data=this.ChartPaint[0].Data,i)a.HorizontalInfo[n]=new CoordinateInfo,a.HorizontalInfo[n].Value=i[n],a.HorizontalInfo[n].Message[1]=i[n].toString(),a.HorizontalInfo[n].Font="14px 微软雅黑";var s=new SubFrameItem;return s.Frame=a,s.Height=10,s},this.UpdateXShowText=function(){for(var t=!0,e=this.Frame.SubFrame.length-1;e>=0;--e){var a=this.Frame.SubFrame[e].Frame,i=this.Frame.SubFrame[e];t?(a.XSplitOperator.ShowText=!0,i.Height>0&&(t=!1)):a.XSplitOperator.ShowText=!1}},this.DeleteIndexPaint=function(t){let e=new Array;for(var a in this.ChartPaint){let i=this.ChartPaint[a];0!=a&&i.ChartFrame==this.Frame.SubFrame[t].Frame||e.push(i)}this.Frame.SubFrame[t].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[t].Frame.IsLocked=!1,this.ChartPaint=e;var i=t+1;this.TitlePaint[i].Data=[],this.TitlePaint[i].Title=null},this.CreateStockInfo=function(){this.ExtendChartPaint[0]=new StockInfoExtendChartPaint,this.ExtendChartPaint[0].Canvas=this.Canvas,this.ExtendChartPaint[0].ChartBorder=this.Frame.ChartBorder,this.ExtendChartPaint[0].ChartFrame=this.Frame,this.Frame.ChartBorder.Right=300},this.CreateMainKLine=function(){var t=new ChartMinutePriceLine;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="Minute-Line",t.Color=g_JSChartResource.Minute.PriceColor,t.AreaColor=g_JSChartResource.Minute.AreaPriceColor,t.HQChart=this,this.ChartPaint[0]=t;var e=new ChartMinutePriceLine;e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.Name="Minute-Average-Line",e.Color=g_JSChartResource.Minute.AvPriceColor,e.IsDrawArea=!1,this.ChartPaint[1]=e;var a=new ChartMinuteVolumBar;a.Color=g_JSChartResource.Minute.VolBarColor,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.SubFrame[1].Frame.ChartBorder,a.ChartFrame=this.Frame.SubFrame[1].Frame,a.Name="Minute-Vol-Bar",this.ChartPaint[2]=a,this.TitlePaint[0]=new DynamicMinuteTitlePainting,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID},this.ChangeScriptIndex=function(t,e,a){this.DeleteIndexPaint(t),this.WindowIndex[t]=new ScriptIndex(e.Name,e.Script,e.Args,e);var i=this.SourceData;this.BindIndexData(t,i),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeIndex=function(t,e,a){if(this.Frame.SubFrame.length<3)return;let i=(new JSIndexScript).Get(e);if(!i)return;t<2&&(t=2),t>=this.Frame.SubFrame.length&&(t=2);let r={Name:i.Name,Script:i.Script,Args:i.Args,ID:e,KLineType:i.KLineType,YSpecificMaxMin:i.YSpecificMaxMin,YSplitScale:i.YSplitScale,FloatPrecision:i.FloatPrecision,Condition:i.Condition,StringFormat:i.StringFormat,OutName:i.OutName};return a&&(a.FloatPrecision>=0&&(r.FloatPrecision=a.FloatPrecision),a.StringFormat>0&&(r.StringFormat=a.StringFormat),a.Args&&(r.Args=a.Args)),this.ChangeScriptIndex(t,r,a)},this.ChangeIndexWindowCount=function(t){if(!(t<2)&&this.Frame.SubFrame.length!=t){var e=this.Frame.SubFrame.length;if(e>t){for(var a=e-1;a>=t;--a){this.DeleteIndexPaint(a),(o=this.Frame.SubFrame[a].Frame).ClearToolbar&&o.ClearToolbar()}this.Frame.SubFrame.splice(t,e-t),this.WindowIndex.splice(t,e-t)}else{for(a=e;a<t;++a){var i=this.CreateSubFrameItem(a);this.Frame.SubFrame[a]=i;var r=new DynamicChartTitlePainting;r.Frame=this.Frame.SubFrame[a].Frame,r.Canvas=this.Canvas,r.LanguageID=this.LanguageID,this.TitlePaint[a+1]=r}const h=["RSI","MACD","DMA","DMI","KDJ","WR"];let l=new JSIndexScript;for(a=e;a<t;++a){var n=h[a%h.length];let t=l.Get(n);this.WindowIndex[a]=new ScriptIndex(t.Name,t.Script,t.Args,t);var s=this.SourceData;this.BindIndexData(a,s)}for(a=0;a<this.Frame.SubFrame.length;++a){var o=this.Frame.SubFrame[a].Frame;a==this.Frame.SubFrame.length-1?o.XSplitOperator.ShowText=!0:o.XSplitOperator.ShowText=!1}this.UpdataDataoffset()}this.UpdateXShowText(),this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}},this.RemoveIndexWindow=function(t){if(JSConsole.Chart.Log("[MinuteChartContainer::RemoveIndexWindow] remove id",t),!(t<2)&&this.Frame.SubFrame&&!(t>=this.Frame.SubFrame.length)){this.Frame.SubFrame[t].Frame;this.DeleteIndexPaint(t),this.Frame.SubFrame[t].Frame.ClearToolbar(),this.Frame.SubFrame.splice(t,1),this.WindowIndex.splice(t,1),this.TitlePaint.splice(t+1,1);for(var e=0;e<this.Frame.SubFrame.length;++e){var a=this.Frame.SubFrame[e].Frame;e==this.Frame.SubFrame.length-1?a.XSplitOperator.ShowText=!0:a.XSplitOperator.ShowText=!1,a.Identify=e}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.ChangeSymbol=function(t){this.CancelAutoUpdate(),this.Symbol=t,this.ResetOverlaySymbolStatus(),this.ReloadChartDrawPicture(),t?(this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.RequestData()):this.DrawEmpty()},this.ChangeDayCount=function(t){t<0||t>10||(this.DayCount=t,this.DayCount>1?this.ChartDrawPicture=[]:this.ReloadChartDrawPicture(),this.ResetOverlaySymbolStatus(),this.RequestData())},this.OverlaySymbol=function(t,e){for(var a in this.OverlayChartPaint){if(this.OverlayChartPaint[a].Symbol==t)return console.warn(`[MinuteChartContainer::OverlaySymbol] overlay symbol=${t} exist.`),!1}var i=new ChartOverlayMinutePriceLine;return i.Canvas=this.Canvas,i.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,i.ChartFrame=this.Frame.SubFrame[0].Frame,i.Name="Overlay-Minute",i.Symbol=t,e&&e.Color?i.Color=e.Color:i.Color=g_JSChartResource.OverlaySymbol.Color[g_JSChartResource.OverlaySymbol.Random%g_JSChartResource.OverlaySymbol.Color.length],++g_JSChartResource.OverlaySymbol.Random,this.ChartPaint[0].YClose>0&&this.ChartPaint[0].Data&&(i.MainData=this.ChartPaint[0].Data,i.MainYClose=this.ChartPaint[0].YClose),this.OverlayChartPaint.push(i),this.DayCount<=1?this.RequestOverlayMinuteData():this.RequestOverlayHistoryMinuteData(),!0},this.ResetOverlaySymbolStatus=function(){for(var t in this.OverlayChartPaint){this.OverlayChartPaint[t].Status=OVERLAY_STATUS_ID.STATUS_NONE_ID}},this.DeleteOverlaySymbol=function(t){for(var e in this.OverlayChartPaint){var a=this.OverlayChartPaint[e];if(a.Symbol===t)return a.IsDelete=!0,this.OverlayChartPaint.splice(e,1),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn(`[MinuteChartContainer::DeleteOverlaySymbol] overlay symbol=${t} not exist.`),!1},this.ClearOverlaySymbol=function(){for(var t in this.OverlayChartPaint){this.OverlayChartPaint[t].IsDelete=!0}this.OverlayChartPaint=[],this.Frame.SubFrame[0].Frame.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.UpdateFrameMaxMin(),this.Draw()},this.ShowBeforeData=function(t){this.IsShowBeforeData!=t&&(this.IsShowBeforeData=t,this.RequestData())},this.RequestData=function(){this.DayCount<=1?this.RequestMinuteData():this.RequestHistoryMinuteData()},this.ChangeDrawType=function(t){if(!(this.ChartPaint.length<=0)){if(0==t)this.ChartPaint[0].IsDrawArea=!0;else{if(1!=t)return;this.ChartPaint[0].IsDrawArea=!1}this.Draw()}},this.RequestHistoryMinuteData=function(){var t=this;if(this.IsBeforeData=!1,this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.NetworkFilter){var e={Name:"MinuteChartContainer::RequestHistoryMinuteData",Explain:"多日分时数据",Request:{Url:t.HistoryMinuteApiUrl,Data:{daycount:t.DayCount,symbol:t.Symbol},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteData(e)}),1==e.PreventDefault)return}JSNetwork.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:t.Symbol,daycount:t.DayCount},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteData(e)}})},this.RecvHistoryMinuteData=function(t){this.DayData=MinuteChartContainer.JsonDataToMinuteDataArray(t),this.Symbol=t.symbol,this.Name=t.name,this.CaclutateLimitPrice(this.DayData[0].YClose,t.data[0].limitprice),this.UpdateHistoryMinuteUI(),this.RecvMinuteDataEvent(),this.RequestOverlayHistoryMinuteData(),this.AutoUpdate()},this.UpdateHistoryMinuteUI=function(){var t=this.HistoryMinuteDataToArray(this.DayData),e=new ChartData;e.Data=t,this.SourceData=e,this.TradeDate=this.DayData[0].Date,this.BindMainData(e,this.DayData[0].YClose);var a=this.Symbol.toUpperCase();if(MARKET_SUFFIX_NAME.IsForeignExchange(a)&&(this.ChartPaint[1].Data=null),this.Frame.SubFrame.length>2){var i=new ChartData;i.Data=t;for(var r=2;r<this.Frame.SubFrame.length;++r)this.BindIndexData(r,i)}for(var r in this.Frame.SubFrame){var n=this.Frame.SubFrame[r];for(var s in n.Frame.XSplitOperator.Symbol=this.Symbol,n.Frame.XSplitOperator.DayCount=this.DayData.length,n.Frame.XSplitOperator.DayData=this.DayData,n.Frame.XSplitOperator.Operator(),n.Frame.XSplitOperator.IsBeforeData=this.IsBeforeData,n.Frame.YSplitOperator.Symbol=this.Symbol,n.Frame.IsBeforeData=this.IsBeforeData,n.OverlayIndex){var o=n.OverlayIndex[s];o.Frame.XPointCount=n.Frame.XPointCount,o.Frame.MinuteCount=n.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.IsBeforeData=this.IsBeforeData,this.TitlePaint[0].IsShowDate=!0,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.HistoryMinuteDataToArray=function(t){for(var e=[],a=t.length-1;a>=0;--a){var i=t[a];for(var r in i.Data)e.push(i.Data[r])}return e},this.UpdateLatestMinuteData=function(t,e){for(var a in this.DayData){var i=this.DayData[a];if(i.Date===e){i.Data=t;break}}},this.RequestMinuteData=function(t){if(void 0===window.RequestMinuteData_obj&&(window.RequestMinuteData_obj=this,debug&&console.log("RequestMinuteData_obj",this)),t){var e=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","minute","minutecount"],a=this.Symbol.toUpperCase();MARKET_SUFFIX_NAME.IsFutures(a)&&(e.push("clearing"),e.push("yclearing")),this.IsBeforeData=!1,this.IsShowBeforeData&&1===this.DayCount&&MARKET_SUFFIX_NAME.IsSHSZStockA(this.Symbol)&&(this.IsBeforeData=!0,e.push("before")),console.log("------------------------------------MinuteChartContainer::RequestMinuteData----------分时数据"),this.ChartSplashPaint.EnableSplash(!1),this.RecvMinuteData(t)}},this.RecvMinuteDataEvent=function(){if(this.mapEvent.has(JSCHART_EVENT_ID.RECV_MINUTE_DATA)){var t=this.mapEvent.get(JSCHART_EVENT_ID.RECV_MINUTE_DATA),e={MinuteData:this.SourceData,Stock:{Symbol:this.Symbol,Name:this.Name}};t.Callback(t,e,this)}},this.RecvMinuteData=function(t){if(1!=this.IsOnTouch){if(this.IsBeforeData)var e=MinuteChartContainer.JsonDataToMinuteData2(t);else e=MinuteChartContainer.JsonDataToMinuteData(t);if(this.DayCount>1)return this.UpdateLatestMinuteData(e,t.stock[0].date),this.UpdateHistoryMinuteUI(),this.RecvMinuteDataEvent(),this.RequestOverlayMinuteData(),void this.AutoUpdate();var a=this.SourceData;this.SourceData||(a=new ChartData),a.Data=e,this.TradeDate=t.stock[0].date,this.SourceData=a,this.Symbol=t.stock[0].symbol,this.Name=t.stock[0].name;var i=t.stock[0].yclose,r=this.Symbol.toUpperCase(),n=MARKET_SUFFIX_NAME.IsFutures(r);t.stock[0].yclearing>0&&n&&(i=t.stock[0].yclearing),this.CaclutateLimitPrice(i,t.stock[0].limitprice);var s=null;if(t.stock[0].high>0&&t.stock[0].low>0&&(s={High:t.stock[0].high,Low:t.stock[0].low}),this.BindMainData(a,i,s),this.Frame.SubFrame.length>2){var o=new ChartData;o.Data=e;for(var h=2;h<this.Frame.SubFrame.length;++h)this.BindIndexData(h,o)}for(var h in this.Frame.SubFrame){var l=this.Frame.SubFrame[h];for(var C in l.Frame.XSplitOperator.Symbol=this.Symbol,l.Frame.XSplitOperator.DayCount=1,l.Frame.XSplitOperator.Operator(),l.Frame.XSplitOperator.IsBeforeData=this.IsBeforeData,l.Frame.YSplitOperator.Symbol=this.Symbol,l.Frame.IsBeforeData=this.IsBeforeData,l.OverlayIndex){var u=l.OverlayIndex[C];u.Frame.XPointCount=l.Frame.XPointCount,u.Frame.MinuteCount=l.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.IsBeforeData=this.IsBeforeData,MARKET_SUFFIX_NAME.IsSHSZ(r)&&(this.TitlePaint[0].IsShowDate=!1),1==t.stock[0].IsHistoryMinute&&(this.TitlePaint[0].IsShowDate=!0);var D=this.GetChartMinuteInfo();D&&(D.SourceData=this.SourceData),this.RecvMinuteDataEvent(),this.RequestMinuteInfoData(),this.RequestOverlayMinuteData(),this.CreateChartDrawPictureByStorage(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.AutoUpdate()}},this.CaclutateLimitPrice=function(t,e){if(this.LimitPrice=null,e&&e.max>0&&e.min>0)this.LimitPrice={Max:e.max,Min:e.min};else{var a=MARKET_SUFFIX_NAME.GetLimitPriceRange(this.Symbol,this.Name);a?t<=0||(this.LimitPrice={Max:t*(1+a.Max),Min:t*(1+a.Min)},JSConsole.Chart.Log(`[MinuteChartContainer::CaclutateLimitPrice] ${this.Symbol} yClose:${t} max:${this.LimitPrice.Max} min:${this.LimitPrice.Min}`),this.LimitPrice.Max=parseFloat(this.LimitPrice.Max.toFixed(2)),this.LimitPrice.Min=parseFloat(this.LimitPrice.Min.toFixed(2)),JSConsole.Chart.Log(`[MinuteChartContainer::CaclutateLimitPrice] ${this.Symbol} tofixed(2) max:${this.LimitPrice.Max} min:${this.LimitPrice.Min}`)):JSConsole.Chart.Log(`[MinuteChartContainer::CaclutateLimitPrice] ${this.Symbol} no limit price.`)}},this.RequestOverlayMinuteData=function(){var t=this,e=this.TradeDate;for(var a in this.OverlayChartPaint){let n=this.OverlayChartPaint[a];if(n.MainData&&n.MainYClose>0&&n.Status==OVERLAY_STATUS_ID.STATUS_NONE_ID){var i=n.Symbol;if(!i)return;if(n.Status=OVERLAY_STATUS_ID.STATUS_REQUESTDATA_ID,this.NetworkFilter){var r={Name:"MinuteChartContainer::RequestOverlayMinuteData",Explain:"叠加股票最新分时数据",Request:{Url:t.HistoryMinuteApiUrl,Data:{days:[e],symbol:i},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(e){n.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOverlayMinuteData(e,n)}),1==r.PreventDefault)continue}JSNetwork.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:i,days:[e]},type:"post",dataType:"json",async:!0,success:function(e){n.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOverlayMinuteData(e,n)}})}}},this.RecvOverlayMinuteData=function(t,e){if(!e.IsDelete){var a,i=MinuteChartContainer.JsonDataToMinuteDataArray(t),r=null;if(this.DayCount>1){if(i.length<=0)return;var n=i[0];for(var s in e.SourceData){if(e.SourceData[s].Date==n.Date){e.SourceData[s]=n;var o=this.HistoryMinuteDataToArray(e.SourceData);(r=new ChartData).Data=o,a=n.YClose;break}}if(null==r)return}else a=(r=i.length>0?i[0]:new ChartData).YClose;e.Data=r,e.Title=t.name,e.Symbol=t.symbol,e.YClose=a,e.Status=OVERLAY_STATUS_ID.STATUS_FINISHED_ID,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.RequestOverlayHistoryMinuteData=function(){var t=this,e=[];for(var a in this.DayData){var i=this.DayData[a];e.push(i.Date)}if(!(e.length<=0))for(var a in this.OverlayChartPaint){let i=this.OverlayChartPaint[a];var r=i.Symbol;if(!r)return;if(i.Status==OVERLAY_STATUS_ID.STATUS_NONE_ID){if(i.Status=OVERLAY_STATUS_ID.STATUS_REQUESTDATA_ID,this.NetworkFilter){var n={Name:"MinuteChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票多日分时数据",Request:{Url:t.HistoryMinuteApiUrl,Data:{days:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,function(e){i.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOverlayHistoryMinuteData(e,i)}),1==n.PreventDefault)return}JSNetwork.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:r,days:e},type:"post",dataType:"json",async:!0,success:function(e){i.Status=OVERLAY_STATUS_ID.STATUS_RECVDATA_ID,t.RecvOverlayHistoryMinuteData(e,i)}})}}},this.RecvOverlayHistoryMinuteData=function(t,e){var a=MinuteChartContainer.JsonDataToMinuteDataArray(t),i=[];for(var r in this.DayData){var n=this.DayData[r],s=!1;for(var o in a)if(n.Date==a[o].Date){i.push(a[r]),s=!0;break}if(!s)(new ChartData).Date=n.Date}e.SourceData=i;var h=this.HistoryMinuteDataToArray(i),l=i[0].YClose,C=new ChartData;C.Data=h,e.Data=C,e.Title=t.name,e.Symbol=t.symbol,e.YClose=l,e.Status=OVERLAY_STATUS_ID.STATUS_FINISHED_ID,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.CancelAutoUpdate=function(){"number"==typeof this.AutoUpdateTimer&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(){if(this.CancelAutoUpdate(),this.IsAutoUpdate&&this.Symbol){var t=this,e=MARKET_SUFFIX_NAME.GetMarketStatus(this.Symbol);if(0!=e&&3!=e){var a=this.AutoUpdateFrequency;1==e?this.AutoUpdateTimer=setTimeout(function(){t.AutoUpdate()},a):2==e&&(this.AutoUpdateTimer=setTimeout(function(){t.ResetOverlaySymbolStatus(),t.RequestMinuteData()},a))}}},this.BindIndexData=function(t,e){if(this.WindowIndex[t]){if("function"!=typeof this.WindowIndex[t].RequestData)return"function"==typeof this.WindowIndex[t].ExecuteScript?(debug&&console.log("xxxxxxxxxxxxxxx BindIndexData2",this.ChartPaint.length),void this.WindowIndex[t].ExecuteScript(this,t,e)):void this.WindowIndex[t].BindData(this,t,e);this.WindowIndex[t].RequestData(this,t,e)}},this.BindMainData=function(t,e,a){var i=new ChartData;if(i.Data=t.GetClose(),this.ChartPaint[0].Data=i,this.ChartPaint[0].YClose=e,this.ChartPaint[0].NotSupportMessage=null,this.ChartPaint[0].SourceData=this.IsBeforeData?t:null,this.ChartPaint[0].IsShowLead=!1,this.ChartPaint[0].LeadData=null,MARKET_SUFFIX_NAME.IsSHSZIndex(this.Symbol)&&1==this.DayCount&&this.IsShowLead){var r=new ChartData;r.Data=t.GetLead(),this.ChartPaint[0].LeadData=r,this.ChartPaint[0].IsShowLead=!0}for(var n in this.Frame.SubFrame[0].Frame.YSplitOperator.YClose=e,this.Frame.SubFrame[0].Frame.YSplitOperator.Data=i,this.Frame.Data=this.ChartPaint[0].Data,this.Frame.SourceData=t,this.Frame.SubFrame){(l=this.Frame.SubFrame[n].Frame).Data=t}(i=new ChartData).Data=t.GetMinuteAvPrice(),this.ChartPaint[1].Data=i;var s=this.Symbol.toUpperCase();MARKET_SUFFIX_NAME.IsForeignExchange(s)&&(this.ChartPaint[1].Data=null),this.Frame.SubFrame[0].Frame.YSplitOperator.AverageData=i,this.Frame.SubFrame[0].Frame.YSplitOperator.SourceData=this.IsBeforeData?t:null,this.Frame.SubFrame[0].Frame.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,this.Frame.SubFrame[0].Frame.YSplitOperator.LimitPrice=this.LimitPrice,a&&(this.Frame.SubFrame[0].Frame.YSplitOperator.High=a.High,this.Frame.SubFrame[0].Frame.YSplitOperator.Low=a.Low),this.ChartPaint[2].Data=t,this.ChartPaint[2].YClose=e,MARKET_SUFFIX_NAME.IsFutures(s)||MARKET_SUFFIX_NAME.IsSHO(s)?this.BindOverlayMainData(t,e):this.ClearBindOverlayMainData(),this.TitlePaint[0].Data=this.SourceData,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].YClose=e,this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.YClose=e,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data),this.ExtendChartPaint[0]&&(this.ExtendChartPaint[0].Symbol=this.Symbol,this.ExtendChartPaint[0].Name=this.Name);var o=0,h=this.IsBeforeData;for(var n in this.DayCount>1&&(h=!1),h&&(o=15),this.OverlayChartPaint){var l;(l=this.OverlayChartPaint[n]).MainData=this.ChartPaint[0].Data,l.MainYClose=e,l.BeforeDataCount=o,l.IsBeforeData=h}},this.BindOverlayMainData=function(t,e){if(!(this.Frame.SubFrame.length<2)){var a=null,i=null,r=this.Frame.SubFrame[1];if(r.OverlayIndex.length<=0){var n=new OverlayIndexItem;n.Identify="Position_Line_Frame",(i=new OverlayMinuteFrame).Canvas=this.Canvas,i.MainFrame=r.Frame,i.ChartBorder=r.Frame.ChartBorder,n.Frame=i,i.YSplitOperator=new FrameSplitY,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=i.ChartBorder,i.YSplitOperator.SplitCount=r.Frame.YSplitOperator.SplitCount,(a=new ChartLine).Canvas=this.Canvas,a.Name="Position-Line",a.ChartBorder=i.ChartBorder,a.ChartFrame=i,a.Identify=n.Identify,a.Color=g_JSChartResource.Minute.PositionColor,n.ChartPaint.push(a),r.OverlayIndex.push(n),r.Frame.RightFrame=i}else a=r.OverlayIndex[0].ChartPaint[0],i=r.OverlayIndex[0].Frame;var s=this.Frame.SubFrame[0].Frame.XPointCount;i.XPointCount=s;var o=new ChartData;o.Data=t.GetPosition(),a.Data=o}},this.ClearBindOverlayMainData=function(){if(!(this.Frame.SubFrame.length<2)){var t=this.Frame.SubFrame[1];t.Frame.RightFrame=null,t.OverlayIndex=[]}},this.GetChartPaint=function(t){var e=new Array;for(var a in this.ChartPaint)if(!(a<3)){var i=this.ChartPaint[a];i.ChartFrame==this.Frame.SubFrame[t].Frame&&e.push(i)}return e},this.CreateWindowIndex=function(t){this.WindowIndex[t].Create(this,t)},this.GetIndexInfo=function(){var t=[];for(var e in this.WindowIndex){var a=this.WindowIndex[e],i={Name:a.Name};a.ID&&(i.ID=a.ID),t.push(i)}return t},this.OnTouchFinished=function(){!0!==this.CorssCursorTouchEnd||this.DrawDynamicInfo()},this.CreateExtendChart=function(t,e){var a;switch(t){case"MinuteTooltip":return(a=e.Create&&"function"==typeof e.Create?e.Create():new MinuteTooltipPaint).Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,e.LanguageID=this.LanguageID,a.SetOption(e),this.ExtendChartPaint.push(a),a;default:return null}},this.SetMinuteInfo=function(t,e){for(var a in this.ChartInfo=[],t){var i=JSMinuteInfoMap.Get(t[a]);if(i){var r=i.Create();this.ChartInfo.push(r)}}1==e&&this.RequestMinuteInfoData()},this.GetChartMinuteInfo=function(){return this.ChartInfoPaint},this.CreateMinuteInfo=function(t){var e=new ChartMinuteInfo;return e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.HQChartBorder=this.Frame.ChartBorder,e.ChartMinutePrice=this.ChartPaint[0],t&&e.SetOption&&e.SetOption(t),this.ChartInfoPaint=e,e},this.RequestMinuteInfoData=function(){if(!(this.ChartInfo.length<=0)){var t=this.GetChartMinuteInfo();for(var e in t||(t=this.CreateMinuteInfo(null)),t.SourceData=this.SourceData,this.ChartInfo)this.ChartInfo[e].RequestData(this)}},this.UpdataChartInfo=function(){var t=this.GetChartMinuteInfo();if(t){var e=new Map;for(var a in this.ChartInfo){var i=this.ChartInfo[a].Data;for(var r in i){var n=i[r],s=`${n.Date} ${n.Time}`;e.has(s)?e.get(s).Data.push(n):e.set(s,{Data:new Array(n)})}}t.Data=e}},this.UpdateWindowIndex=function(t){if(!(t<2)){var e=this.SourceData;this.BindIndexData(t,e),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateChartDrawPicture=function(t,e,a){var i=null;switch(t){case"线段":i=new ChartDrawPictureLine;break;case"射线":i=new ChartDrawPictureHaflLine;break;case"水平线":i=new ChartDrawPictureHorizontalLine;break;case"趋势线":i=new ChartDrawPictureTrendLine;break;case"矩形":i=new ChartDrawPictureRect;break;case"圆弧线":i=new ChartDrawPictureArc;break;case"M头W底":i=new ChartDrawPictureWaveMW;break;default:{const e=new Map([["icon-arrow_up",{Text:"",Color:"#318757"}],["icon-arrow_down",{Text:"",Color:"#db563e"}],["icon-arrow_right",{Text:"",Color:"#318757"}],["icon-arrow_left",{Text:"",Color:"#318757"}]]);if(e.has(t)){var r=e.get(t);(i=new ChartDrawPictureIconFont).FontOption.Family="iconfont",i.Text=r.Text,r.Color&&(i.LineColor=r.Color);break}}return!1}i.Canvas=this.Canvas,i.Status=0,i.Symbol=this.Symbol,i.Period=888888888,i.Option=this.ChartDrawOption,a&&(i.FinishedCallback=a),e&&i.SetOption(e);var n=this;return i.Update=function(){n.DrawDynamicInfo()},this.CurrentChartDrawPicture=i,JSConsole.Chart.Log("[MinuteChartContainer::CreateChartDrawPicture] ",t,this.CurrentChartDrawPicture),!0},this.ReloadChartDrawPicture=function(){this.ChartDrawPicture=[],this.ChartDrawStorageCache,this.ChartDrawStorage&&(this.ChartDrawStorageCache=this.ChartDrawStorage.GetDrawData({Symbol:this.Symbol,Period:888888888}))},this.CreateChartDrawPictureByStorage=function(){if(this.ChartDrawStorageCache&&!(this.ChartDrawStorageCache.length<=0)){for(var t in this.ChartDrawStorageCache){var e=this.ChartDrawStorageCache[t];if(!(e.FrameID<0||!this.Frame.SubFrame||this.Frame.SubFrame.length<e.FrameID)){var a=IChartDrawPicture.CreateChartDrawPicture(e);a&&(a.Canvas=this.Canvas,a.Status=10,a.Frame=this.Frame.SubFrame[e.FrameID].Frame,a.UpdateXValue(),a.ValueToPoint(),"ChartDrawPictureText"===a.ClassName&&(a.IsInitialized=!0),this.ChartDrawPicture.push(a))}}this.ChartDrawStorageCache=null}}}function HistoryMinuteChartContainer(t){this.newMethod=MinuteChartContainer,this.newMethod(t),delete this.newMethod,this.HistoryMinuteApiUrl="https://opensourcecache.zealink.com/cache/minuteday/day/",this.ClassName="HistoryMinuteChartContainer",this.CreateMainKLine=function(){var t,e=new ChartMinutePriceLine;e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.Name="Minute-Line",e.Color=g_JSChartResource.Minute.PriceColor,this.ChartPaint[0]=e,(t=new ChartLine).Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="Minute-Average-Line",t.Color=g_JSChartResource.Minute.AvPriceColor,this.ChartPaint[1]=t,(t=new ChartMinuteVolumBar).Color=g_JSChartResource.Minute.VolBarColor,t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[1].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[1].Frame,t.Name="Minute-Vol-Bar",this.ChartPaint[2]=t,this.TitlePaint[0]=new DynamicMinuteTitlePainting,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].IsShowDate=!0},this.ChangeTradeDate=function(t){t&&(this.TradeDate=t,this.RequestData())},this.RequestData=function(){var t=new Date;1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate()==this.TradeDate?this.RequestMinuteData():this.RequestHistoryMinuteData()},this.RequestHistoryMinuteData=function(){var t=this,e=this.HistoryMinuteApiUrl+this.TradeDate.toString()+"/"+this.Symbol+".json";JSNetwork.HttpRequest({url:e,type:"get",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteData(e)},error:function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteError(e)}})},this.RecvHistoryMinuteError=function(t){if(404==t.status){var e=new ChartData;for(var a in this.SourceData=e,this.ChartPaint)this.ChartPaint[a].Data=e,0==a&&(this.ChartPaint[a].NotSupportMessage="没有权限访问!");this.TitlePaint[0].Data=this.SourceData,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=null,this.Draw()}},this.RecvHistoryMinuteData=function(t){var e=HistoryMinuteChartContainer.JsonDataToMinuteData(t),a=new ChartData;if(a.Data=e,this.TradeDate=t.date,this.SourceData=a,this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(a,t.day.yclose),this.Frame.SubFrame.length>2){var i=new ChartData;i.Data=e;for(var r=2;r<this.Frame.SubFrame.length;++r)this.BindIndexData(r,i)}this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function CustomKLineChartContainer(t){this.newMethod=KLineChartContainer,this.newMethod(t),delete this.newMethod,this.ClassName="CustomKLineChartContainer",this.CustomKLineApiUrl=g_JSChartResource.Domain+"/API/IndexCalculate",this.CustomStock,this.QueryDate={Start:20180101,End:20180627},this.RequestHistoryData=function(){var t=this;this.ChartSplashPaint.EnableSplash(!0),this.Draw(),JSNetwork.HttpRequest({url:this.CustomKLineApiUrl,data:{stock:t.CustomStock,Name:t.Symbol,date:{startdate:t.QueryDate.Start,enddate:t.QueryDate.End}},type:"post",dataType:"json",async:!0,success:function(e){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryData(e)}})},this.RecvHistoryData=function(t){var e=KLineChartContainer.JsonDataToHistoryData(t),a=new ChartData;a.Data=e,a.DataType=0;var i=new ChartData;if(i.Data=e,i.Right=this.Right,i.Period=this.Period,i.DataType=0,i.Right>0){var r=i.GetRightDate(i.Right);i.Data=r}if(ChartData.IsDayPeriod(this.Period,!1)){var n=a.GetPeriodData(i.Period);i.Data=n}this.SourceData=a,this.Name=t.name,this.BindMainData(i,this.PageSize);for(var s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,i);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function KLineTrainChartContainer(t,e){!0===e?(this.newMethod=KLineChartHScreenContainer,this.newMethod(t),delete this.newMethod):(this.newMethod=KLineChartContainer,this.newMethod(t),delete this.newMethod),this.BuySellPaint,this.TrainDataCount=300,this.TrainStartDate,this.AutoRunTimer=null,this.BuySellData=[],this.TrainCallback,this.DragMode=1,this.IsAutoUpdate=!1,this.KLineSourceData,this.TrainInfo={Start:{},End:{}},this.CreateBuySellPaint=function(){var t=new ChartBuySell;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="KLine-Train-BuySell",this.ChartPaintEx[0]=t},this.GetKDataIndexByDateTime=function(t,e){if(!e||!t)return-1;for(var a in t){var i=t[a];if(ChartData.IsMinutePeriod(this.Period,!0)){if(IFrameSplitOperator.IsNumber(this.TrainStartDate.Time)){if(i.Date>=this.TrainStartDate.Date&&i.Time>=this.TrainStartDate.Time)return parseInt(a)}else if(i.Date>=this.TrainStartDate.Date)return parseInt(a)}else if((ChartData.IsDayPeriod(this.Period,!0)||ChartData.IsTickPeriod(this.Period))&&i.Date>=this.TrainStartDate.Date)return parseInt(a)}return-1},this.AfterBindMainData=function(t){this.ChartPaintEx[0]||this.CreateBuySellPaint();var e=this.ChartPaint[0].Data;this.ChartPaintEx[0].Data=e;var a=e.Data[e.Data.length-1];this.TrainInfo.LastShowData=a,this.TrainInfo.LastData=this.SourceData.Data[this.SourceData.Data.length-1],"Update"!=t&&this.UpdateTrainUICallback("开始")},this.BeforeBindMainData=function(t){if("Update"!=t){this.KLineSourceData=new ChartData,this.KLineSourceData.Data=this.SourceData.Data.slice(0);var e=this.SourceData.Data.length,a=e-this.TrainDataCount-20,i=this.GetKDataIndexByDateTime(this.SourceData.Data,this.TrainStartDate);i>=0&&e-(a=i+1)<this.TrainDataCount&&(this.TrainDataCount=e-a);var r=a-1,n=this.SourceData.Data[r];this.TrainInfo.Start.Index=r,this.TrainInfo.Start.Date=n.Date,this.TrainInfo.Start.Time=n.Time,this.TrainInfo.End.Index=r,this.TrainInfo.End.Date=n.Date,this.TrainInfo.End.Time=n.Time,this.TrainInfo.LastData=n,this.SourceData.Data.length=a}},this.Run=function(t){if(!(this.AutoRunTimer||this.TrainDataCount<=0)){var e=this;this.AutoRunTimer=setInterval(function(){e.MoveNextKLineData(t)||clearInterval(e.AutoRunTimer)},1e3)}},this.MoveNextKLineData=function(t){if(this.TrainDataCount<=0)return!1;var e=1;t&&t.Step>1&&(e=t.Step);for(var a=0,i=0;i<e;++i){var r=this.TrainInfo.End.Index+1;if(r>=this.KLineSourceData.Data.length)break;var n=this.KLineSourceData.Data[r];if(this.SourceData.Data.push(n),this.TrainInfo.End.Index=r,this.TrainInfo.End.Date=n.Date,this.TrainInfo.End.Time=n.Time,--this.TrainDataCount,++a,this.TrainDataCount<=0)break}if(0==a)return!1;var s=this.Frame.GetCurrentPageSize();return IFrameSplitOperator.IsNumber(s)&&(this.PageSize=s-this.RightSpaceCount),t&&t.PageSize>0&&(this.PageSize=t.PageSize),this.Update(),this.TrainDataCount<=0?(this.FinishTrainData(),this.UpdateTrainUICallback("结束"),!1):(this.UpdateTrainUICallback("训练中"),!0)},this.UpdateTrainUICallback=function(t){if(this.mapEvent.has(JSCHART_EVENT_ID.RECV_TRAIN_MOVE_STEP)){var e=this.mapEvent.get(JSCHART_EVENT_ID.RECV_TRAIN_MOVE_STEP);if(e.Callback){var a={TrainDataCount:this.TrainDataCount,BuySellData:this.BuySellData,KLine:{Start:{Index:this.TrainInfo.Start.Index,Date:this.TrainInfo.Start.Date},End:{Index:this.TrainInfo.End.Index,Date:this.TrainInfo.End.Date}},LastData:this.TrainInfo.LastData,LastShowData:this.TrainInfo.LastShowData};IFrameSplitOperator.IsNumber(this.TrainInfo.Start.Time)&&(a.KLine.Start.Time=this.TrainInfo.Start.Time),IFrameSplitOperator.IsNumber(this.TrainInfo.End.Time)&&(a.KLine.End.Time=this.TrainInfo.End.Time),t&&(a.Description=t),this.TrainDataCount<=0&&(a.Symbol=this.Symbol,a.Name=this.Name),e.Callback(e,a,this)}}},this.FinishTrainData=function(){JSConsole.Chart.Log("[KLineTrainChartContainer::FinishTrainData] trian end ")},this.Stop=function(){null!=this.AutoRunTimer&&clearInterval(this.AutoRunTimer),this.AutoRunTimer=null},this.BuyOrSell=function(t,e){if(!this.TrainInfo.LastShowData)return!1;var a=this.ChartPaintEx[0];if(!a)return!1;var i=this.ChartPaint[0].Data;if(!i||i.Data.length<=0)return!1;var r=i.Data.length-1,n={Date:this.TrainInfo.End.Date,Time:this.TrainInfo.End.Time,Price:t.Price,Vol:t.Vol,Op:0,ID:t.ID};1==t.Op&&(n.Op=1);var s=r;n.Key=s,this.BuySellData.push(n),a.AddTradeItem(n),1==e&&this.Draw()},this.RestartTrain=function(t){JSConsole.Chart.Log("[KLineTrainChartContainer::RestartTrain] option ",t),this.TrainInfo={Start:{},End:{}},this.BuySellData=[],this.KLineSourceData=null;var e=this.ChartPaintEx[0];e&&(e.Data=null,e.ClearTradeData()),t.Symbol&&(this.Symbol=t.Symbol),IFrameSplitOperator.IsNumber(t.Period)&&(this.Period=t.Period),IFrameSplitOperator.IsNumber(t.Right)&&(this.Right=t.Right),t.Train&&(t.Train.DataCount>1&&(this.TrainDataCount=t.Train.DataCount),t.Train.DateTime&&(this.TrainStartDate=t.Train.DateTime));var a=this.Symbol;this.ChangeSymbol(a)},this.RecvFlowCapitalData=function(t){if(!t.stock||1!=t.stock.length)return;let e=t.stock[0];var a=new Array;for(var i in e.stockday){var r=e.stockday[i];let t=new SingleData;t.Date=r.date;var n=r.capital;n&&(n.a>0&&(t.Value=n.a,a.push(t)))}if(ChartData.IsMinutePeriod(this.Period,!0)){var s=this.SourceData.GetMinuteFittingFinanceData(a);for(var i in this.SourceData.Data){(r=this.SourceData.Data[i]).FlowCapital=s[i].Value}var o=this.ChartPaint[0].Data;if((l=new ChartData).Data=this.SourceData.Data,ChartData.IsMinutePeriod(o.Period,!1)){var h=l.GetPeriodData(o.Period);l.Data=h}o.Data=l.Data;s=this.KLineSourceData.GetMinuteFittingFinanceData(a);for(var i in this.KLineSourceData.Data){(r=this.KLineSourceData.Data[i]).FlowCapital=s[i].Value}}else{s=this.SourceData.GetFittingFinanceData(a);for(var i in this.SourceData.Data){(r=this.SourceData.Data[i]).FlowCapital=s[i].Value}var l;o=this.ChartPaint[0].Data;if((l=new ChartData).Data=this.SourceData.Data,o.Right>0){var C=l.GetRightDate(o.Right);l.Data=C}if(ChartData.IsDayPeriod(o.Period,!1)){h=l.GetPeriodData(o.Period);l.Data=h}o.Data=l.Data;s=this.KLineSourceData.GetFittingFinanceData(a);for(var i in this.KLineSourceData.Data){(r=this.KLineSourceData.Data[i]).FlowCapital=s[i].Value}}this.FlowCapitalReady=!0;var u=!1;for(var i in this.ExtendChartPaint){if("StockChip"==(r=this.ExtendChartPaint[i]).ClassName){u=!0;break}}u&&this.Draw()},this.AutoUpdate()}function KLineChartHScreenContainer(t){this.newMethod=KLineChartContainer,this.newMethod(t),delete this.newMethod,this.ClassName="KLineChartHScreenContainer",this.OnMouseMove=function(t,e,a){this.LastPoint.X=t,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(e),this.DrawDynamicInfo()},t.onmousedown=function(e){if(this.JSChartContainer&&0!=this.JSChartContainer.DragMode){var a=GetDevicePixelRatio();if(this.JSChartContainer.TryClickLock){var i=(e.clientX-this.getBoundingClientRect().left)*a,r=(e.clientY-this.getBoundingClientRect().top)*a;if(this.JSChartContainer.TryClickLock(i,r))return}var n={Click:{},LastMove:{}};n.Click.X=e.clientX,n.Click.Y=e.clientY,n.LastMove.X=e.clientX,n.LastMove.Y=e.clientY,this.JSChartContainer.MouseDrag=n,document.JSChartContainer=this.JSChartContainer,this.JSChartContainer.SelectChartDrawPicture=null,t.ondblclick=function(t){var e=t.clientX-this.getBoundingClientRect().left,a=t.clientY-this.getBoundingClientRect().top;this.JSChartContainer&&this.JSChartContainer.OnDoubleClick(e,a,t)},document.onmousemove=function(t){if(this.JSChartContainer&&(!this.JSChartContainer.ChartSplashPaint||1!=this.JSChartContainer.ChartSplashPaint.IsEnableSplash)){var e=this.JSChartContainer.MouseDrag;if(e){var a=Math.abs(e.LastMove.Y-t.clientY);if(1==this.JSChartContainer.DragMode){if(a<5)return;var i=!0;e.LastMove.Y<t.clientY&&(i=!1),this.JSChartContainer.DataMove(a,i)&&(this.JSChartContainer.UpdataDataoffset(),this.JSChartContainer.UpdatePointByCursorIndex(),this.JSChartContainer.UpdateFrameMaxMin(),this.JSChartContainer.ResetFrameXYSplit(),this.JSChartContainer.Draw()),e.LastMove.X=t.clientX,e.LastMove.Y=t.clientY}}}},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,this.JSChartContainer.MouseDrag=null,this.JSChartContainer.CurrentChartDrawPicture=null,this.JSChartContainer=null}}},this.OnTouchStart=function(e){this.PhonePinch=null,this.IsOnTouch=!0,this.TouchDrawCount=0,this.StopDragTimer();var a=this.IsSingleTouch(e);if(e.cancelable&&e.preventDefault(),this.IsPhoneDragging(e)){if(this.TryClickLock||this.TryClickIndexTitle){var i=(h=this.GetToucheData(e,this.IsForceLandscape))[0].clientX,r=h[0].clientY,n=GetDevicePixelRatio();if(i-=t.getBoundingClientRect().left*n,r-=t.getBoundingClientRect().top*n,this.TryClickLock&&this.TryClickLock(i,r))return;if(this.TryClickIndexTitle&&this.TryClickIndexTitle(i,r))return}var s=!0;this.ChartDrawOption.IsLockScreen?s=!1:this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID?1==this.TouchStatus.CorssCursorShow&&(s=!1):this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID?s=!1:a||(s=!1);var o={Click:{},LastMove:{}},h=this.GetToucheData(e,!1);if(o.Click.X=h[0].clientX,o.Click.Y=h[0].clientY,o.LastMove.X=h[0].clientX,o.LastMove.Y=h[0].clientY,this.MouseDrag=o,this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture)return 2==this.CurrentChartDrawPicture.Status?this.SetChartDrawPictureThirdPoint(o.Click.X,o.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(o.Click.X,o.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),void(e.cancelable&&e.preventDefault());var l={};n=GetDevicePixelRatio();if(l.X=h[0].clientX-t.getBoundingClientRect().left,l.Y=h[0].clientY-t.getBoundingClientRect().top,this.GetChartDrawPictureByPoint(l)){l.ChartDrawPicture.Status=20,l.ChartDrawPicture.ValueToPoint(),l.ChartDrawPicture.MovePointIndex=l.PointIndex,l.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=l.ChartDrawPicture,this.SelectChartDrawPicture=l.ChartDrawPicture;let t=this.GetEventCallback(JSCHART_EVENT_ID.ON_CLICK_DRAWPICTURE);if(t&&t.Callback){let e={DrawPicture:l.ChartDrawPicture};t.Callback(t,e,this)}return void(e.cancelable&&e.preventDefault())}if(s){var C=this;this.DragTimer=setTimeout(function(){if(o.Click.X==o.LastMove.X&&o.Click.Y==o.LastMove.Y){C.MouseDrag;C.MouseDrag=null,C.MoveCorssCursor(o.Click,e)}},C.PressTime)}this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID||(this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(o.Click,e)):this.IsClickShowCorssCursor&&this.MoveCorssCursor(o.Click,e))}else if(this.IsPhonePinching(e)){var u={Start:{},Last:{}};h=this.GetToucheData(e,!1);u.Start={X:h[0].pageX,Y:h[0].pageY,X2:h[1].pageX,Y2:h[1].pageY},u.Last={X:h[0].pageX,Y:h[0].pageY,X2:h[1].pageX,Y2:h[1].pageY},this.PhonePinch=u,this.SelectChartDrawPicture=null}},this.OnTouchMove=function(t){t.cancelable&&t.preventDefault();var e=this.GetToucheData(t,!1);if(this.IsPhoneDragging(t)){var a=this.MouseDrag;if(null==a)this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:e[0].clientX,Y:e[0].clientY},t);else{var i=Math.abs(a.LastMove.Y-e[0].clientY),r=Math.abs(a.LastMove.X-e[0].clientX),n=this.DragMode==JSCHART_DRAG_ID.CLICK_TOUCH_MODE_ID&&1==this.TouchStatus.CorssCursorShow;if(this.CurrentChartDrawPicture){var s=this.CurrentChartDrawPicture;if(1==s.Status||2==s.Status){if(i<5&&r<5)return;this.SetChartDrawPictureSecondPoint(e[0].clientX,e[0].clientY,!0)&&this.DrawDynamicInfo()}else if(3==s.Status)this.SetChartDrawPictureThirdPoint(e[0].clientX,e[0].clientY,!0)&&this.DrawDynamicInfo();else if(20==s.Status){if(i<5&&r<5)return;this.MoveChartDrawPicture(e[0].clientX-a.LastMove.X,e[0].clientY-a.LastMove.Y,!0)&&this.DrawDynamicInfo()}a.LastMove.X=e[0].clientX,a.LastMove.Y=e[0].clientY}if(n){this.MouseDrag;this.MouseDrag=null,this.MoveCorssCursor(a.Click,t)}else if(1==this.DragMode||0==n){if(i<5)return;var o=!0;a.LastMove.Y<e[0].clientY&&(o=!1),this.DataMove(i,o)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):this.DragDownloadData&&this.DragDownloadData(),a.LastMove.X=e[0].clientX,a.LastMove.Y=e[0].clientY}}}else if(this.IsPhonePinching(t)){if(this.DragMode==JSCHART_DRAG_ID.DISABLE_DRAG_ID)return;var h=this.PhonePinch;if(!h)return;var l=Math.abs(e[0].pageX-e[1].pageX)-Math.abs(h.Last.X-h.Last.X2);if(Math.abs(l)<5)return;if(l>0){if((C={}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(C))return;this.CursorIndex=C.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}else{var C;if((C={}).Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(C))return;this.CursorIndex=C.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown()}h.Last={X:e[0].pageX,Y:e[0].pageY,X2:e[1].pageX,Y2:e[1].pageY}}},this.OnTouchEnd=function(t){JSConsole.Chart.Log("[KLineChartHScreenContainer:OnTouchEnd]",t);if(this.CurrentChartDrawPicture){var e=this.CurrentChartDrawPicture;2==e.Status||1==e.Status||3==e.Status?(e.PointStatus=e.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():!1):20==e.Status&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}this.IsOnTouch=!1,this.StopDragTimer(),this.OnTouchFinished(),this.TouchDrawCount=0},this.Create=function(t){for(var e in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new ChartCorssCursor,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=g_DivTooltipDataForamt.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatY=g_DivTooltipDataForamt.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartSplashPaint=new ChartSplashPaint,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new HQTradeHScreenFrame,this.Frame.ChartBorder=new ChartBorder,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var a=new DynamicChartTitlePainting;a.Frame=this.Frame.SubFrame[e].Frame,a.Canvas=this.Canvas,a.LanguageID=this.LanguageID,this.TitlePaint.push(a)}this.UIElement.addEventListener("keydown",OnKeyDown,!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new ChartBorder;a.UIElement=this.UIElement;var i=new KLineHScreenFrame;if(i.Canvas=this.Canvas,i.ChartBorder=a,i.Identify=e,i.RightSpaceCount=this.RightSpaceCount,this.ModifyIndexDialog&&(i.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(i.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),i.HorizontalMax=20,i.HorizontalMin=10,0==e){i.YSplitOperator=new FrameSplitKLinePriceY,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price");var r=GetDevicePixelRatio();a.TopSpace=12*r,a.BottomSpace=12*r}else i.YSplitOperator=new FrameSplitY,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double");i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new FrameSplitKLineX,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,e!=t-1&&(i.XSplitOperator.ShowText=!1);for(var n=i.HorizontalMin;n<=i.HorizontalMax;n+=1)i.HorizontalInfo[n]=new CoordinateInfo,i.HorizontalInfo[n].Value=n,0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=n.toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new SubFrameItem;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}}}function MinuteChartHScreenContainer(t){this.newMethod=MinuteChartContainer,this.newMethod(t),delete this.newMethod,this.ClassName="MinuteChartHScreenContainer",this.OnMouseMove=function(t,e,a){this.LastPoint.X=t,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(e),this.DrawDynamicInfo()},this.Create=function(t){for(var e in this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new ChartCorssCursor,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=new HQMinuteTimeStringFormat,this.ChartCorssCursor.StringFormatY=new HQPriceStringFormat,this.ChartSplashPaint=new ChartSplashPaint,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new HQTradeHScreenFrame,this.Frame.ChartBorder=new ChartBorder,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.Frame.SubFrame){var a=new DynamicChartTitlePainting;a.Frame=this.Frame.SubFrame[e].Frame,a.Canvas=this.Canvas,a.LanguageID=this.LanguageID,this.TitlePaint.push(a)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.UIElement.addEventListener("keydown",OnKeyDown,!0)},this.CreateChildWindow=function(t){for(var e=0;e<t;++e){var a=new ChartBorder;a.UIElement=this.UIElement;var i=new MinuteHScreenFrame;i.Canvas=this.Canvas,i.ChartBorder=a,i.Identify=e,e<2&&(i.ChartBorder.TitleHeight=0),i.XPointCount=243;var r=[9,8,7,6,5,4,3,2,1];for(var n in i.HorizontalMax=r[0],i.HorizontalMin=r[r.length-1],0==e?(i.YSplitOperator=new FrameSplitMinutePriceY,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price")):(i.YSplitOperator=new FrameSplitY,i.YSplitOperator.LanguageID=this.LanguageID,i.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double")),i.YSplitOperator.Frame=i,i.YSplitOperator.ChartBorder=a,i.XSplitOperator=new FrameSplitMinuteX,i.XSplitOperator.Frame=i,i.XSplitOperator.ChartBorder=a,e!=t-1&&(i.XSplitOperator.ShowText=!1),i.XSplitOperator.Operator(),r)i.HorizontalInfo[n]=new CoordinateInfo,i.HorizontalInfo[n].Value=r[n],0==e&&n==i.HorizontalMin||(i.HorizontalInfo[n].Message[1]=r[n].toString(),i.HorizontalInfo[n].Font="14px 微软雅黑");var s=new SubFrameItem;s.Frame=i,s.Height=0==e?20:10,this.Frame.SubFrame[e]=s}}}function SimlpleChartContainer(t){this.newMethod=JSChartContainer,this.newMethod(t),delete this.newMethod,this.MainDataControl,this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new ChartSplashPaint,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new SimpleChartFrame,this.Frame.ChartBorder=new ChartBorder,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor&&(this.ChartCorssCursor.Frame=this.Frame),this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart(),this.UIElement.addEventListener("keydown",OnKeyDown,!0)},this.SetMainDataConotrl=function(t){t&&(this.MainDataControl=t,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl){for(var t in this.MainDataControl.DataType){let a=this.MainDataControl.DataType[t];if("BAR"==a.Type)(e=new ChartBar).Canvas=this.Canvas,e.ChartBorder=this.Frame.ChartBorder,e.ChartFrame=this.Frame,e.Name=a.Name,a.Color&&(e.UpBarColor=a.Color),a.Color2&&(e.DownBarColor=a.Color2),this.ChartPaint.push(e);else if("LINE"==a.Type){var e;(e=new ChartLine).Canvas=this.Canvas,e.ChartBorder=this.Frame.ChartBorder,e.ChartFrame=this.Frame,e.Name=a.Name,a.Color&&(e.Color=a.Color),this.ChartPaint.push(e)}}this.Frame.YSplitOperator=new FrameSplitY,this.Frame.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),this.Frame.YSplitOperator.Frame=this.Frame,this.Frame.YSplitOperator.ChartBorder=this.Frame.ChartBorder,this.Frame.XSplitOperator=new FrameSplitXData,this.Frame.XSplitOperator.Frame=this.Frame,this.Frame.XSplitOperator.ChartBorder=this.Frame.ChartBorder}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(t){let e=0;for(var a in t.Data){let i=new ChartData;i.Data=t.Data[a],this.ChartPaint[a].Data=i,e<i.Data.length&&(e=i.Data.length)}this.Frame.XPointCount=e,this.Frame.Data=this.ChartPaint[0].Data,this.Frame.XData=t.XData,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function PieChartContainer(t){this.Radius,this.newMethod=JSChartContainer,this.newMethod(t),delete this.newMethod,this.MainDataControl,this.OnMouseMove=function(t,e,a){},this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new ChartSplashPaint,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new NoneFrame,this.Frame.ChartBorder=new ChartBorder,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart()},this.SetMainDataConotrl=function(t){t&&(this.MainDataControl=t,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl)for(var t in this.MainDataControl.DataType){let a=this.MainDataControl.DataType[t];if("PIE"==a.Type)(e=new ChartPie).Canvas=this.Canvas,e.ChartBorder=this.Frame.ChartBorder,e.ChartFrame=this.Frame,e.Name=a.Name,this.Radius&&(e.Radius=this.Radius),this.ChartPaint.push(e);else if("RADAR"==a.Type){var e;(e=new ChartRadar).Canvas=this.Canvas,e.ChartBorder=this.Frame.ChartBorder,e.ChartFrame=this.Frame,e.Name=a.Name,a.StartAngle&&(e.StartAngle=a.StartAngle),this.ChartPaint.push(e)}}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(t){for(var e in t.Data){let a=new ChartData;a.Data=t.Data[e],this.ChartPaint[e].Data=a}this.Frame.SetSizeChage(!0),this.Draw()}}function MapChartContainer(t){this.newMethod=JSChartContainer,this.newMethod(t),delete this.newMethod,this.MainDataControl,this.OnMouseMove=function(t,e,a){},this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new ChartSplashPaint,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new NoneFrame,this.Frame.ChartBorder=new ChartBorder,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart()},this.SetMainDataConotrl=function(t){t&&(this.MainDataControl=t,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(!this.MainDataControl)return;let t=new ChartChinaMap;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.ChartBorder,t.ChartFrame=this.Frame,t.Name=this.MainDataControl.DataType[0].Name,this.Radius&&(t.Radius=this.Radius),this.ChartPaint.push(t)},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(t){this.ChartPaint[0].Data=t.Data[0],this.Frame.SetSizeChage(!0),this.Draw()}}function IndexInfo(t,e){this.Name=t,this.Param=e,this.LineColor,this.ReqeustData=null}function BaseIndex(t){this.Index,this.Name=t,this.Script=null,this.OverlayIndex=null,this.Create=function(t,e){},this.NotSupport=function(t,e,a){if(!this.IsOverlay()){t.DeleteIndexPaint(e);var i=t.Frame.SubFrame[e].Frame,r=new ChartErrorMessage;r.Canvas=t.Canvas,r.ChartBorder=i.ChartBorder,r.ChartFrame=i,r.NotSupportMessage=a,t.ChartPaint.push(r)}},this.FormatIndexTitle=function(){var t=this.Name,e=null;for(var a in this.Index){var i=this.Index[a];null!=i.Param&&(e?e+=","+i.Param.toString():e=i.Param.toString())}return e&&(t+="("+e+")"),t},this.IsOverlay=function(){return!(!this.OverlayIndex||1!=this.OverlayIndex.IsOverlay)},this.CreateChart=function(t){return new ChartLine},this.CreatePaints=function(t,e){var a=null,i=this.IsOverlay();i?(a=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(a=t.Frame.SubFrame[e].Frame,t.DeleteIndexPaint(e));var r=[];for(var n in this.Index){var s=this.CreateChart(n);s.Color=this.Index[n].LineColor,s.Canvas=t.Canvas,s.Name=this.Name+"-"+n.toString(),s.ChartBorder=a.ChartBorder,s.ChartFrame=a,i?this.OverlayIndex.Frame.ChartPaint.push(s):t.ChartPaint.push(s),r.push(s)}return r},this.SendEvent=function(t,e,a,i){if(t.GetIndexEvent){var r=t.GetIndexEvent();if(r){var n={Data:this.GetOutData(),WindowIndex:e,Name:this.Name,HistoryData:a,Stock:{Symbol:t.Symbol,Name:t.Name}};i&&(n.Error=i),r.Callback(r,n,self)}}},this.GetOutData=function(){return null}}function JSIndex_CJL(){this.newMethod=BaseIndex,this.newMethod("CJL"),delete this.newMethod,this.Index=new Array(new IndexInfo("VOL",null),new IndexInfo("OPID",null)),this.Index[0].LineColor=g_JSChartResource.Index.LineColor[0],this.Index[1].LineColor=g_JSChartResource.Index.LineColor[1],this.CreateChart=function(t){var e;return 0==t?e=new ChartVolStick:1==t?((e=new ChartSubLine).LineWidth=1*GetDevicePixelRatio(),e):void 0},this.RequestData=function(t,e,a){return this.BindData(t,e,a),t.UpdataDataoffset(),t.UpdateFrameMaxMin(),t.Draw(),!0},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;var n=a.GetVol(),s=a.GetPosition();i[0].HistoryData=a,i[0].Data.Data=n,i[1].Data.Data=s;var o=e+1;if(r){var h=t.TitlePaint[o];for(var l in h.OverlayIndex.set(this.OverlayIndex.Identify,{Data:[],Title:""}),i){var C=new DynamicTitleData(i[l].Data,this.Index[l].Name,this.Index[l].LineColor);h.OverlayIndex.get(this.OverlayIndex.Identify).Data[l]=C}}else t.TitlePaint[o].Data[0]=new DynamicTitleData(i[0].Data,this.Index[0].Name,this.Index[0].LineColor),t.TitlePaint[o].Data[1]=new DynamicTitleData(i[1].Data,this.Index[1].Name,this.Index[1].LineColor),t.TitlePaint[o].Title=this.Name;return!0}}function MarketLongShortIndex(){this.newMethod=BaseIndex,this.newMethod("Long-Short"),delete this.newMethod,this.Index=new Array(new IndexInfo("多头区域",null),new IndexInfo("空头区域",null),new IndexInfo("市场多空指标",null)),this.Index[0].LineColor=g_JSChartResource.UpBarColor,this.Index[1].LineColor=g_JSChartResource.DownBarColor,this.Index[2].LineColor=g_JSChartResource.Index.LineColor[0],this.LongShortData,this.CreateChart=function(t){if(2==t){var e=new ChartLine;return e.LineWidth=2,e}return new ChartStraightLine},this.GetOutData=function(){return{LongShortData:this.LongShortData}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.LongShortData=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),this.SendEvent(t,e,a,"不支持周期切换"),!1):(JSNetwork.HttpRequest({url:g_JSChartResource.Index.MarketLongShortApiUrl,data:{},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0)},this.RecvData=function(t,e){if(!(t.data.length<=0)){var a=new Array;for(var i in t.data){var r=t.data[i],n=new SingleData;n.Date=r[0],n.Value=r[1],a.push(n)}var s=e.HistoryData.GetFittingData(a),o=new ChartData;o.Data=s,o.Period=e.HQChart.Period,o.Right=e.HQChart.Right,this.LongShortData=o.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[2].Data.Data=this.LongShortData,i[0].Data.Data[0]=8,i[1].Data.Data[0]=1;var n=e+1;if(r){this.OverlayIndex.Frame.Frame.YSpecificMaxMin={Max:9,Min:0,Count:3};var s=t.TitlePaint[n];for(var o in s.OverlayIndex.set(this.OverlayIndex.Identify,{Data:[],Title:""}),i){var h=new DynamicTitleData(i[o].Data,this.Index[o].Name,this.Index[o].LineColor);2!=o&&(h.DataType="StraightLine"),s.OverlayIndex.get(this.OverlayIndex.Identify).Data[o]=h}}else for(var o in t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:9,Min:0,Count:3},i)t.TitlePaint[n].Data[o]=new DynamicTitleData(i[o].Data,this.Index[o].Name,this.Index[o].LineColor),2!=o&&(t.TitlePaint[n].Data[o].DataType="StraightLine");return!0}}function MarketTimingIndex(){this.newMethod=BaseIndex,this.newMethod("Market-Timing"),delete this.newMethod,this.Index=new Array(new IndexInfo("因子择时",null)),this.TimingData,this.TitleColor=g_JSChartResource.FrameSplitTextColor,this.CreateChart=function(t){return new ChartMACD},this.GetOutData=function(){return{TimingData:this.TimingData}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.LongShortData=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),this.SendEvent(t,e,a,"不支持周期切换"),!1):(JSNetwork.HttpRequest({url:g_JSChartResource.Index.MarketLongShortApiUrl,data:{},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0)},this.RecvData=function(t,e){if(!(t.data.length<=0)){var a=new Array;for(var i in t.data){var r=t.data[i],n=new SingleData;n.Date=r[0],n.Value=r[2],a.push(n)}var s=e.HistoryData.GetFittingData(a),o=new ChartData;o.Data=s,o.Period=e.HQChart.Period,o.Right=e.HQChart.Right,this.TimingData=o.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[0].Data.Data=this.TimingData,i[0].NotSupportMessage=null;var n=e+1;if(r){var s=t.TitlePaint[n];for(var o in s.OverlayIndex.set(this.OverlayIndex.Identify,{Data:[],Title:""}),i){var h=new DynamicTitleData(i[o].Data,this.Index[o].Name,this.Index[o].LineColor);h.StringFormat=STRING_FORMAT_TYPE.THOUSANDS,h.FloatPrecision=0,s.OverlayIndex.get(this.OverlayIndex.Identify).Data[o]=h}}else for(var o in i)t.TitlePaint[n].Data[o]=new DynamicTitleData(i[o].Data,this.Index[o].Name,this.TitleColor),t.TitlePaint[n].Data[o].StringFormat=STRING_FORMAT_TYPE.THOUSANDS,t.TitlePaint[n].Data[o].FloatPrecision=0;return!0}}function MarketAttentionIndex(){this.newMethod=BaseIndex,this.newMethod("Market-Attention"),delete this.newMethod,this.Index=new Array(new IndexInfo("市场关注度",null)),this.Data,this.TitleColor=g_JSChartResource.FrameSplitTextColor,this.ApiUrl=g_JSChartResource.Index.MarketAttentionApiUrl,this.CreateChart=function(t){return new ChartMACD},this.GetOutData=function(){return{Data:this.Data}},this.SetFrame=function(t,e,a){this.IsOverlay()?this.OverlayIndex.Frame.Frame.YSpecificMaxMin={Max:6,Min:0,Count:3}:t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:6,Min:0,Count:3}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.Data=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),this.SendEvent(t,e,a,"不支持周期切换"),!1):(JSNetwork.HttpRequest({url:this.ApiUrl,data:{symbol:r.HQChart.Symbol,startdate:20100101},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0)},this.RecvData=function(t,e){if(!(t.date.length<0)){var a=new Array;for(var i in t.date){var r=new SingleData;r.Date=t.date[i],r.Value=t.value[i],a.push(r)}var n=e.HistoryData.GetFittingData(a),s=new ChartData;s.Data=n,s.Period=e.HQChart.Period,s.Right=e.HQChart.Right,this.Data=s.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),this.SetFrame(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[0].Data.Data=this.Data,i[0].NotSupportMessage=null;var n=e+1;if(r){var s=t.TitlePaint[n];for(var o in s.OverlayIndex.set(this.OverlayIndex.Identify,{Data:[],Title:""}),i){var h=new DynamicTitleData(i[o].Data,this.Index[o].Name,this.Index[o].LineColor);h.StringFormat=STRING_FORMAT_TYPE.THOUSANDS,h.FloatPrecision=0,s.OverlayIndex.get(this.OverlayIndex.Identify).Data[o]=h}}else for(var o in i)t.TitlePaint[n].Data[o]=new DynamicTitleData(i[o].Data,this.Index[o].Name,this.TitleColor),t.TitlePaint[n].Data[o].StringFormat=STRING_FORMAT_TYPE.THOUSANDS,t.TitlePaint[n].Data[o].FloatPrecision=0;return!0}}function MarketHeatIndex(){this.newMethod=BaseIndex,this.newMethod("Market-Heat"),delete this.newMethod,this.Index=new Array(new IndexInfo("热度",5),new IndexInfo("MA",10),new IndexInfo("MA",null)),this.Data,this.ApiUrl=g_JSChartResource.Index.MarketHeatApiUrl,this.Index[0].LineColor=g_JSChartResource.FrameSplitTextColor,this.Index[1].LineColor=g_JSChartResource.Index.LineColor[0],this.Index[2].LineColor=g_JSChartResource.Index.LineColor[1],this.CreateChart=function(t){return 0==t?new ChartMACD:new ChartLine},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.Data=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),!1):(JSNetwork.HttpRequest({url:this.ApiUrl,data:{symbol:r.HQChart.Symbol,startdate:20100101},type:"post",dataType:"json",async:!0,success:function(t){i.RecvData(t,r)}}),!0)},this.RecvData=function(t,e){if(!(t.date.length<0)){var a=new Array;for(var i in t.date){var r=new SingleData;r.Date=t.date[i],r.Value=t.value[i],a.push(r)}var n=e.HistoryData.GetFittingData(a),s=new ChartData;s.Data=n,s.Period=e.HQChart.Period,s.Right=e.HQChart.Right,this.Data=s.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e),r=this.IsOverlay();if(i.length!=this.Index.length)return!1;i[0].Data.Data=this.Data,i[0].NotSupportMessage=null;var n=HQIndexFormula.MA(this.Data,this.Index[0].Param);i[1].Data.Data=n;var s=HQIndexFormula.MA(this.Data,this.Index[1].Param);i[2].Data.Data=s;var o=e+1;if(r){var h=t.TitlePaint[o];for(var l in h.OverlayIndex.set(this.OverlayIndex.Identify,{Data:[],Title:""}),i){var C="";C=0==l?t.Name+this.Index[l].Name:"MA"+this.Index[l-1].Param;var u=new DynamicTitleData(i[l].Data,C,this.Index[l].LineColor);u.StringFormat=STRING_FORMAT_TYPE.DEFAULT,u.FloatPrecision=2,h.OverlayIndex.get(this.OverlayIndex.Identify).Data[l]=u}}else for(var l in i){C="";C=0==l?t.Name+this.Index[l].Name:"MA"+this.Index[l-1].Param,t.TitlePaint[o].Data[l]=new DynamicTitleData(i[l].Data,C,this.Index[l].LineColor),t.TitlePaint[o].Data[l].StringFormat=STRING_FORMAT_TYPE.DEFAULT,t.TitlePaint[o].Data[l].FloatPrecision=2}return!0}}function CustonIndexHeatIndex(){this.newMethod=BaseIndex,this.newMethod("Market-Heat"),delete this.newMethod,this.Index=new Array(new IndexInfo("区域",3),new IndexInfo("热度指数",10),new IndexInfo("MA",5),new IndexInfo("MA",10)),this.Data,this.ApiUrl=g_JSChartResource.Index.CustomIndexHeatApiUrl,this.Index[1].LineColor=g_JSChartResource.Index.LineColor[1],this.Index[2].LineColor=g_JSChartResource.Index.LineColor[2],this.Index[3].LineColor=g_JSChartResource.Index.LineColor[3],this.Create=function(t,e){for(var a in this.Index){var i=null;0==a?i=new ChartStraightArea:(i=new ChartLine).Color=this.Index[a].LineColor,i.Canvas=t.Canvas,i.Name=this.Name+"-"+a.toString(),i.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,i.ChartFrame=t.Frame.SubFrame[e].Frame,t.ChartPaint.push(i)}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};return this.Data=[],r.HQChart.Period>0?(this.NotSupport(r.HQChart,r.WindowIndex,"不支持周期切换"),r.HQChart.Draw(),!1):(JSNetwork.HttpRequest({url:this.ApiUrl,data:{stock:r.HQChart.CustomStock,date:{startdate:r.HQChart.QueryDate.Start,enddate:r.HQChart.QueryDate.End},day:[this.Index[0].Param,this.Index[1].Param]},type:"post",dataType:"json",async:!0,success:function(t){i.RecvData(t,r)}}),!0)},this.RecvData=function(t,e){if(!(null==t.data||t.data.length<0)){var a=new Array;for(var i in t.data){let e=t.data[i],r=new SingleData;r.Date=e[0],r.Value=e[1],a.push(r)}var r=e.HistoryData.GetFittingData(a),n=new ChartData;n.Data=r,n.Period=e.HQChart.Period,n.Right=e.HQChart.Right,this.Data=n.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){let i=t.GetChartPaint(e);if(i.length!=this.Index.length)return!1;i[0].NotSupportMessage=null,i[0].Data.Data=[{Value:0,Value2:.2,Color:"rgb(50,205,50)",Title:"热度1",TitleColor:"rgb(245,255 ,250)"},{Value:.2,Value2:.4,Color:"rgb(255,140,0)",Title:"热度2",TitleColor:"rgb(245,255 ,250)"},{Value:.4,Value2:.8,Color:"rgb(255,106,106)",Title:"热度3",TitleColor:"rgb(245,255 ,250)"},{Value:.8,Value2:1,Color:"rgb(208, 32 ,144)",Title:"热度4",TitleColor:"rgb(245,255 ,250)"}],i[1].Data.Data=this.Data;let r=HQIndexFormula.MA(this.Data,this.Index[2].Param);i[2].Data.Data=r;let n=HQIndexFormula.MA(this.Data,this.Index[3].Param);i[3].Data.Data=n,t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:1,Min:0,Count:3};let s=e+1;for(var o=1;o<i.length;++o){let e=this.Index[o].Name;"MA"==e&&(e="MA"+this.Index[o].Param),t.TitlePaint[s].Data[o]=new DynamicTitleData(i[o].Data,e,this.Index[o].LineColor),t.TitlePaint[s].Data[o].StringFormat=STRING_FORMAT_TYPE.DEFAULT,t.TitlePaint[s].Data[o].FloatPrecision=2}return t.TitlePaint[s].Title="热度("+this.Index[0].Param+","+this.Index[1].Param+","+this.Index[2].Param+","+this.Index[3].Param+")",!0}}function BenfordIndex(){this.newMethod=BaseIndex,this.newMethod("财务粉饰"),delete this.newMethod,this.Index=new Array(new IndexInfo("区域",null),new IndexInfo("系数",null)),this.Data,this.ApiUrl=g_JSChartResource.Index.StockHistoryDayApiUrl,this.Index[0].LineColor=g_JSChartResource.Index.LineColor[0],this.Index[1].LineColor="rgb(105,105,105)",this.CreateChart=function(t){return 0==t?new ChartStraightArea:new ChartLineMultiData},this.GetOutData=function(){return{Data:this.Data}},this.RequestData=function(t,e,a){var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a};if(this.Data=[],2!=r.HQChart.Period)return this.NotSupport(r.HQChart,r.WindowIndex,"只支持月线"),r.HQChart.Draw(),this.SendEvent(t,e,a,"只支持月线"),!1;return JSNetwork.HttpRequest({url:this.ApiUrl,data:{symbol:[r.HQChart.Symbol],field:["finance.benford","announcement2.quarter","announcement1.quarter","announcement3.quarter","announcement4.quarter"],condition:[{item:["date","int32","gte","20130101"]},{item:["announcement1.year","int32","gte",0,"announcement2.year","int32","gte",0,"announcement3.year","int32","gte",0,"announcement4.year","int32","gte",0,"or"]}]},type:"post",dataType:"json",async:!0,success:function(n){i.RecvData(n,r),i.SendEvent(t,e,a)}}),!0},this.JsonDataToMapSingleData=function(t){var e=t.stock[0].stockday,a=new Map;for(var i in e){var r=e[i],n=new SingleData;if(n.Date=r.date,n.Value=new Array,null!=r.finance1&&null!=r.announcement1){let t=r.announcement1.year,e=r.announcement1.quarter,a=r.finance1.benford;n.Value.push({Year:t,Quarter:e,Value:a})}if(null!=r.finance2&&null!=r.announcement2){let t=r.announcement2.year,e=r.announcement2.quarter,a=r.finance2.benford;n.Value.push({Year:t,Quarter:e,Value:a})}if(null!=r.finance3&&null!=r.announcement3){let t=r.announcement3.year,e=r.announcement3.quarter,a=r.finance3.benford;n.Value.push({Year:t,Quarter:e,Value:a})}if(null!=r.finance4&&null!=r.announcement4){let t=r.announcement4.year,e=r.announcement4.quarter,a=r.finance4.benford;n.Value.push({Year:t,Quarter:e,Value:a})}a.set(n.Date,n)}var s=new Array;for(var r of a)s.push(r[1]);return s},this.RecvData=function(t,e){if(JSConsole.Chart.Log(t),!(null==t.stock||t.stock.length<=0)){var a=this.JsonDataToMapSingleData(t),i=e.HistoryData.GetFittingMonthData(a),r=new ChartData;r.Data=i,r.Period=e.HQChart.Period,r.Right=e.HQChart.Right,this.Data=r.GetValue(),this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()}},this.BindData=function(t,e,a){var i=this.CreatePaints(t,e);if(i.length!=this.Index.length)return!1;i[0].NotSupportMessage=null,i[0].Data.Data=[{Value:0,Value2:.2,Color:"rgb(50,205,50)",Title:"安全区",TitleColor:"rgb(245,255 ,250)"},{Value:.2,Value2:.4,Color:"rgb(255,140,0)",Title:"预警区",TitleColor:"rgb(245,255 ,250)"},{Value:.4,Value2:1,Color:"rgb(255,106,106)",Title:"警示区",TitleColor:"rgb(245,255 ,250)"}],i[1].Data.Data=this.Data,t.Frame.SubFrame[e].Frame.YSpecificMaxMin={Max:1,Min:0,Count:3};var r=e+1;return t.TitlePaint[r].Data[1]=new DynamicTitleData(i[1].Data,this.Index[1].Name,this.Index[1].LineColor),t.TitlePaint[r].Data[1].DataType="MultiReport",t.TitlePaint[r].Title=this.FormatIndexTitle(),!0}}function LighterIndex1(){this.newMethod=BaseIndex,this.newMethod("Lighter-Trend"),delete this.newMethod,this.Index=new Array(new IndexInfo("STICKLINE",null),new IndexInfo("STICKLINE",null)),this.Index[0].LineColor="rgb(255,0,0)",this.Index[1].LineColor="rgb(0,0,255)",this.Create=function(t,e){for(var a in this.Index){var i=new ChartStickLine;i.Canvas=t.Canvas,i.Name=this.Name,i.Name=this.Name+"-"+a.toString(),i.Color=this.Index[a].LineColor,i.LineWidth=2,i.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,i.ChartFrame=t.Frame.SubFrame[e].Frame,t.ChartPaint.push(i)}},this.BindData=function(t,e,a){var i=t.GetChartPaint(e);if(2!=i.length)return!1;var r=a.GetClose(),n=HQIndexFormula.SMA(r,6.5,1),s=HQIndexFormula.SMA(r,13.5,1),o=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(n,s),n,s),h=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(s,n),n,s);i[0].Data.Data=o,i[1].Data.Data=h;var l=e+1;return t.TitlePaint[l].Title="大盘/个股 趋势函数",!0}}function LighterIndex2(){this.newMethod=BaseIndex,this.newMethod("位置研判函数"),delete this.newMethod,this.Index=new Array(new IndexInfo("STICKLINE",34),new IndexInfo("STICKLINE",3),new IndexInfo("STICKLINE",null),new IndexInfo("STICKLINE",null),new IndexInfo("STICKLINE",null),new IndexInfo("STICKLINE",null),new IndexInfo("LINE",null),new IndexInfo("TEXT",null)),this.Index[0].LineColor="rgb(0,0,138)",this.Index[1].LineColor="rgb(133,0,138)",this.Index[2].LineColor="rgb(101,118,0)",this.Index[3].LineColor="rgb(105,0,121)",this.Index[4].LineColor="rgb(121,183,21)",this.Index[5].LineColor="rgb(0,0,138)",this.Index[6].LineColor="rgb(255,0,0)",this.Create=function(t,e){for(var a in this.Index){var i=null;"LINE"==this.Index[a].Name?(i=new ChartLine).Color=this.Index[a].LineColor:"TEXT"==this.Index[a].Name?i=new ChartText:((i=new ChartStickLine).Color=this.Index[a].LineColor,i.LineWidth=5),i.Canvas=t.Canvas,i.Name=this.Name,i.Name=this.Name+"-"+a.toString(),i.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,i.ChartFrame=t.Frame.SubFrame[e].Frame,t.ChartPaint.push(i)}},this.BindData=function(t,e,a){var i=t.GetChartPaint(e);if(i.length!=this.Index.length)return!1;var r=a.GetClose(),n=a.GetHigh(),s=a.GetLow();i[0].Data.Data=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(r,0),0,2),i[1].Data.Data=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(r,0),2,5),i[2].Data.Data=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(r,0),5,10),i[3].Data.Data=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(r,0),10,21.5),i[4].Data.Data=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(r,0),21.5,23,5),i[5].Data.Data=HQIndexFormula.STICKLINE(HQIndexFormula.ARRAY_GT(r,0),23,28,5);var o=HQIndexFormula.ARRAY_DIVIDE(HQIndexFormula.EMA(HQIndexFormula.ARRAY_MULTIPLY(HQIndexFormula.ARRAY_DIVIDE(HQIndexFormula.ARRAY_SUBTRACT(r,HQIndexFormula.LLV(s,this.Index[0].Param)),HQIndexFormula.ARRAY_SUBTRACT(HQIndexFormula.HHV(n,this.Index[0].Param),HQIndexFormula.LLV(s,this.Index[0].Param))),100),this.Index[1].Param),4);i[6].Data.Data=o;var h=new Array;h[0]={Value:1,Message:"底部区域",Color:"rgb(0,255,255)",Position:"Left"},h[1]={Value:3.5,Message:"介入区域",Color:"rgb(0,255,255)",Position:"Left"},h[2]={Value:7.5,Message:"稳健区域",Color:"rgb(0,255,255)",Position:"Left"},h[3]={Value:16,Message:"高位区域",Color:"rgb(0,255,255)",Position:"Left"},h[4]={Value:22,Message:"风险区域",Color:"rgb(0,0,255)",Position:"Left"},h[5]={Value:25.5,Message:"顶部区域",Color:"rgb(255,0,255)",Position:"Left"},i[7].Data.Data=h;var l=e+1;return t.TitlePaint[l].Data[0]=new DynamicTitleData(i[6].Data,"财貌双拳",i[6].Color),t.TitlePaint[l].Title=this.FormatIndexTitle(),!0}}function PyScriptIndex(t,e,a,i){this.newMethod=BaseIndex,this.newMethod(t),delete this.newMethod,this.Script=e,this.Arguments=[],this.OutVar=[],this.ApiUrl=g_JSChartResource.PyIndexDomain+"/hq/code",a&&(this.Arguments=a),this.RequestData=function(t,e,a){this.OutVar=[];var i=this,r={HQChart:t,WindowIndex:e,HistoryData:a},n="";for(var s in this.Arguments){n.length>0&&(n+=",");var o=this.Arguments[s];n+=\'"\'+o.Name+\'":\'+o.Value}n="{"+n+"}";var h=JSON.parse(n),l=JSON.stringify({code:this.Script,symbol:r.HQChart.Symbol,period:r.HQChart.Period,right:r.HQChart.Right,params:h,numcount:t.MaxReqeustDataCount});return JSNetwork.HttpRequest({url:this.ApiUrl,data:l,type:"post",dataType:"json",contentType:" application/json; charset=utf-8",async:!0,success:function(t){i.RecvData(t,r)},complete:function(t){},error:function(t,e){i.RecvError(t,e,r)}}),!0},this.RecvError=function(t,e,a){JSConsole.Chart.Log("[PyScriptIndex::RecvError] error",e),a.HQChart.ScriptErrorCallback&&a.HQChart.ScriptErrorCallback(e)},this.RecvData=function(t,e){if(0!=t.code)return JSConsole.Chart.Log("[PyScriptIndex::RecvData] failed.",t),void(e.HQChart.ScriptErrorCallback&&e.HQChart.ScriptErrorCallback(t.msg));JSConsole.Chart.Log("[PyScriptIndex::RecvData] recv data.",t);var a=t.date;for(var i in t.data){for(var r=t.data[i],n=[],s=0;s<a.length&&s<a.length;++s)if(!(s>=r.data.length)){var o=new SingleData;o.Date=a[s],o.Value=r.data[s],n.push(o)}var h=e.HistoryData.GetFittingData(n),l=new ChartData;l.Data=h,l.Period=e.HQChart.Period,l.Right=e.HQChart.Right;var C={Name:r.name,Type:r.graph,LineWidth:r.width,Data:l.GetValue(),Color:r.color};this.OutVar.push(C)}this.BindData(e.HQChart,e.WindowIndex,e.HistoryData),e.HQChart.UpdataDataoffset(),e.HQChart.UpdateFrameMaxMin(),e.HQChart.Draw()},this.BindData=function(t,e,a){for(var i in t.DeleteIndexPaint(e),this.OutVar){let a=this.OutVar[i];switch(a.Type){case"line":this.CreateLine(t,e,a,i);break;case"colorstick":this.CreateColorStock(t,e,a,i)}}var r=e+1;t.TitlePaint[r].Title=this.Name;let n="";for(var i in this.Arguments){let t=this.Arguments[i];n.length>0&&(n+=","),n+=t.Value.toString()}return n.length>0&&(t.TitlePaint[r].Title=this.Name+"("+n+")"),!0},this.CreateLine=function(t,e,a,i){let r=new ChartLine;r.Canvas=t.Canvas,r.DrawType=1,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame,a.Color?r.Color=a.Color:r.Color=this.GetDefaultColor(i),a.LineWidth>0&&(r.LineWidth=a.LineWidth),0==a.IsShow&&(r.IsShow=!1);let n=e+1;r.Data.Data=a.Data,t.TitlePaint[n].Data[i]=new DynamicTitleData(r.Data,a.Name,r.Color),t.ChartPaint.push(r)},this.CreateColorStock=function(t,e,a,i){let r=new ChartMACD;r.Canvas=t.Canvas,r.Name=a.Name,r.ChartBorder=t.Frame.SubFrame[e].Frame.ChartBorder,r.ChartFrame=t.Frame.SubFrame[e].Frame;let n=e+1;r.Data.Data=a.Data,t.TitlePaint[n].Data[i]=new DynamicTitleData(r.Data,a.Name,this.GetDefaultColor(i)),t.ChartPaint.push(r)},this.GetDefaultColor=function(t){let e=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"];return e[parseInt(t)%(e.length-1)]}}function JsonDataIndex(t,e,a,i){this.newMethod=PyScriptIndex,this.newMethod(t),delete this.newMethod,this.JsonData,i.JsonData&&(this.JsonData=i.JsonData),this.RequestData=function(t,e,a){if(this.JsonData){var i={HQChart:t,WindowIndex:e,HistoryData:a};this.JsonData.code=0;var r=this.JsonData;this.RecvData(r,i)}else console.warn("[PyScriptIndex::RequestData] JsonData is null"),i.HQChart.ScriptErrorCallback&&i.HQChart.ScriptErrorCallback("json 数据不能为空")}}function LighterIndex3(){this.newMethod=BaseIndex,this.newMethod("点位研判函数"),delete this.newMethod,this.Index=new Array(new IndexInfo("启动买点",null)),this.Index[0].LineColor="rgb(255,0,0)",this.BindData=function(t,e,a){var i=t.GetChartPaint(e);if(i.length!=this.Index.length)return!1;var r=a.GetClose(),n=(a.GetHigh(),a.GetLow()),s=HQIndexFormula.REF(n,1),o=HQIndexFormula.ARRAY_MULTIPLY(HQIndexFormula.ARRAY_DIVIDE(HQIndexFormula.SMA(HQIndexFormula.ABS(HQIndexFormula.ARRAY_SUBTRACT(n,s)),13,1),HQIndexFormula.SMA(HQIndexFormula.MAX(HQIndexFormula.ARRAY_SUBTRACT(n,s),0),13,1)),100),h=HQIndexFormula.EMA(HQIndexFormula.ARRAY_IF(HQIndexFormula.ARRAY_MULTIPLY(r,1.2),HQIndexFormula.ARRAY_MULTIPLY(o,13),HQIndexFormula.ARRAY_DIVIDE(o,13)),13),l=HQIndexFormula.LLV(n,34),C=HQIndexFormula.HHV(h,34),u=HQIndexFormula.ARRAY_IF(HQIndexFormula.LLV(n,56),1,0),D=HQIndexFormula.ARRAY_DIVIDE(HQIndexFormula.ARRAY_ADD(h,HQIndexFormula.ARRAY_MULTIPLY(C,2)),2),d=HQIndexFormula.ARRAY_MULTIPLY(HQIndexFormula.ARRAY_DIVIDE(HQIndexFormula.EMA(HQIndexFormula.ARRAY_IF(HQIndexFormula.ARRAY_LTE(n,l),D,0),3),618),u),c=HQIndexFormula.ARRAY_GT(d,HQIndexFormula.REF(d,1)),m=HQIndexFormula.REF(HQIndexFormula.LLV(n,100),3),f=HQIndexFormula.REFDATE(m,-1),v=HQIndexFormula.ARRAY_EQ(n,f),S=HQIndexFormula.ARRAY_AND(c,v);i[0].Data.Data=S;var T=e+1;for(var I in i)t.TitlePaint[T].Data[I]=new DynamicTitleData(i[I].Data,this.Index[I].Name,this.Index[I].LineColor);return t.TitlePaint[T].Title=this.FormatIndexTitle(),!0}}function JSKLineInfoMap(){}function IKLineInfo(){this.MaxReqeustDataCount=1e3,this.StartDate=20160101,this.Data,this.ClassName="IKLineInfo",this.Explain="IKLineInfo",this.GetToday=function(){var t=new Date;return 1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate()},this.GetRequestData=function(t){return{Symbol:t.Symbol,MaxReqeustDataCount:t.MaxReqeustDataCount,MaxRequestMinuteDayCount:t.MaxRequestMinuteDayCount}},this.NetworkFilter=function(t){if(!t.NetworkFilter)return!1;var e=this,a={HQChart:t},i={Name:`${this.ClassName}::RequestData`,Explain:this.Explain,Request:this.GetRequestData(t),Self:this,HQChart:t,PreventDefault:!1};return t.NetworkFilter(i,function(t){e.RecvData(t,a)}),1==i.PreventDefault}}function InvestorInfo(){this.newMethod=IKLineInfo,this.newMethod(),delete this.newMethod,this.ClassName="InvestorInfo",this.Explain="互动易",this.RequestData=function(t){var e=this,a={HQChart:t};if(this.Data=[],!this.NetworkFilter(t)){var i={filed:["question","answerdate","symbol","id"],symbol:[a.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxReqeustDataCount};return JSNetwork.HttpRequest({url:g_JSChartResource.KLine.Info.Investor.ApiUrl,data:i,type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0}},this.RecvData=function(t,e){if(!(t.list.length<=0)){for(var a in t.list){var i=t.list[a],r=new KLineInfoData;r.Date=i.answerdate,r.Title=i.question,r.InfoType=KLINE_INFO_TYPE.INVESTOR,this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function AnnouncementInfo(){this.newMethod=IKLineInfo,this.newMethod(),delete this.newMethod,this.ClassName="AnnouncementInfo",this.Explain="公告",this.ApiType=1,this.RequestData=function(t){var e=this,a={HQChart:t};if(this.Data=[],!this.NetworkFilter(t))if(1==this.ApiType){var i=`${g_JSChartResource.CacheDomain}/cache/analyze/shszreportlist/${a.HQChart.Symbol}.json`;JSNetwork.HttpRequest({url:i,type:"get",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)},error:function(t,i){e.RecvError(t,i,a)}})}else JSNetwork.HttpRequest({url:g_JSChartResource.KLine.Info.Announcement.ApiUrl,data:{filed:["title","releasedate","symbol","id"],symbol:[a.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)},error:function(t,i){e.RecvError(t,i,a)}})},this.RecvData=function(t,e){if(!(t.report.length<=0)){for(var a in t.report){var i=t.report[a],r=new KLineInfoData;for(var n in r.Date=i.releasedate,r.Title=i.title,r.InfoType=KLINE_INFO_TYPE.ANNOUNCEMENT,i.type){switch(i.type[n]){case"一季度报告":r.InfoType=KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_1;break;case"半年度报告":r.InfoType=KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_2;break;case"三季度报告":r.InfoType=KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_3;break;case"年度报告":r.InfoType=KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_4}}for(var n in i.typeex){var s=i.typeex[n];r.InfoType=KLINE_INFO_TYPE.ANNOUNCEMENT_EX_START+s;break}this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}},this.RecvError=function(t,e,a){console.warn("[AnnouncementInfo::RecvError] error, http ",e,t)}}function PforecastInfo(){this.newMethod=IKLineInfo,this.newMethod(),delete this.newMethod,this.ClassName="PforecastInfo",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],JSNetwork.HttpRequest({url:g_JSChartResource.KLine.Info.Pforecast.ApiUrl,data:{field:["pforecast.type","pforecast.reportdate","fweek"],condition:[{item:["pforecast.reportdate","int32","gte",this.StartDate]}],symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(1==t.stock.length&&!(t.stock[0].stockday.length<=0)){for(var a in t.stock[0].stockday){var i=t.stock[0].stockday[a];if(i.pforecast.length>0){var r=i.pforecast[0],n=new KLineInfoData;n.Date=i.date,n.Title=r.type,n.InfoType=KLINE_INFO_TYPE.PFORECAST,n.ExtendData={Type:r.type,ReportDate:r.reportdate},i.fweek&&(n.ExtendData.FWeek={},null!=i.fweek.week1&&(n.ExtendData.FWeek.Week1=i.fweek.week1),null!=i.fweek.week4&&(n.ExtendData.FWeek.Week4=i.fweek.week4)),this.Data.push(n)}}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function ResearchInfo(){this.newMethod=IKLineInfo,this.newMethod(),delete this.newMethod,this.ClassName="ResearchInfo",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],JSNetwork.HttpRequest({url:g_JSChartResource.KLine.Info.Research.ApiUrl,data:{filed:["releasedate","researchdate","level","symbol","id","type"],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(!(t.list.length<=0)){for(var a in t.list){var i=t.list[a],r=new KLineInfoData;r.ID=i.id,r.Date=i.researchdate,r.InfoType=KLINE_INFO_TYPE.RESEARCH,r.ExtendData={Level:i.level,Type:i.type},this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function BlockTrading(){this.newMethod=IKLineInfo,this.newMethod(),delete this.newMethod,this.ClassName="BlockTrading",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],JSNetwork.HttpRequest({url:g_JSChartResource.KLine.Info.BlockTrading.ApiUrl,data:{field:["blocktrading.price","blocktrading.vol","blocktrading.premium","fweek","price"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["blocktrading.vol","int32","gte","0"]}],symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(1==t.stock.length&&!(t.stock[0].stockday.length<=0)){for(var a in t.stock[0].stockday){var i=t.stock[0].stockday[a],r=new KLineInfoData;r.Date=i.date,r.InfoType=KLINE_INFO_TYPE.BLOCKTRADING,r.ExtendData={Price:i.blocktrading.price,Premium:i.blocktrading.premium,Vol:i.blocktrading.vol,ClosePrice:i.price},i.fweek&&(r.ExtendData.FWeek={},null!=i.fweek.week1&&(r.ExtendData.FWeek.Week1=i.fweek.week1),null!=i.fweek.week4&&(r.ExtendData.FWeek.Week4=i.fweek.week4)),this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function TradeDetail(){this.newMethod=IKLineInfo,this.newMethod(),delete this.newMethod,this.ClassName="TradeDetail",this.RequestData=function(t){var e=this,a={HQChart:t};return this.Data=[],JSNetwork.HttpRequest({url:g_JSChartResource.KLine.Info.TradeDetail.ApiUrl,data:{field:["tradedetail.typeexplain","tradedetail.type","fweek"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["tradedetail.type","int32","gte","0"]}],symbol:[a.HQChart.Symbol],start:0,end:this.MaxReqeustDataCount},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)}}),!0},this.RecvData=function(t,e){if(1==t.stock.length&&!(t.stock[0].stockday.length<=0)){for(var a in t.stock[0].stockday){var i=t.stock[0].stockday[a],r=new KLineInfoData;for(var n in r.Date=i.date,r.InfoType=KLINE_INFO_TYPE.TRADEDETAIL,r.ExtendData={Detail:new Array},i.tradedetail){var s=i.tradedetail[n];r.ExtendData.Detail.push({Type:s.type,TypeExplain:s.typeexplain})}i.fweek&&(r.ExtendData.FWeek={},null!=i.fweek.week1&&(r.ExtendData.FWeek.Week1=i.fweek.week1),null!=i.fweek.week4&&(r.ExtendData.FWeek.Week4=i.fweek.week4)),this.Data.push(r)}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}}function JSMinuteInfoMap(){}function IMinuteInfo(){this.Data,this.ClassName="IMinuteInfo"}function MarketEventInfo(){this.newMethod=IMinuteInfo,this.newMethod(),delete this.newMethod,this.ClassName="MarketEventInfo",this.RequestData=function(t){var e=this;this.Data=[];var a={HQChart:t},i=g_JSChartResource.CacheDomain+"/cache/analyze/shszevent/marketevent/concept/"+t.TradeDate+".json";if(t.NetworkFilter){var r={Name:"MarketEventInfo::RequestData",Explain:"大盘异动",Request:{Url:i,Type:"Get",Data:{Date:t.TradeDate,Symbol:t.Symbol}},Self:this,PreventDefault:!1};if(t.NetworkFilter(r,function(t){e.RecvData(t,a),a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}),1==r.PreventDefault)return}return JSNetwork.HttpRequest({url:i,type:"get",dataType:"json",async:!0,success:function(t){e.RecvData(t,a)},error:function(t,e){console.warn("[MarketEventInfo::RequestData] error, http ",e,t)}}),!0},this.RecvData=function(t,e){for(var a in t.event){var i=t.event[a];for(var r in i.data){var n=i.data[r];if(Array.isArray(n)){if(n.length<2)continue;var s={Date:i.date,Time:n[0],Title:n[1],Type:0};n.length>=3&&n[2]&&"string"==typeof n[2]&&(s.Color=n[2]),n.length>=4&&n[3]&&"string"==typeof n[3]&&(s.BGColor=n[3]),this.Data.push(s)}else{if(!IFrameSplitOperator.IsNumber(n.Date)||!IFrameSplitOperator.IsNumber(n.Time)||!n.Title)continue;s={Date:n.Date,Time:n.Time,Title:n.Title,Type:0};n.Color&&(s.Color=n.Color),n.BGColor&&(s.BGColor=n.BGColor),IFrameSplitOperator.IsNumber(n.Price)&&(s.Price=n.Price),n.Content&&(s.Content=n.Content),n.Link&&(s.Link=n.Link),this.Data.push(s)}}}e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}}function IsIndexSymbol(t){var e=t.toUpperCase();if(e.indexOf(".SH")>0){if("0"==(e=e.replace(".SH","")).charAt(0)&&parseInt(e)<=3e3)return!0}else if(e.indexOf(".SZ")>0){if("3"==(e=e.replace(".SZ","")).charAt(0)&&"9"==e.charAt(1))return!0}else if(e.indexOf(".CI")>0)return!0;return!1}function IsFundSymbol(t){if(!t)return!1;var e=t.toUpperCase();if(e.indexOf(".SH")>0){if("5"==(e=e.replace(".SH","")).charAt(0)&&"1"==e.charAt(1))return!0}else if(e.indexOf(".SZ")>0&&"1"==(e=e.replace(".SZ","")).charAt(0)&&("5"==e.charAt(1)||"6"==e.charAt(1)||"7"==e.charAt(1)||"8"==e.charAt(1)))return!0;return!1}function IDivDialog(t){this.DivElement=t,this.ID=null,this.TimeOut=null,this.Hide=function(){$("#"+this.ID).hide()},this.Show=function(t,e,a,i){var r={display:"block"};IFrameSplitOperator.IsNumber(t)&&(r.left=t+"px"),IFrameSplitOperator.IsNumber(e)&&(r.top=e+"px"),IFrameSplitOperator.IsNumber(a)&&(r.width=a+"px"),IFrameSplitOperator.IsNumber(i)&&(r.height=i+"px"),$("#"+this.ID).css(r)}}function ModifyIndexDialog(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.Title={ID:Guid()},this.ParamList={ID:Guid()},this.ParamData=[],this.Identify,this.HQChart,this.Create=function(){this.ID=Guid();var t=document.createElement("div");t.className="jchart-modifyindex-box",t.id=this.ID,t.innerHTML="<div class=\'parameter\'>            <div class=\'parameter-header\'>                <span></span>                <strong id=\'close\' class=\'icon iconfont icon-close\'></strong>            </div>            <div class=\'parameter-content\'><input/>MA</div>            <div class=\'parameter-footer\'>                <button class=\'submit\' >确定</button>                <button class=\'cancel\' >取消</button>            </div>        </div>",this.DivElement.appendChild(t),$("#"+this.ID+" .submit").click({divBox:this},function(t){t.data.divBox.Hide()}),t.getElementsByTagName("span")[0].id=this.Title.ID,t.getElementsByClassName("parameter-content")[0].id=this.ParamList.ID},this.SetTitle=function(t){$("#"+this.Title.ID).html(t)},this.ClearParamList=function(){$("#"+this.ParamList.ID).empty(),this.ParamData=[]},this.BindParam=function(t,e){var a=t.WindowIndex[e];for(var i in a.Arguments){if(null==(o=a.Arguments[i]).Name||isNaN(o.Value))break;var r=Guid(),n=\'<input class="row-line" id="\'+r+\'" value="\'+o.Value+\'" type="number" step="1"/>\'+o.Name+"<br>";$("#"+this.ParamList.ID).append(n),this.ParamData.push({ID:r,Value:o.Value})}var s=this;for(var i in this.ParamData){var o=this.ParamData[i];$("#"+o.ID).mouseup({Chart:t,Identify:e,ParamIndex:i},function(t){var e=parseInt($(this).val());if(IFrameSplitOperator.IsNumber(e)){var a=s.HQChart,i=s.Identify,r=t.data.ParamIndex;a.WindowIndex[i].Arguments[r].Value=e,a.UpdateWindowIndex(i)}else alert("参数不能为空")}),$("#"+o.ID).keyup({Chart:t,Identify:e,ParamIndex:i},function(t){var e=parseInt($(this).val());if(IFrameSplitOperator.IsNumber(e)){var a=s.HQChart,i=s.Identify,r=t.data.ParamIndex;a.WindowIndex[i].Arguments[r].Value=e,a.UpdateWindowIndex(i)}else alert("参数不能为空")})}},this.BindCancel=function(){var t=this;$("#"+this.ID+" .cancel").click(function(){var e=t.HQChart,a=t.Identify;t.RestoreParam(e.WindowIndex[a]),e.UpdateWindowIndex(a),t.Hide()}),$("#"+this.ID+" #close").click(function(){var e=t.HQChart,a=t.Identify;t.RestoreParam(e.WindowIndex[a]),e.UpdateWindowIndex(a),t.Hide()})},this.RestoreParam=function(t){for(var e in this.ParamData){var a=this.ParamData[e];t.Arguments[e].Value=a.Value}},this.DoModal=function(t){var e=t.data.Chart,a=t.data.Identify,i=e.ModifyIndexDialog;i&&(null==i.ID&&i.Create(),i.Identify=a,i.HQChart=e,i.SetTitle(e.WindowIndex[a].Name+" 指标参数设置"),i.ClearParamList(),i.BindParam(e,a),i.BindCancel(),i.Show())}}function ChangeIndexDialog(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.DivElement=t,this.IndexTreeApiUrl="https://opensourcecache.zealink.com/cache/hqh5/index/commonindextree.json",this.OverlayIndexTreeApiUrl="https://opensourcecache.zealink.com/cache/hqh5/index/commonindextree.json",this.IsOverlayIndex=!1,this.Create=function(){var t=document.createElement("div");t.className="jchart-changeindex-box",t.id=this.ID=Guid(),t.innerHTML=\'<div class="target-panel">            <div class="target-header">                <span>换指标</span>                <strong class="close-tar icon iconfont icon-close"></strong>            </div>            <div class="target-content">                <div class="target-left">                    <input type="text">                    <ul></ul>                </div>                <div class="target-right">                    <ul></ul>                </div>            </div>        </div>\',this.DivElement.appendChild(t)},this.ReqeustData=function(){if($("#"+this.ID+" .target-left ul li").length>0)return!1;var t=this.IndexTreeApiUrl;1==this.IsOverlayIndex&&(t=this.OverlayIndexTreeApiUrl),JSNetwork.HttpRequest({url:t,type:"get",success:function(t){var e,a,i,r=t.list;!function(t){$(".target-left ul").html(""),$.each(t,function(t,e){var a;a="<li>"+e.node+"</li>",$(".target-left ul").append(a)}),$(".target-left ul li:first-child").addClass("active-list")}(r),e=r,i=[],$.each(e,function(t,e){i.push(e.list)}),$.each(i[0],function(t,e){a="<li id="+e.id+">"+e.name+"</li>",$(".target-right ul").append(a)}),$(".target-left ul").delegate("li","click",function(){$(this).addClass("active-list").siblings().removeClass("active-list");var t=$(this).index();$(".target-right ul").html(""),$.each(i[t],function(t,e){a="<li id="+e.id+">"+e.name+"</li>",$(".target-right ul").append(a)})})}})},this.BindClose=function(t){$("#"+this.ID+" .close-tar").click({Chart:t},function(t){t.data.Chart.ChangeIndexDialog.Hide()})},this.BindSearch=function(t){$(".target-left input").on("input",{Chart:t},function(t){let e=(new JSIndexScript).Search(t.target.value);for(var a in $(".target-right ul").html(""),e){var i=e[a],r="<li id="+i+">"+i+"</li>";$(".target-right ul").append(r)}})},this.DoModal=function(t){var e=t.data.Chart,a=t.data.Identify,i=e.ChangeIndexDialog,r=t.data.IsOverlay;i&&(null==i.ID&&i.Create(),i.IsOverlayIndex=r,i.ReqeustData(),$(".target-right ul").undelegate().delegate("li","click",function(){var t=$(this).attr("id");r?e.AddOverlayIndex({WindowIndex:a,IndexName:t}):e.ChangeIndex(a,t),$(this).addClass("active-list").siblings().removeClass("active-list")}),i.BindSearch(e),i.BindClose(e),i.Show())}}function KLineInfoTooltip(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.UpColor=g_JSChartResource.UpTextColor,this.DownColor=g_JSChartResource.DownTextColor,this.UnchagneColor=g_JSChartResource.UnchagneTextColor,this.Create=function(){this.ID=Guid();var t=document.createElement("div");t.className="jchart-klineinfo-tooltip",t.id=this.ID,t.innerHTML="<div class=\'title-length\'></div>",this.DivElement.appendChild(t)},this.BindInfoList=function(t,e){var a="<div class=\'total-list\'>共"+e.length+"条</div>",i=[];for(var r in e){var n=e[r],s=n.Date;if(t==KLINE_INFO_TYPE.PFORECAST){var o,h=n.ExtendData.ReportDate,l=parseInt(h/1e4),C=h%1e4;1231==C?o="年报":331==C?o="一季度报":630==C?o="半年度报":930==C&&(o="三季度报");var u="";n.ExtendData.FWeek&&(null!=n.ExtendData.FWeek.Week1&&(u+="一周后涨幅:<i class=\'increase\' style=\'color:"+this.GetColor(n.ExtendData.FWeek.Week1.toFixed(2))+"\'>"+n.ExtendData.FWeek.Week1.toFixed(2)+"%</i>"),null!=n.ExtendData.FWeek.Week4&&(u+="&nbsp;四周后涨幅:<i class=\'increase\' style=\'color:"+this.GetColor(n.ExtendData.FWeek.Week4.toFixed(2))+"\'>"+n.ExtendData.FWeek.Week4.toFixed(2)+"%</i>"),u.length>0&&(u="<br/>&nbsp;&nbsp;<i class=\'prorecast-week\'>"+u+"</i>")),i+="<span>"+(S=(m=n.Date.toString()).substring(0,4)+"-"+m.substring(4,6)+"-"+m.substring(6,8))+"&nbsp;&nbsp;"+l+o+n.Title+"&nbsp;"+u+"</span>"}else if(t==KLINE_INFO_TYPE.RESEARCH){var D=n.ExtendData.Level,d=[];if(0==D.length)d="<i>无</i>";else for(var c in D)0==D[c]?d+="<i style=\'color:#00a0e9\'>证券代表&nbsp;&nbsp;&nbsp;</i>":1==D[c]?d+="<i>董秘&nbsp;&nbsp;&nbsp;</i>":2==D[c]?d+="<i style=\'color:#00a0e9\'>总经理&nbsp;&nbsp;&nbsp;</i>":3==D[c]&&(d+="<i style=\'color:#00a0e9\'>董事长&nbsp;&nbsp;&nbsp;</i>");i+="<span>"+(S=(m=n.Date.toString()).substring(0,4)+"-"+m.substring(4,6)+"-"+m.substring(6,8))+"&nbsp;&nbsp;&nbsp;接待:&nbsp;&nbsp;&nbsp;"+d+"</span>"}else if(t==KLINE_INFO_TYPE.BLOCKTRADING){var m,f=n.ExtendData;i+="<span><i class=\'date-tipbox\'>"+(S=(m=n.Date.toString()).substring(0,4)+"-"+m.substring(4,6)+"-"+m.substring(6,8))+"</i>&nbsp;&nbsp;<i class=\'tipBoxTitle\'>成交价:&nbsp;"+f.Price.toFixed(2)+"</i><i class=\'tipBoxTitle\'>收盘价:&nbsp;"+f.ClosePrice.toFixed(2)+"</i><br/><i class=\'rate-discount tipBoxTitle\'>溢折价率:&nbsp;<strong style=\'color:"+this.GetColor(f.Premium.toFixed(2))+"\'>"+f.Premium.toFixed(2)+"%</strong></i><i class=\'tipBoxTitle\'>成交量(万股):&nbsp;"+f.Vol.toFixed(2)+"</i></span>"}else if(t==KLINE_INFO_TYPE.TRADEDETAIL){var v=n.ExtendData.Detail,S=(I=s.toString()).substring(0,4)+"-"+I.substring(4,6)+"-"+I.substring(6,8),T=[];for(var r in v)T+="<i>"+v[r].TypeExplain+"</i><br/>";i="<span><i class=\'trade-time\'>"+S+"&nbsp;&nbsp;&nbsp;上榜原因:&nbsp;&nbsp;</i><i class=\'reason-list\'>"+T+"</i><br/><i class=\'trade-detall\'>一周后涨幅:&nbsp;<strong style=\'color:"+this.GetColor(n.ExtendData.FWeek.Week1.toFixed(2))+"\'>"+n.ExtendData.FWeek.Week1.toFixed(2)+"%</strong>&nbsp;&nbsp;&nbsp;四周后涨幅:&nbsp;<strong style=\'color:"+this.GetColor(n.ExtendData.FWeek.Week4.toFixed(2))+";\'>"+n.ExtendData.FWeek.Week4.toFixed(2)+"%</strong></i></span>"}else{var I;i+="<span>"+(S=(I=s.toString()).substring(0,4)+"-"+I.substring(4,6)+"-"+I.substring(6,8))+"&nbsp;&nbsp;&nbsp;"+n.Title+"</span>"}}var F=$(".title-length").html(i);$("#"+this.ID).html(F),e.length>8&&$("#"+this.ID).append(a)},this.GetColor=function(t){return t>0?this.UpColor:t<0?this.DownColor:this.UnchagneColor},this.Show=function(t,e,a,i,r,n){$("#"+this.ID).css({display:"block",top:e+"px",left:t+"px",width:a+"px",height:i+"px"}),null!=this.TimeOut&&clearTimeout(this.TimeOut),this.TimeOut=setTimeout(function(){r.Hide()},n)},this.DoModal=function(t){var e=t.data.Chart,a=t.data.InfoType,i=t.data.InfoList,r=e.KLineInfoTooltip;if(r){null==r.ID&&r.Create(),r.BindInfoList(a,i);var n=t.pageX,s=t.pageY+10;$("#"+r.ID).height();n+380>e.UIElement.getBoundingClientRect().width&&(n-=380),r.Show(n,s,380,"auto",r,8e3)}},this.Leave=function(t){var e=t.data.Chart.KLineInfoTooltip;e&&null!=e.ID&&e.Hide()}}function MinuteDialog(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.JSChart=null,this.Height=500,this.Width=600,this.Symbol,this.TradeDate,this.HistoryData,this.Create=function(){this.ID=Guid();var t=document.createElement("div");t.className="jchart-kline-minute-box",t.id=this.ID;var e=Guid();t.innerHTML=`<div><div class=\'minute-dialog-title\'><span></span><strong class=\'close-munite icon iconfont icon-close\'></strong></div><div class=\'minute-hqchart\' id=\'${e}\' ></div></div>`,t.style.width=this.Height+"px",t.style.height=this.Width+"px",this.DivElement.appendChild(t),this.JSChart=JSChart.Init(document.getElementById(e));var a={Type:"历史分钟走势图",Symbol:this.Symbol,IsAutoUpdate:!1,IsShowRightMenu:!1,HistoryMinute:{TradeDate:this.TradeDate,IsShowName:!1,IsShowDate:!1}};this.JSChart.SetOption(a)},this.BindClose=function(t){$("#"+this.ID+" .close-munite").click({Chart:t},function(t){t.data.Chart.MinuteDialog.Hide()})},this.DoModal=function(t){this.UpColor=g_JSChartResource.UpTextColor,this.DownColor=g_JSChartResource.DownTextColor,this.UnchagneColor=g_JSChartResource.UnchagneTextColor;var e=t.data.Chart,a=t.data.Tooltip,i=e.MinuteDialog;if(i.Symbol=e.Symbol,i.TradeDate=a.Data.Date,i){null==i.ID?i.Create():(i.JSChart.JSChartContainer.TradeDate=i.TradeDate,i.JSChart.ChangeSymbol(this.Symbol));t.clientX,t.clientY;i.Show(500,100,600,500),i.JSChart.OnSize(),this.BindClose(e),this.GetColor=function(t,e){return t>e?this.UpColor:t<e?this.DownColor:this.UnchagneColor};var r=t.data.Chart.Name,n=t.data.Tooltip.Data,s=(new Date(parseInt(n.Date/1e4),n.Date/100%100-1,n.Date%100),n.Date.toString()),o="<span>"+r+"</span><span>"+(s.substring(0,4)+"-"+s.substring(4,6)+"-"+s.substring(6,8))+"</span>&nbsp;<span style=\'color:"+this.GetColor(n.Open,n.YClose)+";\'>开:"+n.Open.toFixed(2)+"</span><span style=\'color:"+this.GetColor(n.High,n.YClose)+";\'>高:"+n.High.toFixed(2)+"</span><span style=\'color:"+this.GetColor(n.Low,n.YClose)+";\'>低:"+n.Low.toFixed(2)+"</span><span style=\'color:"+this.GetColor(n.Close,n.YClose)+";\'>收:"+n.Close.toFixed(2)+"</span><span style=\'color:"+this.VolColor+";\'>量:"+IFrameSplitOperator.FormatValueString(n.Vol,2)+"</span><span style=\'color:"+this.AmountColor+";\'>额:"+IFrameSplitOperator.FormatValueString(n.Amount,2)+"</span>";$(".minute-dialog-title span").html(o)}}}function KLineSelectRectDialog(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.SelectData,this.Dialog,this.HQChart,this.Close=function(){this.Dialog&&(this.DivElement.removeChild(this.Dialog),this.Dialog=null),this.HQChart.HideSelectRect()},this.Create=function(){this.ID=Guid();var t=document.createElement("div");t.className="jchart-select-statistics-box",t.id=this.ID,t.innerHTML="<div class=\'parameter jchart-select-section\'>            <div class=\'parameter-header\'>                <span>区间统计</span>                <strong id=\'close\' class=\'icon iconfont icon-close\'></strong>            </div>            <div class=\'parameter-content\'>统计数据</div>        <div class=\'parameter-footer\'>            <button id=\'close\' class=\'submit\' >确定</button>            <button id=\'match\' class=\'submit\' >形态匹配</button>        </div>        </div>",this.DivElement.appendChild(t),this.Dialog=t,$("#"+this.ID+" #close").click({divBox:this},function(t){t.data.divBox.Close()}),$("#"+this.ID+" #match").click({divBox:this},function(t){t.data.divBox.KLineMatch()})},this.BindData=function(){for(var t=this.SelectData.Data,e=this.SelectData.Start,a=this.SelectData.End,i={Open:0,Close:0,High:0,Low:0,YClose:0,Vol:0,Amount:0,Date:{Start:{Time:null,Date:null},End:{Time:null,Date:null}},Count:0,KLine:{Up:0,Down:0,Unchanged:0}},r=e;r<=a&&r<t.Data.length;++r){var n=t.Data[r];r==e&&(i.Date.Start.Date=n.Date,i.Date.Start.Time=n.Time,i.Open=n.Open,i.High=n.High,i.Low=n.Low,i.YClose=n.YClose),i.Date.End.Date=n.Date,i.Date.End.Time=n.Time,i.Close=n.Close,i.Vol+=n.Vol,i.Amount+=n.Amount,++i.Count,i.High<n.High&&(i.High=n.High),i.Low>n.Low&&(i.Low=n.Low),n.Close>n.Open?++i.KLine.Up:n.Close<n.Open?++i.KLine.Down:++i.KLine.Unchanged}i.Vol>0&&(i.AvPrice=i.Amount/i.Vol),n.YClose>0&&(i.Increase=(i.Close-i.YClose)/i.YClose*100,i.Amplitude=(i.High-i.Low)/i.YClose*100);var s=GetfloatPrecision(this.SelectData.Symbol),o=IFrameSplitOperator.FormatDateString(i.Date.Start.Date),h=IFrameSplitOperator.FormatDateString(i.Date.End.Date);ChartData.IsMinutePeriod(this.HQChart.Period)&&(o+=" "+IFrameSplitOperator.FormatTimeString(i.Date.Start.Time,"HH:MM"),h+=" "+IFrameSplitOperator.FormatTimeString(i.Date.End.Time,"HH:MM"));var l="",C="",u="",D="";e<=0&&(l="BtnBackground"),e>=a&&(C="BtnBackground",u="BtnBackground"),a>=t.Data.length-1&&(D="BtnBackground");var d=document.createElement("div");d.className="jchart-select-table-right",d.innerHTML=\'<div class="jchart-select-date">            <span>开始: \'+o+\'<i class="start-date-left \'+l+\'"><</i><i class="start-date-right \'+C+\'">></i></span>            <span>结束: \'+h+\'<i class="end-date-left \'+u+\'"><</i><i class="end-date-right \'+D+\'">></i></span>            <span>总个数: \'+i.Count+"</span>        </div>        <table>            <tr><td><strong>起始价: </strong><span>"+i.YClose.toFixed(s)+"</span></td>               <td><strong>最终价: </strong><span>"+i.Close.toFixed(s)+"</span></td>               <td><strong>均价: </strong><span>"+i.AvPrice.toFixed(s)+"</span></td></tr>            <tr><td><strong>最低价: </strong><span>"+i.Low.toFixed(s)+"</span></td>               <td><strong>最高价: </strong><span>"+i.High.toFixed(s)+\'</span></td>               <td><strong>涨跌幅: </strong><span class="\'+IFrameSplitOperator.FormatValueColor(i.Increase)+\'">\'+i.Increase.toFixed(2)+"%</span></td></tr>            <tr><td><strong>振幅: </strong><span>"+i.Amplitude.toFixed(2)+"%</span></td>               <td><strong>成交量: </strong><span>"+IFrameSplitOperator.FormatValueString(i.Vol,2)+"股</span></td>               <td><strong>金额: </strong><span>"+IFrameSplitOperator.FormatValueString(i.Amount,2)+"元</span></td></tr>            <tr><td><strong>阴线: </strong><span>"+i.KLine.Up+"</span></td>               <td><strong>阳线: </strong><span>"+i.KLine.Down+"</span></td>               <td><strong>平线: </strong><span>"+i.KLine.Unchanged+"</span></td></tr>        </table>",$(".parameter-content").html(d),this.BindEvent()},this.BindEvent=function(){var t=this;t.SelectData.Start>0&&$(".jchart-select-date .start-date-left").click(function(){t.SelectData.Start--,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)}),t.SelectData.Start<t.SelectData.End&&($(".jchart-select-date .start-date-right").click(function(){t.SelectData.Start++,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)}),$(".jchart-select-date .end-date-left").click(function(){t.SelectData.End--,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)})),t.SelectData.End<t.SelectData.Data.Data.length-1&&$(".jchart-select-date .end-date-right").click(function(){t.SelectData.End++,t.BindData(),t.HQChart.UpdateSelectRect(t.SelectData.Start,t.SelectData.End)})},this.DoModal=function(t){var e=t.data.Chart;null==this.ID&&this.Create(),this.SelectData=t.data.SelectData,this.HQChart=e,this.BindData(),this.Show()},this.KLineMatch=function(t){var e=new WaitDialog(this.DivElement);e.DoModal({data:{Title:"计算中......",Chart:this.HQChart}}),this.Close();var a={Scope:{Plate:["CNA.ci"],Minsimilar:.9},WaitDialog:e};this.HQChart.RequestKLineMatch(this.SelectData,a)}}function KLineMatchDialog(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.MatchData,this.Sample,this.Dialog,this.HQChart,this.PageData,this.Close=function(){this.DivElement.removeChild(this.Dialog)},this.Create=function(){this.ID=Guid();var t=document.createElement("div");t.className="jchart-kline-match-box",t.id=this.ID,t.innerHTML="<div class=\'parameter jchart-kline-match-box\'>            <div class=\'parameter-header\'>                <span>形态匹配</span>                <strong id=\'close\' class=\'icon iconfont icon-close\'></strong>            </div>            <div class=\'parameter-content\'>                <p class=\'dataCount\'></p>                <table class=\'matchTable\'>                    <thead>                        <tr>                            <td>股票名称</td>                            <td>匹配度</td>                            <td>时间段</td>                        </tr>                    </thead>                    <tbody>                    </tbody>                </table>                <div class=\'pagination\' data-current=\'1\'></div>            </div>            <div class=\'parameter-footer\'>                <button id=\'close\' class=\'submit\' >确定</button>            </div>        </div>".trim(),this.DivElement.appendChild(t),this.Dialog=t,$("#"+this.ID+" #close").click({divBox:this},function(t){t.data.divBox.Close()})},this.BindData=function(){JSConsole.Chart.Log(`[KLineMatchDialog::BindData] 形态源: ${this.Sample.Stock.Name} 区间:${this.Sample.Date.Start} - ${this.Sample.Date.End}`);var t=this.MatchData.length+1,e={NewData:{},MetaData:[],PageCount:0,Count:t},a=0;$("#"+this.ID+" .dataCount").html("个数："+t);for(var i=0;i<t;i++){var r={};if(0==i)r={Symbol:this.Sample.Stock.Symbol,Name:this.Sample.Stock.Name,Rate:"形态源",Color:"red",Date:`${this.Sample.Date.Start}-${this.Sample.Date.End}`};else{let t=this.MatchData[i-1];r={Symbol:t.Symbol,Name:t.Name,Rate:Number(100*t.Similar).toFixed(2),Color:"",Date:`${t.Start}-${t.End}`}}e.MetaData.push(r)}a=e.Count%10==0?e.Count/10:Math.floor(e.Count/10)+1,e.PageCount=a,this.PaginationMetaData(e),this.PageData=e,JSConsole.Chart.Log("[KLineMatchDialog::DoModal pageData]",e),this.RenderDom(1),this.PaginationInit("#"+this.ID,e.PageCount,this.paginationCallback)},this.RenderDom=function(t){let e=this.PageData.NewData[t];JSConsole.Chart.Log("[KLineMatchDialog::RenderDom currentPageData]",e);let a="";for(var i=0;i<e.length;i++)a+=`<tr>                        <td class=${e[i].Color}>${e[i].Name}</td>                        <td class=${e[i].Color}>${e[i].Rate}</td>                        <td class=${e[i].Color}>${e[i].Date}</td>                    </tr>`.trim();$("#"+this.ID+" .matchTable tbody").html(a)};var e=this;this.paginationCallback=function(t){e.RenderDom(t),e.PaginationInit("#"+e.ID,e.PageData.PageCount,e.paginationCallback)},this.PaginationInit=function(t,e,a){var i="",r=$(t+" .pagination").data("current"),n=0;if(r<5)if(e>=5)for(var s=0;s<5;s++)i+=s+1!=r?"<span>"+(s+1)+"</span>":"<span class=\'active\'>"+(s+1)+"</span>";else for(s=0;s<e;s++)i+=s+1!=r?"<span>"+(s+1)+"</span>":"<span class=\'active\'>"+(s+1)+"</span>";else{n=r+1>e?r:r+1;for(var o=r-3;o<=n;o++)i+=o!=r?"<span>"+o+"</span>":"<span class=\'active\'>"+o+"</span>"}i="<span class=\'beforePage\'>上一页</span>"+i+"<span class=\'nextPage\'>下一页</span>",$(t+" .pagination").html(i),$(t+" .pagination span").bind("click",{maxpage:e,Callback:a},this.PaginationCurrentIndex)},this.PaginationCurrentIndex=function(t){var e=$(this).text();JSConsole.Chart.Log("[::PaginationCurrentIndex text]",e);var a=Number($(this).parent().data("current")),i=t.data.maxpage,r=t.data.Callback,n=1;n="上一页"===e?1===a?a:a-1:"下一页"===e?a===i?a:a+1:Number(e),$(this).parent().data("current",n),r(n)},this.PaginationMetaData=function(t){for(var e={},a=t.MetaData,i=t.PageCount,r=0;r<i;r++){for(var n=[],s=0;s<10;s++){var o=10*r+s;if(!(o<=a.length-1))break;var h=a[o];n.push(h)}e[r+1]=n}t.NewData=e},this.DoModal=function(t){var e=t.data.Chart;null==this.ID&&this.Create(),this.MatchData=t.data.MatchData,this.Sample=t.data.Sample,this.HQChart=e,this.BindData();var a=e.Frame.ChartBorder,i=(GetScrollPosition(),a.GetWidth()/2),r=a.GetHeight()/2;this.Show(i,r,200,200)}}function WaitDialog(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.Title="加载中......",this.Dialog,this.Close=function(){this.Dialog&&(this.DivElement.removeChild(this.Dialog),this.Dialog=null)},this.SetTitle=function(t){this.Title=t,this.Dialog},this.Create=function(){this.ID=Guid();var t=document.createElement("div");t.className="jchart-wait-box",t.id=this.ID,t.innerHTML=`<div class=\'parameter jchart-kline-match-box\'>            <div class=\'parameter-header\'>                <span>${this.Title}</span>            </div>        </div>`.trim(),this.DivElement.appendChild(t),this.Dialog=t},this.DoModal=function(t){this.Title=t.data.Title;var e=t.data.Chart;null==this.ID&&this.Create();var a=e.Frame.ChartBorder,i=(GetScrollPosition(),a.GetWidth()/2),r=a.GetHeight()/2;this.Show(i,r,200,40)}}function KLineRightMenu(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.option={},this.Create=function(){this.ID=Guid(),this.BindData(),this.BindEvent()},this.BindData=function(){var t=this.DivElement.id,e=$("#"+t);e.find("div[id^=\'topMenu_\']").remove(),e.find("div[id^=\'childMenu_\']").remove();var a=$("<div />");a.attr("id","topMenu_"+this.ID).addClass("context-menu-wrapper topmenu").hide(),e.append(a);var i=$("<table />");i.attr({id:"topTable_"+this.ID,cellspacing:"0",cellpadding:"0"}).addClass("context-menu"),a.append(i),i.append(this.childrenList(this.option.data));for(var r=0;r<this.option.data.length;r++){if(void 0!==this.option.data[r].children){var n=$("<div />");n.attr({id:"childMenu_"+this.ID+r,"data-index":r}).addClass("context-menu-wrapper").hide(),e.append(n);var s=$("<table />");s.attr({id:"childTable_"+this.ID+r,cellspacing:"0",cellpadding:"0"}).addClass("context-menu"),n.append(s),s.append(this.childrenList(this.option.data[r].children))}}},this.Update=function(){this.BindData(),this.BindEvent()},this.childrenList=function(t){for(var e=[],a=0;a<t.length;a++){var i=void 0!==t[a].isBorder&&t[a].isBorder,r=$("<tr />");r.addClass("font_Arial context-menu"),i&&r.addClass("border");var n=$("<td />");t[a].selected?n.addClass("spacer context-menu").html("√"):n.addClass("spacer context-menu");var s=$("<td />");s.addClass("text").html(t[a].text);var o=$("<td />");o.addClass("right shortcut");var h=$("<td />");h.addClass(void 0!==t[a].children?"submenu-arrow":"context-menu spacer"),r.append(n).append(s).append(o).append(h),e.push(r)}return e},this.Show=function(t){$.extend(this.option,t),this.ID?this.Update():this.Create();var e=$("#topMenu_"+this.ID),a=e.outerWidth(),i=e.outerHeight(),r=this.option.x,n=this.option.y;a>this.option.position.X+this.option.position.W-r&&(r-=a),i>this.option.position.Y+this.option.position.H-n&&(n-=i),e.hide(),e.css({position:"absolute",left:r+"px",top:n+"px"}).show(),this.isInit=!0},this.Hide=function(){$("#topMenu_"+this.ID).hide(),$("[id^=\'childMenu_"+this.ID+"\']").hide()},this.BindEvent=function(){var t=this,e=$("[id^=\'childMenu_"+t.ID+"\']");$("#topTable_"+t.ID).find("tr").mouseenter(function(){var a=$(this),i=a.index(),r=$("#topMenu_"+t.ID),n=$("#childMenu_"+t.ID+i),s=a.outerWidth(),o=a.outerHeight(),h=r.position().left+s+1,l=r.position().top+o*i;s>t.option.position.X+t.option.position.W-h&&(h=h-s-r.outerWidth()-2),n.outerHeight()>t.option.position.Y+t.option.position.H-l&&(l=r.position().top+r.outerHeight()-n.outerHeight()),e.hide(),n.css({left:h+"px",top:l+"px"}).show()}).mouseleave(function(){var e=$(this).index();setTimeout(function(){1!=$("#childMenu_"+t.ID+e).attr("data-isShow")&&$("#childMenu_"+t.ID+e).hide()},10)}).click(function(){var e=$(this),a=e.index();"function"==$.type(t.option.data[a].click)&&(t.option.data[a].click(t.option.returnData),e.hide())}).contextmenu(function(){return!1}),e.mouseenter(function(){$(this).attr("data-isShow","1")}).mouseleave(function(){$(this).attr("data-isShow","0")}).contextmenu(function(){return!1}),e.find("tr").click(function(){var a=$(this),i=parseInt(a.closest("div").attr("data-index")),r=a.index();"function"==$.type(t.option.data[i].children[r].click)&&(t.option.data[i].children[r].click(t.option.windowIndex||1),e.hide())})},this.GetPeriod=function(t){var e=[{text:"日线",Value:0,click:function(){t.ChangePeriod(0)}},{text:"周线",Value:1,click:function(){t.ChangePeriod(1)}},{text:"双周线",Value:21,click:function(){t.ChangePeriod(21)}},{text:"月线",Value:2,click:function(){t.ChangePeriod(2)}},{text:"季线",Value:9,click:function(){t.ChangePeriod(9)}},{text:"年线",Value:3,click:function(){t.ChangePeriod(3)}},{text:"1分",Value:4,click:function(){t.ChangePeriod(4)}},{text:"5分",Value:5,click:function(){t.ChangePeriod(5)}},{text:"15分",Value:6,click:function(){t.ChangePeriod(6)}},{text:"30分",Value:7,click:function(){t.ChangePeriod(7)}},{text:"60分",Value:8,click:function(){t.ChangePeriod(8)}},{text:"2小时",Value:11,click:function(){t.ChangePeriod(11)}},{text:"4小时",Value:12,click:function(){t.ChangePeriod(12)}},{text:"分笔",Value:10,click:function(){t.ChangePeriod(10)}},{text:"自定义周期:3分钟",Value:20003,click:function(){t.ChangePeriod(20003)}},{text:"自定义周期:35分钟",Value:20035,click:function(){t.ChangePeriod(20035)}},{text:"自定义周期:8日",Value:40008,click:function(){t.ChangePeriod(40008)}}];for(var a in e){var i=e[a];if(i.Value==t.Period){i.selected=!0;break}}return e},this.GetRight=function(t){var e=[{text:"不复权",click:function(){t.ChangeRight(0)}},{text:"前复权",click:function(){t.ChangeRight(1)}},{text:"后复权",click:function(){t.ChangeRight(2)}}];return t.Right>=0&&t.Right<e.length&&(e[t.Right].selected=!0),e},this.GetIndex=function(t){return[{text:"均线",click:function(e){t.ChangeIndex(e,"均线")}},{text:"BOLL",click:function(e){t.ChangeIndex(e,"BOLL")},isBorder:!0},{text:"MACD",click:function(e){t.ChangeIndex(e,"MACD")}},{text:"KDJ",click:function(e){t.ChangeIndex(e,"KDJ")}},{text:"VOL",click:function(e){t.ChangeIndex(e,"VOL")}},{text:"RSI",click:function(e){t.ChangeIndex(e,"RSI")}},{text:"BRAR",click:function(e){t.ChangeIndex(e,"BRAR")}},{text:"WR",click:function(e){t.ChangeIndex(e,"WR")}},{text:"BIAS",click:function(e){t.ChangeIndex(e,"BIAS")}},{text:"OBV",click:function(e){t.ChangeIndex(e,"OBV")}},{text:"DMI",click:function(e){t.ChangeIndex(e,"DMI")}},{text:"CR",click:function(e){t.ChangeIndex(e,"CR")}},{text:"PSY",click:function(e){t.ChangeIndex(e,"PSY")}},{text:"CCI",click:function(e){t.ChangeIndex(e,"CCI")}},{text:"DMA",click:function(e){t.ChangeIndex(e,"DMA")}},{text:"TRIX",click:function(e){t.ChangeIndex(e,"TRIX")}},{text:"VR",click:function(e){t.ChangeIndex(e,"VR")}},{text:"EMV",click:function(e){t.ChangeIndex(e,"EMV")}},{text:"ROC",click:function(e){t.ChangeIndex(e,"ROC")}},{text:"MIM",click:function(e){t.ChangeIndex(e,"MIM")}},{text:"FSL",click:function(e){t.ChangeIndex(e,"FSL")}}]},this.GetColorIndex=function(t){var e=[{text:"十字星",click:function(e){t.ChangeInstructionIndex("五彩K线-十字星")}},{text:"早晨之星",click:function(e){t.ChangeInstructionIndex("五彩K线-早晨之星")}},{text:"垂死十字",click:function(e){t.ChangeInstructionIndex("五彩K线-垂死十字")}},{text:"三只乌鸦",click:function(e){t.ChangeInstructionIndex("五彩K线-三只乌鸦")}},{text:"光脚阴线",click:function(e){t.ChangeInstructionIndex("五彩K线-光脚阴线")}},{text:"黄昏之星",click:function(e){t.ChangeInstructionIndex("五彩K线-黄昏之星")}}];return t.ColorIndex&&(e[e.length-1].isBorder=!0,e.push({text:"删除五彩K线",click:function(e){t.CancelInstructionIndex()}})),e},this.GetTradeIndex=function(t){var e=[{text:"BIAS",click:function(e){t.ChangeInstructionIndex("交易系统-BIAS")}},{text:"CCI",click:function(e){t.ChangeInstructionIndex("交易系统-CCI")}},{text:"DMI",click:function(e){t.ChangeInstructionIndex("交易系统-DMI")}},{text:"KD",click:function(e){t.ChangeInstructionIndex("交易系统-KD")}},{text:"BOLL",click:function(e){t.ChangeInstructionIndex("交易系统-BOLL")}},{text:"KDJ",click:function(e){t.ChangeInstructionIndex("交易系统-KDJ")}}];return t.TradeIndex&&(e[e.length-1].isBorder=!0,e.push({text:"删除专家系统",click:function(e){t.CancelInstructionIndex()}})),e},this.GetOverlay=function(t){var e=[{text:"上证指数",click:function(){t.OverlaySymbol("000001.sh")}},{text:"深证成指",click:function(){t.OverlaySymbol("399001.sz")}},{text:"中小板指",click:function(){t.OverlaySymbol("399005.sz")}},{text:"创业板指",click:function(){t.OverlaySymbol("399006.sz")}},{text:"沪深300",click:function(){t.OverlaySymbol("000300.sh")}}];for(var a in t.OverlayChartPaint){var i=t.OverlayChartPaint[a].Symbol;const n=new Map([["000001.sh",0],["399001.sz",1],["399005.sz",2],["399006.sz",3],["000300.sh",4]]);if(n.has(i)){var r=e[n.get(i)];let a=i;r.selected=!0,r.click=function(){t.DeleteOverlaySymbol(a)}}}return t.OverlayChartPaint&&t.OverlayChartPaint.length>0&&(e[e.length-1].isBorder=!0,e.push({text:"取消叠加",click:function(){t.ClearOverlaySymbol()}})),e},this.GetKLineType=function(t){var e=[{text:"K线(空心阳线)",click:function(){t.ChangeKLineDrawType(3)}},{text:"K线(实心阳线)",click:function(){t.ChangeKLineDrawType(0)}},{text:"美国线",click:function(){t.ChangeKLineDrawType(2)}},{text:"收盘线",click:function(){t.ChangeKLineDrawType(1)}},{text:"收盘面积",click:function(){t.ChangeKLineDrawType(4)}}];switch(t.KLineDrawType){case 0:e[1].selected=!0;break;case 1:e[3].selected=!0;break;case 2:e[2].selected=!0;break;case 3:e[0].selected=!0;break;case 4:e[4].selected=!0}return e},this.GetIndexWindowCount=function(t){var e=[{text:"1个窗口",click:function(){t.ChangeIndexWindowCount(1)}},{text:"2个窗口",click:function(){t.ChangeIndexWindowCount(2)}},{text:"3个窗口",click:function(){t.ChangeIndexWindowCount(3)}},{text:"4个窗口",click:function(){t.ChangeIndexWindowCount(4)}},{text:"5个窗口",click:function(){t.ChangeIndexWindowCount(5)}}],a=t.Frame.SubFrame.length;return a-1>=0&&a-1<e.length&&(e[a-1].selected=!0),e},this.GetCoordinateType=function(t){var e=[{text:"普通坐标",click:function(){t.ChangeCoordinateType({Type:0})}},{text:"百分比坐标",click:function(){t.ChangeCoordinateType({Type:1})}},{text:"反转坐标",click:function(){t.ChangeCoordinateType({IsReverse:!0})}},{text:"对数坐标",click:function(){t.ChangeCoordinateType({Type:2})}}];return t.Frame&&t.Frame.SubFrame&&t.Frame.SubFrame.length>0&&(1==t.Frame.SubFrame[0].Frame.CoordinateType&&(e[2].selected=!0,e[2].click=function(){t.ChangeCoordinateType({IsReverse:!1})}),1==t.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType?e[1].selected=!0:0==t.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType?e[0].selected=!0:2==t.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType&&(e[3].selected=!0)),e},this.GetDragModeType=function(t){var e=[{text:"禁止拖拽",click:function(){t.DragMode=0}},{text:"启动拖拽",click:function(){t.DragMode=1}},{text:"区间选择",click:function(){t.DragMode=2}}];return t.DragMode>=0&&t.DragMode<e.length&&(e[t.DragMode].selected=!0),e},this.GetTools=function(t){var e=[],a=t.GetExtendChartByClassName("DrawToolsButton");a?e.push({text:"关闭画图工具",click:function(){for(var e=a.Chart.Width,i=parseInt(a.Index)+1;i<t.ExtendChartPaint.length;++i){var r=t.ExtendChartPaint[i];"StockChip"==r.ClassName&&(r.Left-=e)}t.DeleteExtendChart(a),t.Frame.ChartBorder.Right-=e,t.SetSizeChage(!0),t.Draw()}}):e.push({text:"画图工具",click:function(){var e={Name:"画图工具",Top:t.Frame.ChartBorder.Top};t.CreateExtendChart(e.Name,e);t.SetSizeChage(!0),t.Draw()}});var i=t.GetExtendChartByClassName("StockChip");return i?e.push({text:"关闭移动筹码",click:function(){for(var e=i.Chart.Width,a=parseInt(i.Index)+1;a<t.ExtendChartPaint.length;++a){var r=t.ExtendChartPaint[a];"DrawToolsButton"==r.ClassName&&(r.Left-=e)}t.DeleteExtendChart(i),t.Frame.ChartBorder.Right-=e,t.SetSizeChage(!0),t.Draw()}}):e.push({text:"移动筹码",click:function(){var e={Name:"筹码分布",ShowType:1,Width:230};t.CreateExtendChart(e.Name,e);t.SetSizeChage(!0),t.Draw()}}),e},this.GetKLineInfo=function(t){var e=new Set;for(var a in t.ChartInfo){var i=t.ChartInfo[a];e.add(i.ClassName)}var r=["公告","业绩预告","调研","大宗交易","龙虎榜","互动易"],n=[];for(var a in r){var s=r[a],o=JSKLineInfoMap.GetClassInfo(s);if(o){i=this.CreateKlineInfoItem(s,e.has(o.ClassName),t);n.push(i)}}if(t.ChartInfo.length>0){n[n.length-1].isBorder=!0;i={text:"删除所有",click:function(){t.ClearKLineInfo()}};n.push(i)}return n},this.CreateKlineInfoItem=function(t,e,a){var i={text:t,selected:e};return i.click=e?function(){a.DeleteKLineInfo(t)}:function(){a.AddKLineInfo(t,!0)},i},this.DoModal=function(t){var e=t.data.Chart,a=e.RightMenu,i=t.offsetX,r=t.offsetY,n=[{text:"分析周期",children:this.GetPeriod(e)},{text:"复权处理",children:this.GetRight(e)},{text:"指标切换",children:this.GetIndex(e)},{text:"五彩K线",children:this.GetColorIndex(e)},{text:"专家系统",children:this.GetTradeIndex(e)},{text:"信息地雷",children:this.GetKLineInfo(e)},{text:"叠加品种",children:this.GetOverlay(e)},{text:"主图线型",children:this.GetKLineType(e)},{text:"坐标类型",children:this.GetCoordinateType(e)},{text:"指标窗口个数",children:this.GetIndexWindowCount(e)},{text:"鼠标拖拽",children:this.GetDragModeType(e)},{text:"工具",children:this.GetTools(e)}],s=e.Symbol.toUpperCase();(MARKET_SUFFIX_NAME.IsSHSZIndex(e.Symbol)||MARKET_SUFFIX_NAME.IsBIT(s))&&n.splice(1,1);var o=t.data.FrameID,h=this.GetOverlayIndex(e,o);if(h&&h.length>0){var l={text:"删除叠加指标",children:this.GetDeleteOverlayIndex(e,h)};n.splice(3,0,l)}JSConsole.Chart.Log("[KLineRightMenu::DoModal]",o),a.Show({windowIndex:o,x:i+e.UIElement.offsetLeft,y:r+e.UIElement.offsetTop,position:e.Frame.Position,data:n}),$(document).click(function(){a.Hide()})},this.GetOverlayIndex=function(t,e){if(e>=t.Frame.SubFrame.length)return[];var a=[],i=t.Frame.SubFrame[e];for(var r in i.OverlayIndex){var n=i.OverlayIndex[r];a.push({Name:n.Script.Name,Identify:n.Identify})}return a},this.GetDeleteOverlayIndex=function(t,e){var a=[];for(var i in e){let r=e[i].Identify;a.push({text:e[i].Name,click:function(){t.DeleteOverlayWindowsIndex(r)}})}return a}}function KLineSelectRightMenu(t){this.newMethod=KLineRightMenu,this.newMethod(t),delete this.newMethod,this.DoModal=function(e){var a=e.data.Chart,i=this,r=e.data.X,n=e.data.Y,s=[{text:"区间统计",click:function(){JSConsole.Chart.Log("[KLineSelectRightMenu::click] 区间统计"),i.Hide(),new KLineSelectRectDialog(t).DoModal(e)}},{text:"区间放大",click:function(){JSConsole.Chart.Log("[KLineSelectRightMenu::click] 区间放大"),e.data.Chart.ShowSelectData(e.data.SelectData)}}];i.Show({x:r,y:n,position:a.Frame.Position,data:s})},this.Show=function(t){$.extend(this.option,t),this.ID||this.Create();var e="topMenu_"+this.ID;document.getElementById(e)||this.Create();var a=$("#topMenu_"+this.ID),i=a.outerWidth(),r=a.outerHeight();a.contextmenu(function(){return!1});var n=this.option.x,s=this.option.y;i>this.option.position.X+this.option.position.W-n&&(n-=i),r>this.option.position.Y+this.option.position.H-s&&(s-=r),a.hide(),a.css({position:"absolute",left:n+"px",top:s+"px"}).show(),$("#topMenu_"+this.ID).find("tr").show(),this.isInit=!0}}function MinuteRightMenu(t){this.newMethod=KLineRightMenu,this.newMethod(t),delete this.newMethod,this.DoModal=function(t){var e=t.data.Chart,a=e.RightMenu,i=t.offsetX,r=t.offsetY,n=[{text:"叠加品种",children:this.GetOverlay(e)},{text:"多日分时图",children:this.GetDayCount(e)},{text:"指标窗口个数",children:this.GetIndexWindowCount(e)},{text:"副图指标切换",children:this.GetIndex(e)}],s=e.Symbol;MARKET_SUFFIX_NAME.IsSHSZStockA(s)&&n.push({text:"集合竞价",children:this.GetShowBeforeData(e)});var o=t.data.FrameID;JSConsole.Chart.Log("[MinuteRightMenu::DoModal]",o),a.Show({windowIndex:o,x:i+e.UIElement.offsetLeft,y:r+e.UIElement.offsetTop,position:e.Frame.Position,data:n}),$(document).click(function(){a.Hide()})},this.GetDayCount=function(t){var e=[{text:"当日分时图",click:function(){t.ChangeDayCount(1)},isBorder:!0},{text:"最近2日",click:function(){t.ChangeDayCount(2)}},{text:"最近3日",click:function(){t.ChangeDayCount(3)}},{text:"最近4日",click:function(){t.ChangeDayCount(4)}},{text:"最近5日",click:function(){t.ChangeDayCount(5)}},{text:"最近6日",click:function(){t.ChangeDayCount(6)}}];return t.DayCount-1>=0&&t.DayCount-1<e.length&&(e[t.DayCount-1].selected=!0),e},this.GetIndex=function(t){return[{text:"MACD",click:function(e){t.ChangeIndex(e,"MACD")}},{text:"DMI",click:function(e){t.ChangeIndex(e,"DMI")}},{text:"DMA",click:function(e){t.ChangeIndex(e,"DMA")}},{text:"BRAR",click:function(e){t.ChangeIndex(e,"BRAR")}},{text:"KDJ",click:function(e){t.ChangeIndex(e,"KDJ")}},{text:"RSI",click:function(e){t.ChangeIndex(e,"RSI")}},{text:"WR",click:function(e){t.ChangeIndex(e,"WR")}},{text:"CCI",click:function(e){t.ChangeIndex(e,"CCI")}},{text:"TRIX",click:function(e){t.ChangeIndex(e,"TRIX")}}]},this.GetShowBeforeData=function(t){return t.IsShowBeforeData?[{text:"隐藏",click:function(){t.ShowBeforeData(!1)}}]:[{text:"显示",click:function(){t.ShowBeforeData(!0)}}]},this.GetIndexWindowCount=function(t){var e=[{text:"1个窗口",click:function(){t.ChangeIndexWindowCount(2)}},{text:"2个窗口",click:function(){t.ChangeIndexWindowCount(3)}},{text:"3个窗口",click:function(){t.ChangeIndexWindowCount(4)}}],a=t.Frame.SubFrame.length-1;return a-1>=0&&a-1<e.length&&(e[a-1].selected=!0),e}}function ChartPictureSettingMenu(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.HQChart,this.ChartPicture,this.SubToolsDiv,this.SettingMenu,this.DoModal=function(t){if(!this.SubToolsDiv){this.ID=Guid();var e=document.createElement("div");e.className="subTolls",e.id=this.ID,this.DivElement.appendChild(e),this.SubToolsDiv=e}this.HQChart=t.data.HQChart,this.ChartPicture=t.data.ChartPicture;var a=GetDevicePixelRatio(),i=this.HQChart.Frame.SubFrame[0].Frame,r=i.ChartBorder.Top+40,n=i.ChartBorder.Right,s=i.ChartBorder.GetLeft(),o="";o="ChartDrawPictureText"===this.ChartPicture.ClassName?\'<span class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="\'+this.ChartPicture.LineColor+\'"></span><span class="subtool-set" title="设置"><i class="iconfont icon-shezhi"></i></span><span class="subtool-del"><i class="iconfont icon-recycle_bin"></i></span>\':\'<p class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="\'+this.ChartPicture.LineColor+\'"></p>        <p class="subtool-del"><i class="iconfont icon-recycle_bin"></i></p>\',this.SubToolsDiv.style.right=n/a+"px",this.SubToolsDiv.style.top=r/a+"px",this.SubToolsDiv.innerHTML=o,this.SubToolsDiv.style.position="absolute",this.SubToolsDiv.style.display="block";var h=this.HQChart,l=this.ChartPicture;this.SubToolsDiv;$(".subtool-del").click(function(){h.ClearChartDrawPicture(l),$(".subTolls").css("display","none")});var C=this;$(".subtool-set").click(function(){$(C.SubToolsDiv).hide(),this.SettingMenu||(C.SettingMenu=new ChartPictureTextSettingMenu(i.ChartBorder.UIElement.parentNode)),C.SettingMenu.ChartPicture=l,C.SettingMenu.HQChart=h,C.SettingMenu.Position={Left:n+80,Top:r+20},C.SettingMenu.DoModal()}),$(".changes-color").click(function(){document.getElementById("color").click(),$(".change-color").change(function(){var t=$(".change-color").val();l.LineColor=t,l.PointColor=t,h.ChartDrawStorage&&h.ChartDrawStorage.SaveDrawData(l)})}),JSConsole.Chart.Log("[ChartPictureSettingMenu::DoModal]",{Top:r,Left:s,Right:n})}}function ChartPictureTextSettingMenu(t){this.newMethod=IDivDialog,this.newMethod(t),delete this.newMethod,this.ChartPicture,this.SettingDiv,this.Position,this.BackupData,this.Close=function(){this.SettingDiv&&this.DivElement.removeChild(this.SettingDiv)},this.DoModal=function(){var t=this.ChartPicture.Text,e=this.ChartPicture.FontOption,a=this.ChartPicture.LineColor;this.BackupData={Text:t,LineColor:a,FontOption:{Family:e.Family,Size:e.Size,Weight:e.Weight,Style:e.Style}},JSConsole.Chart.Log("[ChartPictureTextSettingMenu::DoModal] picture info",this.BackupData);var i=this,r=this.DivElement.getElementsByClassName("chartpicture-text-setting")[0];r?this.SettingDiv=r:((r=document.createElement("div")).className="chartpicture-text-setting",this.DivElement.appendChild(r),this.SettingDiv=r);var n=[10,11,12,14,16,20,24,28,32,40],s=["微软雅黑","宋体","Arial","仿宋"],o="",h="";s.forEach(function(t,e){h+=0!==e?"<p>"+t+"</P>":\'<p class="active">\'+t+"</P>"}),n.forEach(function(t,e){o+=5!==e?"<p>"+t+"</P>":\'<p class="active">\'+t+"</P>"});var l=\'<div class="contentWrap"><div class="styleOptions"><span class="colorPicker"><input type="color" id="fontColor" value="#1e90ff"></span><div class="likeSelect fontSelect"><span class="choicedText">微软雅黑</span><div class="selectList">\'+h+\'</div><i class="iconfont icon-xia"></i></div><div class="likeSelect fontSizeSelect"><span class="choicedText">20</span><div class="selectList">\'+o+\'</div><i class="iconfont icon-xia"></i></div><span class="strongFont likeBtn"><i class="iconfont icon-jiacu"></i></span><span class="italicsFont likeBtn"><i class="iconfont icon-qingxieL"></i></span></div><textarea class="tArea" id="tArea" placeholder="Text"></textarea></div>\',C=GetDevicePixelRatio(),u=\'<div class="titleWrap"><span class="titleName">样式设置</span><i class="closeBtn iconfont icon-close"></i></div>\'+l+\'<div class="btnsContainer"><span class="okBtn btn">确认</span><span class="cancelBtn btn">取消</span></div>\';this.SettingDiv.style.left=this.Position.Left/C+"px",this.SettingDiv.style.top=this.Position.Top/C+"px",this.SettingDiv.innerHTML=u,this.SettingDiv.style.position="absolute",this.SettingDiv.style.display="block",$(".chartpicture-text-setting .colorPicker").css({borderColor:i.ChartPicture.LineColor,"background-color":i.ChartPicture.LineColor});var D=this.ChartPicture.FontOption.Family;$(".chartpicture-text-setting .fontSelect .choicedText").html(D),s.forEach(function(t,e){t==D&&($(".chartpicture-text-setting .fontSelect p").removeClass("active"),$(".chartpicture-text-setting .fontSelect p").eq(e).addClass("active"))});var d=this.ChartPicture.FontOption.Size;$(".chartpicture-text-setting .fontSizeSelect .choicedText").html(d),n.forEach(function(t,e){t==d&&($(".chartpicture-text-setting .fontSizeSelect p").removeClass("active"),$(".chartpicture-text-setting .fontSizeSelect p").eq(e).addClass("active"))});var c=this.ChartPicture.FontOption.Weight;null!=c&&"bold"==c&&$(".chartpicture-text-setting .strongFont").addClass("hot");var m=this.ChartPicture.FontOption.Style;null!=m&&"italic"==m&&$(".chartpicture-text-setting .italicsFont").addClass("hot");t=this.ChartPicture.Text;$(".chartpicture-text-setting .tArea").val(t);$(".chartpicture-text-setting #fontColor").change({Picture:this.ChartPicture},function(t){var e=$(this).val();$(this).parent().css({borderColor:e,"background-color":e});var a=t.data.Picture;a.LineColor=e,a.Update&&a.Update()}),$(".chartpicture-text-setting .fontSelect,.chartpicture-text-setting .fontSizeSelect").click(function(){$(this).find(".selectList").toggle(),$(this).toggleClass("hot")}),$(".chartpicture-text-setting .fontSelect p").click({Picture:this.ChartPicture},function(t){var e=$(this).closest(".fontSelect").find(".choicedText").html(),a=t.currentTarget.innerHTML;if(e!==a){$(this).closest(".fontSelect").find(".choicedText").html(a),$(this).siblings().removeClass("active"),$(this).addClass("active");var i=t.data.Picture;i.FontOption.Family=a,i.Update&&i.Update()}}),$(".chartpicture-text-setting .fontSizeSelect p").click({Picture:this.ChartPicture},function(t){var e=$(this).closest(".fontSizeSelect").find(".choicedText").html(),a=t.currentTarget.innerHTML;if(e!==a){$(this).closest(".fontSizeSelect").find(".choicedText").html(a),$(this).siblings().removeClass("active"),$(this).addClass("active");var i=t.data.Picture;i.FontOption.Size=Number(a),i.Update&&i.Update()}}),$(".chartpicture-text-setting .strongFont").click({Picture:this.ChartPicture},function(t){if($(this).toggleClass("hot"),$(this).attr("class").indexOf("hot")>0){var e=t.data.Picture;e.FontOption.Weight="bold",e.Update&&e.Update()}}),$(".chartpicture-text-setting .italicsFont").click({Picture:this.ChartPicture},function(t){if($(this).toggleClass("hot"),$(this).attr("class").indexOf("hot")>0){var e=t.data.Picture;e.FontOption.Style="italic",e.Update&&e.Update()}}),$(".chartpicture-text-setting .titleWrap .closeBtn,.chartpicture-text-setting .btnsContainer .cancelBtn").click({Picture:this.ChartPicture},function(t){var e=t.data.Picture;e.Text=i.BackupData.Text,e.LineColor=i.BackupData.LineColor,e.FontOption=i.BackupData.FontOption,e.Update&&e.Update(),i.Close()}),$(".chartpicture-text-setting .tArea").keyup({Picture:this.ChartPicture},function(t){JSConsole.Chart.Log(\'[ChartPictureTextSettingMenu::DoModal] $(".chartpicture-text-setting .tArea").keyup()\');var e=$(this).val(),a=t.data.Picture;a.Text=e,a.Update&&a.Update()}),$(".chartpicture-text-setting .btnsContainer .okBtn").click(function(){i.Close(),i.HQChart&&i.HQChart.ChartDrawStorage&&i.HQChart.ChartDrawStorage.SaveDrawData(i.ChartPicture)})}}JSIndexMap.Get=function(t){return new Map([["市场多空",{IsMainIndex:!1,Create:function(){return new MarketLongShortIndex}}],["市场择时",{IsMainIndex:!1,Create:function(){return new MarketTimingIndex}}],["市场关注度",{IsMainIndex:!1,Create:function(){return new MarketAttentionIndex}}],["指数热度",{IsMainIndex:!1,Create:function(){return new MarketHeatIndex}}],["财务粉饰",{IsMainIndex:!1,Create:function(){return new BenfordIndex}}],["自定义指数热度",{IsMainIndex:!1,Create:function(){return new CustonIndexHeatIndex},Name:"自定义指数热度"}],["能图-趋势",{IsMainIndex:!1,Create:function(){return new LighterIndex1},Name:"大盘/个股趋势"}],["能图-位置研判",{IsMainIndex:!1,Create:function(){return new LighterIndex2},Name:"位置研判"}],["能图-点位研判",{IsMainIndex:!1,Create:function(){return new LighterIndex3},Name:"点位研判"}],["CJL",{IsMainIndex:!1,Create:function(){return new JSIndex_CJL}}]]).get(t)},HQIndexFormula.EMA=function(t,e){var a=[],i=0;if(i>=t.length)return a;for(;i<t.length&&(null==t[i]||isNaN(t[i]));++i);var r=i,n=i+1;a[r]=t[r];for(var s=i+1;s<t.length;++s,++r,++n)a[n]=(2*t[n]+(e-1)*a[r])/(e+1);return a},HQIndexFormula.SMA=function(t,e,a){for(var i=[],r=0,n=null;r<t.length;++r)if(null!=t[r]&&!isNaN(t[r])){n=t[r],i[r]=n;break}for(++r;r<t.length;++r)i[r]=(a*t[r]+(e-a)*n)/e,n=i[r];return i},HQIndexFormula.DMA=function(t,e){var a=[];if(t.length<0||t.length!=e.length)return a;for(var i=0;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i])&&null!=e[i]&&!isNaN(e[i])){a[i]=t[i];break}for(i+=1;i<t.length;++i)null==t[i]||null==e[i]?a[i]=null:t[i]<1?a[i]=e[i]*t[i]+(1-e[i])*a[i-1]:a[i]=t[i];return a},HQIndexFormula.HHV=function(t,e){var a=[];if(e>t.length)return a;for(var i=-1e4,r=e,n=0;r<t.length;++r,++n){if(r<e+i)i=t[r]<t[i]?i:r;else for(n=1+(i=r-e+1);n<=r;++n)t[n]>t[i]&&(i=n);a[r]=t[i]}return a},HQIndexFormula.LLV=function(t,e){var a=[];if(e>t.length)return a;for(var i=-1e4,r=e;r<t.length;++r,++n){if(r<e+i)i=t[r]>t[i]?i:r;else for(var n=1+(i=r-e+1);n<=r;++n)t[n]<t[i]&&(i=n);a[r]=t[i]}return a},HQIndexFormula.REF=function(t,e){var a=[];if(t.length<=0)return a;if(e>=t.length)return a;a=t.slice(0,t.length-e);for(var i=0;i<e;++i)a.unshift(null);return a},HQIndexFormula.REFDATE=function(t,e){var a=[];if(t.length<=0)return a;for(var i in e=t.length-1,t)a[i]=t[e];return a},HQIndexFormula.SUM=function(t,e){var a=[];if(0==e){a[0]=t[0];for(var i=1;i<t.length;++i)a[i]=a[i-1]+t[i]}else{i=e-1;for(var r=0;i<t.length;++i,++r)for(var n=0;n<e;++n)0==n?a[i]=t[n+r]:a[i]+=t[n+r]}return a},HQIndexFormula.ARRAY_SUBTRACT=function(t,e){var a=[];if("number"==typeof e)for(var i in t)null==t[i]||isNaN(t[i])?a[i]=null:a[i]=t[i]-e;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?null==t[i]||null==e[i]?a[i]=null:a[i]=t[i]-e[i]:a[i]=null}return a},HQIndexFormula.ARRAY_GT=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]>e?1:0;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?a[i]=t[i]>e[i]?1:0:a[i]=null}return a},HQIndexFormula.ARRAY_GTE=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]>=e?1:0;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?a[i]=t[i]>=e[i]?1:0:a[i]=null}return a},HQIndexFormula.ARRAY_LT=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]<e?1:0;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?a[i]=t[i]<e[i]?1:0:a[i]=null}return a},HQIndexFormula.ARRAY_LTE=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]<=e?1:0;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?a[i]=t[i]<=e[i]?1:0:a[i]=null}return a},HQIndexFormula.ARRAY_EQ=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]==e?1:0;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?a[i]=t[i]==e[i]?1:0:a[i]=null}return a},HQIndexFormula.ARRAY_IF=function(t,e,a){var i=[],r=["number"==typeof e,"number"==typeof a];for(var n in t)t[n]?i[n]=r[0]?e:e[n]:i[n]=r[1]?a:a[n];return i},HQIndexFormula.ARRAY_AND=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]&&e?1:0;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?a[i]=t[i]&&e[i]?1:0:a[i]=0}return a},HQIndexFormula.ARRAY_OR=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]||e?1:0;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&t[i]?a[i]=1:i<e.length&&e[i]?a[i]=1:a[i]=0}return a},HQIndexFormula.ARRAY_MULTIPLY=function(t,e){if(2==arguments.length){var a=[];if("number"==typeof e)for(var i in t)null==t[i]||isNaN(t[i])?a[i]=null:a[i]=t[i]*e;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?a[i]=t[i]*e[i]:a[i]=null}return a}for(a=HQIndexFormula.ARRAY_MULTIPLY(arguments[0],arguments[1]),i=2;i<arguments.length;++i)a=HQIndexFormula.ARRAY_MULTIPLY(a,arguments[i]);return a},HQIndexFormula.ARRAY_DIVIDE=function(t,e){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]/e;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?null==t[i]||null==e[i]||isNaN(t[i])||isNaN(e[i])?a[i]=null:0==e[i]?a[i]=null:a[i]=t[i]/e[i]:a[i]=null}return a},HQIndexFormula.ARRAY_ADD=function(t,e){if(2==arguments.length){var a=[];if("number"==typeof e)for(var i in t)a[i]=t[i]+e;else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?null==t[i]||null==e[i]||isNaN(t[i])||isNaN(e[i])?a[i]=null:a[i]=t[i]+e[i]:a[i]=null}return a}for(a=HQIndexFormula.ARRAY_ADD(arguments[0],arguments[1]),i=2;i<arguments.length;++i)a=HQIndexFormula.ARRAY_ADD(a,arguments[i]);return a},HQIndexFormula.MAX=function(t,e){var a=[];if("number"==typeof e)for(var i in t)null==t[i]?a[i]=null:a[i]=Math.max(t[i],e);else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?null==t[i]||null==e[i]?a[i]=null:a[i]=Math.max(t[i],e[i]):a[i]=null}return a},HQIndexFormula.MIN=function(t,e){var a=[];if("number"==typeof e)for(var i in t)null==t[i]?a[i]=null:a[i]=Math.min(t[i],e);else{var r=Math.max(t.length,e.length);for(i=0;i<r;++i)i<t.length&&i<e.length?null==t[i]||null==e[i]?a[i]=null:a[i]=Math.min(t[i],e[i]):a[i]=null}return a},HQIndexFormula.ABS=function(t){var e=[];for(var a in t)null==t[a]?e[a]=null:e[a]=Math.abs(t[a]);return e},HQIndexFormula.MA=function(t,e){for(var a=[],i=0,r=t.length;i<r;i++)if(i<e)a[i]=null;else{for(var n=0,s=0;s<e;s++)n+=t[i-s];a[i]=n/e}return a},HQIndexFormula.EXPMA=function(t,e){var a=[];if(e>=t.length)return a;for(var i=e;i<t.length;++i)if(null!=t[i]){a[i]=t[i];break}for(i+=1;i<t.length;++i)null!=a[i-1]&&null!=t[i]?a[i]=(2*t[i]+(e-1)*a[i-1])/(e+1):null!=a[i-1]&&(a[i]=a[i-1]);return a},HQIndexFormula.EXPMEMA=function(t,e){var a=[];if(e>=t.length)return a;for(var i=0;i<t.length&&(!t[i]||isNaN(t[i]));++i);for(var r=0,n=0;i<t.length&&n<e;++n,++i)t[i]&&!isNaN(t[i])?r+=t[i]:r+=t[i-1];for(a[i-1]=r/e;i<t.length;++i)null!=a[i-1]&&null!=t[i]?a[i]=(2*t[i]+(e-1)*a[i-1])/(e+1):null!=a[i-1]&&(a[i]=a[i-1]);return a},HQIndexFormula.STD=function(t,e){for(var a=[],i=0,r=[],n=e-1;n<t.length;++n){i=0;for(var s=0;s<e;++s)i+=t[n-s];r[n]=i/e}for(n=e-1;n<t.length;++n){i=0;for(s=0;s<e;++s)i+=Math.pow(t[n-s]-r[n],2);a[n]=Math.sqrt(i/e)}return a},HQIndexFormula.AVEDEV=function(t,e){for(var a=[],i=0,r=[],n=e-1;n<t.length;++n){i=0;for(var s=0;s<e;++s)i+=t[n-s];r[n]=i/e}for(n=e-1;n<t.length;++n){i=0;for(s=0;s<e;++s)i+=Math.abs(t[n-s]-r[n]);a[n]=i/e}return a},HQIndexFormula.COUNT=function(t,e){for(var a=[],i=e-1;i<t.length;++i){for(var r=0,n=0;n<e;++n)t[i-n]&&++r;a[i]=r}return a},HQIndexFormula.CROSS=function(t,e){var a=[];if(t.length!=e.length)return[];for(var i=0;i<t.length&&(null==t[i]||isNaN(t[i])||null==e[i]||!isNaN(e[i]));++i);for(++i;i<t.length;++i)a[i]=t[i]>e[i]&&t[i-1]<e[i-1]?1:0;return a},HQIndexFormula.MULAR=function(t,e){var a=[];if(t.length<e)return a;for(var i=e;i<t.length;++i)if(null!=t[i]&&!isNaN(t[i])){a[i]=t[i];break}for(++i;i<t.length;++i)a[i]=a[i-1]*t[i];return a},HQIndexFormula.STICKLINE=function(t,e,a){var i=[];if(t.length<=0)return i;var r="number"==typeof e,n="number"==typeof a;for(var s in t)if(i[s]=null,!isNaN(t[s])&&t[s])if(r&&n)i[s]={Value:e,Value2:a};else if(r&&!n){if(isNaN(a[s]))continue;i[s]={Value:e,Value2:a[s]}}else if(!r&&n){if(isNaN(e[s]))continue;i[s]={Value:e[s],Value2:a}}else{if(isNaN(e[s])||isNaN(a[s]))continue;i[s]={Value:e[s],Value2:a[s]}}return i},KLineChartContainer.JsonDataToHistoryData=function(t){var e=[];if(!t.data)return e;var a=null;t.symbol&&(a=t.symbol.toUpperCase());MARKET_SUFFIX_NAME.IsFutures(a);for(var i=t.data,r=0;r<i.length;++r){var n=new HistoryData,s=i[r];n.Date=s[0],n.Open=s[2],n.YClose=s[1],n.Close=s[5],n.High=s[3],n.Low=s[4],n.Vol=s[6],n.Amount=s[7],IFrameSplitOperator.IsNumber(s[8])&&(n.Position=s[8]),IFrameSplitOperator.IsNumber(s[9])&&(n.FClose=s[9]),IFrameSplitOperator.IsNumber(s[10])&&(n.YFClose=s[10]),isNaN(n.Open)||n.Open<=0||e.push(n)}return e},KLineChartContainer.JsonDataToRealtimeData=function(t,e){if(!t.stock)return null;var a;for(var i in t.stock){var r=t.stock[i];if(r&&r.symbol==e){a=r;break}}if(!a)return null;var n=e.toUpperCase(),s=(MARKET_SUFFIX_NAME.IsSHSZ(n),new HistoryData);return s.Date=a.date,s.Open=a.open,s.YClose=a.yclose,s.High=a.high,s.Low=a.low,s.Vol=a.vol,s.Amount=a.amount,s.Close=a.price,IFrameSplitOperator.IsNumber(a.position)&&(s.Position=a.position),s},KLineChartContainer.JsonDataToMinuteRealtimeData=function(t,e){if(!t.stock)return null;var a;for(var i in t.stock){var r=t.stock[i];if(r&&r.symbol==e){a=r;break}}if(!a)return null;var n=e.toUpperCase(),s=(MARKET_SUFFIX_NAME.IsSHSZ(n),MARKET_SUFFIX_NAME.IsFutures(n)),o=new Array,h=a.yclose,l=a.date;for(var i in s&&a.yclearing&&(h=a.yclearing),a.minute){var C=a.minute[i],u=new HistoryData;u.Close=C.price,u.Open=C.open,u.High=C.high,u.Low=C.low,u.Vol=C.vol,u.Amount=C.amount,C.date>0?u.Date=C.date:u.Date=l,u.Time=C.time,u.YClose=h,IFrameSplitOperator.IsNumber(C.position)&&(u.Position=C.position),u.Close||(u.Close=h,u.Open=u.High=u.Low=u.Close),u.Open<=0&&(u.Open=null),u.Close<=0&&(u.Close=null),u.High<=0&&(u.High=null),u.Low<=0&&(u.Low=null),C.price>0&&(h=C.price),o[i]=u}return o},KLineChartContainer.JsonDataToMinuteHistoryData=function(t){var e=null;t.symbol&&(e=t.symbol.toUpperCase());e&&MARKET_SUFFIX_NAME.IsSHSZ(e);e&&MARKET_SUFFIX_NAME.IsFutures(e);for(var a=t.data,i=new Array,r=0,n=0;n<a.length;++n){var s=new HistoryData,o=a[n];s.Close=o[2],s.Open=o[1],s.High=o[3],s.Low=o[4],s.Amount=o[6],s.Vol=o[5],s.YClose=r||s.Close,s.Time=o[0],s.Time>1e7&&(s.DateTime=datetime(s.Time),s.Date=s.DateTime.substr(0,8),s.Time=s.DateTime.substr(9,4)),IFrameSplitOperator.IsNumber(o[9])&&(s.Position=o[9]),s.YClose<=0&&r>0&&(s.YClose=r),s.Close>0&&(r=s.Close),i.push(s)}for(n=0;n<i.length;++n){var h=i[n];if(null!=h&&(isNaN(h.Open)||h.Open<=0||isNaN(h.High)||h.High<=0||isNaN(h.Low)||h.Low<=0||isNaN(h.Close)||h.Close<=0))if(0==n)h.YClose>0&&(h.Open=h.YClose,h.High=h.YClose,h.Low=h.YClose,h.Close=h.YClose);else for(var l=n-1;l>=0;--l){var C=i[l];if(null==C&&coninue,C.Open>0&&C.High>0&&C.Low>0&&C.Close>0){h.YClose<=0&&(h.YClose=C.Close),h.Open=C.Open,h.High=C.High,h.Low=C.Low,h.Close=C.Close;break}}}return i},KLineChartContainer.JsonDataToTickData=function(t){var e=[];if(!t.detail)return e;var a=t.date,i=t.yclose;for(var r in t.detail){var n=new HistoryData,s=t.detail[r];s&&(n.Date=a,n.Time=s[0],n.Low=n.High=n.Close=n.Open=s[1],n.YClose=i,n.Vol=s[2],n.Amount=s[3],n.Flag=s[4],isNaN(n.Open)||n.Open<=0||(i=n.Close,e.push(n)))}return e},MinuteChartContainer.JsonDataToMinuteData2=function(t){t.stock[0].symbol;var e=t.stock[0].yclose,a=t.stock[0].yclose,i=t.stock[0].yclose,r=[],n=t.stock[0],s=n.date;for(var o in n.before){var h=new MinuteData,l=(C=n.before[o])[0];h.Before={},h.Before.Close=C[1],h.Before.Close?e=h.Before.Close:h.Before.Close=e,h.Before.Vol=C[2]/100,h.Before.Amount=C[3],h.DateTime=s.toString()+" "+l.toString(),h.Date=s,h.Time=l,i&&h.Before.Close&&(h.Before.Increase=(h.Before.Close-i)/i*100),r.push(h)}for(var o in n.minute){var C=n.minute[o];h=new MinuteData;C.price&&(e=C.price),C.avprice&&(a=C.avprice),925!=C.time&&(h.Close=C.price||C[2],h.Open=C.open||C[1],h.High=C.high||C[3],h.Low=C.low||C[4],h.Amount=C.amount||C[6],h.Vol=C.vol||C[5],h.Time=C.time||C[0],h.DateTime=t.stock[0].date.toString()+" "+h.Time.toString(),h.Date=t.stock[0].date,h.Increase=C.increase,h.Risefall=C.risefall,h.AvPrice=C.avprice,h.Close||(h.Open=h.High=h.Low=h.Close=e),h.AvPrice||(h.AvPrice=a),i&&h.Close&&(h.Increase=(h.Close-i)/i*100),r.push(h))}return r},MinuteChartContainer.JsonDataToMinuteData=function(t,e){var a=t.stock[0].symbol.toUpperCase(),i=(MARKET_SUFFIX_NAME.IsSHSZ(a),MARKET_SUFFIX_NAME.IsFutures(a)),r=MARKET_SUFFIX_NAME.IsSHO(a),n=new Array,s=t.stock[0].yclose,o=t.stock[0].yclose,h=t.stock[0].yclose;i&&t.stock[0].yclearing&&(h=s=o=t.stock[0].yclearing);var l=t.stock[0].date,C=0,u=0;for(var D in t.stock[0].minute){var d=t.stock[0].minute[D],c=new MinuteData;c.Close=d.price||d[2],c.Open=d.open||d[1],c.High=d.high||d[3],c.Low=d.low||d[4],c.Amount=d.amount||d[6],c.Vol=d.vol||d[5],c.Increase=d.increase||d[8],c.Risefall=d.risefall||d[9],c.AvPrice=d.avprice||d[7],d.date>0&&(l=d.date),c.Time=d.time||d[0],c.DateTime=l.toString()+" "+c.Time.toString(),c.Date=l,c.Time>1e7&&(c.DateTime=datetime(c.Time),c.Date=c.DateTime.substr(0,8),c.Time=c.DateTime.substr(9,4)),c.AvPrice||(C+=c.Vol,u+=c.Amount,c.AvPrice=u/C),(i||r)&&(c.Position=d.position),0==D&&(c.IsFristData=!0),IFrameSplitOperator.IsNumber(d.lead)&&(c.Lead=d.lead),c.Close||(c.Close=s,c.Open=c.High=c.Low=c.Close),c.AvPrice||(c.AvPrice=o),c.Open<=0&&(c.Open=null),c.Close<=0&&(c.Close=null),c.AvPrice<=0&&(c.AvPrice=null),c.High<=0&&(c.High=null),c.Low<=0&&(c.Low=null),h&&c.Close&&(c.Increase=(c.Close-h)/h*100),c.Close>0&&(s=c.Close),c.AvPrice>0&&(o=c.AvPrice),n[D]=c}return n},MinuteChartContainer.JsonDataToMinuteDataArray=function(t){var e=t.symbol.toUpperCase(),a=MARKET_SUFFIX_NAME.IsSHSZ(e),i=MARKET_SUFFIX_NAME.IsSHO(e),r=MARKET_SUFFIX_NAME.IsFutures(e),n=[],s=0,o=0;for(var h in t.data){var l=[],C=t.data[h],u=C.date,D=C.yclose,d=D,c=null;for(var m in C.minute){var f=C.minute[m];f[2]&&(d=f[2]);var v=new MinuteData;v.Close=f[2],v.Open=f[1],v.High=f[3],v.Low=f[4],v.Vol=a?f[5]/100:f[5],v.Amount=f[6],v.DateTime=u.toString()+" "+f[0].toString(),v.Date=u,v.Time=f[0],8<f.length&&f[8]>0&&(v.Date=f[8]),f[0]>1e7&&(v.DateTime=datetime(f[0]),v.Date=v.DateTime.substr(0,8),v.Time=v.DateTime.substr(9,4)),f[7]||(s+=f[5],o+=f[6],f[7]=o/s),7<f.length&&f[7]>0&&(v.AvPrice=f[7]),(r||i)&&9<f.length&&(v.Position=f[9]),v.Close||(v.Close=d,v.Open=v.High=v.Low=v.Close),!v.AvPrice&&c&&(v.AvPrice=c),v.Close&&D?v.Increase=(v.Close-D)/D*100:v.Increase=null,0==m&&(v.IsFristData=!0),v.Open<=0&&(v.Open=null),v.Close<=0&&(v.Close=null),v.AvPrice<=0&&(v.AvPrice=null),v.High<=0&&(v.High=null),v.Low<=0&&(v.Low=null),v.AvPrice<=0&&(v.AvPrice=null),v.AvPrice,f.length>7&&f[7]>0&&v.AvPrice===f[7]&&(c=f[7]),l[m]=v}var S=new ChartData;S.Data=l,S.YClose=D,S.Close=C.close,S.Date=u,n.push(S)}return n},HistoryMinuteChartContainer.JsonDataToMinuteData=function(t){var e=[];for(var a in t.minute.time){var i=new MinuteData;t.minute.price[a]<=0&&a>0?(i.Close=e[a-1].Close,i.Open=e[a-1].Close,i.High=i.Close,i.Low=i.Close,i.Vol=t.minute.vol[a],i.Amount=t.minute.amount[a],i.DateTime=t.date.toString()+" "+t.minute.time[a].toString(),i.AvPrice=e[a-1].AvPrice):(i.Close=t.minute.price[a],i.Open=t.minute.open[a],i.High=t.minute.high[a],i.Low=t.minute.low[a],i.Vol=t.minute.vol[a],i.Amount=t.minute.amount[a],i.DateTime=t.date.toString()+" "+t.minute.time[a].toString(),i.AvPrice=t.minute.avprice[a]),i.Open<=0&&(i.Open=null),i.Close<=0&&(i.Close=null),i.AvPrice<=0&&(i.AvPrice=null),i.High<=0&&(i.High=null),i.Low<=0&&(i.Low=null),e[a]=i}return e},PyScriptIndex.prototype.GetDefaultColor=function(t){let e=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"];return e[parseInt(t)%(e.length-1)]},JSKLineInfoMap.Get=function(t){return new Map([["互动易",{Create:function(){return new InvestorInfo}}],["公告",{Create:function(){return new AnnouncementInfo}}],["业绩预告",{Create:function(){return new PforecastInfo}}],["调研",{Create:function(){return new ResearchInfo}}],["大宗交易",{Create:function(){return new BlockTrading}}],["龙虎榜",{Create:function(){return new TradeDetail}}]]).get(t)},JSKLineInfoMap.GetClassInfo=function(t){return new Map([["互动易",{ClassName:"InvestorInfo"}],["公告",{ClassName:"AnnouncementInfo"}],["业绩预告",{ClassName:"PforecastInfo"}],["调研",{ClassName:"ResearchInfo"}],["大宗交易",{ClassName:"BlockTrading"}],["龙虎榜",{ClassName:"TradeDetail"}]]).get(t)},JSKLineInfoMap.GetIconUrl=function(t){switch(t){case KLINE_INFO_TYPE.INVESTOR:return g_JSChartResource.KLine.Info.Investor.Icon;case KLINE_INFO_TYPE.PFORECAST:return g_JSChartResource.KLine.Info.Pforecast.Icon;case KLINE_INFO_TYPE.ANNOUNCEMENT:return g_JSChartResource.KLine.Info.Announcement.Icon;case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_1:case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_2:case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_3:case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_4:return g_JSChartResource.KLine.Info.Announcement.IconQuarter;case KLINE_INFO_TYPE.RESEARCH:return g_JSChartResource.KLine.Info.Research.Icon;case KLINE_INFO_TYPE.BLOCKTRADING:return g_JSChartResource.KLine.Info.BlockTrading.Icon;case KLINE_INFO_TYPE.TRADEDETAIL:return g_JSChartResource.KLine.Info.TradeDetail.Icon;default:return g_JSChartResource.KLine.Info.Announcement.Icon}},JSKLineInfoMap.GetIconLibrary=function(t){var e=g_JSChartResource.KLine.Info.IconLibrary;if(!e||!e.Icon)return g_JSChartResource.KLine.Info.Announcement.IconFont;if(t>=0&&t<e.Icon.length){var a=e.Icon[t];return{Text:a.Text,HScreenText:a.HScreenText,Color:a.Color,Family:e.Family}}return g_JSChartResource.KLine.Info.Announcement.IconFont},JSKLineInfoMap.GetIconFont=function(t){if(t>=KLINE_INFO_TYPE.ANNOUNCEMENT_EX_START&&t<=KLINE_INFO_TYPE.ANNOUNCEMENT_EX_END){var e=t-KLINE_INFO_TYPE.ANNOUNCEMENT_EX_START;return JSKLineInfoMap.GetIconLibrary(e)}switch(t){case KLINE_INFO_TYPE.INVESTOR:return g_JSChartResource.KLine.Info.Investor.IconFont;case KLINE_INFO_TYPE.PFORECAST:return g_JSChartResource.KLine.Info.Pforecast.IconFont;case KLINE_INFO_TYPE.ANNOUNCEMENT:return g_JSChartResource.KLine.Info.Announcement.IconFont;case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_1:case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_2:case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_3:case KLINE_INFO_TYPE.ANNOUNCEMENT_QUARTER_4:return g_JSChartResource.KLine.Info.Announcement.IconFont2;case KLINE_INFO_TYPE.RESEARCH:return g_JSChartResource.KLine.Info.Research.IconFont;case KLINE_INFO_TYPE.BLOCKTRADING:return g_JSChartResource.KLine.Info.BlockTrading.IconFont;case KLINE_INFO_TYPE.TRADEDETAIL:return g_JSChartResource.KLine.Info.TradeDetail.IconFont;default:return g_JSChartResource.KLine.Info.Announcement.IconFont}},JSMinuteInfoMap.InfoMap=new Map([["大盘异动",{Create:function(){return new MarketEventInfo}}]]),JSMinuteInfoMap.Get=function(t){return JSMinuteInfoMap.InfoMap.get(t)};var MARKET_SUFFIX_NAME={SH:".SH",SZ:".SZ",SHSZ_C_Index:".CI",SHO:".SHO",HK:".HK",FHK:".FHK",SHFE:".SHF",SHFE2:".SHFE",CFFEX:".CFE",DCE:".DCE",CZCE:".CZC",USA:".USA",FTSE:".FTSE",BIT:".BIT",BIZ:".BIZ",FOREX:".FOREX",NYMEX:".NYMEX",COMEX:".COMEX",NYBOT:".NYBOT",CBOT:".CBOT",LME:".LME",ET:".ET",IsET:function(t){return!!t&&t.indexOf(this.ET)>0},IsETShowAvPrice:function(t){return!1},IsNYMEX:function(t){return!!t&&t.indexOf(this.NYMEX)>0},IsCOMEX:function(t){return!!t&&t.indexOf(this.COMEX)>0},IsNYBOT:function(t){return!!t&&t.indexOf(this.NYBOT)>0},IsCBOT:function(t){return!!t&&t.indexOf(this.CBOT)>0},IsLME:function(t){return!!t&&t.indexOf(this.LME)>0},IsForeignExchange(t){return!!t&&t.indexOf(this.FOREX)>0},IsFTSE:function(t){return!!t&&t.indexOf(this.FTSE)>0},IsFHK:function(t){return!!t&&t.indexOf(this.FHK)>0},IsBIT:function(t){return!!t&&(t.indexOf(this.BIT)>0||t.indexOf(this.BIZ)>0)},IsUSA:function(t){return!!t&&t.indexOf(this.USA)>0},IsSH:function(t){var e=t.length-this.SH.length;return t.indexOf(this.SH)==e},IsSZ:function(t){var e=t.length-this.SZ.length;return t.indexOf(this.SZ)==e},IsSHSZCustomIndex:function(t){var e=t.length-this.SHSZ_C_Index.length;return t.indexOf(this.SHSZ_C_Index)==e},IsSHO:function(t){var e=t.length-this.SHO.length;return t.indexOf(this.SHO)==e},IsHK:function(t){var e=t.length-this.HK.length;return t.indexOf(this.HK)==e},IsSHFE:function(t){return!!t&&(t.indexOf(this.SHFE)>0||t.indexOf(this.SHFE2)>0)},IsCFFEX:function(t){return!!t&&t.indexOf(this.CFFEX)>0},IsDCE:function(t){return!!t&&t.indexOf(this.DCE)>0},IsCZCE:function(t){return!!t&&t.indexOf(this.CZCE)>0},IsChinaFutures:function(t){return this.IsCFFEX(t)||this.IsCZCE(t)||this.IsDCE(t)||this.IsSHFE(t)},IsFutures:function(t){return this.IsChinaFutures(t)||this.IsNYMEX(t)||this.IsCOMEX(t)||this.IsNYBOT(t)||this.IsCBOT(t)||this.IsLME(t)},IsSHSZ:function(t){return this.IsSZ(t)||this.IsSH(t)||this.IsSHSZCustomIndex(t)},IsSHSZFund:function(t){if(!t)return!1;if(this.IsSH(t)){if("5"==t.charAt(0)&&"1"==t.charAt(1))return!0}else if(this.IsSZ(t)&&"1"==t.charAt(0)&&("5"==t.charAt(1)||"6"==t.charAt(1)||"7"==t.charAt(1)||"8"==t.charAt(1)))return!0;return!1},IsSHSZIndex:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){var a=e.replace(".SH","");if("0"==e.charAt(0)&&parseInt(a)<=3e3)return!0}else if(this.IsSZ(e)){if("3"==e.charAt(0)&&"9"==e.charAt(1))return!0}else if(this.IsSHSZCustomIndex(e))return!0;return!1},IsSHSZStockA:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){e.replace(".SH","");if("6"==e.charAt(0))return!0}else if(this.IsSZ(e)&&"0"==e.charAt(0)){if("0"==e.charAt(1)&&"2"==e.charAt(2))return!0;if("7"!=e.charAt(1)&&"8"!=e.charAt(1))return!0}return!1},IsSHStockSTAR:function(t){if(!t)return!1;var e=t.toUpperCase();return!!this.IsSH(e)&&("6"==e.charAt(0)&&"8"==e.charAt(1)&&"8"==e.charAt(2))},GetMarketStatus:function(t){if(!t)return 0;var e=t.toUpperCase(),a=new Date,i=a.getDay(),r=100*a.getHours()+a.getMinutes();if(this.IsUSA(e)){var n=GetLocalTime(-4);i=n.getDay(),r=100*n.getHours()+n.getMinutes();return 6==i||0==i?0:r>1730?3:r<930?1:2}return this.IsBIT(e)?2:this.IsForeignExchange(e)?2:this.IsFTSE(e)?6==i||0==i?0:r>=830&&r<=2359?2:r>=0&&r<=500?2:0:this.IsFHK(e)?6==i||0==i?0:r>=900&&r<=2359?2:r>=0&&r<=320?2:0:this.IsET(e)?this.GetETMarketStatus(t):this.IsHK(e)?6==i||0==i?0:r>1630?3:r<925?1:2:this.IsNYMEX(e)?this.GetNYMEXMarketStatus(e):this.IsCOMEX(e)?this.GetCOMEXMarketStatus(e):this.IsNYBOT(e)?this.GetNYBOTMarketStatus(e):this.IsCBOT(e)?this.GetCBOTMarketStatus(e):this.IsLME(e)?this.GetLMEMarketStatus(e):this.IsChinaFutures(e)?6==i||0==i?0:r>=2100?2:r<=240?2:r>=830&&r<=1510?2:1:6==i||0==i?0:r>1540?3:r<925?1:2},GetLimitPriceRange:function(t,e){return this.IsSHSZStockA(t)?this.IsSHStockSTAR(t)?{Max:.2,Min:-.2}:e?e.indexOf("ST")>=0?{Max:.05,Min:-.05}:{Max:.1,Min:-.1}:null:null},GetFHKDecimal:function(t){return 0},GetFTSEDecimal:function(t){return 0},GetBITDecimal:function(t){return 2},GetSHODecimal:function(t){return 4},GetETDecimal:function(t){return 2},GetForeignExchangeDecimal:function(t){return 4},GetNYMEXDecimal:function(t){return g_NYMEXTimeData.GetDecimal(t)},GetCOMEXDecimal:function(t){return g_COMEXTimeData.GetDecimal(t)},GetNYBOTDecimal:function(t){return g_NYBOTTimeData.GetDecimal(t)},GetCBOTDecimal:function(t){return g_CBOTTimeData.GetDecimal(t)},GetLMEDecimal:function(t){return g_LMETimeData.GetDecimal(t)},GetETMarketStatus:function(t){return 2},GetNYMEXMarketStatus:function(t){return g_NYMEXTimeData.GetMarketStatus(t)},GetCOMEXMarketStatus:function(t){return g_COMEXTimeData.GetMarketStatus(t)},GetNYBOTMarketStatus:function(t){return g_NYBOTTimeData.GetMarketStatus(t)},GetCBOTMarketStatus:function(t){return g_CBOTTimeData.GetMarketStatus(t)},GetLMEMarketStatus:function(t){return g_LMETimeData.GetMarketStatus(t)}};function MinuteTimeStringData(){this.SHSZ=null,this.SHO=null,this.HK=null,this.Futures=new Map,this.USA=null,this.FTSE=null,this.FHK=null,this.ForeEx=null,this.BIT=null,this.Initialize=function(){},this.GetET=function(t){throw{Name:"MinuteTimeStringData::GetET",Error:"not implement"}},this.GetSHSZ=function(t){return this.SHSZ||(this.SHSZ=this.CreateSHSZData()),this.SHSZ},this.GetSHO=function(){return this.SHO||(this.SHO=this.CreateSHOData()),this.SHO},this.GetHK=function(){return this.HK||(this.HK=this.CreateHKData()),this.HK},this.GetFutures=function(t){if(!this.Futures.has(t.Name)){var e=this.CreateTimeData(t.Data);this.Futures.set(t.Name,e)}return this.Futures.get(t.Name)},this.GetUSA=function(){return this.USA||(this.USA=this.CreateUSAData(0)),this.USA},this.GetFTSE=function(){return this.FTSE||(this.FTSE=this.CreateFTSEData()),this.FTSE},this.GetFHK=function(){return this.FHK||(this.FHK=this.CreateFHKData()),this.FHK},this.GetForeignExchange=function(){return this.ForeEx||(this.ForeEx=this.CreateForeignExchangeData()),this.ForeEx},this.GetBIT=function(t){return this.BIT||(this.BIT=this.CreateBITData()),this.BIT},this.CreateSHSZData=function(){return this.CreateTimeData([{Start:925,End:925},{Start:930,End:1130},{Start:1300,End:1500}])},this.CreateSHOData=function(){return this.CreateTimeData([{Start:930,End:1129},{Start:1300,End:1500}])},this.CreateHKData=function(){return this.CreateTimeData([{Start:930,End:1200},{Start:1300,End:1600}])},this.CreateFTSEData=function(){return this.CreateTimeData([{Start:1700,End:2359},{Start:0,End:445},{Start:900,End:1630}])},this.CreateFHKData=function(){return this.CreateTimeData([{Start:1715,End:2359},{Start:0,End:300},{Start:915,End:1200},{Start:1300,End:1630}])},this.CreateUSAData=function(t){if(1==t){const t=[{Start:2130,End:2359},{Start:0,End:400}];return this.CreateTimeData(t)}if(2==t){const t=[{Start:2230,End:2359},{Start:0,End:500}];return this.CreateTimeData(t)}{const t=[{Start:930,End:1600}];return this.CreateTimeData(t)}},this.CreateForeignExchangeData=function(){return this.CreateTimeData([{Start:600,End:2359},{Start:0,End:559}])},this.CreateBITData=function(){return this.CreateTimeData([{Start:600,End:2359},{Start:0,End:559}])},this.CreateTimeData=function(t){var e=[];for(var a in t)for(var i=t[a],r=i.Start;r<=i.End;++r)r%100>=60||e.push(r);return e},this.GetTimeData=function(t){if(!t)return this.SHSZ;var e,a=t.toLocaleUpperCase();return MARKET_SUFFIX_NAME.IsSH(a)||MARKET_SUFFIX_NAME.IsSZ(a)?this.GetSHSZ(a):MARKET_SUFFIX_NAME.IsSHO(a)?this.GetSHO():MARKET_SUFFIX_NAME.IsHK(a)?this.GetHK():MARKET_SUFFIX_NAME.IsUSA(a)?this.GetUSA(!0):MARKET_SUFFIX_NAME.IsCFFEX(a)||MARKET_SUFFIX_NAME.IsCZCE(a)||MARKET_SUFFIX_NAME.IsDCE(a)||MARKET_SUFFIX_NAME.IsSHFE(a)?(e=g_FuturesTimeData.GetSplitData(a))?this.GetFutures(e):null:MARKET_SUFFIX_NAME.IsFTSE(a)?this.GetFTSE():MARKET_SUFFIX_NAME.IsFHK(a)?this.GetFHK():MARKET_SUFFIX_NAME.IsForeignExchange(a)?this.GetForeignExchange():MARKET_SUFFIX_NAME.IsET(a)?this.GetET(a):MARKET_SUFFIX_NAME.IsBIT(a)?this.GetBIT(a):MARKET_SUFFIX_NAME.IsNYMEX(a)?(e=g_NYMEXTimeData.GetSplitData(a))?this.GetFutures(e):null:MARKET_SUFFIX_NAME.IsCOMEX(a)?(e=g_COMEXTimeData.GetSplitData(a))?this.GetFutures(e):null:MARKET_SUFFIX_NAME.IsNYBOT(a)?(e=g_NYBOTTimeData.GetSplitData(a))?this.GetFutures(e):null:MARKET_SUFFIX_NAME.IsCBOT(a)?(e=g_CBOTTimeData.GetSplitData(a))?this.GetFutures(e):null:MARKET_SUFFIX_NAME.IsLME(a)?(e=g_LMETimeData.GetSplitData(a))?this.GetFutures(e):null:void 0}}function MinuteCoordinateData(){const t={Full:[[0,0,"rgb(200,200,200)","09:30"],[31,0,"RGB(200,200,200)","10:00"],[61,0,"RGB(200,200,200)","10:30"],[91,0,"RGB(200,200,200)","11:00"],[122,1,"RGB(200,200,200)","13:00"],[152,0,"RGB(200,200,200)","13:30"],[182,0,"RGB(200,200,200)","14:00"],[212,0,"RGB(200,200,200)","14:30"],[242,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[61,0,"RGB(200,200,200)","10:30"],[122,1,"RGB(200,200,200)","13:00"],[182,0,"RGB(200,200,200)","14:00"],[242,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[122,1,"RGB(200,200,200)","13:00"],[242,1,"RGB(200,200,200)","15:00"]],Count:243,MiddleCount:122,GetData:function(t){return t<200?this.Min:t<400?this.Simple:this.Full}},e={Full:[[0,0,"rgb(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,0,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","13:00"],[150,0,"RGB(200,200,200)","13:30"],[180,0,"RGB(200,200,200)","14:00"],[210,0,"RGB(200,200,200)","14:30"],[240,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[60,0,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","13:00"],[180,0,"RGB(200,200,200)","14:00"],[240,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[120,1,"RGB(200,200,200)","13:00"],[240,1,"RGB(200,200,200)","15:00"]],Count:241,MiddleCount:120,GetData:function(t){return t<200?this.Min:t<400?this.Simple:this.Full}},a={Full:[[0,1,"RGB(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,1,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","11:30"],[151,0,"RGB(200,200,200)","13:00"],[181,1,"RGB(200,200,200)","13:30"],[211,0,"RGB(200,200,200)","14:00"],[241,1,"RGB(200,200,200)","14:30"],[271,0,"RGB(200,200,200)","15:00"],[301,1,"RGB(200,200,200)","15:30"],[331,1,"RGB(200,200,200)","16:00"]],Simple:[[0,1,"RGB(200,200,200)","09:30"],[60,1,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","11:30"],[211,0,"RGB(200,200,200)","14:00"],[271,0,"RGB(200,200,200)","15:00"],[331,1,"RGB(200,200,200)","16:00"]],Min:[[0,1,"RGB(200,200,200)","09:30"],[151,0,"RGB(200,200,200)","13:00"],[331,1,"RGB(200,200,200)","16:00"]],Count:332,MiddleCount:151,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}},i={Full:[[0,0,"rgb(200,200,200)","9:30"],[30,0,"RGB(200,200,200)","10:00"],[90,1,"RGB(200,200,200)","11:00"],[150,0,"RGB(200,200,200)","12:00"],[210,0,"RGB(200,200,200)","13:00"],[270,0,"RGB(200,200,200)","14:00"],[330,0,"RGB(200,200,200)","15:00"],[390,0,"RGB(200,200,200)","16:00"]],Simple:[[30,0,"rgb(200,200,200)","10:00"],[150,1,"RGB(200,200,200)","12:00"],[270,0,"RGB(200,200,200)","14:00"],[390,0,"RGB(200,200,200)","16:00"]],Min:[[30,0,"rgb(200,200,200)","10:00"],[210,1,"RGB(200,200,200)","13:00"],[390,0,"RGB(200,200,200)","16:00"]],Count:391,MiddleCount:211,GetData:function(t){return t<200?this.Min:t<400?this.Simple:this.Full}},r={Full:[[0,1,"RGB(200,200,200)","17:00"],[120,1,"RGB(200,200,200)","19:00"],[240,1,"RGB(200,200,200)","21:00"],[360,1,"RGB(200,200,200)","23:00"],[480,1,"RGB(200,200,200)","01:00"],[600,1,"RGB(200,200,200)","03:00"],[706,1,"RGB(200,200,200)","09:00"],[826,1,"RGB(200,200,200)","11:00"],[946,1,"RGB(200,200,200)","13:00"],[1066,1,"RGB(200,200,200)","15:00"],[1156,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:00"],[240,1,"RGB(200,200,200)","21:00"],[480,1,"RGB(200,200,200)","01:00"],[706,1,"RGB(200,200,200)","09:00"],[946,1,"RGB(200,200,200)","13:00"],[1156,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:00"],[706,1,"RGB(200,200,200)","09:00"],[1156,1,"RGB(200,200,200)","16:30"]],Count:1157,MiddleCount:707,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}},n={Full:[[0,1,"RGB(200,200,200)","17:15"],[105,1,"RGB(200,200,200)","19:00"],[225,1,"RGB(200,200,200)","21:00"],[345,1,"RGB(200,200,200)","23:00"],[586,0,"RGB(200,200,200)","09:15"],[691,1,"RGB(200,200,200)","11:00"],[812,1,"RGB(200,200,200)","14:00"],[963,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:15"],[225,1,"RGB(200,200,200)","21:00"],[586,0,"RGB(200,200,200)","09:15"],[752,1,"RGB(200,200,200)","13:00"],[963,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:15"],[586,0,"RGB(200,200,200)","09:15"],[963,1,"RGB(200,200,200)","16:30"]],Count:963,MiddleCount:526,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}},s={Full:[[0,1,"RGB(200,200,200)","06:00"],[120,1,"RGB(200,200,200)","08:00"],[240,1,"RGB(200,200,200)","10:00"],[360,1,"RGB(200,200,200)","12:00"],[480,0,"RGB(200,200,200)","14:00"],[600,1,"RGB(200,200,200)","16:00"],[720,1,"RGB(200,200,200)","18:00"],[840,1,"RGB(200,200,200)","20:00"],[960,1,"RGB(200,200,200)","22:00"],[1080,1,"RGB(200,200,200)","0:00"],[1200,1,"RGB(200,200,200)","02:00"],[1320,1,"RGB(200,200,200)","04:00"]],Simple:[[0,1,"RGB(200,200,200)","06:00"],[240,1,"RGB(200,200,200)","10:00"],[480,0,"RGB(200,200,200)","14:00"],[720,1,"RGB(200,200,200)","18:00"],[960,1,"RGB(200,200,200)","22:00"],[1200,1,"RGB(200,200,200)","02:00"]],Min:[[0,1,"RGB(200,200,200)","06:00"],[480,0,"RGB(200,200,200)","14:00"],[960,1,"RGB(200,200,200)","22:00"]],Count:1440,MiddleCount:600,GetData:function(t){return t<200?this.Min:t<450?this.Simple:this.Full}};this.GetCoordinateData=function(e,i){var r=null;if(e){var n=e.toLocaleUpperCase();if(MARKET_SUFFIX_NAME.IsSH(n)||MARKET_SUFFIX_NAME.IsSZ(n)||MARKET_SUFFIX_NAME.IsSHSZIndex(n))r=this.GetSHSZData(n,i);else if(MARKET_SUFFIX_NAME.IsSHO(n))r=this.GetSHOData(n,i);else if(MARKET_SUFFIX_NAME.IsHK(n))r=a;else{if(MARKET_SUFFIX_NAME.IsCFFEX(n)||MARKET_SUFFIX_NAME.IsCZCE(n)||MARKET_SUFFIX_NAME.IsDCE(n)||MARKET_SUFFIX_NAME.IsSHFE(n))return this.GetChinatFuturesData(n,i);if(MARKET_SUFFIX_NAME.IsUSA(n))r=this.GetUSAData(n,i);else if(MARKET_SUFFIX_NAME.IsFTSE(n))r=this.GetFTSEData(n,i);else if(MARKET_SUFFIX_NAME.IsFHK(n))r=this.GetFHKData(n,i);else if(MARKET_SUFFIX_NAME.IsForeignExchange(n))r=this.GetForeignExchangeData(n,i);else if(MARKET_SUFFIX_NAME.IsBIT(n,i))r=this.GetBITData(n,i);else if(MARKET_SUFFIX_NAME.IsET(n))r=this.GetETData(n,i);else{if(MARKET_SUFFIX_NAME.IsNYMEX(n,i))return this.GetNYMEXData(n,i);if(MARKET_SUFFIX_NAME.IsCOMEX(n,i))return this.GetCOMEXData(n,i);if(MARKET_SUFFIX_NAME.IsNYBOT(n,i))return this.GetNYBOTData(n,i);if(MARKET_SUFFIX_NAME.IsCBOT(n,i))return this.GetCBOTData(n,i);if(MARKET_SUFFIX_NAME.IsLME(n,i))return this.GetLMEData(n,i)}}}else r=t;return{Count:r.Count,MiddleCount:r.MiddleCount,Data:r.GetData(i)}},this.GetSHSZData=function(e,a){return t},this.GetUSAData=function(t,e){return i},this.GetSHOData=function(t,a){return e},this.GetFuturesData=function(t,e,a){var i=a.GetSplitData(t);if(!i)return null;var r=g_MinuteTimeStringData.GetFutures(i);if(!r)return null;var n={Count:r.length},s=null;s=e<200?i.Coordinate.Min:e<480?i.Coordinate.Simple:i.Coordinate.Full;for(var o=[],h=0;h<r.length;++h)for(var l=r[h],C=0;C<s.length;++C){var u=s[C];if(l==u.Value){var D=[h,0,"RGB(200,200,200)",u.Text];o.push(D);break}}return n.Data=o,n},this.GetChinatFuturesData=function(t,e){return this.GetFuturesData(t,e,g_FuturesTimeData)},this.GetNYMEXData=function(t,e){return this.GetFuturesData(t,e,g_NYMEXTimeData)},this.GetCOMEXData=function(t,e){return this.GetFuturesData(t,e,g_COMEXTimeData)},this.GetNYBOTData=function(t,e){return this.GetFuturesData(t,e,g_NYBOTTimeData)},this.GetCBOTData=function(t,e){return this.GetFuturesData(t,e,g_CBOTTimeData)},this.GetLMEData=function(t,e){return this.GetFuturesData(t,e,g_LMETimeData)},this.GetFTSEData=function(t,e){return r},this.GetFHKData=function(t,e){return n},this.GetForeignExchangeData=function(t,e){return s},this.GetBITData=function(t,e){return s},this.GetETData=function(t,e){throw{Name:"MinuteCoordinateData::GetETData",Error:"not implement"}}}function FuturesTimeData(){this.TIME_SPLIT=[{Name:"9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:900,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1330,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Min:[{Value:900,Text:"9:00"},{Value:1330,Text:"13:30"},{Value:1500,Text:"15:00"}]}},{Name:"9:15-11:30,13:00-15:15",Data:[{Start:915,End:1130},{Start:1301,End:1515}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1515,Text:"15:15"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1515,Text:"15:15"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1515,Text:"15:15"}]}},{Name:"9:30-11:30,13:00-15:00",Data:[{Start:930,End:1130},{Start:1301,End:1500}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:30,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2330},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-1:00,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2359},{Start:0,End:100},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-2:30,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2359},{Start:0,End:230},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:00,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2300},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}}],this.MAP_TWOWORDS=new Map([[MARKET_SUFFIX_NAME.DCE+"-JD",{Time:0,Decimal:0,Name:"鸡蛋"}],[MARKET_SUFFIX_NAME.DCE+"-FB",{Time:0,Decimal:2,Name:"纤板"}],[MARKET_SUFFIX_NAME.DCE+"-BB",{Time:0,Decimal:2,Name:"胶板"}],[MARKET_SUFFIX_NAME.DCE+"-PP",{Time:6,Decimal:0,Name:"丙烯"}],[MARKET_SUFFIX_NAME.DCE+"-JM",{Time:6,Decimal:1,Name:"焦煤"}],[MARKET_SUFFIX_NAME.DCE+"-EG",{Time:6,Decimal:0,Name:"乙二醇"}],[MARKET_SUFFIX_NAME.DCE+"-EB",{Time:6,Decimal:0,Name:"苯乙烯"}],[MARKET_SUFFIX_NAME.DCE+"-CS",{Time:6,Decimal:0,Name:"淀粉"}],[MARKET_SUFFIX_NAME.DCE+"-PG",{Time:6,Decimal:0,Name:"液化气"}],[MARKET_SUFFIX_NAME.DCE+"-RR",{Time:6,Decimal:0,Name:"梗米"}],[MARKET_SUFFIX_NAME.SHFE+"-CU",{Time:4,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-AL",{Time:4,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-NI",{Time:4,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-SN",{Time:4,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-ZN",{Time:4,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-PB",{Time:4,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-RU",{Time:6,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-FU",{Time:6,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-RB",{Time:6,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-BU",{Time:6,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-HC",{Time:6,Decimal:0}],[MARKET_SUFFIX_NAME.SHFE+"-SP",{Time:6,Decimal:0,Name:"纸浆"}],[MARKET_SUFFIX_NAME.SHFE+"-WR",{Time:0,Decimal:0,Name:"线材"}],[MARKET_SUFFIX_NAME.SHFE+"-AG",{Time:5,Decimal:0,Name:"白银"}],[MARKET_SUFFIX_NAME.SHFE+"-AU",{Time:5,Decimal:2,Name:"黄金"}],[MARKET_SUFFIX_NAME.SHFE+"-NR",{Time:6,Decimal:1,Name:"20号胶"}],[MARKET_SUFFIX_NAME.SHFE+"-SC",{Time:6,Decimal:1,Name:"中质含硫原油"}],[MARKET_SUFFIX_NAME.SHFE+"-LU",{Time:6,Decimal:0,Name:"低硫燃料油"}],[MARKET_SUFFIX_NAME.CZCE+"-CF",{Time:6,Decimal:0,Name:"棉花"}],[MARKET_SUFFIX_NAME.CZCE+"-SR",{Time:6,Decimal:0,Name:"白糖"}],[MARKET_SUFFIX_NAME.CZCE+"-MA",{Time:6,Decimal:0,Name:"甲醇"}],[MARKET_SUFFIX_NAME.CZCE+"-ZC",{Time:6,Decimal:1,Name:"动力煤"}],[MARKET_SUFFIX_NAME.CZCE+"-TA",{Time:6,Decimal:0,Name:"精对苯二甲酸(PTA)"}],[MARKET_SUFFIX_NAME.CZCE+"-RM",{Time:6,Decimal:0,Name:"菜籽粕"}],[MARKET_SUFFIX_NAME.CZCE+"-OI",{Time:6,Decimal:0,Name:"菜籽油"}],[MARKET_SUFFIX_NAME.CZCE+"-ME",{Time:3,Decimal:0,Name:"甲醇(老)"}],[MARKET_SUFFIX_NAME.CZCE+"-FG",{Time:6,Decimal:0,Name:"平板玻璃"}],[MARKET_SUFFIX_NAME.CZCE+"-WS",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-WT",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-GN",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-RO",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-RS",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-ER",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-RI",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-WH",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-AP",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-PM",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-QM",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-TC",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-JR",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-LR",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-SF",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CZCE+"-SM",{Time:0,Decimal:0}],[MARKET_SUFFIX_NAME.CFFEX+"-TF",{Time:1,Decimal:3,Name:"二债"}],[MARKET_SUFFIX_NAME.CFFEX+"-TS",{Time:1,Decimal:3,Name:"五债"}],[MARKET_SUFFIX_NAME.CFFEX+"-IH",{Time:2,Decimal:1,Name:"上证股指期货"}],[MARKET_SUFFIX_NAME.CFFEX+"-IC",{Time:2,Decimal:1,Name:"中证股指期货"}],[MARKET_SUFFIX_NAME.CFFEX+"-IF",{Time:2,Decimal:1,Name:"沪深股指期货"}]]),this.MAP_ONEWORD=new Map([[MARKET_SUFFIX_NAME.DCE+"-C",{Time:6,Decimal:0,Name:"玉米"}],[MARKET_SUFFIX_NAME.DCE+"-L",{Time:6,Decimal:0,Name:"乙烯"}],[MARKET_SUFFIX_NAME.DCE+"-V",{Time:6,Decimal:0,Name:"PVC"}],[MARKET_SUFFIX_NAME.DCE+"-A",{Time:6,Decimal:0,Name:"豆一"}],[MARKET_SUFFIX_NAME.DCE+"-B",{Time:6,Decimal:0,Name:"豆二"}],[MARKET_SUFFIX_NAME.DCE+"-M",{Time:6,Decimal:0,Name:"豆粕"}],[MARKET_SUFFIX_NAME.DCE+"-Y",{Time:6,Decimal:0,Name:"豆油"}],[MARKET_SUFFIX_NAME.DCE+"-P",{Time:6,Decimal:0,Name:"棕榈"}],[MARKET_SUFFIX_NAME.DCE+"-J",{Time:6,Decimal:1,Name:"焦炭"}],[MARKET_SUFFIX_NAME.DCE+"-I",{Time:6,Decimal:1,Name:"铁矿"}],[MARKET_SUFFIX_NAME.CFFEX+"-T",{Time:1,Decimal:3,Name:"十债"}]]),this.AddNewFutures=function(t){if(t){var e=t.Suffix+"-"+t.Symbol,a={Time:t.Time,Decimal:t.Decimal,Name:t.Name};1==t.Symbol.length?this.MAP_ONEWORD.set(e,a):2==t.Symbol.length&&this.MAP_TWOWORDS.set(e,a)}},this.GetData=function(t){var e=t.charAt(0),a=t.substr(0,2),i=null,r=null;return MARKET_SUFFIX_NAME.IsDCE(t)?(i=MARKET_SUFFIX_NAME.DCE+"-"+e,r=MARKET_SUFFIX_NAME.DCE+"-"+a):MARKET_SUFFIX_NAME.IsSHFE(t)?(i=MARKET_SUFFIX_NAME.SHFE+"-"+e,r=MARKET_SUFFIX_NAME.SHFE+"-"+a):MARKET_SUFFIX_NAME.IsCFFEX(t)?(i=MARKET_SUFFIX_NAME.CFFEX+"-"+e,r=MARKET_SUFFIX_NAME.CFFEX+"-"+a):MARKET_SUFFIX_NAME.IsCZCE(t)&&(i=MARKET_SUFFIX_NAME.CZCE+"-"+e,r=MARKET_SUFFIX_NAME.CZCE+"-"+a),this.MAP_TWOWORDS.has(r)?this.MAP_TWOWORDS.get(r):this.MAP_ONEWORD.has(i)?this.MAP_ONEWORD.get(i):null},this.GetSplitData=function(t){var e=this.GetData(t);return e?this.TIME_SPLIT[e.Time]:null},this.GetDecimal=function(t){var e=this.GetData(t);return e?e.Decimal:2}}function NYMEXTimeData(){this.TIME_SPLIT=[{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1900,Text:"19:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"CL",Decimal:2,Time:0},{Symbol:"NG",Decimal:3,Time:0},{Symbol:"RB",Decimal:4,Time:0},{Symbol:"PL",Decimal:1,Time:0},{Symbol:"PA",Decimal:2,Time:0},{Symbol:"HR",Decimal:0,Time:0},{Symbol:"QM",Decimal:3,Time:0},{Symbol:"HO",Decimal:4,Time:0}],this.MarketSuffix=".NYMEX",this.TimeType=0,this.GetFuturesInfo=function(t){if(t.indexOf(this.MarketSuffix)<=0)return null;for(var e in this.FUTURES_LIST){var a=this.FUTURES_LIST[e];if(0==t.indexOf(a.Symbol))return a}return null},this.GetSplitData=function(t){var e=0==this.TimeType?this.TIME_SPLIT:this.TIME_SPLIT2,a=this.GetFuturesInfo(t);return a?e[a.Time]:e[0]},this.GetDecimal=function(t){var e=this.GetFuturesInfo(t);return e?e.Decimal:3},this.GetMarketStatus=function(t){var e=GetLocalTime(-4),a=new Date,i=e.getDay(),r=100*a.getHours()+a.getMinutes();return 6==i||0==i?0:r>430&&r<730?1:2}}function COMEXTimeData(){this.newMethod=NYMEXTimeData,this.newMethod(),delete this.newMethod,this.FUTURES_LIST=[{Symbol:"GC",Decimal:1,Time:0},{Symbol:"QO",Decimal:2,Time:0},{Symbol:"MG",Decimal:1,Time:0},{Symbol:"QI",Decimal:4,Time:0},{Symbol:"SI",Decimal:3,Time:0},{Symbol:"QI",Decimal:4,Time:0},{Symbol:"HG",Decimal:4,Time:0}],this.MarketSuffix=".COMEX"}function NYBOTTimeData(){this.newMethod=NYMEXTimeData,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"9:00-2:20",Data:[{Start:900,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1700,Text:"17:00"},{Value:100,Text:"1:00"}]}},{Name:"15:30-1:00",Data:[{Start:1530,End:2359},{Start:0,End:100}],Coordinate:{Full:[{Value:1600,Text:"16:00"},{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"}],Simple:[{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"}],Min:[{Value:1600,Text:"16:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}]}}],this.TIME_SPLIT2=[{Name:"10:00-3:20",Data:[{Start:1e3,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:1e3,Text:"10:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"16:30-2:00",Data:[{Start:1630,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Min:[{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SB",Decimal:2,Time:1},{Symbol:"CT",Decimal:2,Time:0}],this.MarketSuffix=".NYBOT",this.GetMarketStatus=function(t){var e=GetLocalTime(-4),a=e.getDay(),i=100*e.getHours()+e.getMinutes();if(6==a||0==a)return 0;var r=this.GetFuturesInfo(t);if(!r)return 2;if("SB"==r.Symbol){if(i>300&&i<1400)return 2}else if("CT"==r.Symbol)return i>=0&&i<=1500||i>=2e3&&i<=2359?2:1;return 0}}function CBOTTimeData(){this.newMethod=NYMEXTimeData,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"8:00-2:20",Data:[{Start:800,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"8:00-2:45",Data:[{Start:800,End:2359},{Start:0,End:245}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"9:00-3:20",Data:[{Start:900,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"9:00-3:45",Data:[{Start:900,End:2359},{Start:0,End:345}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"ZC",Decimal:2,Time:0},{Symbol:"XC",Decimal:2,Time:1},{Symbol:"ZS",Decimal:2,Time:0},{Symbol:"XK",Decimal:2,Time:1},{Symbol:"ZL",Decimal:2,Time:0},{Symbol:"ZR",Decimal:2,Time:0},{Symbol:"ZO",Decimal:2,Time:0},{Symbol:"ZW",Decimal:2,Time:0},{Symbol:"XW",Decimal:2,Time:1},{Symbol:"ZM",Decimal:1,Time:0},{Symbol:"EH",Decimal:3,Time:2},{Symbol:"YM",Decimal:0,Time:2},{Symbol:"ES",Decimal:2,Time:2},{Symbol:"NQ",Decimal:2,Time:2},{Symbol:"TY",Decimal:4,Time:2},{Symbol:"TU",Decimal:4,Time:2},{Symbol:"FV",Decimal:4,Time:2},{Symbol:"US",Decimal:4,Time:2},{Symbol:"UL",Decimal:4,Time:2}],this.MarketSuffix=".CBOT"}function LMETimeData(){this.newMethod=NYMEXTimeData,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"LME 9:00-3:00",Data:[{Start:900,End:2359},{Start:0,End:300}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1800,Text:"18:00"},{Value:300,Text:"3:00"}]}}],this.TIME_SPLIT=[{Name:"LME 8:00-2:00",Data:[{Start:800,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SND",Decimal:0,Time:0},{Symbol:"AHD",Decimal:2,Time:0},{Symbol:"PBD",Decimal:2,Time:0},{Symbol:"ZSD",Decimal:2,Time:0},{Symbol:"CAD",Decimal:2,Time:0},{Symbol:"NID",Decimal:0,Time:0}],this.MarketSuffix=".LME"}var g_MinuteTimeStringData=new MinuteTimeStringData,g_MinuteCoordinateData=new MinuteCoordinateData,g_FuturesTimeData=new FuturesTimeData,g_NYMEXTimeData=new NYMEXTimeData,g_COMEXTimeData=new COMEXTimeData,g_NYBOTTimeData=new NYBOTTimeData,g_CBOTTimeData=new CBOTTimeData,g_LMETimeData=new LMETimeData;function GetfloatPrecision(t){var e=2;if(!t)return e;var a=t.toUpperCase();return MARKET_SUFFIX_NAME.IsSHSZFund(a)?e=3:MARKET_SUFFIX_NAME.IsSHO(a)?e=MARKET_SUFFIX_NAME.GetSHODecimal(a):MARKET_SUFFIX_NAME.IsChinaFutures(a)?e=g_FuturesTimeData.GetDecimal(a):MARKET_SUFFIX_NAME.IsFHK(a)?e=MARKET_SUFFIX_NAME.GetFHKDecimal(a):MARKET_SUFFIX_NAME.IsFTSE(a)?e=MARKET_SUFFIX_NAME.GetFTSEDecimal(a):MARKET_SUFFIX_NAME.IsBIT(a)?e=MARKET_SUFFIX_NAME.GetBITDecimal(a):MARKET_SUFFIX_NAME.IsET(a)?e=MARKET_SUFFIX_NAME.GetETDecimal(a):MARKET_SUFFIX_NAME.IsForeignExchange(a)?e=MARKET_SUFFIX_NAME.GetForeignExchangeDecimal(a):MARKET_SUFFIX_NAME.IsNYMEX(a)?e=g_NYMEXTimeData.GetDecimal(a):MARKET_SUFFIX_NAME.IsCOMEX(a)?e=g_COMEXTimeData.GetDecimal(a):MARKET_SUFFIX_NAME.IsNYBOT(a)?e=g_NYBOTTimeData.GetDecimal(a):MARKET_SUFFIX_NAME.IsCBOT(a)&&(e=g_CBOTTimeData.GetDecimal(a)),e}function GenerateMinuteStockJsonData(t){var e={symbol:t.symbol,name:t.name,time:t.time,date:t.date,price:t.price,open:t.open,yclose:t.yclose,high:t.high,low:t.low,vol:t.vol,amount:t.amount,minute:[]},a=new Map;for(var i in t.minute){var r=t.minute[i];a.set(r.time,r)}var n=g_MinuteTimeStringData.GetTimeData(e.symbol);for(var i in n){var s=n[i],o={time:s,vaild:!1};if(a.has(s)){var h=a.get(s);o.vaild=!0,o.price=h.price,o.open=h.open,o.high=h.high,o.low=h.low,o.avprice=h.avprice,o.vol=h.vol,o.amount=h.amount,IFrameSplitOperator.IsNumber(h.increase)&&(o.increase=h.increase),IFrameSplitOperator.IsNumber(h.risefall)&&(o.risefall=h.risefall),IFrameSplitOperator.IsNumber(h.position)&&(o.position=h.position)}e.minute.push(o)}var l=0;for(i=e.minute.length-1;i>=0;--i){if(l=i+1,1==(r=e.minute[i]).vaild)break}return e.minute=e.minute.slice(0,l),e}function GetLocalTime(t){if("number"==typeof t){var e=new Date,a=e.getTime(),i=6e4*e.getTimezoneOffset();return new Date(a+i+36e5*t)}};function JSStockResource(){this.Domain="https://opensource.zealink.com",this.CacheDomain="https://opensourcecache.zealink.com"}var g_JSStockResource=new JSStockResource;function IndexTopData(){this.Stop,this.Down,this.Up,this.Unchanged,this.UpStock={Symbol:null,Name:null},this.DownStock={Symbol:null,Name:null}}function IndexHeatData(){this.Good,this.GoodIncrease={Day1:null,Week1:null,Week4:null}}function SortData(t,e,a){this.arySymbol=new Array,this.SortField=t,this.Order=e,this.TagID=new Set([a])}function FinanceData(){this.ROE,this.Date,this.PerSEarning,this.EPS,this.PerNetAsset,this.NProfit,this.NProfitIncrease,this.NnetProfit,this.NnProfitIncrease,this.NnProfitSpeed,this.Benford,this.SetData=function(t){isNaN(t.roe)||(this.ROE=t.roe),isNaN(t.finance.date)||(this.Date=t.finance.date),isNaN(t.finance.persearning)||(this.PerSEarning=t.finance.persearning),isNaN(t.finance.eps)||(this.EPS=t.finance.eps),isNaN(t.finance.pernetasset)||(this.PerNetAsset=t.finance.pernetasset),isNaN(t.finance.nprofit)||(this.NProfit=t.finance.nprofit),isNaN(t.finance.nprofitincrease)||(this.NProfitIncrease=t.finance.nprofitincrease),isNaN(t.finance.nnetprofit)||(this.NnetProfit=t.finance.nnetprofit),isNaN(t.finance.nnprofitincrease)||(this.NnProfitIncrease=t.finance.nnprofitincrease),isNaN(t.finance.nnprofitspeed)||(this.NnProfitSpeed=t.finance.nnprofitspeed),isNaN(t.finance.benford)||(this.Benford=t.finance.benford)}}function CapitalData(){this.Date,this.A,this.Total,this.ARate,this.SetData=function(t){isNaN(t.capital.date)||(this.Date=t.capital.date),isNaN(t.capital.a)||(this.A=t.capital.a),isNaN(t.capital.total)||(this.Total=t.capital.total),isNaN(t.capital.arate)||(this.ARate=t.capital.arate)}}function CapitalFlowDayData(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.SetData=function(t){this.SuperIn=t.superin,this.SuperOut=t.superout,this.BigIn=t.bigin,this.BigOut=t.bigout,this.MidIn=t.midin,this.MidOut=t.midout,this.SmallIn=t.smallin,this.SmallOut=t.smallout,this.MainIn=t.mainin,this.MainOut=t.mainout,this.MainNetIn=t.mainnetin}}function CapitalFlowDaysData(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.MainNetInRatio,this.SetData=function(t){this.SuperIn=t.superin,this.SuperOut=t.superout,this.BigIn=t.bigin,this.BigOut=t.bigout,this.MidIn=t.midin,this.MidOut=t.midout,this.SmallIn=t.smallin,this.SmallOut=t.smallout,this.MainIn=t.mainin,this.MainOut=t.mainout,this.MainNetIn=t.mainnetin,this.MainNetInRatio=t.mainnetinratio}}function DDEData(){this.DDX,this.DDY,this.DDZ,this.SetData=function(t){this.DDX=t.ddx,this.DDY=t.ddy,this.DDZ=t.ddz}}function CompanyData(){this.Name,this.Business,this.Vol,this.Price,this.ReleaseDate,this.Competence,this.SetData=function(t){t.company&&(this.Name=t.company.name,this.Business=t.company.business,this.Vol=t.company.vol,this.Price=t.company.price,this.ReleaseDate=t.company.releasedate,this.Competence=t.company.corecompetence)}}function PlateData(){this.Industry,this.Region,this.Concept,this.SetData=function(t){this.SetIndustryData(t),this.SetRegionData(t),this.SetConceptData(t)},this.SetIndustryData=function(t){if(t.industry){this.Industry=[];for(var e in t.industry){var a=t.industry[e];this.Industry.push({Name:a.name,Symbol:a.symbol})}}},this.SetRegionData=function(t){if(t.region){this.Region=[];for(var e in t.region){var a=t.region[e];this.Region.push({Name:a.name,Symbol:a.symbol})}}},this.SetConceptData=function(t){if(t.concept){this.Concept=[];for(var e in t.concept){var a=t.concept[e];this.Concept.push({Name:a.name,Symbol:a.symbol})}}}}function EventData(){this.IsMargin=!1,this.IsHK=!1,this.IsSHHK=!1,this.IsSZHK=!1,this.STType=0,this.HK,this.SetData=function(t){t.events&&(isNaN(t.events.margin)||(this.IsMargin=1==t.events.margin),isNaN(t.events.hk)||(this.IsHK=1==t.events.hk),isNaN(t.events.shhk)||(this.IsSHHK=1==t.events.shhk),isNaN(t.events.szhk)||(this.IsSZHK=1==t.events.szhk),isNaN(t.events.st)||(this.STType=t.events.st),this.IsHK&&t.events.hksymbol&&t.events.hkname&&(this.HK={Symbol:t.events.hksymbol,Name:t.events.hkname}))}}function IsIndexSymbol(t){var e=t.toUpperCase();if(e.indexOf(".SH")>0){if("0"==(e=e.replace(".SH","")).charAt(0)&&parseInt(e)<=3e3)return!0}else if(e.indexOf(".SZ")>0){if("3"==(e=e.replace(".SZ","")).charAt(0)&&"9"==e.charAt(1))return!0}else if(e.indexOf(".CI")>0)return!0;return!1}function StockData(t){this.Symbol=t,this.Name,this.Open,this.Price,this.High,this.Low,this.YClose,this.Vol,this.Amount,this.Date,this.Time,this.ExchangeRate,this.Amplitude,this.VolRatio,this.Increase,this.MaxPrice,this.MinPrice,this.RFPrice,this.IndexTop,this.Week,this.MinuteAmplitude={},this.RiseFallSpeed={},this.MAmount={},this.GetBaseData=function(t,e){switch(this.BaseDataTagID.add(t),e){case STOCK_FIELD_NAME.SYMBOL:return this.Symbol;case STOCK_FIELD_NAME.NAME:return this.Name;case STOCK_FIELD_NAME.OPEN:return this.Open;case STOCK_FIELD_NAME.PRICE:return this.Price;case STOCK_FIELD_NAME.YCLOSE:return this.YClose;case STOCK_FIELD_NAME.HIGH:return this.High;case STOCK_FIELD_NAME.LOW:return this.Low;case STOCK_FIELD_NAME.VOL:return this.Vol;case STOCK_FIELD_NAME.AMOUNT:return this.Amount;case STOCK_FIELD_NAME.DATE:return this.Date;case STOCK_FIELD_NAME.TIME:return this.Time;case STOCK_FIELD_NAME.INCREASE:return this.Increase;case STOCK_FIELD_NAME.EXCHANGE_RATE:return this.ExchangeRate;case STOCK_FIELD_NAME.AMPLITUDE:return this.Amplitude;case STOCK_FIELD_NAME.MAX_PRICE:return this.MaxPrice;case STOCK_FIELD_NAME.MIN_PRICE:return this.MinPrice;case STOCK_FIELD_NAME.RISE_FALL_PRICE:return this.RFPrice;case STOCK_FIELD_NAME.VOLRATIO:return this.VolRatio;case STOCK_FIELD_NAME.INDEXTOP:return this.IndexTop;case STOCK_FIELD_NAME.WEEK:return this.Week}},this.Heat,this.GetHeatData=function(t){return this.HeatTagID.add(t),this.Heat},this.Sort=new Map,this.GetSortData=function(t,e,a){var i=e.toString()+"-"+a.toString();if(!this.Sort.has(i)){var s=new SortData(e,a,t);return this.Sort.set(i,s),s}return(s=this.Sort.get(i)).TagID.add(t),s},this.Buy5,this.GetBuy5=function(t){return this.BuySellTagID.add(t),this.Buy5},this.Sell5,this.GetSell5=function(t){return this.BuySellTagID.add(t),this.Sell5},this.Deal,this.GetDeal=function(t){return this.DealTagID.add(t),this.Deal},this.MarketValue,this.FlowMarketValue,this.Bookrate,this.Bookdiffer,this.PE,this.PE2,this.PE3,this.PB,this.GetDerivative=function(t,e){switch(this.DerivativeTagID.add(t),e){case STOCK_FIELD_NAME.MARKET_VALUE:return this.MarketValue;case STOCK_FIELD_NAME.FLOW_MARKET_VALUE:return this.FlowMarketValue;case STOCK_FIELD_NAME.BOOK_RATE:return this.Bookrate;case STOCK_FIELD_NAME.BOOK_DIFFER:return this.Bookdiffer;case STOCK_FIELD_NAME.PE:return this.PE;case STOCK_FIELD_NAME.PE2:return this.PE2;case STOCK_FIELD_NAME.PE3:return this.PE3;case STOCK_FIELD_NAME.PB:return this.PB}},this.Finance,this.GetFinance=function(t,e){if(!this.Finance)return this.FinanceTagID.add(t),null;switch(e){case STOCK_FIELD_NAME.ROE:return this.Finance.ROE;case STOCK_FIELD_NAME.FINANCE_DATE:return this.Finance.Date;case STOCK_FIELD_NAME.FINANCE_PERSEARNING:return this.Finance.PerSEarning;case STOCK_FIELD_NAME.FINANCE_PERNETASSET:return this.Finance.PerNetAsset;case STOCK_FIELD_NAME.FINANCE_NPROFIT:return this.Finance.NProfit;case STOCK_FIELD_NAME.FINANCE_NPROFITINCREASE:return this.Finance.NProfitIncrease;case STOCK_FIELD_NAME.FINANCE_NNETPROFIT:return this.Finance.NnetProfit;case STOCK_FIELD_NAME.FINANCE_NNPROFITINCREASE:return this.Finance.NnProfitIncrease;case STOCK_FIELD_NAME.FINANCE_NNPROFITSPEED:return this.Finance.NnProfitSpeed;case STOCK_FIELD_NAME.FINANCE_EPS:return this.Finance.EPS;case STOCK_FIELD_NAME.FINANCE_BENFORD:return this.Finance.Benford}},this.Capital,this.GetCapital=function(t,e){if(!this.Capital)return this.CapitalTagID.add(t),null;switch(e){case STOCK_FIELD_NAME.CAPITAL_TOTAL:return this.Capital.Total;case STOCK_FIELD_NAME.CAPITAL_A:return this.Capital.A;case STOCK_FIELD_NAME.CAPTIAL_ARATE:return this.Capital.ARate}},this.CapitalFlowDay,this.CapitalFlowDay3,this.CapitalFlowDay5,this.CapitalFlowDay10,this.GetCapitalFlowDay=function(t,e){var a=null;switch(e){case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY:this.CapitalFlowDayID.add(t),this.CapitalFlowDay&&(a=this.CapitalFlowDay);break;case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY3:this.CapitalFlowDay3ID.add(t),this.CapitalFlowDay3&&(a=this.CapitalFlowDay3);break;case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY5:this.CapitalFlowDay5ID.add(t),this.CapitalFlowDay5&&(a=this.CapitalFlowDay5);break;case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY10:this.CapitalFlowDay10ID.add(t),this.CapitalFlowDay10&&(a=this.CapitalFlowDay10)}return a},this.DDE,this.DDE3,this.DDE5,this.DDE10,this.GetDDE=function(t,e){var a=null;switch(e){case STOCK_FIELD_NAME.DDE:this.DDEID.add(t),this.DDE&&(a=this.DDE);break;case STOCK_FIELD_NAME.DDE3:this.DDE3ID.add(t),this.DDE3&&(a=this.DDE3);break;case STOCK_FIELD_NAME.DDE5:this.DDE5ID.add(t),this.DDE5&&(a=this.DDE5);break;case STOCK_FIELD_NAME.DDE10:this.DDE10ID.add(t),this.DDE10&&(a=this.DDE10)}return a},this.Event,this.GetEvent=function(t,e){return this.Event?this.Event:(this.EventTagID.add(t),null)},this.Company,this.GetCompany=function(t,e){if(!this.Company)return this.CompanyTagID.add(t),null;switch(e){case STOCK_FIELD_NAME.COMPANY_NAME:return this.Company.Name;case STOCK_FIELD_NAME.COMPANY_BUSINESS:return this.Company.Business;case STOCK_FIELD_NAME.COMPANY_VOL:return this.Company.Vol;case STOCK_FIELD_NAME.COMPANY_PRICE:return this.Company.Price;case STOCK_FIELD_NAME.COMPANY_RELEASEDATE:return this.Company.ReleaseDate;case STOCK_FIELD_NAME.COMPANY_COMPETENCE:return this.Company.Competence}},this.Plate,this.GetPlate=function(t,e){if(!this.Plate)return this.PlateTagID.add(t),null;switch(e){case STOCK_FIELD_NAME.PLATE_INDUSTRY:return this.Plate.Industry;case STOCK_FIELD_NAME.PLATE_CONCEPT:return this.Plate.Concept;case STOCK_FIELD_NAME.PLATE_REGION:return this.Plate.Region}},this.TagID=new Set,this.BaseDataTagID=new Set,this.HeatTagID=new Set,this.BuySellTagID=new Set,this.DealTagID=new Set,this.DerivativeTagID=new Set,this.FinanceTagID=new Set,this.CapitalTagID=new Set,this.CapitalFlowDayID=new Set,this.CapitalFlowDay3ID=new Set,this.CapitalFlowDay5ID=new Set,this.CapitalFlowDay10ID=new Set,this.DDEID=new Set,this.DDE3ID=new Set,this.DDE5ID=new Set,this.DDE10ID=new Set,this.EventTagID=new Set,this.CompanyTagID=new Set,this.PlateTagID=new Set,this.AttachTagID=function(t){this.TagID.add(t)},this.ClearTagID=function(){for(var t of(this.TagID.clear(),this.BaseDataTagID.clear(),this.HeatTagID.clear(),this.BuySellTagID.clear(),this.DealTagID.clear(),this.DerivativeTagID.clear(),this.FinanceTagID.clear(),this.CapitalTagID.clear(),this.CapitalFlowDayID.clear(),this.CapitalFlowDay3ID.clear(),this.CapitalFlowDay5ID.clear(),this.CapitalFlowDay10ID.clear(),this.DDEID.clear(),this.DDE3ID.clear(),this.DDE5ID.clear(),this.DDE10ID.clear(),this.EventTagID.clear(),this.CompanyTagID.clear(),this.Sort))t[1].TagID.clear()},this.RemoveTagID=function(t){for(var e of(this.TagID.delete(t),this.BaseDataTagID.delete(t),this.HeatTagID.delete(t),this.BuySellTagID.delete(t),this.DealTagID.delete(t),this.DerivativeTagID.delete(t),this.FinanceTagID.delete(t),this.CapitalTagID.delete(t),this.CapitalFlowDayID.delete(t),this.CapitalFlowDay3ID.delete(t),this.CapitalFlowDay5ID.delete(t),this.CapitalFlowDay10ID.delete(t),this.DDEID.delete(t),this.DDE3ID.delete(t),this.DDE5ID.delete(t),this.DDE10ID.delete(t),this.EventTagID.delete(t),this.CompanyTagID.delete(t),this.Sort))e[1].TagID.delete(t)},this.SetBaseData=function(t){this.Name=t.name,this.YClose=t.yclose,this.Price=t.price,this.High=t.high,this.Low=t.low,this.Open=t.open,this.Vol=t.vol,this.Amount=t.amount,this.Date=t.date,this.Time=t.time,this.Increase=t.increase,isNaN(t.exchangerate)||(this.ExchangeRate=t.exchangerate),isNaN(t.amplitude)||(this.Amplitude=t.amplitude),isNaN(t.volratio)||(this.VolRatio=t.volratio),this.Name.indexOf("ST")>=0?(this.MaxPrice=1.05*this.Open,this.MinPrice=.95*this.Open):(this.MaxPrice=1.1*this.Open,this.MinPrice=.9*this.Open),this.Price&&this.YClose&&(this.RFPrice=this.Price-this.YClose),t.week&&(this.Week={},this.Week.Week1=t.week.week1,this.Week.Week4=t.week.week4,this.Week.Week13=t.week.week13,this.Week.Week26=t.week.week26,this.Week.Week52=t.week.week52)},this.SetDerivativeData=function(t){this.MarketValue=t.marketvalue,this.FlowMarketValue=t.flowmarketvalue,this.Bookrate=t.bookrate,this.Bookdiffer=t.bookdiffer,this.PE=t.pe,this.PE2=t.pe2,this.PE3=t.pe3,this.PB=t.pb},this.SetFinanceData=function(t){console.log(t),t.finance&&(this.Finance=new FinanceData,this.Finance.SetData(t))},this.SetCapitalData=function(t){t.capital&&(this.Capital=new CapitalData,this.Capital.SetData(t))},this.SetIndexBaseData=function(t){this.SetBaseData(t);var e=new IndexTopData;t.indextop&&(e.Up=t.indextop.up,e.Down=t.indextop.down,e.Unchanged=t.indextop.unchanged,e.Stop=t.indextop.stop,e.UpStock.Symbol=t.indextop.upstock.symbol,e.UpStock.Name=t.indextop.upstock.name,e.DownStock.Symbol=t.indextop.downstock.symbol,e.DownStock.Name=t.indextop.downstock.name),this.IndexTop=e},this.SetBuySellData=function(t){for(var e in this.SetBaseData(t),this.Buy5=new Array,this.Sell5=new Array,t.buy){var a=t.buy[e];this.Buy5.push({Price:a.price,Vol:a.vol})}for(var e in t.sell){a=t.sell[e];this.Sell5.push({Price:a.price,Vol:a.vol})}},this.SetDealData=function(t){for(var e in this.Price=t.price,this.High=t.high,this.Low=t.low,this.Vol=t.vol,this.Amount=t.amount,this.Date=t.date,this.Time=t.time,this.Increase=t.increase,this.Deal=new Array,t.deal){var a=t.deal[e];if(!isNaN(a.price)&&!isNaN(a.time)){var i="";0===a.bs?i="B":1===a.bs&&(i="S"),this.Deal.push({Price:a.price,Amount:a.amount,Vol:a.vol,Time:a.time,BS:i})}}},this.SetHeatData=function(t){var e=new IndexHeatData;e.Good=t.quadrant.good,e.GoodIncrease.Day1=t.quadrant.gincrease.day1,e.GoodIncrease.Week1=t.quadrant.gincrease.week1,e.GoodIncrease.Week4=t.quadrant.gincrease.week4,this.Heat=e},this.SetCapitalFlowDayData=function(t,e){if(t)switch(e){case RECV_DATA_TYPE.CAPITAL_FLOW_DAY_DATA:this.CapitalFlowDay=new CapitalFlowDayData,this.CapitalFlowDay.SetData(t);break;case RECV_DATA_TYPE.CAPITAL_FLOW_DAY3_DATA:this.CapitalFlowDay3=new CapitalFlowDaysData,this.CapitalFlowDay3.SetData(t);break;case RECV_DATA_TYPE.CAPITAL_FLOW_DAY5_DATA:this.CapitalFlowDay5=new CapitalFlowDaysData,this.CapitalFlowDay5.SetData(t);break;case RECV_DATA_TYPE.CAPITAL_FLOW_DAY10_DATA:this.CapitalFlowDay10=new CapitalFlowDaysData,this.CapitalFlowDay10.SetData(t)}},this.SetDDE=function(t,e){if(t){switch(e){case RECV_DATA_TYPE.DDE_DAY_DATA:this.DDE=new DDEData,this.DDE.SetData(t);break;case RECV_DATA_TYPE.DDE_DAY3_DATA:this.DDE3=new DDEData,this.DDE3.SetData(t);break;case RECV_DATA_TYPE.DDE_DAY5_DATA:this.DDE5=new DDEData,this.DDE5.SetData(t);break;case RECV_DATA_TYPE.DDE_DAY10_DATA:this.DDE10=new DDEData,this.DDE10.SetData(t)}return t}},this.SetEventData=function(t){t.events&&(this.Event=new EventData,this.Event.SetData(t))},this.SetCompanyData=function(t){t.company&&(this.Company=new CompanyData,this.Company.SetData(t))},this.SetPlateData=function(t){(t.industry||t.region||t.concept)&&(this.Plate=new PlateData,this.Plate.SetData(t))},this.SetData=function(t){t.name&&(this.Name=t.name),isNaN(t.yclose)||(this.YClose=t.yclose),isNaN(t.price)||(this.Price=t.price),isNaN(t.high)||(this.High=t.high),isNaN(t.low)||(this.Low=t.low),isNaN(t.vol)||(this.Vol=t.vol),isNaN(t.amount)||(this.Amount=t.amount),isNaN(t.date)||(this.Date=t.date),isNaN(t.time)||(this.Time=t.time),isNaN(t.increase)||(this.Increase=t.increase),isNaN(t.marketvalue)||(this.MarketValue=t.marketvalue),isNaN(t.flowmarketvalue)||(this.FlowMarketValue=t.flowmarketvalue),isNaN(t.bookrate)||(this.Bookrate=t.bookrate),isNaN(t.bookdiffer)||(this.Bookdiffer=t.bookdiffer),isNaN(t.pe)||(this.PE=t.pe),isNaN(t.pb)||(this.PB=t.pb),t.finance&&this.SetFinanceData(t),t.finance&&this.SetFinanceDetailData(t),t.capital&&this.SetCapitalData(t),t.mamplitude&&(isNaN(t.mamplitude[1])||(this.MinuteAmplitude.M1=t.mamplitude[1]),isNaN(t.mamplitude[3])||(this.MinuteAmplitude.M3=t.mamplitude[3]),isNaN(t.mamplitude[5])||(this.MinuteAmplitude.M5=t.mamplitude[5]),isNaN(t.mamplitude[10])||(this.MinuteAmplitude.M10=t.mamplitude[10]),isNaN(t.mamplitude[15])||(this.MinuteAmplitude.M15=t.mamplitude[15])),t.risefallspeed&&(isNaN(t.risefallspeed[1])||(this.RiseFallSpeed.M1=t.risefallspeed[1]),isNaN(t.risefallspeed[3])||(this.RiseFallSpeed.M3=t.risefallspeed[3]),isNaN(t.risefallspeed[5])||(this.RiseFallSpeed.M5=t.risefallspeed[5]),isNaN(t.risefallspeed[10])||(this.RiseFallSpeed.M10=t.risefallspeed[10]),isNaN(t.risefallspeed[15])||(this.RiseFallSpeed.M15=t.risefallspeed[15])),t.mamount&&(isNaN(t.mamount[1])||(this.MAmount.M1=t.mamount[1]),isNaN(t.mamount[3])||(this.MAmount.M5=t.mamount[3]),isNaN(t.mamount[5])||(this.MAmount.M5=t.mamount[5]),isNaN(t.mamount[10])||(this.MAmount.M10=t.mamount[10]),isNaN(t.mamount[15])||(this.MAmount.M15=t.mamount[15]))}}var STOCK_FIELD_NAME={SYMBOL:0,NAME:1,OPEN:2,PRICE:3,HIGH:4,LOW:5,YCLOSE:6,VOL:7,AMOUNT:8,DATE:9,TIME:10,INCREASE:11,BUY5:12,SELL5:13,DEAL:14,AMPLITUDE:15,MARKET_VALUE:16,FLOW_MARKET_VALUE:17,BOOK_RATE:18,BOOK_DIFFER:19,PE:20,PB:21,EXCHANGE_RATE:23,ROE:24,FINANCE_DATE:25,FINANCE_PERSEARNING:26,FINANCE_PERNETASSET:27,FINANCE_NPROFIT:28,FINANCE_NPROFITINCREASE:29,FINANCE_NNETPROFIT:30,FINANCE_NNPROFITINCREASE:31,FINANCE_NNPROFITSPEED:32,FINANCE_EPS:33,MAX_PRICE:34,MIN_PRICE:35,RISE_FALL_PRICE:36,FINANCE_BENFORD:37,RISEFALLSPEED_1:38,RISEFALLSPEED_3:39,RISEFALLSPEED_5:40,RISEFALLSPEED_10:41,RISEFALLSPEED_15:42,MINUTE_AMPLITUDE_1:43,MINUTE_AMPLITUDE_3:44,MINUTE_AMPLITUDE_5:45,MINUTE_AMPLITUDE_10:46,MINUTE_AMPLITUDE_15:47,MINUTE_AMOUNT_1:48,MINUTE_AMOUNT_3:49,MINUTE_AMOUNT_5:50,MINUTE_AMOUNT_10:51,MINUTE_AMOUNT_15:52,COMPANY_NAME:53,PLATE_INDUSTRY:54,PLATE_CONCEPT:55,PLATE_REGION:56,COMPANY_BUSINESS:57,COMPANY_VOL:58,COMPANY_PRICE:59,COMPANY_RELEASEDATE:60,COMPANY_COMPETENCE:61,CAPITAL_FLOW_DAY:67,CAPITAL_FLOW_DAY3:68,CAPITAL_FLOW_DAY5:69,CAPITAL_FLOW_DAY10:70,DDE:71,DDE3:72,DDE5:73,DDE10:74,EVENTS:75,CAPITAL_A:76,CAPITAL_TOTAL:77,CAPTIAL_ARATE:78,VOLRATIO:79,PE2:80,PE3:81,INDEXTOP:100,WEEK:101,HEAT:102},StockDataFieldName={m_mapFiled:new Map([[STOCK_FIELD_NAME.NAME,"name"],[STOCK_FIELD_NAME.SYMBOL,"symbol"],[STOCK_FIELD_NAME.PRICE,"price"],[STOCK_FIELD_NAME.INCREASE,"increase"],[STOCK_FIELD_NAME.PE,"pe"],[STOCK_FIELD_NAME.FINANCE_BENFORD,"finance.benford"],[STOCK_FIELD_NAME.YCLOSE,"yclose"],[STOCK_FIELD_NAME.RISEFALLSPEED_1,"risefallspeed.1"],[STOCK_FIELD_NAME.RISEFALLSPEED_3,"risefallspeed.3"],[STOCK_FIELD_NAME.RISEFALLSPEED_5,"risefallspeed.5"],[STOCK_FIELD_NAME.RISEFALLSPEED_10,"risefallspeed.10"],[STOCK_FIELD_NAME.RISEFALLSPEED_15,"risefallspeed.15"],[STOCK_FIELD_NAME.MINUTE_AMPLITUDE_1,"mamplitude.1"],[STOCK_FIELD_NAME.MINUTE_AMPLITUDE_3,"mamplitude.3"],[STOCK_FIELD_NAME.MINUTE_AMPLITUDE_5,"mamplitude.5"],[STOCK_FIELD_NAME.MINUTE_AMPLITUDE_10,"mamplitude.10"],[STOCK_FIELD_NAME.MINUTE_AMPLITUDE_15,"mamplitude.15"],[STOCK_FIELD_NAME.MINUTE_AMOUNT_1,"mamount.1"],[STOCK_FIELD_NAME.MINUTE_AMOUNT_3,"mamount.3"],[STOCK_FIELD_NAME.MINUTE_AMOUNT_5,"mamount.5"],[STOCK_FIELD_NAME.MINUTE_AMOUNT_10,"mamount.10"],[STOCK_FIELD_NAME.MINUTE_AMOUNT_15,"mamount.15"]]),GetFieldName:function(t){return this.m_mapFiled.has(t)?this.m_mapFiled.get(t):null}};function StockRead(t,e){this.JSStock=t,this.TagID=e,this.Get=function(e,a){var i=t.Get(e,this.TagID);if(!i)return null;switch(a){case STOCK_FIELD_NAME.SYMBOL:case STOCK_FIELD_NAME.NAME:case STOCK_FIELD_NAME.OPEN:case STOCK_FIELD_NAME.PRICE:case STOCK_FIELD_NAME.YCLOSE:case STOCK_FIELD_NAME.HIGH:case STOCK_FIELD_NAME.LOW:case STOCK_FIELD_NAME.VOL:case STOCK_FIELD_NAME.AMOUNT:case STOCK_FIELD_NAME.DATE:case STOCK_FIELD_NAME.TIME:case STOCK_FIELD_NAME.INCREASE:case STOCK_FIELD_NAME.EXCHANGE_RATE:case STOCK_FIELD_NAME.AMPLITUDE:case STOCK_FIELD_NAME.MAX_PRICE:case STOCK_FIELD_NAME.MIN_PRICE:case STOCK_FIELD_NAME.RISE_FALL_PRICE:case STOCK_FIELD_NAME.INDEXTOP:case STOCK_FIELD_NAME.WEEK:case STOCK_FIELD_NAME.VOLRATIO:return i.GetBaseData(this.TagID,a);case STOCK_FIELD_NAME.HEAT:return i.GetHeatData(this.TagID);case STOCK_FIELD_NAME.BUY5:return i.GetBuy5(this.TagID);case STOCK_FIELD_NAME.SELL5:return i.GetSell5(this.TagID);case STOCK_FIELD_NAME.DEAL:return i.GetDeal(this.TagID);case STOCK_FIELD_NAME.MARKET_VALUE:case STOCK_FIELD_NAME.FLOW_MARKET_VALUE:case STOCK_FIELD_NAME.BOOK_RATE:case STOCK_FIELD_NAME.BOOK_DIFFER:case STOCK_FIELD_NAME.PE:case STOCK_FIELD_NAME.PE2:case STOCK_FIELD_NAME.PE3:case STOCK_FIELD_NAME.PB:return i.GetDerivative(this.TagID,a);case STOCK_FIELD_NAME.ROE:case STOCK_FIELD_NAME.FINANCE_DATE:case STOCK_FIELD_NAME.FINANCE_PERSEARNING:case STOCK_FIELD_NAME.FINANCE_PERNETASSET:case STOCK_FIELD_NAME.FINANCE_NPROFIT:case STOCK_FIELD_NAME.FINANCE_NPROFITINCREASE:case STOCK_FIELD_NAME.FINANCE_NNETPROFIT:case STOCK_FIELD_NAME.FINANCE_NNPROFITINCREASE:case STOCK_FIELD_NAME.FINANCE_NNPROFITSPEED:case STOCK_FIELD_NAME.FINANCE_EPS:case STOCK_FIELD_NAME.FINANCE_BENFORD:return i.GetFinance(this.TagID,a);case STOCK_FIELD_NAME.PLATE_INDUSTRY:case STOCK_FIELD_NAME.PLATE_CONCEPT:case STOCK_FIELD_NAME.PLATE_REGION:return i.GetPlate(this.TagID,a);case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY:case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY3:case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY5:case STOCK_FIELD_NAME.CAPITAL_FLOW_DAY10:return i.GetCapitalFlowDay(this.TagID,a);case STOCK_FIELD_NAME.DDE:case STOCK_FIELD_NAME.DDE3:case STOCK_FIELD_NAME.DDE5:case STOCK_FIELD_NAME.DDE10:return i.GetDDE(this.TagID,a);case STOCK_FIELD_NAME.EVENTS:return i.GetEvent(this.TagID,a);case STOCK_FIELD_NAME.COMPANY_NAME:case STOCK_FIELD_NAME.COMPANY_BUSINESS:case STOCK_FIELD_NAME.COMPANY_VOL:case STOCK_FIELD_NAME.COMPANY_PRICE:case STOCK_FIELD_NAME.COMPANY_RELEASEDATE:case STOCK_FIELD_NAME.COMPANY_COMPETENCE:return i.GetCompany(this.TagID,a);case STOCK_FIELD_NAME.CAPITAL_A:case STOCK_FIELD_NAME.CAPTIAL_ARATE:case STOCK_FIELD_NAME.CAPITAL_TOTAL:return i.GetCapital(this.TagID,a);default:return null}},this.GetSort=function(e,a,i){var s=t.Get(e,this.TagID);return null==s?s:s.GetSortData(this.TagID,a,i)},this.EndRead=function(t){1==t&&this.JSStock.ReqeustData()},this.SetQueryField=function(t,e){for(var a in e)this.Get(t,e[a])}}function JSStockHistory(){this.Symbol,this.Callback,this.Order=-1,this.SortField,this.Field,this.Plate,this.Data=new Map,this.ApiUrl=g_JSStockResource.Domain+"/API/StockHistoryDay",this.PageSize=20,this.PageIndex=1,this.Count,this.currentData=null,this.RequsetData=function(t,e){var a=this,i="string"==typeof a.Symbol?[this.Symbol]:this.Symbol,s=i?i.length:0;this.Plate?this.currentData={plate:this.Plate,symbol:i,start:0,end:this.PageSize,field:this.Field,orderfield:this.SortField,order:this.Order,condition:t.GetQuery(),condition2:e?e.GetQuery():[]}:this.currentData={symbol:i,start:0,end:s,field:this.Field,orderfield:this.SortField,order:this.Order,condition:t.GetQuery(),condition2:e?e.GetQuery():[]},$.ajax({url:this.ApiUrl,data:a.currentData,method:"POST",dataType:"json",success:function(e){a.Count=e.data.count,a.RecvData(e,t)},fail:function(e){a.RecvError(e,t)}})},this.GetNextPage=function(){var t=this;this.PageSize*this.PageIndex<this.Count?(this.currentData.start=this.PageSize*this.PageIndex,this.PageIndex++,this.currentData.end=this.PageSize*this.PageIndex,$.ajax({url:this.ApiUrl,data:t.currentData,method:"POST",dataType:"json",success:function(e){t.RecvData(e)},fail:function(e){t.RecvError(e)}})):alert("数据已全部加载")},this.RecvData=function(t,e){var a=t.data;for(var t in a.stock){var e=a.stock[t],i=e.symbol,s={};this.Data.has(i)?s=this.Data.get(i):(s={Symbol:e.symbol,Name:e.name,Data:new Map},this.Data.set(i,s)),this.SetStockData(e,s)}this.Callback&&this.Callback(this,e)},this.SetStockData=function(t,e){for(var a in t.stockday){var i=t.stockday[a],s=i.date,n=new Map;this.SetFinanceData(i,n),this.SetBlocktradingData(i,n),this.SetChangesData(i,n),this.SetLiftingData(i,n),this.SetPforecastData(i,n),this.SetShortIndicatorsData(i,n),e.Data.set(s,n)}return e},this.SetFinanceData=function(t,e){var a,i;(a=t.finance1)&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_BENFORD,a.benford)),(i=t.announcement1)&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_QUARTER,i.quarter)),(a=t.finance2)&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_BENFORD,a.benford)),(i=t.announcement2)&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_QUARTER,i.quarter)),(a=t.finance3)&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_BENFORD,a.benford)),(i=t.announcement3)&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_QUARTER,i.quarter)),(a=t.finance4)&&(isNaN(a.nprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NPROFITINCREASE,a.nprofitincrease),isNaN(a.nnprofitincrease)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITINCREASE,a.nnprofitincrease),isNaN(a.nnprofitspeed)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITSPEED,a.nnprofitspeed),isNaN(a.benford)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_BENFORD,a.benford)),(i=t.announcement4)&&(isNaN(i.year)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_YEAR,i.year),isNaN(i.quarter)||e.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_QUARTER,i.quarter))},this.SetBlocktradingData=function(t,e){var a=t.blocktrading;a&&e.set(STOCK_HISTORY_FIELD_NAME.BLOCK_TRADING,{Premium:a.premium,Price:a.price,Vol:a.vol,Amount:a.amount})},this.SetChangesData=function(t,e){var a=t.changes;a&&e.set(STOCK_HISTORY_FIELD_NAME.HOLDERS_CHANGES,{List:a.list})},this.SetLiftingData=function(t,e){var a=t.lifting;a&&e.set(STOCK_HISTORY_FIELD_NAME.LIFTING,{Lifting:a})},this.SetPforecastData=function(t,e){var a=t.pforecast;a&&e.set(STOCK_HISTORY_FIELD_NAME.PFORECAST,{Lowprofit:a[0].lowprofit,Highprofit:a[0].highprofit,Lowchange:a[0].lowchange,Highchange:a[0].highchange,Reportdate:a[0].reportdate})},this.SetShortIndicatorsData=function(t,e){var a=t.policy;if(a){const t=["三只乌鸦","乌云盖顶","黄昏之星","巨量阴线","头肩顶","射击之星","倾盆大雨","断头铡刀","淡友反攻","空方炮","连续1周空头排列"];var i=0,s=[],n=0,o="";a.forEach(e=>{t.some(t=>t===e.name)&&(i++,s.push(e.time))}),i?(n=Math.max.apply(s,s),o=a.find(t=>t.time===n).name):o="",console.log(o,i,"latestName-targetedCount"),e.set(STOCK_HISTORY_FIELD_NAME.SHORTIND_ICATORS,{latestIndicatorName:o,indicatorCount:i})}},this.RecvError=function(t,e){},this.CreateCondition=function(t){return new QueryCondition(t)}}JSStock.Init=function(){return new JSStock},JSStock.SetDomain=function(t,e){t&&(g_JSStockResource.Domain=t),e&&(g_JSStockResource.CacheDomain=e)},JSStock.GetSearchStock=function(t){return new SearchStock(t)},JSStock.GetShortTerm=function(t){return new ShortTerm(t)},JSStock.GetDealDay=function(t){return new DealDay(t)},JSStock.GetBlockMember=function(t){return new BlockMember(t)},JSStock.GetBlockTop=function(){return new BlockTop},JSStock.GetMinuteImage=function(t){return new MinuteImage(t)},JSStock.GetHistoryDayData=function(t){return new HistoryDayData(t)},JSStock.GetDealPriceListData=function(t){return new DealPriceListData(t)},JSStock.GetLatestDetailData=function(t){return new LatestDetailData(t)},JSStock.GetAnalylisPlate=function(){return new AnalylisPlate},JSStock.GetStockHistory=function(){return new JSStockHistory};var RECV_DATA_TYPE={BASE_DATA:1,INDEX_BASE_DATA:2,HEAT_DATA:3,SORT_DATA:4,BUY_SELL_DATA:5,DEAL_DATA:6,DERIVATIVE_DATA:7,FINANCE_DATA:8,SEARCH_STOCK_DATA:9,SELF_STOCK_DATA:10,LOGON_DATA:11,BLOCK_MEMBER_DATA:13,SHORT_TERM_DATA:14,COMPANY_DATA:15,PLATE_DATA:16,CAPITAL_DATA:17,CAPITAL_FLOW_DAY_DATA:23,CAPITAL_FLOW_DAY3_DATA:24,CAPITAL_FLOW_DAY5_DATA:25,CAPITAL_FLOW_DAY10_DATA:26,DDE_DAY_DATA:27,DDE_DAY3_DATA:28,DDE_DAY5_DATA:29,DDE_DAY10_DATA:30,DEAL_DAY_DATA:105,EVENT_DATA:106,IMAGE_MINUTE_DATA:107,HISTORY_DAY_DATA:108,DEAL_PRICE_LIST_DATA:109,LATEST_DETAIL_DATA:110};function JSStock(){window.JSStock=this,this.MapStock=new Map,this.MapTagCallback=new Map,this.RequestVersion=new Array([100,100,100]),this.RealtimeApiUrl=g_JSStockResource.Domain+"/API/Stock",this.PlateQuadrantApiUrl=g_JSStockResource.Domain+"/API/StockPlateQuadrant",this.IsAutoUpdate=!0,this.AutoUpateTimeout=15e3,this.Timeout,this.NetworkFilter,this.Interval=null,this.GetStockRead=function(t,e){for(var a of this.MapStock)a[1].RemoveTagID(t);return this.MapTagCallback.set(t,e),new StockRead(this,t)},this.Unsubscribe=function(t){for(var e of this.MapStock)e[1].RemoveTagID(t)},this.UnsubscribeStock=function(t,e){for(var a of this.MapStock)if(a[0]===t){e?a[1].RemoveTagID(e):a[1].ClearTagID(),console.log(`[JSStock::UnsubscribeStock] symbol=${t}, tagID=${e}`);break}},this.Get=function(t,e){this.MapStock.has(t)||this.MapStock.set(t,new StockData(t));var a=this.MapStock.get(t);return e&&a.AttachTagID(e),a},this.RequestData=function(){this.ClearTimer();var t=new Array,e=new Array,a=new Array,i=new Array,s=new Array,n=new Array,o=new Array,r=[],D=[],h=[],l=[],c=[],A=[],E=[],u=[],T=new Array,_=new Array,S=new Array,I=new Array;for(var C of this.MapStock){var p=C[1],N=C[0];p.BaseDataTagID.size>0&&(IsIndexSymbol(N)?e.push(N):t.push(N)),p.BuySellTagID.size>0&&i.push(N),p.CapitalFlowDayID.size>0&&r.push(N),p.CapitalFlowDay3ID.size>0&&D.push(N),p.CapitalFlowDay5ID.size>0&&h.push(N),p.CapitalFlowDay10ID.size>0&&l.push(N),p.DDEID.size>0&&c.push(N),p.DDE3ID.size>0&&A.push(N),p.DDE5ID.size>0&&E.push(N),p.DDE10ID.size>0&&u.push(N),p.HeatTagID.size>0&&a.push(N),p.DealTagID.size>0&&s.push(N),p.DerivativeTagID.size>0&&n.push(N),p.FinanceTagID.size>0&&o.push(N),p.CapitalTagID.size>0&&I.push(N),null==p.Event&&p.EventTagID.size>0&&T.push(N),null==p.Company&&p.CompanyTagID.size>0&&_.push(N),null==C[1].Plate&&C[1].PlateTagID.size>0&&S.push(C[0])}getalldata(),i.length>0&&this.RequestBuySellData(i),t.length>0&&this.RequestBaseData(t),e.length>0&&this.RequestIndexBaseData(e),a.length>0&&this.RequestIndexHeatData(a),s.length>0&&this.RequestDealData(s),n.length>0&&this.RequestDerivativeData(n),o.length>0&&this.RequestFinanceData(o),I.length>0&&this.RequestCapitalData(I),r.length>0&&this.RequestSubDocumentData(r,"flowday"),D.length>0&&this.RequestSubDocumentData(D,"flowday3"),h.length>0&&this.RequestSubDocumentData(h,"flowday5"),l.length>0&&this.RequestSubDocumentData(l,"flowday10"),c.length>0&&this.RequestSubDocumentData(c,"dde"),A.length>0&&this.RequestSubDocumentData(A,"dde3"),E.length>0&&this.RequestSubDocumentData(E,"dde5"),u.length>0&&this.RequestSubDocumentData(u,"dde10"),T.length>0&&this.RequestEventData(T),_.length>0&&this.RequestCompanyData(_),S.length>0&&this.RequestPlateData(S),this.ReqeustAllSortData()},this.ReqeustData=this.RequestData,this.RequestBaseData=function(t){var e=this,a=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate","amplitude","volratio"];if(this.NetworkFilter){var i={Name:"JSStock::RequestBaseData",Explain:"股票基础数据",ID:RECV_DATA_TYPE.BASE_DATA,Request:{Url:ChartApiBase,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,function(t){e.RecvData(t,RECV_DATA_TYPE.BASE_DATA)}),1==i.PreventDefault)return}$.ajax({url:ChartApiBase,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,RECV_DATA_TYPE.BASE_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.BASE_DATA)}})},this.RequestDerivativeData=function(t){var e=this,a=["name","symbol","marketvalue","flowmarketvalue","pe","pe2","pe3","pb","bookrate","bookdiffer"];if(this.NetworkFilter){var i={Name:"JSStock::RequestDerivativeData",Explain:"实时衍生数据",ID:RECV_DATA_TYPE.DERIVATIVE_DATA,Request:{Url:ChartApiDerivative,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,function(t){e.RecvData(t,RECV_DATA_TYPE.DERIVATIVE_DATA)}),1==i.PreventDefault)return}$.ajax({url:ChartApiDerivative,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,RECV_DATA_TYPE.DERIVATIVE_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.DERIVATIVE_DATA)}})},this.RequestFinanceData=function(t){var e=this,a=["name","symbol","roe","finance"];if(this.NetworkFilter){var i={Name:"JSStock::RequestFinanceData",Explain:"财务数据",ID:RECV_DATA_TYPE.FINANCE_DATA,Request:{Url:ChartApiFinance,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,function(t){e.RecvData(t,RECV_DATA_TYPE.FINANCE_DATA)}),1==i.PreventDefault)return}$.ajax({url:ChartApiFinance,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,RECV_DATA_TYPE.FINANCE_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.FINANCE_DATA)}})},this.RequestCapitalData=function(t){var e=this,a=["name","symbol","capital"];if(this.NetworkFilter){var i={Name:"JSStock::RequestCapitalData",Explain:"股本数据",ID:RECV_DATA_TYPE.CAPITAL_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,function(t){e.RecvData(t,RECV_DATA_TYPE.CAPITAL_DATA)}),1==i.PreventDefault)return}$.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,RECV_DATA_TYPE.CAPITAL_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.CAPITAL_DATA)}})},this.RequestBuySellData=function(t,e){if(e){console.log("------------------------------------JSStock::RequestBuySellData---------买卖盘数据"),this.RecvData(e,RECV_DATA_TYPE.BUY_SELL_DATA)}},this.RequestDealData=function(t,e){if(e){console.log("------------------------------------JSStock::RequestDealData----------分笔数据"),this.RecvData(e,RECV_DATA_TYPE.DEAL_DATA)}},this.RequestIndexBaseData=function(t){var e=this,a=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","indextop","increase"];if(this.NetworkFilter){var i={Name:"JSStock::RequestIndexBaseData",Explain:"指数基础数据(包含上涨下跌家数)",ID:RECV_DATA_TYPE.INDEX_BASE_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:a,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(i,function(t){e.RecvData(t,RECV_DATA_TYPE.INDEX_BASE_DATA)}),1==i.PreventDefault)return}$.ajax({url:this.RealtimeApiUrl,data:{field:a,symbol:t},type:"post",dataType:"json",async:!0,success:function(t){console.log(t),e.RecvData(t,RECV_DATA_TYPE.INDEX_BASE_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.INDEX_BASE_DATA)}})},this.RequestIndexHeatData=function(t){var e=this;$.ajax({url:this.PlateQuadrantApiUrl,data:{plate:t},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,RECV_DATA_TYPE.HEAT_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.HEAT_DATA)}})},this.ReqeustAllSortData=function(){var t=new Array;for(var e of this.MapStock)if(IsIndexSymbol(e[0])&&!(null==e[1].Sort||e[1].Sort.size<=0))for(var a of e[1].Sort){var i=a[1],s={Plate:e[0],SortField:i.SortField,Order:i.Order,TagID:i.TagID};t.push(s)}for(var n in t){a=t[n];this.ReqeustSortData(a)}},this.ReqeustSortData=function(t){var e=this,a=t,i="";switch(a.SortField){case STOCK_FIELD_NAME.INCREASE:i="increase";break;case STOCK_FIELD_NAME.PRICE:i="price";break;default:return}var s=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate"];if(this.NetworkFilter){var n={Name:"JSStock::ReqeustSortData",Explain:"板块排序数据",ID:RECV_DATA_TYPE.SORT_DATA,Request:{Url:e.RealtimeApiUrl,Data:{field:s,plate:[t.Plate],orderfield:i,order:t.Order,ordernull:1,filterstop:1},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,function(t){e.RecvData(t,RECV_DATA_TYPE.SORT_DATA,a)}),1==n.PreventDefault)return}$.ajax({url:this.RealtimeApiUrl,data:{field:s,plate:[t.Plate],orderfield:i,order:t.Order,ordernull:1,filterstop:1},type:"post",dataType:"json",async:!0,success:function(t){e.RecvData(t,RECV_DATA_TYPE.SORT_DATA,a)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.SORT_DATA,a)}})},this.RequestSubDocumentData=function(t,e){var a=this;const i=new Map([["flowday",{Field:"flowday",RecvID:RECV_DATA_TYPE.CAPITAL_FLOW_DAY_DATA}],["flowday3",{Field:"flowday3",RecvID:RECV_DATA_TYPE.CAPITAL_FLOW_DAY3_DATA}],["flowday5",{Field:"flowday5",RecvID:RECV_DATA_TYPE.CAPITAL_FLOW_DAY5_DATA}],["flowday10",{Field:"flowday10",RecvID:RECV_DATA_TYPE.CAPITAL_FLOW_DAY10_DATA}],["dde",{Field:"dde",RecvID:RECV_DATA_TYPE.DDE_DAY_DATA}],["dde3",{Field:"dde3",RecvID:RECV_DATA_TYPE.DDE_DAY3_DATA}],["dde5",{Field:"dde5",RecvID:RECV_DATA_TYPE.DDE_DAY5_DATA}],["dde10",{Field:"dde10",RecvID:RECV_DATA_TYPE.DDE_DAY10_DATA}]]);if(i.has(e)){var s=i.get(e);if(this.NetworkFilter){var n={Name:"JSStock::RequestSubDocumentData",Explain:"子文档数据",ID:s.RecvID,Request:{Url:a.RealtimeApiUrl,Data:{field:["symbol",s.Field],symbol:t,start:0,end:50},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,function(t){a.RecvData(t,s.RecvID)}),1==n.PreventDefault)return}$.ajax({url:this.RealtimeApiUrl,data:{field:["symbol",s.Field],symbol:t,start:0,end:50},type:"post",dataType:"json",success:function(t){a.RecvData(t,s.RecvID)},error:function(t){a.RecvError(t,s.RecvID)}})}},this.RequestEventData=function(t){var e=this;$.ajax({url:this.RealtimeApiUrl,data:{field:["symbol","events.margin","events.shhk","events.hk","events.st","events.hksymbol","events.hkname","events.szhk"],symbol:t,start:0,end:50},type:"POST",dataType:"json",success:function(t){e.RecvData(t,RECV_DATA_TYPE.EVENT_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.EVENT_DATA)}})},this.RequestCompanyData=function(t){var e=this;$.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","company"],symbol:t,start:0,end:50},type:"POST",dataType:"json",success:function(t){e.RecvData(t,RECV_DATA_TYPE.COMPANY_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.COMPANY_DATA)}})},this.RequestPlateData=function(t){var e=this;$.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","industry","region","concept"],symbol:t,start:0,end:50},type:"POST",dataType:"json",success:function(t){e.RecvData(t,RECV_DATA_TYPE.PLATE_DATA)},error:function(t){e.RecvError(t,RECV_DATA_TYPE.PLATE_DATA)}})},this.RecvError=function(t,e,a){console.log("RecvError: datatype="+e.toString()),console.log(t);var i=this;this.Timeout&&clearTimeout(this.Timeout),this.Timeout=setTimeout(function(){i.ReqeustData()},2*this.AutoUpateTimeout)},this.RecvData=function(t,e,a){var i;switch(e){case RECV_DATA_TYPE.BASE_DATA:case RECV_DATA_TYPE.INDEX_BASE_DATA:i=this.RecvBaseData(t,e);break;case RECV_DATA_TYPE.HEAT_DATA:i=this.RecvHeatData(t,e);break;case RECV_DATA_TYPE.SORT_DATA:i=this.RecvSortData(t,e,a);break;case RECV_DATA_TYPE.BUY_SELL_DATA:i=this.RecvBuySellData(t,e);break;case RECV_DATA_TYPE.DEAL_DATA:i=this.RecvDealData(t,e);break;case RECV_DATA_TYPE.DERIVATIVE_DATA:i=this.RecvDerivativeData(t,e);break;case RECV_DATA_TYPE.FINANCE_DATA:i=this.RecvFinanceData(t,e);break;case RECV_DATA_TYPE.CAPITAL_DATA:i=this.RecvCapitalData(t,e);break;case RECV_DATA_TYPE.CAPITAL_FLOW_DAY_DATA:case RECV_DATA_TYPE.CAPITAL_FLOW_DAY3_DATA:case RECV_DATA_TYPE.CAPITAL_FLOW_DAY5_DATA:case RECV_DATA_TYPE.CAPITAL_FLOW_DAY10_DATA:case RECV_DATA_TYPE.DDE_DAY_DATA:case RECV_DATA_TYPE.DDE_DAY3_DATA:case RECV_DATA_TYPE.DDE_DAY5_DATA:case RECV_DATA_TYPE.DDE_DAY10_DATA:i=this.RecvSubDocumentData(t,e);break;case RECV_DATA_TYPE.EVENT_DATA:i=this.RecvEventData(t,e);break;case RECV_DATA_TYPE.COMPANY_DATA:i=this.RecvCompanyData(t,e);break;case RECV_DATA_TYPE.PLATE_DATA:i=this.RecvPlateData(t,e)}for(var s of i)this.MapTagCallback.has(s[0])&&this.MapTagCallback.get(s[0])(s[0],s[1],e,this);this.AutoUpdate()},this.ClearTimer=function(){this.Timeout&&(clearTimeout(this.Timeout),this.Timeout=null)},this.AutoUpdate=function(){if(this.ClearTimer(),this.IsAutoUpdate){var t=0;this.Interval||(this.Interval=setInterval(function(){if(window.chartdata){(t+=100)>=2e3&&(t=0,getalldata()),"on"==localStorage.buysell?$("#rightMinute2").show():$("#rightMinute2").hide();var e=localStorage.chartcontrol,a="00"==chartdata.viewperiod?chartdata.Mchart:chartdata.Kchart;switch(localStorage.chartcontrol="",e){case"zoomup":zoomup(a);break;case"zoomdown":zoomdown(a);break;case"panleft":pan(a,!1);break;case"panright":pan(a,!0);break;case"pantoend":pan(a,!0,!0)}}},100))}},this.RecvBaseData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n){switch(e){case RECV_DATA_TYPE.BASE_DATA:n.SetBaseData(s);break;case RECV_DATA_TYPE.INDEX_BASE_DATA:n.SetIndexBaseData(s);break;default:continue}if(n.TagID.size>0)for(var o of n.TagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}}return a},this.RecvBuySellData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n){if(n.SetBuySellData(s),n.TagID.size>0)for(var o of n.TagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol));if(n.BuySellTagID.size>0)for(var o of n.BuySellTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}}return a},this.RecvDerivativeData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetDerivativeData(s),n.DerivativeTagID.size>0))for(var o of n.DerivativeTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a},this.RecvFinanceData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetFinanceData(s),n.FinanceTagID.size>0))for(var o of n.FinanceTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a},this.RecvCapitalData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetCapitalData(s),n.CapitalTagID.size>0))for(var o of n.CapitalTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a},this.RecvDealData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetDealData(s),n.DealTagID.size>0))for(var o of n.DealTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a},this.RecvHeatData=function(t,e){var a=new Map;for(var i in t.data){var s=t.data[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetHeatData(s),n.HeatTagID.size>0))for(var o of n.HeatTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a},this.RecvSortData=function(t,e,a){var i=new Map,s=new Array,n=this.MapStock.get(a.Plate);for(var o in t.stock){var r,D=t.stock[o];if(s.push(D.symbol),this.MapStock.has(D.symbol))(r=this.MapStock.get(D.symbol)).SetBaseData(D);else(r=new StockData(D.symbol)).SetBaseData(D),this.MapStock.set(D.symbol,r)}var h=a.SortField.toString()+"-"+a.Order.toString();if(!n.Sort.has(h))return i;var l=n.Sort.get(h);for(var D of(l.arySymbol=s,a.TagID))i.set(D,new Array([n.Symbol]));return i},this.RecvSubDocumentData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n){var o=null;switch(e){case RECV_DATA_TYPE.CAPITAL_FLOW_DAY_DATA:n.SetCapitalFlowDayData(s.flowday,e),o=n.CapitalFlowDayID;break;case RECV_DATA_TYPE.CAPITAL_FLOW_DAY3_DATA:n.SetCapitalFlowDayData(s.flowday3,e),o=n.CapitalFlowDay3ID;break;case RECV_DATA_TYPE.CAPITAL_FLOW_DAY5_DATA:n.SetCapitalFlowDayData(s.flowday5,e),o=n.CapitalFlowDay5ID;break;case RECV_DATA_TYPE.CAPITAL_FLOW_DAY10_DATA:n.SetCapitalFlowDayData(s.flowday10,e),o=n.CapitalFlowDay10ID;break;case RECV_DATA_TYPE.DDE_DAY_DATA:n.SetDDE(s.dde,e),o=n.DDEID;break;case RECV_DATA_TYPE.DDE_DAY3_DATA:n.SetDDE(s.dde3,e),o=n.DDE3ID;break;case RECV_DATA_TYPE.DDE_DAY5_DATA:n.SetDDE(s.dde5,e),o=n.DDE5ID;break;case RECV_DATA_TYPE.DDE_DAY10_DATA:n.SetDDE(s.dde10,e),o=n.DDE10ID}if(o&&o.size>0)for(var r of o)a.has(r)?a.get(r).push(n.Symbol):a.set(r,new Array(n.Symbol))}}return a},this.RecvEventData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetEventData(s),n.EventTagID.size>0))for(var o of n.EventTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a},this.RecvCompanyData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetCompanyData(s),n.CompanyTagID.size>0))for(var o of n.CompanyTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a},this.RecvPlateData=function(t,e){var a=new Map;for(var i in t.stock){var s=t.stock[i],n=this.MapStock.get(s.symbol);if(n&&(n.SetPlateData(s),n.PlateTagID.size>0))for(var o of n.PlateTagID)a.has(o)?a.get(o).push(n.Symbol):a.set(o,new Array(n.Symbol))}return a}}function SearchStock(t){this.SearchStockApiUrl=g_JSStockResource.Domain+"/API/StockSpell",this.UpdateUICallback=t,this.PageSize=50,this.Count,this.EndOffset,this.Data=new Array,this.SearchString="",this.SearchType=0,this.Search=function(t,e){if(this.SearchString==t&&this.SearchType==e)"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this);else{this.SearchString=t,this.SearchType=e,this.Count=0,this.EndOffset=0,this.Data=[];var a=this.PageSize-1;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,a)}},this.IsEndPage=function(){return this.Count<=0||this.EndOffset>this.Count-1},this.NextPage=function(){if(!(this.EndOffset+1>this.Count)){var t=this.EndOffset+this.PageSize;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,t)}},this.ReqeustSearchStock=function(t,e,a,i){var s=this;$.ajax({url:this.SearchStockApiUrl,data:{input:t,start:a,end:i,type:e},type:"post",dataType:"json",async:!0,success:function(t){s.RecvSearchStockData(t,RECV_DATA_TYPE.SEARCH_STOCK_DATA)},error:function(t){s.RecvError(t,RECV_DATA_TYPE.SEARCH_STOCK_DATA)}})},this.RecvSearchStockData=function(t){for(var e in t.stock){var a=t.stock[e];this.Data.push({Name:a.name,Symbol:a.symbol,Type:a.type})}0==t.count?(this.Count=0,this.EndOffset=0):(0==this.Count&&(this.Count=t.count),this.EndOffset=t.end,this.Count>0&&this.EndOffset>this.Count&&(this.EndOffset=this.Count-1)),"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this)},this.RecvError=function(t,e){console.log("[SearchStock::RecvError] datatype="+e.toString()),console.log(t),"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this,"error")}}function IStockData(){this.IsAutoUpdate=!0,this.AutoUpateTimeout=5e3,this.Timeout,this.ApiUrl,this.Data,this.Error,this.UpdateUICallback,this.RequestData=function(){},this.Stop=function(){this.IsAutoUpdate=!1,this.Timeout&&clearTimeout(this.Timeout)},this.AutoUpate=function(){if(this.Timeout&&clearTimeout(this.Timeout),this.IsAutoUpdate&&(this.Timeout&&clearTimeout(this.Timeout),this.IsAutoUpdate)){var t=this;if(this.Symbol){var e=STOCK_MARKET.GetMarketStatus(this.Symbol);2==e?this.Timeout=setTimeout(function(){t.RequestData()},this.AutoUpateTimeout):1==e&&(this.Timeout=setTimeout(function(){t.AutoUpdate()},this.AutoUpateTimeout))}else{t=this;var e=new Date;e.getHours(),e.getMinutes();this.Timeout=setTimeout(function(){t.RequestData()},this.AutoUpateTimeout)}}},this.InvokeUpdateUICallback=function(){this.UpdateUICallback&&this.UpdateUICallback(this)}}function ShortTerm(t){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.Symbol=t,this.ApiUrl=g_JSStockResource.Domain+"/API/StockShortTerm",this.Count=20,this.RequestData=function(){var t=this;var e={count:this.Count};this.Symbol&&(e.symbol=this.Symbol),$.ajax({url:this.ApiUrl,data:e,type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e,RECV_DATA_TYPE.SHORT_TERM_DATA)},fail:function(e){t.RecvError(e,RECV_DATA_TYPE.SHORT_TERM_DATA)}})},this.RecvData=function(t,e){this.Data=[];for(var e in t.shortterm){var a=t.shortterm[e];this.Data.push({Date:a.date,Name:a.name,Symbol:a.symbol,Time:a.time,Content:a.content,TypeInfo:a.typeinfo,Type:a.type})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(t,e){}}function DealDay(t){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.Symbol=t,this.Date,this.RequestData=function(){this.Data=null,this.Error=null;var t=this,e=g_JSStockResource.CacheDomain+"/cache/dealday/day/"+this.Date+"/"+this.Symbol+".json";console.log("[DealDay::RequestData] cache url ",e),$.ajax({url:e,type:"get",dataType:"json",async:!0,success:function(e){t.RecvData(e,RECV_DATA_TYPE.DEAL_DAY_DATA)},error:function(e){t.RecvError(e,RECV_DATA_TYPE.DEAL_DAY_DATA)}})},this.RecvData=function(t,e){if(t.day&&t.deal){var a=t.deal.amount,i=t.deal.price,s=t.deal.time,n=t.deal.vol,o=t.deal.flag;if(o&&n&&s&&i&&a){var r={Date:t.date,Open:t.day.open,Close:t.day.price,YClose:t.day.yclose,Symbol:t.symbol,Name:t.name,Deal:[],PriceList:[]},D=new Map,h=0,l=Math.min(s.length,n.length,o.length,i.length,a.length);for(var t=0;t<l;++t){var e={Time:s[t],Vol:n[t],Flag:"",Price:i[t],Amount:a[t]};var c;0===o[t]?e.Flag="B":1===o[t]&&(e.Flag="S"),e.Time>15e4&&(e.Time=15e4),r.Deal.push(e),D.has(e.Price)?(c=D.get(e.Price)).Vol+=e.Vol:(c={Vol:e.Vol,Price:e.Price,BuyVol:0,SellVol:0,NoneVol:0},D.set(e.Price,c)),0===o[t]?c.BuyVol+=e.Vol:1===o[t]?c.SellVol+=e.Vol:c.NoneVol+=e.Vol,h+=e.Vol}for(var A of D){var E=A[1];h>0&&(E.Proportion=E.Vol/h),r.PriceList.push(E)}r.PriceList.sort(function(t,e){return e.Price-t.Price}),this.Data=r,this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()},this.RecvError=function(t,e){console.log(`[DealDay::RecvError] status=${t.status} statusText=${t.statusText} responseText=${t.responseText}`),this.Error={Status:t.status,Message:t.responseText},this.InvokeUpdateUICallback()}}function BlockMember(t){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.ApiUrl=g_JSStockResource.Domain+"/API/StockBlockMember",this.PageSize=10,this.Start=0,this.OrderField,this.Order,this.Symbol=t,this.OrderNull=0,this.Field=new Array,this.Data=new Array,this.PageInfo,this.SetField=function(t){this.Field=new Array;for(var e in t){var a=t[e],i=StockDataFieldName.GetFieldName(a);null!=i&&this.Field.push(i)}return this.Field.length>0},this.SetOrder=function(t,e){this.Order=null,this.OrderField=null;var a=StockDataFieldName.GetFieldName(t);return null!=a&&(this.OrderField=a,this.Order=e,!0)},this.RequestData=function(){this.Data=[];var t=this;$.ajax({url:this.ApiUrl,data:{symbol:this.Symbol,field:this.Field,order:this.Order,orderfield:this.OrderField,start:this.Start,end:this.Start+this.PageSize,ordernull:this.OrderNull},type:"post",dataType:"json",success:function(e){t.RecvData(e,RECV_DATA_TYPE.BLOCK_MEMBER_DATA)},error:function(e){t.RecvError(e,RECV_DATA_TYPE.BLOCK_MEMBER_DATA)}})},this.RecvData=function(t,e){for(var e in t.stock){var i=t.stock[e];if(null!=i.symbol){var a=new StockData(i.symbol);a.SetData(i),this.Data.push(a)}}this.PageInfo={Count:t.count,Start:t.start,End:t.end},"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(t,e){}}function BlockTop(){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.BlockType=1,this.Count=20,this.OrderField="increase",this.Order=-1,this.Field=["symbol","price","name","vol","increase","indextop","risefall"],this.ApiUrl=g_JSStockResource.Domain+"/API/StockBlockTop",this.SetField=function(t){},this.ReqeustData=function(){var t=this;$.ajax({url:this.ApiUrl,data:{blocktype:this.BlockType,start:0,end:this.Count,field:this.Field,orderfield:this.OrderField,order:this.Order},type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e,RECV_DATA_TYPE.BLOCK_TOP_DATA)},fail:function(e){t.RecvError(e,RECV_DATA_TYPE.BLOCK_TOP_DATA)}})},this.RecvData=function(t,e){var a=t;this.Data=[],this.resCount=a.count;for(var t in a.stock){var e=a.stock[t];if(null!=e.indextop)var i={Down:e.indextop.down,Stop:e.indextop.stop,Up:e.indextop.up,Unchanged:e.indextop.unchanged,DownStock:{Name:e.indextop.downstock.name,Symbol:e.indextop.downstock.symbol},UpStock:{Name:e.indextop.upstock.name,Symbol:e.indextop.upstock.symbol}};this.Data.push({Name:e.name,Symbol:e.symbol,Increase:e.increase,Risefall:e.risefall,IndexTop:i})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(t,e){}}function MinuteImage(t){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.ApiUrl=g_JSStockResource.Domain+"/API/StockMinuteImage",this.Symbol=[t],this.Data=[],this.RequestData=function(){this.Data=[];var t=this;$.ajax({url:this.ApiUrl,data:{symbol:this.Symbol},type:"post",dataType:"json",success:function(e){t.RecvData(e,RECV_DATA_TYPE.IMAGE_MINUTE_DATA)},error:function(e){t.RecvError(e,RECV_DATA_TYPE.IMAGE_MINUTE_DATA)}})},this.RecvData=function(t,e){for(var e in t.symbol){var a={Symbol:t.symbol[e],Image:t.imagerelative[e]};this.Data.push(a)}"function"==typeof this.UpdateUICallback&&this.UpdateUICallback(this)},this.RecvError=function(t,e){}}function HistoryDayData(t){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.Symbol=t,this.RequestData=function(){this.Data=null,this.Error=null;var t=this,e=g_JSStockResource.CacheDomain+"/cache/historyday/all/"+this.Symbol+".json";console.log("[HistoryDayData::RequestData] cache url ",e),$.ajax({url:e,type:"get",dataType:"json",async:!0,success:function(e){t.RecvData(e,RECV_DATA_TYPE.HISTORY_DAY_DATA)},error:function(e){t.RecvError(e,RECV_DATA_TYPE.HISTORY_DAY_DATA)}})},this.RecvData=function(t,e){if(t.symbol&&t.name){var a=t.amount,i=t.close,s=t.date,n=t.high,o=t.low,r=t.open,D=t.vol,h=t.yclose;if(a&&i&&s&&n&&o&&r&&D&&h){var l={UpdateDate:t.update,Symbol:t.symbol,Name:t.name,KLine:[]};for(var t=0;t<s.length;++t){var e={Date:s[t],YClose:h[t],Open:r[t],High:n[t],Low:o[t],Close:i[t],Vol:D[t],Amount:a[t]};l.KLine.push(e)}this.Data=l,this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()},this.RecvError=function(t,e){console.log(`[HistoryDayData::RecvError] status=${t.status} statusText=${t.statusText} responseText=${t.responseText}`),this.Error={Status:t.status,Message:t.responseText},this.InvokeUpdateUICallback()},this.GetWeekData=function(){return this.Data&&this.Data.KLine?this.GetDayPeriodData(1):[]},this.GetMonthData=function(){return this.Data&&this.Data.KLine?this.GetDayPeriodData(2):[]},this.GetDayPeriodData=function(t){var e=new Array,a=0,i=null;for(var s in this.Data.KLine){var n=!1,o=this.Data.KLine[s];switch(t){case 1:var r=this.GetFirday(o.Date);r!=a&&(n=!0,a=r);break;case 2:parseInt(o.Date/100)!=parseInt(a/100)&&(n=!0,a=o.Date);break;case 3:parseInt(o.Date/1e4)!=parseInt(a/1e4)&&(n=!0,a=o.Date)}if(n){if((i={}).Date=o.Date,e.push(i),null==o.Open||null==o.Close)continue;i.Open=o.Open,i.High=o.High,i.Low=o.Low,i.YClose=o.YClose,i.Close=o.Close,i.Vol=o.Vol,i.Amount=o.Amount}else{if(null==i)continue;if(null==o.Open||null==o.Close)continue;null==i.Open||null==i.Close?(i.Open=o.Open,i.High=o.High,i.Low=o.Low,i.YClose=o.YClose,i.Close=o.Close,i.Vol=o.Vol,i.Amount=o.Amount):(i.High<o.High&&(i.High=o.High),i.Low>o.Low&&(i.Low=o.Low),i.Close=o.Close,i.Vol+=o.Vol,i.Amount+=o.Amount,i.Date=o.Date)}}return e},this.GetFirday=function(t){var e=new Date(parseInt(t/1e4),t/100%100-1,t%100),a=e.getDay();if(5==a)return t;var i=e.getTime();a<5?i+=864e5*(5-a):i-=864e5*(a-5);e.setTime(i);var s=1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate();e.getDay();return s}}function DealPriceListData(t){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.Symbol=t,this.ApiUrl=g_JSStockResource.Domain+"/API/StockPriceList",this.RequestData=function(){if(this.Symbol){var t=this,e={};Array.isArray(this.Symbol)?e.Symbol=this.Symbol:e.Symbol=[this.Symbol],$.ajax({url:this.ApiUrl,data:e,type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e,RECV_DATA_TYPE.DEAL_PRICE_LIST_DATA)},fail:function(e){t.RecvError(e,RECV_DATA_TYPE.DEAL_PRICE_LIST_DATA)}})}},this.RecvData=function(t,e){if(this.Data=null,!(t.statistics.length<=0)){this.Data={Day:{},PriceList:[]};var a=t.data[0];this.Data.Day={Date:a.date,YClose:a.yclose,Price:a.price,Vol:a.vol,Time:a.time},this.Data.Stock={Symbol:a.symbol,Name:a.name};var i=t.statistics[0];for(var s in i.list){var n=i.list[s],o={Price:n[0],Vol:n[1],BuyVol:n[2],SellVol:n[3],NoneVol:n[4]};a.vol>0&&(o.Proportion=o.Vol/a.vol),this.Data.PriceList.push(o)}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()}},this.RecvError=function(t,e){}}function LatestDetailData(t){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.IsAutoUpdate=!1,this.Symbol=t,this.PageSize=20,this.Request=function(t,e){this.Error=null;var a=this,i=t*e,s=i+e,n=g_JSStockResource.Domain+"/API/StockDetail";console.log(`[LatestDetailData::RequestData] url=${n}, start=${i} , end=${s}`),$.ajax({url:n,data:{symbol:this.Symbol,start:i,end:s},type:"post",dataType:"json",async:!0,success:function(t){a.RecvData(t,RECV_DATA_TYPE.LATEST_DETAIL_DATA)},error:function(t){a.RecvError(t,RECV_DATA_TYPE.LATEST_DETAIL_DATA)}})},this.RequestData=function(){this.Data={Deal:[],Count:0,Reqeust:{PageIndex:0},Response:{}},this.Request(0,this.PageSize)},this.RequestPage=function(t){this.Data||(this.Data={Deal:[],Count:0}),this.Data.Reqeust={PageIndex:t},this.Data.Response={};for(var e=t*this.PageSize,a=e+this.PageSize,i=!0,s=e;s<a;++s)if(!this.Data.Deal[s]){i=!1;break}i?(this.Data.Response={Start:e,End:a},this.InvokeUpdateUICallback()):this.Request(t,this.PageSize)},this.RecvData=function(t,e){if(this.Data.Count=t.count,t.detail){this.Data.Day={YClose:t.yclose,Open:t.open,Close:t.price,Date:t.date},this.Data.Stock={Symbol:t.symbol,Name:t.name};for(var a=0,i=t.start;a<t.detail.length;++a,++i){var s=t.detail[a],n={Time:s[0],Price:s[1],Vol:s[2],Amount:s[3],Flag:""};0===s[4]?n.Flag="B":1===s[4]&&(n.Flag="S"),this.Data.Deal[i]=n}this.Data.Response={Start:t.start,End:t.end},this.InvokeUpdateUICallback()}else this.InvokeUpdateUICallback()},this.RecvError=function(t,e){console.log(`[LatestDetailData::RecvError] status=${t.status} statusText=${t.statusText} responseText=${t.responseText}`),this.Error={Status:t.status,Message:t.responseText},this.InvokeUpdateUICallback()}}function AnalylisPlate(){this.newMethod=IStockData,this.newMethod(),delete this.newMethod,this.ApiUrl=g_JSStockResource.Domain+"/api/StockListAnalyze",this.PolicyGuid,this.Plate="",this.SymbolList=[],this.RequestData=function(){var t=this;$.ajax({url:t.ApiUrl,data:{PolicyGuid:t.PolicyGuid,Plate:t.Plate,Symbol:t.SymbolList},type:"post",dataType:"json",async:!0,success:function(e){t.RecvData(e)},error:function(e){t.RecvError(e)}})},this.RecvData=function(t){this.Data={};var e=t;if(0!=e.count){if(e.concept){var a=[];for(var i in e.concept.data){var s=e.concept.data[i],n={};n.Name=s[0],n.Symbol=s[1],n.Ratio=s[2],n.Count=s[3],n.Increase=s[4],n.Price=s[5],n.Week1=s[6],n.Week4=s[7],a.push(n)}this.Data.Concept=a}e.distributed&&(this.Data.Distributed=e.distributed),e.industry&&(this.Data.Industry=e.industry),e.quadrant&&(this.Data.Quadrant=e.quadrant),e.region&&(this.Data.Region=e.region),this.UpdateUICallback&&this.UpdateUICallback(this)}},this.RecvError=function(t){console.log(t)}}var STOCK_MARKET={SH:".SH",SZ:".SZ",HK:".HK",SHFE:".SHF",CFFEX:".CFE",DCE:".DCE",CZCE:".CZC",USA:".USA",IsUSA:function(t){return!!t&&t.indexOf(this.USA)>0},IsSH:function(t){var e=t.length-this.SH.length;return t.indexOf(this.SH)==e},IsSZ:function(t){var e=t.length-this.SZ.length;return t.indexOf(this.SZ)==e},IsHK:function(t){var e=t.length-this.HK.length;return t.indexOf(this.HK)==e},IsSHFE:function(t){return t.indexOf(this.SHFE)>0},IsCFFEX:function(t){return t.indexOf(this.CFFEX)>0},IsDCE:function(t){return t.indexOf(this.DCE)>0},IsCZCE:function(t){return t.indexOf(this.CZCE)>0},IsChinaFutures:function(t){return this.IsCFFEX(t)||this.IsCZCE(t)||this.IsDCE(t)||this.IsSHFE(t)},IsSHSZ:function(t){return this.IsSZ(t)||this.IsSH(t)},IsSHSZFund:function(t){if(!t)return!1;if(this.IsSH(t)){if("5"==t.charAt(0)&&"1"==t.charAt(1))return!0}else if(this.IsSZ(t)&&"1"==t.charAt(0)&&("5"==t.charAt(1)||"6"==t.charAt(1)||"7"==t.charAt(1)||"8"==t.charAt(1)))return!0;return!1},IsSHSZIndex:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){var a=e.replace(".SH","");if("0"==e.charAt(0)&&parseInt(a)<=3e3)return!0}else if(this.IsSZ(e)){if("3"==e.charAt(0)&&"9"==e.charAt(1))return!0}else if(e.indexOf(".CI")>0)return!0;return!1},IsSHSZStockA:function(t){if(!t)return!1;var e=t.toUpperCase();if(this.IsSH(e)){e.replace(".SH","");if("6"==e.charAt(0))return!0}else if(this.IsSZ(e)&&"0"==e.charAt(0)){if("0"==e.charAt(1)&&"2"==e.charAt(1))return!0;if("7"!=e.charAt(1)&&"8"!=e.charAt(1))return!0}return!1},IsSHStockSTAR:function(t){if(!t)return!1;var e=t.toUpperCase();return!!this.IsSH(e)&&("6"==e.charAt(0)&&"8"==e.charAt(1)&&"8"==e.charAt(2))},GetMarketStatus:function(t){if(!t)return 0;var e=t.toUpperCase();if(this.IsUSA(e)){var a=GetLocalTime(-4);return s=a.getDay(),n=100*a.getHours()+a.getMinutes(),6==s||0==s?0:n>1730?3:n<930?1:2}var i=new Date,s=i.getDay(),n=100*i.getHours()+i.getMinutes();return 6==s||0==s?0:n>1540?3:n<925?1:2}};';eval(_code);